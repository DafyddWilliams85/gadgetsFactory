[{"id":"a2b40f09.d18fd8","type":"tab","label":"SystemFlows / cron jobs","disabled":false,"info":""},{"id":"508957a1.dd5398","type":"tab","label":"Local app API","disabled":true,"info":""},{"id":"22428f45.8ab","type":"tab","label":"API","disabled":false,"info":""},{"id":"aec22158.fe4e38","type":"tab","label":"User oAuth flows","disabled":false,"info":""},{"id":"2294209a.0c95b","type":"tab","label":"users","disabled":false,"info":""},{"id":"e5822137.be45d","type":"tab","label":"Organization","disabled":false,"info":""},{"id":"d8703926.e2eca","type":"tab","label":"Generic","disabled":false,"info":""},{"id":"9921cbf1.f82328","type":"tab","label":"A-D gadgets","disabled":false,"info":""},{"id":"9de255bd.0d0938","type":"tab","label":"F - Z gadgets","disabled":false,"info":""},{"id":"ac049260.12936","type":"tab","label":"Playground","disabled":false,"info":""},{"id":"45759581.11da84","type":"subflow","name":"Topbar","info":"","category":"","in":[{"x":1520,"y":1620,"wires":[{"id":"704d4000.20aee"}]}],"out":[{"x":1800,"y":1620,"wires":[{"id":"704d4000.20aee","port":0}]}],"env":[]},{"id":"39834eee.0dd5a2","type":"subflow","name":"Flow session mgt ","info":"","category":"System flows","in":[{"x":20,"y":80,"wires":[{"id":"a16ff674.24bb78"}]}],"out":[{"x":280,"y":80,"wires":[{"id":"a16ff674.24bb78","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"5e9b9c1d.bbe4a4","type":"subflow","name":"Redirect","info":"","category":"System flows","in":[{"x":340,"y":260,"wires":[{"id":"c84e6b09.3e90f8"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"a55f7aee.572be","type":"subflow","name":"Prepair flow","info":"","category":"System flows","in":[{"x":40,"y":80,"wires":[{"id":"2927f5ef.05639a"}]}],"out":[{"x":540,"y":80,"wires":[{"id":"4e19b9ea.51eff8","port":0}]},{"x":540,"y":140,"wires":[{"id":"4e19b9ea.51eff8","port":1}]},{"x":560,"y":200,"wires":[{"id":"4e19b9ea.51eff8","port":2}]}],"env":[]},{"id":"152aab03.7a806d","type":"subflow","name":"menu call","info":"","category":"System flows","in":[{"x":320,"y":380,"wires":[{"id":"b4440fc5.ad787"}]}],"out":[{"x":1060,"y":520,"wires":[{"id":"f4360e46.6f855","port":2}]}],"env":[]},{"id":"3170c4ab.fadb9c","type":"subflow","name":"Form call","info":"","category":"System flows","in":[{"x":420,"y":260,"wires":[{"id":"301d64c9.14362c"}]}],"out":[{"x":1140,"y":360,"wires":[{"id":"3ca50242.9fc416","port":1}]}],"env":[]},{"id":"4cbbc60.828563c","type":"subflow","name":"Global context","info":"","category":"System flows","in":[{"x":220,"y":140,"wires":[{"id":"ce4931e.2eadfd"},{"id":"4468c444.53ac84"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"e25f5e2d.45871","type":"subflow","name":"Generate response Object","info":"","category":"System flows","in":[{"x":160,"y":840,"wires":[{"id":"e0bfa97f.699338"}]}],"out":[{"x":1160,"y":680,"wires":[{"id":"ef1059a8.d05948","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"2ef93158.ae5276","type":"subflow","name":"TB design","info":"","category":"System flows","in":[{"x":-20,"y":80,"wires":[{"id":"2780dc99.05adfc"}]}],"out":[{"x":400,"y":80,"wires":[{"id":"2780dc99.05adfc","port":0}]}],"env":[]},{"id":"19457c3b.7f3ba4","type":"subflow","name":"Generic breadcrumb post","info":"","category":"","in":[{"x":-20,"y":80,"wires":[{"id":"75a214b5.1247dc"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"73dff3ad.4e7f84","type":"subflow","name":"convert IDs","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"820eb5ef.100fd8"}]}],"out":[{"x":340,"y":80,"wires":[{"id":"820eb5ef.100fd8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"5c6b8786.2f63d","type":"subflow","name":"Init org level","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"c456991.34d5368"}]}],"out":[{"x":340,"y":80,"wires":[{"id":"c456991.34d5368","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"8db3b81a.693fd","type":"subflow","name":"BreadCrumbsAction","info":"","category":"","in":[{"x":0,"y":80,"wires":[{"id":"e4b702f8.2026a"}]}],"out":[{"x":460,"y":40,"wires":[{"id":"e4b702f8.2026a","port":0}]},{"x":640,"y":180,"wires":[{"id":"f2f17cd0.7f59a8","port":0},{"id":"e4b702f8.2026a","port":2}]}],"env":[],"color":"#DDAA99"},{"id":"53926ffd.c5a74","type":"subflow","name":"Validate token","info":"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"3eaaac4f.be9de4"}]}],"out":[{"x":340,"y":80,"wires":[{"id":"3eaaac4f.be9de4","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"8e853889.7b4f78","type":"subflow","name":"prepair redirect","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"2968cd86.c7a2e2"}]}],"out":[{"x":360,"y":80,"wires":[{"id":"2968cd86.c7a2e2","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"d237f7f5.48aae8","type":"subflow","name":"Google Translate","info":"Pre conditions:\n\nmsg.payload ={\n    data : [], // REQUIRED ARRAY of objects with the to be translated data \n    translateVar: 'label', //REQUIRED  STRING the translateVar KEY on the data \n    translateDestinationVar: 'label', //REQUIRED STRING the translateVar KEY on the data object\n    languageSource: 'en' // STRING the language of the souce value, (default = 'en')\n    languageDestination: 'nl', // REQUIRED STRING the language that is to be translated to\n    \n}\n","category":"","in":[{"x":40,"y":100,"wires":[{"id":"4d81e47d.d8780c"}]}],"out":[{"x":600,"y":80,"wires":[{"id":"7a7fc4.02c9e03c","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"ab79407.ded3ec","type":"subflow","name":"Logout user","info":"","category":"","in":[{"x":20,"y":80,"wires":[{"id":"cc51476b.f74068"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"be61da9a.8b3cd8","type":"subflow","name":"Error handeling","info":"","category":"System flows","in":[{"x":140,"y":180,"wires":[{"id":"dd5ad5f8.cf8828"}]}],"out":[{"x":580,"y":180,"wires":[{"id":"c2d92f7a.f4f5e","port":0},{"id":"e3d59bbe.0b2068","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"3c16f370.3edeac","type":"subflow","name":"Change form to view only","info":"","category":"","in":[{"x":0,"y":80,"wires":[{"id":"8f562a45.346078"}]}],"out":[{"x":380,"y":80,"wires":[{"id":"8f562a45.346078","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"a78ee99e.44ec48","type":"subflow","name":"nodemailer_mailgun_transport && nodemailer","info":"","category":"System flows","in":[{"x":-60,"y":80,"wires":[{"id":"c5ab9339.eca4"}]}],"out":[{"x":680,"y":100,"wires":[{"id":"c5ab9339.eca4","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"594fbb51.16039c","type":"catch","z":"e5822137.be45d","name":"","scope":null,"x":60,"y":160,"wires":[["ae14566f.c06d9"]]},{"id":"ae14566f.c06d9","type":"debug","z":"e5822137.be45d","name":"ERROR","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","x":178.33332443237305,"y":159.99999618530273,"wires":[]},{"id":"90b9b2bb.71e9","type":"catch","z":"aec22158.fe4e38","name":"","scope":null,"x":60,"y":20,"wires":[["968e2324.e80b"]]},{"id":"968e2324.e80b","type":"debug","z":"aec22158.fe4e38","name":"ERROR","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","x":160,"y":20,"wires":[]},{"id":"a86d336c.1e032","type":"comment","z":"aec22158.fe4e38","name":"User authentication","info":"","x":90,"y":153.99999618530273,"wires":[]},{"id":"bc6ac440.7a7d78","type":"comment","z":"aec22158.fe4e38","name":"User authentication gagdet actions","info":"","x":1155,"y":219.99999618530273,"wires":[]},{"id":"d92220ce.df2c7","type":"comment","z":"aec22158.fe4e38","name":"User authentication gadgets","info":"","x":781.166748046875,"y":212.49999618530273,"wires":[]},{"id":"3fb52bc8.66088c","type":"debug","z":"aec22158.fe4e38","name":"debug - User authentication INIT","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":395,"y":339.99999618530273,"wires":[]},{"id":"ffb8ad05.fe04","type":"link in","z":"aec22158.fe4e38","name":"UserAuthentication INIT","links":["ad478a5b.bb35a","a46d6d89.0ff6a8","e130563c.567048"],"x":250,"y":379.99999618530273,"wires":[["3fb52bc8.66088c","e80a67d5.4cc398"]]},{"id":"dd911c3e.69ac98","type":"comment","z":"aec22158.fe4e38","name":"User account activation","info":"","x":95,"y":719.9999961853027,"wires":[]},{"id":"603f053d.277bd4","type":"comment","z":"aec22158.fe4e38","name":"User account activation gagdet actions","info":"","x":2385,"y":799.9999961853027,"wires":[]},{"id":"9fde6397.653cf8","type":"comment","z":"aec22158.fe4e38","name":"User account activation gadgets","info":"","x":1365,"y":799.9999961853027,"wires":[]},{"id":"dd631978.387b18","type":"debug","z":"aec22158.fe4e38","name":"debug - User account activation INIT","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":345,"y":919.9999961853027,"wires":[]},{"id":"f08a12de.bf0fd","type":"link in","z":"aec22158.fe4e38","name":"UserAccountActivation INIT","links":["75463c50.ea35e4","9b9de128.140c3","6537bec2.9226e8"],"x":130,"y":979.9999961853027,"wires":[["dd631978.387b18","cb573448.22b968"]]},{"id":"4f5a2540.8fc0c4","type":"debug","z":"aec22158.fe4e38","name":"debug - User account activation Gadget Post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"RevotioData.PostData","targetType":"msg","x":2635,"y":899.9999961853027,"wires":[]},{"id":"cb573448.22b968","type":"link out","z":"aec22158.fe4e38","name":"","links":["28fbb602.bac6a2"],"x":548.5000076293945,"y":978.0000095367432,"wires":[]},{"id":"986822a8.580788","type":"comment","z":"aec22158.fe4e38","name":"two step authentication","info":"","x":100,"y":1177.9999961853027,"wires":[]},{"id":"f23132e9.5e6e58","type":"comment","z":"aec22158.fe4e38","name":"two step authentication gagdet actions","info":"","x":2085,"y":1279.9999961853027,"wires":[]},{"id":"ac4fc122.89ea9","type":"comment","z":"aec22158.fe4e38","name":"two step authentication gadgets","info":"","x":1085,"y":1239.9999961853027,"wires":[]},{"id":"4ddc1f0b.3d3f68","type":"function","z":"aec22158.fe4e38","name":"Trigger email","func":"\nvar emailTemplate = '<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"> <html xmlns=\"http://www.w3.org/1999/xhtml\"> <head> <meta name=\"viewport\" content=\"width=device-width\"/> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/> <title>Academic Projects User invitation</title> <style type=\"text/css\"> *{margin:0; padding:0;}*{font-family: Roboto-Regular,Helvetica,Arial,sans-serif;}body{-webkit-font-smoothing:antialiased; -webkit-text-size-adjust:none; width: 100%!important; height: 100%;}a{color: #2BA6CB;}. btn{text-decoration:none; color: #FFF; background-color: #1991EB; margin-top: 5px; padding:10px 16px; font-weight:bold; margin-right:10px; text-align:center; cursor:pointer; display: inline-block; border-radius: 2px;}table.body- wrap{width: 100%;}h2{font-size: 24px; line-height: 28px; margin-bottom:15px; color:#000;}h2 small{color: #6f6f6f; text-transform:none; font-size: 20px;}p{margin-bottom: 10px; font-weight: normal; font-size:14px; line-height:1.4;}p small{font-size: 13px; line-height: 24px;}p.lead{font-size:17px;}. container{display:block!important; max-width:600px!important; margin:0 auto!important; clear:both!important;}.content{padding: 35px 20px; max-width:600px; margin:0 auto; display:block;}.content table{width: 100%;}@media only creen and (max-width: 600px){a[class=\"btn\"]{display:block!important; margin-bottom:10px!important; background-image:none!important; margin-right:0!important;}}</style> </head> <body bgcolor=\"#FFFFFF\"> <table class=\"body-wrap\"> <tr> <td></td><td class=\"container\" bgcolor=\"#FFFFFF\"> <div class=\"content\"> <table> <tr> <td> <h2><small>Hi,</small> msg.payload.firstname msg.payload.lastname </h2> <br/> <p class=\"lead\">Welcome to the project management application for the University of Leiden!</p><br/> <p class=\"lead\">Cheerfully yours,<br/>Team Academic projects.</p><br/> <p><small>You can activate your account by clicking on this link:</small></p><a class=\"btn\" href=\" currentDomain /api/app/#/confirmation?activate=msg.payload.user_id \">Click Me to Activate!</a> <br/> <br/> </td></tr></table> </div></td><td></td></tr></table> </body> </html>';\n\nmsg.payload = {\n                   \"apiKey\": global.get(\"mailgun.apiKey\"),\n                   \"domain\":global.get(\"mailgun.domain\"), \n                   \"emailHeaders\":{\n                      \"from\":global.get(\"mailgun.from\"),\n                      \"to\":msg.RevotioData.session.userData.email,\n                      \"subject\":\"Two step authentication\",\n                      \"body\":\"\",\n                   },\n                   \"emailData\":{\n                      \"optional key-one\":\"some value\",\n                      \"optional key-two\":\"some other value !!!\"\n                   },\n                   \"emailTemplate\":\"Hi \" + msg.RevotioData.session.userData.firstname +  \", please enter this token : \" + msg.RevotioData.FlowData.Token + \" into the app. Thanks!!!\"\n                };\n                \n                \n              \n                \n                \nreturn msg;","outputs":1,"noerr":0,"x":1190,"y":1320,"wires":[[]]},{"id":"8eda4890.cca5e8","type":"catch","z":"d8703926.e2eca","name":"","scope":null,"x":118.75,"y":33.75,"wires":[["b2e8d966.2f42b"]]},{"id":"b2e8d966.2f42b","type":"debug","z":"d8703926.e2eca","name":"ERROR","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","x":260,"y":40,"wires":[]},{"id":"3ab682ae.10e656","type":"link in","z":"aec22158.fe4e38","name":"UserAuthentication ACTION","links":["88cb22fd.2938c","6dbb7fd6.2f51d","82e73790.6bba78"],"x":1070,"y":299.99999618530273,"wires":[["cde0b321.b9d5c","aed8c006.3bdf3"]]},{"id":"579313d7.2430dc","type":"link in","z":"aec22158.fe4e38","name":"UserAccountActivation ACTION","links":["28cd6ef4.fc46fa","60f9add0.f0070c","e8682458.5b8fb"],"x":2370,"y":859.9999961853027,"wires":[["4f5a2540.8fc0c4","a6610d0a.93f8e"]]},{"id":"a06272bd.e32538","type":"comment","z":"aec22158.fe4e38","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2425,"y":759.9999961853027,"wires":[]},{"id":"be1f9240.8525","type":"comment","z":"aec22158.fe4e38","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2430,"y":1207.9999961853027,"wires":[]},{"id":"fb87369c.23e","type":"comment","z":"aec22158.fe4e38","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2430,"y":180,"wires":[]},{"id":"cd8c7f3.154188","type":"link out","z":"aec22158.fe4e38","name":"","links":["fdeb0a33.b80658","ac130025.b78d4","8f317f74.8f0218","7063f25b.94df04"],"x":490,"y":379.99999618530273,"wires":[]},{"id":"fdeb0a33.b80658","type":"link in","z":"aec22158.fe4e38","name":"user authentication - Custom login form Gadget","links":["cd8c7f3.154188"],"x":650,"y":259.99999618530273,"wires":[["f6cfd796.ef5268"]]},{"id":"f6cfd796.ef5268","type":"function","z":"aec22158.fe4e38","name":"Login user Form","func":"\n    \ngadgetsList =[{\n            \"gadgetId\":  \"349a509d-e145-33a6-7888-e8906915b223\",\n            \"gadgetName\":  \"Login form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": {\n      id: 'Login',\n      canceled: false, // false\n      submitButtonText: 'Login',\n    //   prevButtonText: 'Previous',\n      nextButtonText: 'Next',\n      showPrevious: false, //false\n      title: 'Login',\n      steps: [\n        {\n          title: '',\n          subtitle: '',\n          fields: [\n              {\n              name: 'username',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Email address',\n                placeholder: 'John',\n                type: 'email', // default: text | button | checkbox | date | email | number | password | radio | submit\n                required: true // false by default\n              }\n            },\n              {\n              name: 'password',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Password',\n                type: 'password', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: true, // false by default\n                maxlength: 50\n              }\n            },\n        //  {\n        //               name: 'twostep',\n        //               htmlTag: 'input',  // button | select | textarea\n        //               options: {\n        //                 value: 'yes',\n        //                 label: 'twostep',\n        //                 type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n        //                 placeholder: '',\n        //                 required: true, // false by default\n        //                 maxlength: 50\n        //               }\n        //             },\n\n        ]}\n      ]\n    }},\n    // {\n    //         \"gadgetId\":  \"e54b2885-1a8e-3e58-0314-c2a388e2b8bc\",\n    //         \"gadgetName\": \"dashboard - involvement\",\n    //         \"gadgetType\": \"dynamic-modal\",\n    //         \"gadgetData\": {\"modalStatus\":'show'}}\n            ]\n\nmsg.payload = {gadgetsList:gadgetsList};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":735,"y":259.99999618530273,"wires":[["ad59d764.8f538"]]},{"id":"cde0b321.b9d5c","type":"debug","z":"aec22158.fe4e38","name":"debug - User authentication Gagdet Post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1475,"y":399.99999618530273,"wires":[]},{"id":"ad59d764.8f538","type":"link out","z":"aec22158.fe4e38","name":"","links":["1766e26.2df601e","15f8aeef.16f7d1","ec6395bb.05eb08","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":830,"y":259.99999618530273,"wires":[]},{"id":"aed8c006.3bdf3","type":"function","z":"aec22158.fe4e38","name":"Route POST ","func":"// Get libraries\nvar moment = global.get('moment');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\n// delair output var's\nvar  Menu , LoginForm,ResetPassword ;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n\n// Check if it is a Gadget action\nif ( PostData.hasOwnProperty('gadgetType')) {\n        // Check if it was a menu action\n\n        if (PostData.gadgetType === \"Menu\") {\n            Menu = msg;\n        }\n\n         else if (PostData.gadgetName === \"Login form\"){\n            LoginForm = msg;\n        }\n  \n     else if (PostData.gadgetName === \"reset password\"){\n            ResetPassword = msg;\n        }\n}\n\n\nreturn [ Menu, LoginForm, ResetPassword ];","outputs":3,"noerr":0,"x":1145,"y":299.99999618530273,"wires":[["a4311a51.a3b6d"],["2fafffb5.4b7cf8"],["e9d1128b.31c918"]],"outputLabels":["Menu","LoginForm","ResetPassword"]},{"id":"a4311a51.a3b6d","type":"link out","z":"aec22158.fe4e38","name":"","links":["8e48eec2.dcffb","47fe9e1a.f0bb9","f1a071ae.735c6","cd80bf04.26b1c","14418773.9dfa29"],"x":1270,"y":259.99999618530273,"wires":[]},{"id":"fa86daf5.84f458","type":"comment","z":"aec22158.fe4e38","name":"Menu","info":"","x":1350,"y":220,"wires":[]},{"id":"2fafffb5.4b7cf8","type":"function","z":"aec22158.fe4e38","name":"check if user exists","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nif (msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty('username')){\n    msg.RevotioData.PostData.gadgetData.formData.username = msg.RevotioData.PostData.gadgetData.formData.username.toLowerCase()\n}\n\naggregateObj = {\n       query: { query : [ { \n            \"$match\" : {\n                username : msg.RevotioData.PostData.gadgetData.formData.username\n            }\n        }, \n        { \n            \"$lookup\" : {\n                \"from\" : \"user_accounts\", \n                \"localField\" : \"_id\", \n                \"foreignField\" : \"user\", \n                \"as\" : \"UserAccountData\"\n            }\n        }, \n        \n        \n         {    $lookup: {\n            from: \"user_permissions\",\n            localField: \"_id\",\n            foreignField: \"user\",\n            as: \"AppUserPermissionInfo\"\n        }},\n                ],},\n        connection:global.get(\"DB_data.connection\"),\n        database:global.get(\"DB_data.appDB\"),\n        collection:'users',\n        operation:'aggregate',\n        }\n        \nmongodbTools.resolveAsync(aggregateObj, node, function(res){\n        msg.payload = res\n        node.send(msg) \n}) \n            \n            \n// msg.payload =  [\n       \n//         //   { \n//         //     \"$unwind\" : {\n//         //         \"path\" : \"$UserAccountData\", \n//         //         \"preserveNullAndEmptyArrays\" : false\n//         //     }\n//         // },    \n\n//     ]; \n\n\n// msg.operation = 'aggregate.toArray';\n\n\n\n\n\n// return msg;\n\n\n\n","outputs":1,"noerr":0,"x":1405,"y":319.99999618530273,"wires":[["d99c562c.a79378"]]},{"id":"d99c562c.a79378","type":"function","z":"aec22158.fe4e38","name":"Check if user exists","func":"var NoUser, User;\n// msg.RevotioData.userData = msg.payload[0];\n\n\n\nif (typeof msg.payload[0] === 'object' && msg.payload[0]._id){\n    \n    user_accounts = msg.payload[0].user_accounts\n    payload =   msg.payload[0]\n    \n    payload.user_accounts = user_accounts;\n    \n    msg.payload = payload\n     User = msg;\n}else{\n    NoUser = msg;\n}\n\nreturn [NoUser, User];","outputs":2,"noerr":0,"x":1705,"y":319.99999618530273,"wires":[["19945af0.650975"],["c260b609.a9b02"]],"outputLabels":["NoUser, ","User"]},{"id":"19945af0.650975","type":"function","z":"aec22158.fe4e38","name":"Prepair error response","func":"\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[0].error =  {\n                                                                    msg: \"user does not exists\"\n                                                                    };\n\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\":  \"349a509d-e145-33a6-7888-e8906915b223\",\n            \"gadgetName\":  \"Login form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":1935,"y":299.99999618530273,"wires":[["237dc0d6.55ce58"]]},{"id":"237dc0d6.55ce58","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","ec6395bb.05eb08","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":2050,"y":299.99999618530273,"wires":[]},{"id":"c260b609.a9b02","type":"function","z":"aec22158.fe4e38","name":"Check if password is correct","func":"// var crypto = require('crypto');\n\nvar invalid, valid;\nvar crypto = global.get('crypto');\nvar password = String(msg.RevotioData.PostData.gadgetData.formData.password)\n\nvar dhash = crypto.pbkdf2Sync(password, msg.payload.salt, 1000, 64, 'sha1').toString('hex');\n\nif(msg.payload.hash === dhash){\n\n   valid = msg;\n}\nelse{\n   invalid =  msg;\n}\n\n\n\nreturn [invalid, valid];","outputs":2,"noerr":0,"x":1955,"y":339.99999618530273,"wires":[["2f69da72.60f79e"],["115dbd4f.d83e53"]],"outputLabels":["invalid, ","valid"]},{"id":"2f69da72.60f79e","type":"function","z":"aec22158.fe4e38","name":"Prepair error response","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\npayload = msg.payload;\n\nif (payload.hasOwnProperty(\"loginAttempts\") && isNaN(payload.loginAttempts) === false ){\n    payload.loginAttempts = payload.loginAttempts + 1\n} else {\n    payload.loginAttempts =  1\n}\n// payload.loginAttempts = payload.loginAttempts + 1\n\n\nif (payload.loginAttempts  < 4 ){\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[1].error =  {\n                                                                    msg: \"Incorrect password, you have \" + ( 3 -  payload.loginAttempts ) + \" attempts left\"\n                                                                    };\nmsg.query = [\n    {_id: new ObjectID(payload._id)},\n    {\"$set\": {loginAttempts: payload.loginAttempts},},\n    {upsert: true}\n    ]\n} else {\n  msg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[0].error =  {\n                                                                    msg: \"Incorrect password, this account is blocked, please contact your administrator\"\n                                                                    };\n  msg.query = [\n    {_id: new ObjectID(payload._id)},\n    {\"$set\": {blockAccount:true}},\n    {upsert: true}\n    ]\n}\n\n\n\n\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\": \"349a509d-e145-33a6-7888-e8906915b223\",\n            \"gadgetName\":  \"Login form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n    \n    \n\nreturn msg;","outputs":1,"noerr":0,"x":2195,"y":299.99999618530273,"wires":[["6b7d9d4c.4f7de4","ff257da5.7a778"]]},{"id":"6b7d9d4c.4f7de4","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","ec6395bb.05eb08","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":2330,"y":299.99999618530273,"wires":[]},{"id":"e954696c.c9cc1","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":1985,"y":259.99999618530273,"wires":[]},{"id":"49ad2fe3.46de68","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":2430,"y":280,"wires":[]},{"id":"c8628eb6.6a32a8","type":"function","z":"aec22158.fe4e38","name":"Activate user Form","func":"msg.RevotioData.FlowData.Data.UserData = msg.payload\ngadgetsList =[{\n            \"gadgetId\":  \"2041a5fe-e808-6a23-da7b-5421d34c4bbf\",\n            \"gadgetName\":  \"activate account form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": {\n                  id: 'Login',\n                  canceled: true, // false\n                  submitButtonText: 'Submit',\n                  prevButtonText: 'Previous',\n                  nextButtonText: 'Next',\n                  showPrevious: true, //false\n                  title: 'Account activation',\n                  steps: [\n                    {\n                      title: '',\n                      subtitle: '',\n                      fields: [\n                          {\n                          name: 'first_name',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value: msg.RevotioData.FlowData.Data.UserData.first_name,\n                            label: 'First name',\n                            placeholder: '',\n                            type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            required: true, // false by default\n                            editable: true\n                          }\n                        },\n                         {\n                          name: 'last_name',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value: msg.RevotioData.FlowData.Data.UserData.last_name,\n                            label: 'Last name',\n                            placeholder: '',\n                            type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            required: true, // false by default\n                            editable: true\n                          }\n                        },\n                        {\n                          name: 'username',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value: msg.RevotioData.FlowData.Data.UserData.username,\n                            label: 'User name',\n                            placeholder: '',\n                            type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            required: true, // false by default\n                            editable: false\n                          }\n                        },\n                        {\n                          name: 'passwordOne',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value: '',\n                            label: 'Password',\n                            placeholder: '',\n                            type: 'password', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            required: true, // false by default\n                            // editable: false\n                          }\n                        }, \n                        {\n                          name: 'passwordTwo',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value: '',\n                            label: 'Password again',\n                            placeholder: '',\n                            type: 'password', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            required: true, // false by default\n                            // editable: false\n                          }\n                        },\n                        {\n                          name: 'phone_number',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value: '',\n                            label: 'Phone number',\n                            placeholder: '',\n                            type: 'number', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            required: false, // false by default\n                            editable: true\n                          }\n                        },\n                        {\n                          name: 'email',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value: msg.RevotioData.FlowData.Data.UserData.email,\n                            label: 'Email address',\n                            placeholder: '',\n                            type: 'email', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            editable: false // false by default\n                          }\n                        },\n                        {\n                            name: 'avatar',\n                            label: 'Avatar',\n                            htmlTag: 'button',\n                            options: {\n                                type: 'upload',\n                                folder: global.get(\"DomainProperties.filesFolder\")+ \"users/\"+msg.RevotioData.FlowData.Data.UserData._id  ,\n                                classes: 'md-icon-button md-primary',\n                                preview: 'inside', // inside , outside\n                                previewPosition: 'right',\n                                icon: 'fas fa-upload',\n                                // previewUrl: global.get(\"DomainProperties.url\") + msg.RevotioData.FlowData.Data.UserData.avatar,\n                                editable: true\n                            }\n                        },\n                    ]}\n                  ]\n                }},\n            ]\n\nmsg.payload = {gadgetsList:gadgetsList};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1745,"y":879.9999961853027,"wires":[["22600218.5f17ce"]]},{"id":"28fbb602.bac6a2","type":"link in","z":"aec22158.fe4e38","name":"user account activation form","links":["cb573448.22b968"],"x":910,"y":839.9999961853027,"wires":[["f3baa581.b4119"]]},{"id":"48979864.699d78","type":"function","z":"aec22158.fe4e38","name":"Create error msg","func":"msg.payload = \"Error - token generation issue\"\nreturn msg;","outputs":1,"noerr":0,"x":4525,"y":359.99999618530273,"wires":[["2d570acc.402cee"]]},{"id":"2d570acc.402cee","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":4630,"y":359.99999618530273,"wires":[]},{"id":"7d4e09a6.9a835","type":"function","z":"aec22158.fe4e38","name":"Check if BrowserId is present **TwoStep**","func":"var present, notPresent; \n\nif (msg.RevotioData.SessionData.BrowserId && typeof msg.RevotioData.SessionData.BrowserId === 'object'){\n    present = msg;\n} else {\n    notPresent = msg;\n}\n\nreturn [present, notPresent];","outputs":2,"noerr":0,"x":3855,"y":379.99999618530273,"wires":[["124f6b5b.e9925d"],["f2fc87a2.44bf68"]],"outputLabels":["present","notPresent"]},{"id":"5e088157.862158","type":"function","z":"aec22158.fe4e38","name":"Create error msg","func":"msg.payload = \"Error - token generation issue\"\nreturn msg;","outputs":1,"noerr":0,"x":4525,"y":439.99999618530273,"wires":[["4d2f5f49.74d588"]]},{"id":"4d2f5f49.74d588","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":4630,"y":439.99999618530273,"wires":[]},{"id":"a27da0ef.7fe0c8","type":"link in","z":"aec22158.fe4e38","name":"two step authentication - INIT","links":["f9c11c94.800ed","aa063ab.0c16648","839b0669.2a35d"],"x":150,"y":1439.9999961853027,"wires":[["ff593a75.391dc8","459f52fa.fc087c"]]},{"id":"e8c424c8.a91d3","type":"link in","z":"aec22158.fe4e38","name":"two step authentication - Action","links":["d366fdbc.eb5658","756461b6.504a38","e84a1d06.e6f258"],"x":1990,"y":1359.9999961853027,"wires":[["b7f1c28a.2b2b2","144a230b.917dfd"]]},{"id":"ff593a75.391dc8","type":"debug","z":"aec22158.fe4e38","name":"debug -two step authentication INIT","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"RevotioData","targetType":"msg","x":345,"y":1399.9999961853027,"wires":[]},{"id":"b7f1c28a.2b2b2","type":"debug","z":"aec22158.fe4e38","name":"debug - INIT two step action","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"RevotioData.PostData","targetType":"msg","x":2095,"y":1319.9999961853027,"wires":[]},{"id":"f2fc87a2.44bf68","type":"function","z":"aec22158.fe4e38","name":"Generate new token && prepair update query","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar OK, NOK;\n\nif (msg.token !== \"Error\"){\n// create new token string\ntokenString = {\n    hash : msg.payload.hash,\n    user_id :msg.RevotioData.session.UserData._id,\n    deviceId : msg.RevotioData.session.deviceId,\n      key:global.get(\"SystemVars.tokenSecret\"),//new ObjectID(),\n    type : \"unauthorized\"}\nmsg.RevotioData.session.token =  jsonwebtoken.sign(tokenString, global.get(\"SystemVars.secret\"))\n\n// msg.RevotioData.session.userData = msg.payload;\n\nmsg.payload = [{\n        deviceId: msg.RevotioData.session.deviceId\n        },\n        {\"$set\": {token: msg.RevotioData.session.token, UserData:  msg.RevotioData.session.UserData }},\n        {upsert:1}]\n\nmsg.operation = \"updateMany\"\nOK = msg;\n}else {\nNOK = msg;\n}\nreturn [OK, NOK];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":4225,"y":399.99999618530273,"wires":[["ab3ed11a.d5793"],["5e088157.862158"]],"outputLabels":["OK","NOK"]},{"id":"124f6b5b.e9925d","type":"function","z":"aec22158.fe4e38","name":"Generate new token && prepair update query","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar OK, NOK;\n\nif (msg.token !== \"Error\"){\n// create new token string\ntokenString = {\n    BrowserId : msg.RevotioData.SessionData.BrowserId,\n    hash : msg.payload.hash,\n    key:global.get(\"SystemVars.tokenSecret\"), //new ObjectID(),\n    user_id :msg.RevotioData.session.UserData._id,\n    deviceId : msg.RevotioData.session.deviceId,\n    type : \"authorized\"}\nmsg.RevotioData.session.token =  jsonwebtoken.sign(tokenString, global.get(\"SystemVars.secret\"))\n\n// msg.RevotioData.session.userData = msg.payload;\n\nmsg.payload = [{\n        deviceId: msg.RevotioData.session.deviceId\n        },\n        {\"$set\": {token: msg.RevotioData.session.token, UserData:  msg.RevotioData.session.UserData }},\n        {upsert:true}]\n\nmsg.operation = \"updateMany\"\nmsg.RevotioData.session.user_id = new ObjectID(msg.RevotioData.session.UserData._id)\nOK = msg;\n}else {\nNOK = msg;\n}\nreturn [OK, NOK];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":4225,"y":359.99999618530273,"wires":[["2df202d2.7f9f2e","2c8a0c62.86d694"],["48979864.699d78"]],"outputLabels":["OK","NOK"]},{"id":"ed52f54.32f3488","type":"function","z":"aec22158.fe4e38","name":"Activate user Form","func":"\n    \ngadgetsList =[{\n            \"gadgetId\":  \"2a6f80a3-790b-cbd6-01cd-ea9bbf222993\",\n            \"gadgetName\":  \"two step authentication form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": {\n                  id: 'Login',\n                  canceled: true, // false\n                  submitButtonText: 'Submit',\n                  prevButtonText: 'Previous',\n                  nextButtonText: 'Next',\n                  showPrevious: true, //false\n                  title: 'Two step authentication',\n                  steps: [\n                    {\n                      title: '',\n                      subtitle: '',\n                      fields: [\n                        {\n                          name: 'token',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value:\"\" ,\n                            label: 'Enter token',\n                            placeholder: '',\n                            type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            editable: true ,// false by default\n                           required: true\n                            \n                          }\n                        },\n                    ]}\n                  ]\n                }},\n            ]\n\nmsg.payload = {gadgetsList:gadgetsList};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1125,"y":1279.9999961853027,"wires":[["7bd715c1.48678c"]]},{"id":"61a146dd.2d076","type":"link out","z":"aec22158.fe4e38","name":"TwoStepAuthentication INIT - out","links":["fadf22a9.e1d53","fff10a71.935b1","7335c039.8347a8"],"x":350,"y":1439.9999961853027,"wires":[]},{"id":"fadf22a9.e1d53","type":"link in","z":"aec22158.fe4e38","name":"TwoStepAuthentication form","links":["61a146dd.2d076"],"x":1030,"y":1279.9999961853027,"wires":[["ed52f54.32f3488"]]},{"id":"22600218.5f17ce","type":"link out","z":"aec22158.fe4e38","name":"","links":["1766e26.2df601e","15f8aeef.16f7d1","ec6395bb.05eb08","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":1850,"y":879.9999961853027,"wires":[]},{"id":"7bd715c1.48678c","type":"link out","z":"aec22158.fe4e38","name":"","links":["1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":1230,"y":1279.9999961853027,"wires":[]},{"id":"459f52fa.fc087c","type":"function","z":"aec22158.fe4e38","name":"generate first token","func":"var crypto = global.get('crypto');\n\nmsg.RevotioData.FlowData.Token = crypto.randomBytes(10).toString('hex');\nmsg.RevotioData.FlowData.TokenAttempts = 0\nreturn msg;","outputs":1,"noerr":0,"x":245,"y":1439.9999961853027,"wires":[["61a146dd.2d076"]]},{"id":"fff10a71.935b1","type":"link in","z":"aec22158.fe4e38","name":"TwoStepAuthentication Email trigger","links":["61a146dd.2d076"],"x":1030,"y":1319.9999961853027,"wires":[["4d7aeb07.6c37fc"]]},{"id":"144a230b.917dfd","type":"function","z":"aec22158.fe4e38","name":"Route POST ","func":"// Get libraries\nvar moment = global.get('moment');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\n// delair output var's\nvar  Menu , LoginForm;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n\n// Check if it is a Gadget action\nif ( PostData.hasOwnProperty('gadgetType')) {\n        // Check if it was a menu action\n\n        if (PostData.gadgetType === \"Menu\") {\n            Menu = msg;\n        }\n\n         else if (PostData.gadgetName === \"two step authentication form\"){\n            LoginForm = msg;\n        }\n  \n}\n\n\nreturn [ Menu, LoginForm ];","outputs":2,"noerr":0,"x":2085,"y":1359.9999961853027,"wires":[["3c2ea246.1ea72e"],["fc29b32.594fc5"]],"outputLabels":["Menu","LoginForm"]},{"id":"3c2ea246.1ea72e","type":"link out","z":"aec22158.fe4e38","name":"","links":["8e48eec2.dcffb","47fe9e1a.f0bb9","f1a071ae.735c6","cd80bf04.26b1c","14418773.9dfa29"],"x":2210,"y":1339.9999961853027,"wires":[]},{"id":"aa56ecbf.9881d","type":"comment","z":"aec22158.fe4e38","name":"Menu","info":"","x":2265,"y":1339.9999961853027,"wires":[]},{"id":"fc29b32.594fc5","type":"function","z":"aec22158.fe4e38","name":"Form post check","func":"var validToken, invalidToken, TokenAttemptsExceeded  ;\n\n// update token attempts\n\nmsg.RevotioData.FlowData.TokenAttempts = msg.RevotioData.FlowData.TokenAttempts + 1;\n\n\n\nif (msg.RevotioData.PostData.gadgetData.formData.token === msg.RevotioData.FlowData.Token ) {\n    validToken = msg;\n} else {\n    \n    if (msg.RevotioData.FlowData.TokenAttempts > 3){\n        TokenAttemptsExceeded = msg;\n    } else {\n        invalidToken = msg;\n    }\n    \n}\nreturn [validToken, invalidToken, TokenAttemptsExceeded ];","outputs":3,"noerr":0,"x":2285,"y":1399.9999961853027,"wires":[["2730383.453ef48"],["7ca740d.fc825c"],[]],"outputLabels":["validToken, ","invalidToken","TokenAttemptsExceeded"]},{"id":"2730383.453ef48","type":"function","z":"aec22158.fe4e38","name":"Generate new token && prepair redirect","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// create new token string\ntokenString = {\n    hash : msg.RevotioData.session.UserData.hash,\n    user_id : msg.RevotioData.session.UserData._id,\n    deviceId : msg.RevotioData.session.deviceId,\n    key:new ObjectID(),\n    type : \"authorized\"}\nmsg.RevotioData.session.token =  jsonwebtoken.sign(tokenString, global.get(\"SystemVars.secret\"))\n\n msg.payload = {\n        setToken : true,\n    };\n\n    if (msg.RevotioData.UserData.UserAccountData[0].user_type && msg.RevotioData.UserData.UserAccountData[0].user_type === \"Client_User\" ){\n        msg.payload.Page =  global.get(\"DomainProperties.ClientDefaultPage\");\n        msg.payload.RevotioData = {organization_id : new ObjectID(msg.RevotioData.UserData.organization_id)}\n    }else {\n        msg.payload.Page =  global.get(\"DomainProperties.PNODefaultPage\");\n    }\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2615,"y":1339.9999961853027,"wires":[["4a4fa343.c95144"]]},{"id":"7ca740d.fc825c","type":"function","z":"aec22158.fe4e38","name":"Prepair error response && gen new token","func":"var crypto = global.get('crypto');\n\n    \n    \nmsg.RevotioData.FlowData.Token = crypto.randomBytes(10).toString('hex');\n\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[0].error =  {\n                                                                    msg: \"Incorrect token\"\n                                                                    };\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[0].options.value =    msg.RevotioData.FlowData.Token ;\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\":  \"f858890a-1caf-8900-8279-7add8451c3c7\",\n            \"gadgetName\":  \"Login form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n    \n    \n    \n\nreturn msg;","outputs":1,"noerr":0,"x":2615,"y":1419.9999961853027,"wires":[["4f069602.986148","ef7031df.f8f2b"]]},{"id":"4f069602.986148","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":2870,"y":1439.9999961853027,"wires":[]},{"id":"3d53ecc3.d23364","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":2925,"y":1439.9999961853027,"wires":[]},{"id":"42b3aebc.e049d","type":"function","z":"aec22158.fe4e38","name":"Check if password has correct syntax","func":"// var crypto = require('crypto');\n\nvar invalid, valid;\nvar crypto = global.get('crypto');\n\nvar strongRegex = new RegExp(\"^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\\$%\\^&\\*])(?=.{8,})\");\n\n\n// msg.test = strongRegex.test(msg.RevotioData.PostData.gadgetData.formData.password)\n\n\nif(String(strongRegex.test(msg.RevotioData.PostData.gadgetData.formData.password))){\n\n  valid = msg;\n}\nelse{\n  invalid =  msg;\n}\n\nreturn [invalid, valid];","outputs":2,"noerr":0,"x":3225,"y":899.9999961853027,"wires":[["3314d296.d3a246"],["5a96f6f0.517e4"]],"outputLabels":["invalid, ","valid"]},{"id":"a6610d0a.93f8e","type":"function","z":"aec22158.fe4e38","name":"Route POST ","func":"// Get libraries\nvar moment = global.get('moment');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\n// delair output var's\nvar  Menu , Form;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n\n// Check if it is a Gadget action\nif ( PostData.hasOwnProperty('gadgetType')) {\n        // Check if it was a menu action\n\n        if (PostData.gadgetType === \"Menu\") {\n            Menu = msg;\n        }\n\n         else if (PostData.gadgetName === \"activate account form\"){\n            Form = msg;\n        }\n  \n}\n\n\nreturn [ Menu, Form ];","outputs":2,"noerr":0,"x":2525,"y":859.9999961853027,"wires":[["c17c74ab.5523f8"],["30a67121.5f2ade"]],"outputLabels":["Menu","Form"]},{"id":"c17c74ab.5523f8","type":"link out","z":"aec22158.fe4e38","name":"","links":["8e48eec2.dcffb","47fe9e1a.f0bb9","f1a071ae.735c6","cd80bf04.26b1c","14418773.9dfa29"],"x":2710,"y":819.9999961853027,"wires":[]},{"id":"a42d5ed4.a7045","type":"comment","z":"aec22158.fe4e38","name":"Menu","info":"","x":2773.333297729492,"y":818.3333034515381,"wires":[]},{"id":"5a96f6f0.517e4","type":"function","z":"aec22158.fe4e38","name":"finalize user account","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar crypto = global.get('crypto');\n\n// var atararchange, NoAvatarChange\nvar hash = crypto.pbkdf2Sync(String(msg.RevotioData.PostData.gadgetData.formData.passwordOne), msg.RevotioData.FlowData.Data.UserData.salt, 1000, 64, 'sha1').toString('hex');\n\nmsg.RevotioData.FlowData.Data.UserData.hash = hash\n\n\nObj = {\n    hash : hash,\n    active : true,\n    activationToken: \"\",\n    first_name: msg.RevotioData.PostData.gadgetData.formData.first_name,\n    last_name: msg.RevotioData.PostData.gadgetData.formData.last_name,\n}\n\nif ( msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty(\"avatar\")){\n  Obj.avatar=  msg.RevotioData.PostData.gadgetData.formData.avatar.path  \n}\n\n\n\nmsg.payload = [{_id: new ObjectID(msg.RevotioData.FlowData.Data.UserData._id)},\n               {\"$set\" : Obj},\n               {upsert:true}\n               \n               ];\nmsg.operation = \"update\"\n\n\nmsg.RevotioData.FlowData.UserObj = Obj\n\nreturn msg;","outputs":1,"noerr":0,"x":3535,"y":919.9999961853027,"wires":[["2329b1df.ff9cde"]],"outputLabels":["invalid, "]},{"id":"3314d296.d3a246","type":"function","z":"aec22158.fe4e38","name":"Prepair error response","func":"\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[3].error =  {\n                                                                    msg: \"Minimum eight characters, at least one uppercase letter, one lowercase letter, one number and one special character (@$!%*?&)\"\n                                                                    };\n\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\":  \"2041a5fe-e808-6a23-da7b-5421d34c4bbf\",\n            \"gadgetName\":  \"activate account form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":3495,"y":879.9999961853027,"wires":[["fb679d51.f23358"]]},{"id":"fb679d51.f23358","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":3630,"y":879.9999961853027,"wires":[]},{"id":"87f911f9.4f5a7","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":3685,"y":879.9999961853027,"wires":[]},{"id":"c8100bdd.6522b8","type":"comment","z":"aec22158.fe4e38","name":"Reset password","info":"","x":95,"y":1979.9999961853027,"wires":[]},{"id":"eb91fac0.295fd8","type":"comment","z":"aec22158.fe4e38","name":"Reset password gagdet actions","info":"","x":1945,"y":2039.9999961853027,"wires":[]},{"id":"52faac69.11c514","type":"comment","z":"aec22158.fe4e38","name":"Reset password","info":"","x":95,"y":2039.9999961853027,"wires":[]},{"id":"480f6e06.8ebe5","type":"comment","z":"aec22158.fe4e38","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2445,"y":2009.9999961853027,"wires":[]},{"id":"201c5cde.9b6f44","type":"comment","z":"aec22158.fe4e38","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2425,"y":2439.9999961853027,"wires":[]},{"id":"d431a2e4.6d283","type":"link in","z":"aec22158.fe4e38","name":"reset password - INIT","links":["8a3da463.b1e34","7ac9b7b9.35adf8","8b9609e7.cfa4c8"],"x":110,"y":2239.9999961853027,"wires":[["249a8713.6784","5b61eb52.bcc75c"]]},{"id":"249a8713.6784","type":"debug","z":"aec22158.fe4e38","name":"debug - Reset password INIT","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":245,"y":2199.9999961853027,"wires":[]},{"id":"25e60b9d.f35b14","type":"function","z":"aec22158.fe4e38","name":"Get username form","func":"if (msg.RevotioData.FlowData.user){\n    \n   userName = {\n                          name: 'username',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value:msg.payload.username ,\n                            label: 'Email address',\n                            placeholder: '',\n                            type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            editable: true ,// false by default\n                           required: true,\n                          disabled : true\n                            \n                          }\n                        };\n    \n} else {\n    userName = {\n                          name: 'username',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value:\"\",\n                            label: 'User name',\n                            placeholder: '',\n                            type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            // editable: true ,// false by default\n                           required: true,\n                        //   disabled : true\n                            \n                          }\n                        };\n}\n    \ngadgetsList =[{\n            \"gadgetId\":  \"e947591f-f70b-84c4-c2f7-5a78178ad897\",\n            \"gadgetName\":  \"username\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": {\n                  id: 'Login',\n                  canceled: false, // false\n                  submitButtonText: 'Submit',\n                  prevButtonText: 'Previous',\n                  nextButtonText: 'Next',\n                  showPrevious: true, //false\n                  title: 'Step 1 password reset',\n                  steps: [\n                    {\n                      title: '',\n                      subtitle: '',\n                      fields: [\n                         userName,\n                    ]}\n                  ]\n                }},\n            ]\n\nmsg.payload = {gadgetsList:gadgetsList};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":2260,"wires":[["6b8fb4fa.663c8c"]]},{"id":"6b8fb4fa.663c8c","type":"link out","z":"aec22158.fe4e38","name":"","links":["1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":775,"y":2260,"wires":[]},{"id":"5d5b80cb.b815c","type":"function","z":"aec22158.fe4e38","name":"Reset password BTN","func":"// Admin buttons\n\nmsg.payload = {\n    gadgetsList : [{            \n       \"gadgetId\": \"56c483a5-735e-9f55-c7a6-4a92bd67ebcd\",\n            \"gadgetName\":\"reset password\",\n            \"gadgetType\":\"dynamic-btn\",\n            \"gadgetOptions\":\n                {\"types\":\"\",\n                \"styles\":[\"btn-success\"],\n                \"buttonalign\":\"right\",\n                \"textcolor\":\"black\",\n                \"buttonlabel\":\"Reset password\"},\n                // \"gadgetData\":\"create_project\"\n       \n   }]\n}\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":755,"y":339.99999618530273,"wires":[["ba29073e.8adb"]]},{"id":"ac130025.b78d4","type":"link in","z":"aec22158.fe4e38","name":"user authentication - Custom login form Gadget","links":["cd8c7f3.154188"],"x":650,"y":339.99999618530273,"wires":[["5d5b80cb.b815c"]]},{"id":"ba29073e.8adb","type":"link out","z":"aec22158.fe4e38","name":"","links":["1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":870,"y":339.99999618530273,"wires":[]},{"id":"e9d1128b.31c918","type":"function","z":"aec22158.fe4e38","name":"Redirect to reset password","func":"// Prepair redirect to chosen project\n\n           msg.payload = { \n               Page:'reset password', \n               RevotioData:{\n                   \n               } \n            };\n        \n\n\nreturn msg;","outputs":1,"noerr":0,"x":1435,"y":359.99999618530273,"wires":[["aee578b.d1a4a88"]]},{"id":"e298dd8d.cbd328","type":"link in","z":"aec22158.fe4e38","name":"reset password - Action","links":["d366fdbc.eb5658","a95f9492.bf8098","756461b6.504a38","b0dce74d.09db9","32198700.e5b5b8"],"x":1830,"y":2159.9999961853027,"wires":[["d9bcd251.2ea468","4aa2d425.db2074"]]},{"id":"d9bcd251.2ea468","type":"debug","z":"aec22158.fe4e38","name":"debug - Reset password action","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"RevotioData.PostData","targetType":"msg","x":2000,"y":2081.9999961853027,"wires":[]},{"id":"2e14c717.416758","type":"function","z":"aec22158.fe4e38","name":"Check if password has correct syntax","func":"// var crypto = require('crypto');\n\nvar invalid, valid;\nvar crypto = global.get('crypto');\n// Minimum eight characters, at least one uppercase letter, one lowercase letter, one number and one special character\nvar strongRegex = new RegExp(\"^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\\$%\\^&\\*])(?=.{8,})\");\n\n// msg.test = strongRegex.test(msg.RevotioData.PostData.gadgetData.formData.passwordOne)\n\nif(String(strongRegex.test(msg.RevotioData.PostData.gadgetData.formData.passwordOne))){\n\n\n  valid = msg;\n}\nelse{\n  invalid =  msg;\n}\n\nreturn [invalid, valid];","outputs":2,"noerr":0,"x":2565,"y":2319.9999961853027,"wires":[["d43d088f.c70298"],["86f7d2bb.4375f8"]],"outputLabels":["invalid, ","valid"]},{"id":"4aa2d425.db2074","type":"function","z":"aec22158.fe4e38","name":"Route POST ","func":"// Get libraries\nvar moment = global.get('moment');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\n// delair output var's\nvar  Menu, UsernameForm,  PasswordForm , CancelReset;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n\n// Check if it is a Gadget action\nif ( PostData.hasOwnProperty('gadgetType')) {\n        // Check if it was a menu action\n\n        if (PostData.gadgetType === \"Menu\") {\n            Menu = msg;\n        }\n\n         else if (PostData.gadgetName ===  \"Reset password form\"){\n            PasswordForm = msg;\n        }\n         else if (PostData.gadgetName ===   \"username\"){\n            UsernameForm = msg;\n        }\n        else if (PostData.gadgetType ===   \"CancelReset\"){\n            CancelReset = msg;\n        }\n  \n}\n\n\nreturn [ Menu, UsernameForm,  PasswordForm, CancelReset];","outputs":4,"noerr":0,"x":1930,"y":2157.9999961853027,"wires":[["7bc8a353.17418c"],["b3153c28.f9eb78"],["166d34e4.0920ab"],["ba5ecdcd.97009"]],"outputLabels":["Menu","UsernameForm","PasswordForm","CancelReset"]},{"id":"86f7d2bb.4375f8","type":"function","z":"aec22158.fe4e38","name":"finalize user account","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar hash = crypto.pbkdf2Sync(String(msg.RevotioData.PostData.gadgetData.formData.passwordOne), msg.RevotioData.FlowData.Data.UserData.salt, 1000, 64, 'sha1').toString('hex');\n\nmsg.payload.hash = hash\n               \n               \n// update    \n    updateObj = {\n                    query : {\n                            query :{_id: new ObjectID(msg.RevotioData.FlowData.Data.UserData._id)}, \n                            update :  {\"$set\" : {\n                                                   hash : hash,\n                                                   resetPassword : false,\n                                                  resetToken: \"\"\n                                               }},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.result = res\n                     msg.payload = {\n                                    Page :  global.get(\"DomainProperties.NonAuthDefaultPage\"),\n                                    // setToken : true,\n                                    RevotioData: {\n                                    }\n                                };\n                    node.send(msg) \n            })  \n            \n","outputs":1,"noerr":0,"x":2855,"y":2359.9999961853027,"wires":[["74c995c2.07940c"]],"outputLabels":["invalid, "]},{"id":"d43d088f.c70298","type":"function","z":"aec22158.fe4e38","name":"Prepair error response","func":"\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[1].error =  {\n                                                                    msg: \"Minimum eight characters, at least one uppercase letter, one lowercase letter, one number and one special character (@$!%*?&)\"\n                                                                    };\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[2].error =  {\n                                                                    msg: \"Minimum eight characters, at least one uppercase letter, one lowercase letter, one number and one special character (@$!%*?&)\"\n                                                                    };\n\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\":  \"e947591f-f70b-84c4-c2f7-5a78178ad897\",\n            \"gadgetName\":  \"Reset password form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":2855,"y":2279.9999961853027,"wires":[["98c425c5.4b0328"]]},{"id":"98c425c5.4b0328","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":2970,"y":2279.9999961853027,"wires":[]},{"id":"e585444.02f5db8","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":3025,"y":2279.9999961853027,"wires":[]},{"id":"7bc8a353.17418c","type":"link out","z":"aec22158.fe4e38","name":"","links":["8e48eec2.dcffb","47fe9e1a.f0bb9","f1a071ae.735c6","cd80bf04.26b1c","14418773.9dfa29"],"x":2130,"y":2099.9999961853027,"wires":[]},{"id":"e91706b2.256508","type":"comment","z":"aec22158.fe4e38","name":"Menu","info":"","x":2193.333297729492,"y":2098.333303451538,"wires":[]},{"id":"166d34e4.0920ab","type":"function","z":"aec22158.fe4e38","name":"Check if passwords match","func":"var invalid, valid;\n\nif(String(msg.RevotioData.PostData.gadgetData.formData.passwordOne) === String(msg.RevotioData.PostData.gadgetData.formData.passwordTwo)  ){\n\n  valid = msg;\n}\nelse{\n  invalid =  msg;\n}\n\nreturn [invalid, valid];","outputs":2,"noerr":0,"x":2215,"y":2259.9999961853027,"wires":[["343505e.c6a70fa"],["2e14c717.416758"]],"outputLabels":["invalid, ","valid"]},{"id":"343505e.c6a70fa","type":"function","z":"aec22158.fe4e38","name":"Prepair error response","func":"\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[1].error =  {\n                                                                    msg: \"Passwords dont match\"\n                                                                    };\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[2].error =  {\n                                                                    msg: \"Passwords dont match\"\n                                                                    };\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\":  \"e947591f-f70b-84c4-c2f7-5a78178ad897\",\n            \"gadgetName\":  \"Reset password form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":2515,"y":2219.9999961853027,"wires":[["7d81d17c.aaecb8"]]},{"id":"7d81d17c.aaecb8","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":2630,"y":2219.9999961853027,"wires":[]},{"id":"46b860cf.93db28","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":2685,"y":2219.9999961853027,"wires":[]},{"id":"85f2e522.8b14d","type":"function","z":"aec22158.fe4e38","name":"Prepair error response","func":"\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[0].error =  {\n                                                                    msg: \"User does not exist\"\n                                                                    };\n\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\":  \"e947591f-f70b-84c4-c2f7-5a78178ad897\",\n            \"gadgetName\":  \"username\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":2860,"y":2120,"wires":[["a9e514e2.43afa8"]]},{"id":"a9e514e2.43afa8","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":2975,"y":2120,"wires":[]},{"id":"ef4632a4.8742c8","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":2425,"y":2199.9999961853027,"wires":[]},{"id":"b3153c28.f9eb78","type":"function","z":"aec22158.fe4e38","name":"check if user exists","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty('username')){\n    msg.RevotioData.PostData.gadgetData.formData.username = msg.RevotioData.PostData.gadgetData.formData.username.toLowerCase()\n}\n\n// aggregate\n\n\n            aggregateObj = {\n                    query : { query : [ { \n                                        \"$match\" : {\n                                            username : msg.RevotioData.PostData.gadgetData.formData.username\n                                        }\n                                    }, \n                                    { \n                                        \"$lookup\" : {\n                                            \"from\" : \"user_accounts\", \n                                            \"localField\" : \"_id\", \n                                            \"foreignField\" : \"user\", \n                                            \"as\" : \"user_accounts\"\n                                        }\n                                    }, \n                                    { \n                                        \"$unwind\" : {\n                                            \"path\" : \"$user_accounts\", \n                                            \"preserveNullAndEmptyArrays\" : false\n                                        }\n                                    },\n                         \n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n            \n            \n       \n\n// return msg;","outputs":1,"noerr":0,"x":2305,"y":2139.9999961853027,"wires":[["2f1a3e82.d43b12"]]},{"id":"2f1a3e82.d43b12","type":"function","z":"aec22158.fe4e38","name":"Check if user exists","func":"var NoUser, User;\n// msg.RevotioData.userData = msg.payload[0];\n\n\n\nif (typeof msg.payload[0] === 'object' && msg.payload[0]._id){\n    \n    user_accounts = msg.payload[0].user_accounts\n    payload =   msg.payload[0]\n    \n    payload.user_accounts = user_accounts;\n    \n    msg.payload = payload\n    \n    msg.RevotioData.FlowData.Data.UserData = payload\n     User = msg;\n}else{\n    NoUser = msg;\n}\n\nreturn [NoUser, User];","outputs":2,"noerr":0,"x":2605,"y":2139.9999961853027,"wires":[["85f2e522.8b14d"],["3311b64e.a40e82"]],"outputLabels":["NoUser, ","User"]},{"id":"e54d16bc.54e4f","type":"function","z":"aec22158.fe4e38","name":"check if account is active === true","func":"var accountActive,accountInactive, LinkExpired;\n\nif (typeof msg.payload !== 'object' || msg.payload === null){\n    LinkExpired = msg;\n} else {\n    if (msg.payload.active === true){\n    accountActive = msg;\n    } else {\n         accountInactive = msg;\n    }\n}\n\n\nreturn [accountActive,accountInactive, LinkExpired];","outputs":3,"noerr":0,"x":1435,"y":859.9999961853027,"wires":[["a98198f0.0c996"],["c8628eb6.6a32a8"],["494991a.a3d73f"]],"outputLabels":["accountActive","accountInactive","LinkExpired"]},{"id":"a98198f0.0c996","type":"function","z":"aec22158.fe4e38","name":"redirect user","func":"\n msg.payload = {\n            Page :  global.get(\"DomainProperties.NonAuthDefaultPage\"),\n            RevotioData: {\n            }\n        };\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1725,"y":839.9999961853027,"wires":[["c374e685.14751"]]},{"id":"af88346b.2dfd","type":"function","z":"aec22158.fe4e38","name":"Reset password form Form","func":"\n    \ngadgetsList =[{\n            \"gadgetId\":  \"e947591f-f70b-84c4-c2f7-5a78178ad897\",\n            \"gadgetName\":  \"Reset password form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": {\n                  id: 'Login',\n                  canceled: false, // false\n                  submitButtonText: 'Submit',\n                  prevButtonText: 'Previous',\n                  nextButtonText: 'Next',\n                  showPrevious: false, //false\n                  title: 'Reset password',\n                  steps: [\n                    {\n                      title: '',\n                      subtitle: '',\n                      fields: [\n                          {\n                          name: 'username',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value:msg.RevotioData.FlowData.Data.UserData.username ,\n                            label: 'Email address',\n                            placeholder: '',\n                            type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            editable: false ,// false by default\n                           required: true,\n                           disabled:true\n                            \n                          }\n                        },\n                        {\n                          name: 'passwordOne',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value:\"\" ,\n                            label: 'New password',\n                            placeholder: '',\n                            type: 'password', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            editable: true ,// false by default\n                           required: true\n                            \n                          }\n                        },\n                        {\n                          name: 'passwordTwo',\n                          htmlTag: 'input',  // button | select | textarea\n                          options: {\n                            value:\"\" ,\n                            label: 'New password (again)',\n                            placeholder: '',\n                            type: 'password', // default: text | button | checkbox | date | email | number | password | radio | submit\n                            editable: true ,// false by default\n                           required: true\n                            \n                          }\n                        },\n                    ]}\n                  ]\n                }},\n            ]\n\nmsg.payload = {gadgetsList:gadgetsList};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":2200,"wires":[["881d9107.af00e"]]},{"id":"881d9107.af00e","type":"link out","z":"aec22158.fe4e38","name":"","links":["1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":1235,"y":2200,"wires":[]},{"id":"3311b64e.a40e82","type":"function","z":"aec22158.fe4e38","name":"Generate and update appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.RevotioData.FlowData.Data.UserData.resetToken = crypto.randomBytes(25).toString('hex');\n\n// update    \n    updateObj = {\n                    query : {\n                            query : { _id : new ObjectID(msg.RevotioData.FlowData.Data.UserData._id)}, \n                            update :  { \"$set\" :{resetToken : msg.RevotioData.FlowData.Data.UserData.resetToken}},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.result = res\n                    node.send(msg) \n            })  \n            ","outputs":1,"noerr":0,"x":2890,"y":2160,"wires":[["16731a52.126fe6","78e9ce03.4f11c"]]},{"id":"5b61eb52.bcc75c","type":"function","z":"aec22158.fe4e38","name":"check if resetToken is present","func":"var present, notPresent; \n\nif (msg.RevotioData.FlowData.resetToken){\n    present = msg;\n} else {\n    notPresent = msg;\n}\nreturn [present, notPresent];","outputs":2,"noerr":0,"x":245,"y":2239.9999961853027,"wires":[["d554894d.135478","249a8713.6784"],["fbfb1b97.df21f8"]],"outputLabels":["present","notPresent"]},{"id":"8f35e986.f06c78","type":"function","z":"aec22158.fe4e38","name":"Check if user is found and if resetToken is valid","func":"var ValidToken, InvalidToken;\n\nif (typeof msg.payload === 'object' || msg.payload === null){\n    msg.RevotioData.FlowData.Data = {UserData : msg.payload}\n    ValidToken = msg;\n} else {\n    InvalidToken = msg;\n}\n\nreturn [ValidToken, InvalidToken];","outputs":2,"noerr":0,"x":760,"y":2220,"wires":[["af88346b.2dfd","71332273.c1870c"],["d97eeec5.bf9518"]],"outputLabels":["ValidToken, ","InvalidToken"]},{"id":"494991a.a3d73f","type":"function","z":"aec22158.fe4e38","name":"prepair redirect to NonAuthDefaultPage","func":"msg.payload  = {\n    Page :global.get(\"DomainProperties.NonAuthDefaultPage\"),\n}\nreturn msg;","outputs":1,"noerr":0,"x":1815,"y":919.9999961853027,"wires":[["fa60834f.7ab0f"]]},{"id":"d97eeec5.bf9518","type":"function","z":"aec22158.fe4e38","name":"prepair redirect to NonAuthDefaultPage","func":"msg.payload  = {\n    Page :global.get(\"DomainProperties.NonAuthDefaultPage\"),\n}\nreturn msg;","outputs":1,"noerr":0,"x":1140,"y":2240,"wires":[["5e3c68e9.35887"]]},{"id":"6bba7999.73091","type":"comment","z":"e5822137.be45d","name":"organizations global","info":"","x":90,"y":240,"wires":[]},{"id":"4c98a046.12853","type":"comment","z":"e5822137.be45d","name":"Organization global gadgets","info":"","x":1420,"y":240,"wires":[]},{"id":"ad43cd91.431cc8","type":"comment","z":"e5822137.be45d","name":"Organization global gagdet actions","info":"","x":3280,"y":240,"wires":[]},{"id":"2593799.dd12e06","type":"comment","z":"e5822137.be45d","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2430,"y":200,"wires":[]},{"id":"90f055d0.958ee8","type":"link in","z":"e5822137.be45d","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","e6c8f68c.3a8fd"],"x":735,"y":420,"wires":[["2cc71536.88996a","c7460c54.ee33b"]]},{"id":"5ff89a19.327a54","type":"function","z":"e5822137.be45d","name":"Route userAction","func":"var CreateOrganizationTrigger, FormAction, OpenOrganization, MenuAction ,RevotioBreadCrumbs\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n\nif (PostData.gadgetType=== \"dynamic-btn\"&& PostData.gadgetName === \"create organization\"){\n    CreateOrganizationTrigger = msg;\n} else if (PostData.gadgetType=== \"custom-form\"){\n    FormAction = msg;\n} else if (PostData.gadgetType=== \"data-table\"){\n    \n    if (PostData.gadgetData.hasOwnProperty(\"buttonData\") === true){\n        CreateOrganizationTrigger = msg;\n    } else {\n         OpenOrganization = msg;\n    }\n} else if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else if (PostData.gadgetType=== \"revotio-breadcrumbs\"){\n    RevotioBreadCrumbs  = msg;\n}\n\n\n\nreturn [CreateOrganizationTrigger, FormAction, OpenOrganization, MenuAction, RevotioBreadCrumbs];","outputs":"5","noerr":0,"x":3270,"y":340,"wires":[["42ba8494.e47aec"],["62533240.e8b54c"],["4d3d3f17.7ceb2"],["b4232b59.fc3c9"],["860d2caf.36873"]],"outputLabels":["CreateOrganizationTrigger","FormAction","OpenOrganization","MenuAction","RevotioBreadCrumbs"]},{"id":"a3d15c2e.a18008","type":"debug","z":"e5822137.be45d","name":"Organiozation Global Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3320,"y":280,"wires":[]},{"id":"2cc71536.88996a","type":"link out","z":"e5822137.be45d","name":"Trigger gadgets","links":["1198ab94.12521c","76bbdec4.14e998","58327abd.8edce4","a04c82ab.77936","e714ad41.62fe18","a00aba6e.69bb58","26c29dda.6daf62","cd9f1d1b.bf34"],"x":1115,"y":420,"wires":[]},{"id":"73fab343.93d92c","type":"comment","z":"e5822137.be45d","name":"INIT FLOW","info":"","x":700,"y":380,"wires":[]},{"id":"a04c82ab.77936","type":"link in","z":"e5822137.be45d","name":"** Gadget Name **","links":["2cc71536.88996a"],"x":1375,"y":280,"wires":[["41fcbe10.63615"]]},{"id":"c7460c54.ee33b","type":"debug","z":"e5822137.be45d","name":"Organiozation Global INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":910,"y":380,"wires":[]},{"id":"41fcbe10.63615","type":"function","z":"e5822137.be45d","name":"Get org records","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\n\nvar OrgIds = [];\nindex = -1\n_.each(msg.RevotioData.session.UserData.AppUserPermissionInfo, function(Item, Index ){\n    // if (Item.type_id === global.get(\"MasterOrganizationData._id\")){\n  if (String(Item.type_id) === String(global.get(\"MasterOrganizationData._id\")) ){\n//   if (new ObjectID(Item.type_id) === new ObjectID(global.get(\"MasterOrganizationData._id\")) ){\n       index =  Index\n    }\n})\nif (index > -1 || msg.RevotioData.session.UserData.UserAccountData.user_type === \"Admin_Users\" ){\n//   match = {\"_id\": {\"$ne\": new ObjectID(global.get(\"MasterOrganizationData._id\"))}};\n    // msg.operation = \"find.toArray\";\n    \n    msg.payload = { parent_id: { $exists: false} , _id: {\"$ne\": new ObjectID(global.get(\"MasterOrganizationData._id\"))}};\n    msg.operation = \"find.toArray\";\n} else {\n    // get organization ID's\n    \n    var ids = [];\n    \n    _.each(msg.RevotioData.session.UserData.AppUserPermissionInfo, function(Item, Index){\n        if (Item.type === \"organization\"){\n            ids.push(Item.type_id)\n        }\n        msg.payload = { parent_id: { $exists: false} , _id: {\"$in\": ids}};\n        msg.operation = \"find.toArray\";\n    })\n    \n}\n\n// find  \nfindObj = {\n                    query : {\n                            query : msg.payload, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n\n\n\n// return msg;","outputs":1,"noerr":0,"x":1460,"y":280,"wires":[["2505354a.38e0ca","a7691843.e08928","e1288258.b5e2a"]]},{"id":"4d3d3f17.7ceb2","type":"function","z":"e5822137.be45d","name":"Open org.","func":"msg.payload = {\n    Page :   'organization overview',\n    RevotioData: {\n        organization_id : msg.RevotioData.PostData.gadgetData.data._id\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"x":3640,"y":360,"wires":[["6f35ce9c.ca2728"]]},{"id":"42ba8494.e47aec","type":"function","z":"e5822137.be45d","name":"Set Form Data","func":"    msg.RevotioData.FlowData.Form = {\n        FormType : \"Organization\",\n        FormActionType : \"Create\",\n        // Type : \"Create\",\n    };\nreturn msg;","outputs":1,"noerr":0,"x":3620,"y":260,"wires":[["229e849a.2b771c"]]},{"id":"62533240.e8b54c","type":"function","z":"e5822137.be45d","name":"Set Form Data","func":"// if (msg.RevotioData.FlowData.Form.hasOnwFormActionType)\n    // msg.RevotioData.FlowData.Form.Type = msg.RevotioData.FlowData.Form.FormActionType\nmsg.RevotioData.FlowData.Form.FormActionType = \"Post\";\n\nreturn msg;","outputs":1,"noerr":0,"x":3620,"y":320,"wires":[["229e849a.2b771c"]]},{"id":"a7691843.e08928","type":"function","z":"e5822137.be45d","name":"Count Organizations Card","func":"\n\n\nvar cardData = { \"cardType\":\"success\", \"cardTitle\":\"Organizations : \" , cardContentValue:  msg.payload.length,\"cardBottonValue\":\"\" } ;\n\n// Create GadgetList message\nmsg.payload = {gadgetsList:[{\n\n            \"gadgetId\":  \"448ba930-0610-ddc3-f8d7-bd9050e475aa\",\n            \"gadgetName\": \"Count Organizations\",\n            \"gadgetType\": \"data-card\",\n            \"gadgetData\": cardData\n            \n                     \n}]};\n\nreturn msg;","outputs":1,"noerr":0,"x":1690,"y":280,"wires":[["4ae71785.1c5fc"]]},{"id":"2505354a.38e0ca","type":"function","z":"e5822137.be45d","name":"Create Organizations DT","func":"var _ = global.get('underscore');\nvar lodash = global.get('lodash');\nvar columnStyles = [] ;\nvar headerStyles = [] ;\n\nvar tableColumnData  =  {\n         columnHead : [\n                  {\n                    \"title\": \"Name\",\n                    \"allowSort\": true,\n                    \"headKey\": \"Name\",\n                    \"hidden\": false,\n                    \"editable\": false\n                  },\n                            {\n                    \"title\": \"Legal entity\",\n                    \"allowSort\": true,\n                    \"headKey\": \"Legal entity\",\n                    \"hidden\": false,\n                    \"editable\": false\n                  },\n                  {\n                    \"title\": \"Type\",\n                    \"allowSort\": true,\n                    \"headKey\": \"Type\",\n                    \"hidden\": false,\n                    \"editable\": false\n                  },\n                //   {\n                //     \"title\": \"Multiple entity\",\n                //     \"allowSort\": true,\n                //     \"headKey\": \"Multiple entity\",\n                //     \"hidden\": false,\n                //     \"editable\": false\n                //   }\n                ],\n          \"columnOptions\": {\n            \"columnStyle\": {\n              \"width\": \"30%\"\n            },\n            \"cellStyle\": {\n            //   \"color\": \"red\"\n            },\n            \"allowSort\": true\n          }\n        };\n\n// var columns = [\n//                   {\n//                     \"title\": \"Name\",\n//                     \"allowSort\": true,\n//                     \"headKey\": \"name\",\n//                     \"hidden\": false,\n//                     \"editable\": false\n//                   },\n//                             {\n//                     \"title\": \"Legal entity\",\n//                     \"allowSort\": true,\n//                     \"headKey\": \"legal_entity\",\n//                     \"hidden\": false,\n//                     \"editable\": false\n//                   },\n//                   {\n//                     \"title\": \"Type\",\n//                     \"allowSort\": true,\n//                     \"headKey\": \"type\",\n//                     \"hidden\": false,\n//                     \"editable\": false\n//                   },\n//                   {\n//                     \"title\": \"Multiple entity\",\n//                     \"allowSort\": true,\n//                     \"headKey\": \"multiple_entity\",\n//                     \"hidden\": false,\n//                     \"editable\": false\n//                   },\n//                   {\n//                     \"title\": \"_id\",\n//                     \"allowSort\": true,\n//                     \"headKey\": \"_id\",\n//                     \"hidden\": true,\n//                     \"editable\": false\n//                   }\n                  \n//                 ]\n// commen buttons\n// var buttons = [ 'export'];  \nvar tableRowData = [];\n_.each(lodash.orderBy(msg.payload, [\"name\"],[\"asc\"]),function(orgItem, orgItemIndex){\n\n    obj = {\n            \"rowData\":[\n                  {\n                  \n              \n                            \"data\":  orgItem.name,\n                             \"type\": \"string\",\n                           \n                            \"headKey\":\"Name\",\n                            \"hidden\": false,\n                            \"editable\": false\n                          },\n                            {\n                            \"data\":  orgItem.legal_entity,\n                            \"type\": \"string\",\n                            \"headKey\": \"Legal entity\",\n                            \"hidden\": false,\n                            \"editable\": false\n                          },\n                            {\n                            \"data\": orgItem.type,\n                            \"type\": \"string\",\n                            \"headKey\":\"Type\",  \n                            \"hidden\": false,\n                            \"editable\": false\n                          },\n                            {\n                            \"data\": orgItem.multiple_entity,\n                             \"type\": \"string\",\n                            \"headKey\": \"Multiple entity\", \n                            \"hidden\": false,\n                            \"editable\": false\n                          },\n                          {\n                            \"data\":  orgItem._id,\n                            \"type\": \"string\",\n                            \"headKey\": \"_id\",\n                            \"hidden\": false,\n                            \"editable\": false\n                          },\n                        ],\n                    \"rowOptions\": {\n                    //   \"state\": \"warning\",\n                      \"globalClick\": true,\n                      \"style\": {\n                        \"width\": \"20%\"\n                      }\n                    },\n                    \"rowSourceData\":orgItem\n            }\n    \n    tableRowData.push(obj);\n})\n\ntableButton = [\n    {\n       \"buttonData\":\n          {\n           \"title\": \"Create\",\n            \"design\": {\n               \"file\": \"\",\n                \"icon\":global.get(\"icons.fas.create\") ,\n                // \"width\": \"\",\n                size :\"small\",\n                \"embossed\": true,\n                \"linebox\": true,\n                \"gradient\": false,\n                // \"color\": \"green\",\n                // padding : \"10px\"\n              },\n          \n              \"disabled\": false,\n            // \"type\": \"success\",\n                action: 'create',\n\n          },\n        \"buttonOptions\": {\n            \"dataType\": \"single\",\n            \"displayType\": \"text\",\n            \"selectionType\": \"global\"\n          }\n         }\n      \n      ]\n\n\n \nmsg.payload = {\n     gadgetsList :[ {\n        \"gadgetId\": \"5682828f-6f71-730f-6058-a1bd588add37\",\n        \"gadgetName\": \"Organizations DT\",\n        \"gadgetType\": \"data-table\",\n            \n    \"gadgetOptions\": {\n      \"allowSearch\": true,\n      \"maxItems\": tableRowData.length,\n      \"striped\": true,\n      \"export\": true\n    },\n    \"gadgetData\": {\n      \"tableColumnData\": tableColumnData,\n      \"tableTitle\": \"Organizations\",\n      \"tableRowData\": tableRowData ,\n      \"tableButton\": tableButton,\n      \"tableOptions\": {\n        \"mainOption\": \"global\"\n      }\n    }\n  }]}\n  \n  \n// msg.payload = {\n//      gadgetsList : [global.get(\"functions.dataTableObject\")(GadgetObject, columns, msg.payload)] \n\n//  } \nreturn msg;\n","outputs":1,"noerr":0,"x":1690,"y":240,"wires":[["5002c494.80c03c"]]},{"id":"91850e71.061e1","type":"link in","z":"e5822137.be45d","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","c44b4bde.0df218"],"x":2935,"y":320,"wires":[["a3d15c2e.a18008","5ff89a19.327a54"]]},{"id":"4ae71785.1c5fc","type":"link out","z":"e5822137.be45d","name":"","links":["e840ddd7.11a94","b4124e7e.13a8c8","f08dbd30.19106","ade0a880.e9e3","8ad43811.fd07d","74cebd07.0f68ec","ca494f41.c9ae08","c0a93485.127778","9c22e19d.5d8b4","8b5b3ea9.8d95d","a290aa5e.2d5bd8","62cd4701.1412e8","ec762598.4c2af8","9f7a0e6d.1758e8","c26c7f96.20094","3284eff1.d8cd78","d5c0b170.80cb78","11b5fac2.b2221d","4c93583.818b628","283ed720.02f7a","8414ff77.fcbb8","eefe6ecb.492078","33d6d74c.25aeb8","aba290c9.ab162","c37dfc7e.43b73","df85e4a9.ff02f8","527cdfb6.14653","7f33fea0.9165c","a23ff887.2048e8","4fdab1fb.c42528","ded62554.44e988"],"x":1815,"y":280,"wires":[]},{"id":"5002c494.80c03c","type":"link out","z":"e5822137.be45d","name":"","links":["e840ddd7.11a94","b4124e7e.13a8c8","f08dbd30.19106","ade0a880.e9e3","8ad43811.fd07d","74cebd07.0f68ec","ca494f41.c9ae08","c0a93485.127778","9c22e19d.5d8b4","8b5b3ea9.8d95d","a290aa5e.2d5bd8","62cd4701.1412e8","ec762598.4c2af8","9f7a0e6d.1758e8","c26c7f96.20094","3284eff1.d8cd78","d5c0b170.80cb78","11b5fac2.b2221d","4c93583.818b628","283ed720.02f7a","8414ff77.fcbb8","eefe6ecb.492078","33d6d74c.25aeb8","aba290c9.ab162","c37dfc7e.43b73","df85e4a9.ff02f8","527cdfb6.14653","7f33fea0.9165c","a23ff887.2048e8","4fdab1fb.c42528","ded62554.44e988"],"x":1835,"y":240,"wires":[]},{"id":"b7978fa4.f54cb","type":"function","z":"e5822137.be45d","name":"create organization btn","func":"msg.payload = \n    {\n   \"gadgetsList\":[{            \n       \"gadgetId\": \"092dc49e-14ce-a387-f97b-e65d303faf86\",\n            \"gadgetName\":\"create organization\",\n            \"gadgetType\":\"dynamic-btn\",\n            \"gadgetOptions\":\n                {\n                //  url:   \"http://localhost:1881/#/pageBuilder/5bacdd9fb9bf1c120bef1088/page/5bc987181e040202e7b74589\",\n                //  target: \"_blank\",\n                \"types\":\"\",\n                \"styles\":[\"btn-embossed\",\n                \"btn-success\",\"btn-square\"],\n                \"buttonalign\":\"right\",\n                \"textcolor\":\"black\",\n                \"buttonlabel\":\"Create new organization\"},\n                \"gadgetData\":{}\n       \n   }]\n\n                // \"gadgetData\":{\"DropdownData\":[{\"label\":\"Employee based\",\"action\":\"Employee\"},{\"label\":\"Project based\",\"action\":\"Project\"}]}}]\n\n} ;   \nreturn msg;","outputs":1,"noerr":0,"x":1500,"y":360,"wires":[["fb03028f.7d0f4"]]},{"id":"fb03028f.7d0f4","type":"link out","z":"e5822137.be45d","name":"","links":["e840ddd7.11a94","b4124e7e.13a8c8","f08dbd30.19106","ade0a880.e9e3","8ad43811.fd07d","74cebd07.0f68ec","ca494f41.c9ae08","c0a93485.127778","9c22e19d.5d8b4","8b5b3ea9.8d95d","a290aa5e.2d5bd8","62cd4701.1412e8","ec762598.4c2af8","9f7a0e6d.1758e8","c26c7f96.20094","3284eff1.d8cd78","d5c0b170.80cb78","11b5fac2.b2221d","4c93583.818b628","283ed720.02f7a","8414ff77.fcbb8","eefe6ecb.492078","33d6d74c.25aeb8","aba290c9.ab162","c37dfc7e.43b73","df85e4a9.ff02f8","527cdfb6.14653","7f33fea0.9165c","a23ff887.2048e8","4fdab1fb.c42528","ded62554.44e988"],"x":1835,"y":360,"wires":[]},{"id":"76bbdec4.14e998","type":"link in","z":"e5822137.be45d","name":"** Gadget Name **","links":["2cc71536.88996a"],"x":1375,"y":360,"wires":[["b7978fa4.f54cb"]]},{"id":"62867a86.49ad5c","type":"function","z":"aec22158.fe4e38","name":"Prepair redirect","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nvar PNO , Client, update;\n\nmsg.RevotioData.session.UserData =  msg.payload;\n\n// set login Date info\n\nmsg.RevotioData.session.UserData.previousLogin = new Date(msg.RevotioData.session.UserData.login)\nmsg.RevotioData.session.UserData.login = new Date()\n\nupdate = msg;\nmsg.RevotioData.session.UserData.type = \"NonPNOAdmin\"\n\n_.each(msg.RevotioData.session.UserData.AppUserPermissionInfo, function(Item, Index){\n    \n    if (Item.type === \"organization\"){\n        \n        if (String(Item.type_id) === String(global.get(\"MasterOrganizationData._id\")) && Item.permission === 0){\n            msg.RevotioData.session.UserData.type = \"PNOAdmin\"\n        }\n        \n        \n    }\n    \n})\n\n\nif (msg.RevotioData.FlowData.hasOwnProperty(\"Page\") === false){\n    // check if user is a PNO user\n    \n    if (msg.RevotioData.session.UserData.UserAccountData.user_type === \"Admin_Users\"){\n    msg.RevotioData.FlowData.Page = global.get(\"DomainProperties.PNODefaultPage\")\n    msg.payload = {\n                Page  :   msg.RevotioData.FlowData.Page\n    }\nPNO = msg;\n    } else {\n        \n\n        \n Client = msg\n        \n    }\n   \n}\n\n\nreturn [PNO , Client, update];","outputs":3,"noerr":0,"x":2715,"y":379.99999618530273,"wires":[["7d4e09a6.9a835"],["1bf31fd6.55c3a8"],["7951c57e.e01884"]],"outputLabels":["PNO","Client","update"]},{"id":"1bf31fd6.55c3a8","type":"function","z":"aec22158.fe4e38","name":"Get participants && projects","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nUserOrgPermissionObj = lodash.find(msg.RevotioData.session.UserData.AppUserPermissionInfo,{type: \"organization\"} );\n\n\n\n// find  \nfindObj = {\n                    query : {\n                            query :{organization_id:new ObjectID(UserOrgPermissionObj.type_id), contact_person_organization:new ObjectID(msg.RevotioData.session.UserData._id) }, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'participants',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n   \n                msg.RevotioData.session.UserData.OrgRepresentativeProjects = res\n\n                // find  \n                    findObj = {\n                                        query : {\n                                                query :{ project_leader : new ObjectID(msg.RevotioData.session.UserData._id)} , \n                                                },\n                                        connection:global.get(\"DB_data.connection\"),\n                                        database:global.get(\"DB_data.appDB\"),\n                                        collection:'projects',\n                                        operation:'find',\n                                        }\n                    \n                                        mongodbTools.resolveAsync(findObj, node, function(res){\n                               \n                                            // msg.RevotioData.session.UserData.OrgRepresentativeProjects = res\n                            \n                                            msg.RevotioData.session.UserData.ProjectLeaderProjects= res;\n                            \n                            \n                                                node.send(msg) \n                                        })\n            })   \n\n// return msg;\n\n","outputs":1,"noerr":0,"x":3060,"y":440,"wires":[["7ab33dc3.9bebac"]]},{"id":"7ab33dc3.9bebac","type":"function","z":"aec22158.fe4e38","name":"Permission check ","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\nOrgObj = lodash.find(msg.RevotioData.session.UserData.AppUserPermissionInfo, {type: \"organization\"})\n\nif (msg.RevotioData.session.UserData.ProjectLeaderProjects.length === 0 && msg.RevotioData.session.UserData.OrgRepresentativeProjects.length === 0){\n    \n            msg.RevotioData.FlowData.Page = global.get(\"DomainProperties.PNODefaultPage\")\n            msg.RevotioData.OrganzationId = OrgObj.type_id;\n            msg.RevotioData.FlowData.organization_id = OrgObj.type_id;\n        \n       \n} else {\n        \n                msg.RevotioData.FlowData.Page = global.get(\"DomainProperties.ClientDefaultPage\")\n                msg.RevotioData.OrganzationId = OrgObj.type_id;\n                msg.RevotioData.FlowData.organization_id = OrgObj.type_id;\n         \n         \n\n}\n\n            msg.payload = {\n                    Page                 :   msg.RevotioData.FlowData.Page,\n                    RevotioData         : {\n                        organization_id : OrgObj.type_id\n                    }\n                }\n\n\nreturn msg;","outputs":1,"noerr":0,"x":3290,"y":440,"wires":[["7d4e09a6.9a835"]]},{"id":"bf863fcb.3b803","type":"subflow:45759581.11da84","z":"e5822137.be45d","name":"","env":[],"x":1430,"y":400,"wires":[["c36f0764.45994"]]},{"id":"58327abd.8edce4","type":"link in","z":"e5822137.be45d","name":"** Gadget Name **","links":["2cc71536.88996a"],"x":1375,"y":400,"wires":[["bf863fcb.3b803"]]},{"id":"b4a3b5aa.487f6","type":"link out","z":"e5822137.be45d","name":"","links":["e840ddd7.11a94","b4124e7e.13a8c8","f08dbd30.19106","ade0a880.e9e3","8ad43811.fd07d","74cebd07.0f68ec","ca494f41.c9ae08","c0a93485.127778","9c22e19d.5d8b4","8b5b3ea9.8d95d","a290aa5e.2d5bd8","62cd4701.1412e8","ec762598.4c2af8","9f7a0e6d.1758e8","c26c7f96.20094","3284eff1.d8cd78","d5c0b170.80cb78","11b5fac2.b2221d","4c93583.818b628","283ed720.02f7a","8414ff77.fcbb8","eefe6ecb.492078","33d6d74c.25aeb8","aba290c9.ab162","c37dfc7e.43b73","df85e4a9.ff02f8","527cdfb6.14653","7f33fea0.9165c","a23ff887.2048e8","4fdab1fb.c42528","ded62554.44e988"],"x":1695,"y":400,"wires":[]},{"id":"e1288258.b5e2a","type":"function","z":"e5822137.be45d","name":"Breadcrumb organizations","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\n\nOrgKeysOptions = [];\n\n_.each(msg.payload, function(Item, Index){\n    \n    if (String(Item._id) === String(msg.RevotioData.FlowData.organization_id)){\n        selected = true\n    } else {\n        selected = false\n    }\n    \n    OrgKeysOptions.push({\n              \"title\": Item.name,\n              selected:selected,\n              \"design\": {\n                \"icon\": global.get(\"icons.fas.organization\")\n              },\n              \"action\": {\n                Page : 'organization overview',\n                organization_id: Item._id,\n                icon: global.get(\"icons.fas.organization\"),\n                key: \"organization\",\n                value: Item.name \n              }\n            })\n})\n\n\nvar data = [\n    {\n        \"buttonData\": {\n                      \"title\": \"Organizations\",\n                      \"allowsearch\": true,\n                      titleDisplayType: \"selected\",\n                      \"design\": {\n                        \"icon\": global.get(\"icons.fas.organization\")\n                      },\n                      subButton:[{\n                            icons : global.get(\"icons.fas.create\"),\n                            action : {\n                                                FormType : \"Organization\",\n                                                FormActionType : \"Create\",\n                                                // FormData: msg.RevotioData.FlowData.Data.OrganizationData,\n                                                // organization_id : msg.RevotioData.FlowData.Data.OrganizationData._id\n                                            },\n                            color : \"green\" ,\n                            tooltip: \"Create a new organization\"\n                      }],\n                      \"options\":OrgKeysOptions,\n                    //   \"action\": {}\n                    },\n        \"buttonOptions\": {\n          \"dataType\": \"multiple\",\n          \"displayType\": \"text\"\n        }\n      }]\n\n    \nmsg.payload = {\n    gadgetsList: [{\n                \"gadgetId\": \"593e0f9b-f4f2-d2e3-fc56-2aa3eb9ccfc6\",\n              \"gadgetName\": \"scope breadcrumb\",\n              \"gadgetType\": \"revotio-breadcrumbs\",\n                gadgetData: data,\n                gadgetOptions: {\n                    disabled:false,\n                    separatorIcon: 'fas fa-angle-right',\n                }\n              }]}\n\nreturn msg;","outputs":1,"noerr":0,"x":1700,"y":320,"wires":[["f10a8582.df74b"]]},{"id":"f10a8582.df74b","type":"link out","z":"e5822137.be45d","name":"","links":["e840ddd7.11a94","b4124e7e.13a8c8","f08dbd30.19106","ade0a880.e9e3","8ad43811.fd07d","74cebd07.0f68ec","ca494f41.c9ae08","c0a93485.127778","9c22e19d.5d8b4","8b5b3ea9.8d95d","a290aa5e.2d5bd8","62cd4701.1412e8","ec762598.4c2af8","9f7a0e6d.1758e8","c26c7f96.20094","3284eff1.d8cd78","d5c0b170.80cb78","11b5fac2.b2221d","4c93583.818b628","283ed720.02f7a","8414ff77.fcbb8","eefe6ecb.492078","33d6d74c.25aeb8","aba290c9.ab162","c37dfc7e.43b73","df85e4a9.ff02f8","527cdfb6.14653","7f33fea0.9165c","a23ff887.2048e8","4fdab1fb.c42528","ded62554.44e988"],"x":1835,"y":320,"wires":[]},{"id":"ab10a2d5.fc6ad","type":"catch","z":"2294209a.0c95b","name":"","scope":null,"x":60,"y":240,"wires":[["58ea0e0c.87eda"]]},{"id":"58ea0e0c.87eda","type":"debug","z":"2294209a.0c95b","name":"ERROR","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","x":178.33332443237305,"y":239.99999618530273,"wires":[]},{"id":"777db7e9.fd3678","type":"comment","z":"2294209a.0c95b","name":"users global","info":"","x":70,"y":320,"wires":[]},{"id":"96263bd.b412fc8","type":"debug","z":"2294209a.0c95b","name":"users global INIT POST  ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"RevotioData","targetType":"msg","x":1070,"y":560,"wires":[]},{"id":"8c63f461.7ede2","type":"debug","z":"2294209a.0c95b","name":"users global action ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"RevotioData.PostData","targetType":"msg","x":2650,"y":440,"wires":[]},{"id":"dfb51746.eb5818","type":"comment","z":"2294209a.0c95b","name":"users global action ","info":"","x":2650,"y":320,"wires":[]},{"id":"a3a4efb5.82b6a8","type":"function","z":"2294209a.0c95b","name":"Route userAction","func":"var BtnAction, FormAction, OpenOrganization, MenuAction ,RevotioBreadCrumbs, sliderAction, tabsSelect\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n\nif (PostData.gadgetType=== \"dynamic-btn\"){\n    BtnAction = msg;\n} else if (PostData.gadgetType=== \"custom-form\"){\n    FormAction = msg;\n} else if (PostData.gadgetType=== \"data-table\"){\n    \n    if (PostData.gadgetData.hasOwnProperty(\"buttonData\") === true){\n        CreateOrganizationTrigger = msg;\n    } else {\n         OpenOrganization = msg;\n    }\n} else if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else if (PostData.gadgetType=== \"revotio-breadcrumbs\"){\n    RevotioBreadCrumbs  = msg;\n} else if (PostData.gadgetType=== \"user-slider\"){\n    sliderAction  = msg;\n} else if (PostData.gadgetType === \"revotio-tabs-select\"){\n            tabsSelect = msg\n\n    }\n\n\n\nreturn [BtnAction, FormAction, OpenOrganization, MenuAction, RevotioBreadCrumbs, sliderAction, tabsSelect];","outputs":7,"noerr":0,"x":2650,"y":540,"wires":[["5df13deb.3acd8c"],["52927150.b34eb8"],[],["de32b4e0.6e0cb"],["de0a486c.213f5"],["36833fec.f99c5"],[]],"outputLabels":["BtnAction","FormAction","OpenOrganization","MenuAction","RevotioBreadCrumbs","sliderAction","tabsSelect"]},{"id":"52927150.b34eb8","type":"function","z":"2294209a.0c95b","name":"Set Form Data","func":"\nmsg.RevotioData.FlowData.Form.Type = msg.RevotioData.FlowData.Form.FormActionType\nmsg.RevotioData.FlowData.Form.FormActionType = \"Post\";\n\nreturn msg;","outputs":1,"noerr":0,"x":2980,"y":540,"wires":[["6db87728.a54d58"]]},{"id":"b4ce0864.df5ff8","type":"function","z":"2294209a.0c95b","name":"Set Form Data","func":"    msg.RevotioData.FlowData.Form = {\n        FormType : \"User\",\n        FormActionType : \"Create\",\n        // FormData :{\n            organization_id: msg.RevotioData.FlowData.organization_id\n        // }\n    };\nreturn msg;","outputs":1,"noerr":0,"x":3400,"y":400,"wires":[["a59768fe.a6a258"]]},{"id":"b09f7e8.6839d8","type":"comment","z":"2294209a.0c95b","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2430,"y":280,"wires":[]},{"id":"32bc6eb7.c073aa","type":"link in","z":"2294209a.0c95b","name":"users global INIT ","links":["c5aa2d02.8f412","f366e4ef.12135","b0ae31e0.11c9e8"],"x":915,"y":600,"wires":[["96263bd.b412fc8","12877cee.3216e3"]]},{"id":"3a23c4b4.bdc8a4","type":"link in","z":"2294209a.0c95b","name":"users global action ","links":["a73b1515.e10af","c01419a1.2a769","be4224db.bfd728"],"x":2495,"y":540,"wires":[["a3a4efb5.82b6a8","8c63f461.7ede2"]]},{"id":"aea25a8a.fa4a58","type":"link out","z":"2294209a.0c95b","name":"","links":["b99d146e.edaab","4c702830.810f","bad52f95.bf573","5db440a.6f3ea4","77ece62a.01347","c114b448.029c4","449e3134.053a68"],"x":1195,"y":600,"wires":[]},{"id":"b99d146e.edaab","type":"link in","z":"2294209a.0c95b","name":"users global = slider Gagdet","links":["aea25a8a.fa4a58"],"x":1415,"y":520,"wires":[["54bebd9c.e00f24"]]},{"id":"4c702830.810f","type":"link in","z":"2294209a.0c95b","name":"users global = BTN Gagdet","links":["aea25a8a.fa4a58"],"x":1415,"y":560,"wires":[["5fe4db8e.07be7c"]]},{"id":"bad52f95.bf573","type":"link in","z":"2294209a.0c95b","name":"users global = ACC Gagdet","links":["aea25a8a.fa4a58"],"x":1375,"y":600,"wires":[[]]},{"id":"54bebd9c.e00f24","type":"function","z":"2294209a.0c95b","name":"\"users slider\"","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\n// aggregate\n                   aggregateObj = {\n                    query : { query : [{\n                                $match: {\n                                  \"type_id\": new ObjectID(msg.RevotioData.FlowData.organization_id),\n                                  \"type\": \"organization\"\n                                }\n                              },\n                              {\n                                $lookup: {\n                                  \"from\": \"user_accounts\",\n                                  \"localField\": \"user\",\n                                  \"foreignField\": \"user\",\n                                  \"as\": \"user_accounts\"\n                                }\n                              },\n                               {\n                                $lookup: {\n                                  \"from\": \"users\",\n                                  \"localField\": \"user\",\n                                  \"foreignField\": \"_id\",\n                                  \"as\": \"users\"\n                                }\n                              },\n                            //   {\n                            //     $project: {\n                            //       \"permission\": 1.0,\n                            //       \"projectData.name\": 1.0\n                            //     }\n                            //   },\n                              {\n                                $unwind: {\n                                  \"path\": \"$user_accounts\",\n                                  \"includeArrayIndex\": \"arrayIndex\",\n                                  \"preserveNullAndEmptyArrays\": false\n                                }\n                              },\n                              {\n                                $unwind: {\n                                  \"path\": \"$users\",\n                                  \"includeArrayIndex\": \"arrayIndex\",\n                                  \"preserveNullAndEmptyArrays\": false\n                                }\n                              }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_permissions',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    \n                    data = [];\n                    \n                    // if (res.length > 0){\n                    _.each(res, function(item, index ){\n                        \n                        \n                        // if (String(item.user_accounts.user) ===  )\n                        data.push(\n                               {\n                                  \"name\": item.user_accounts.first_name + \"  \" + item.user_accounts.last_name,\n                                  \"src\": global.get(\"functions.fileManagement\")(global.get(\"DomainProperties.rootPath\") +  item.user_accounts.avatar, item.user_accounts.avatar ,msg.RevotioData.session._id, \"copySync\"), // source, destination, operation global.get(\"DomainProperties.url\") + msg.RevotioData.session.UserData.avatar,\n                                filePath: item.user_accounts.avatar,\n                                //   global.get(\"functions.fileManagement\")(global.get(\"DomainProperties.rootPath\") +  item.user_accounts.avatar, item.user_accounts.avatar ,msg.RevotioData.session._id, \"copySync\"), // source, destination, operation global.get(\"DomainProperties.url\") + msg.RevotioData.session.UserData.avatar,\n                            \n                                  \"status\": \"inactive\",\n                                  appUserId : item.user\n                                })\n                    \n                    \n\n\n                  \n            })  \n                   \n                    \n                    msg.payload = {gadgetsList: [{\n                           \"gadgetId\": \"556e2104-bc36-30ba-a12b-6e90c899c5ab\",\n                          \"gadgetName\": \"users slider\",\n                          \"gadgetType\": \"user-slider\",\n                              \"gadgetData\":data\n                            }\n                   ]}\n\n              node.send(msg) \n            })\n\n\n\n","outputs":1,"noerr":0,"x":1490,"y":520,"wires":[["1c021baa.41b07c"]]},{"id":"5fe4db8e.07be7c","type":"function","z":"2294209a.0c95b","name":"Create user BTN GADGET","func":"msg.payload = \n    {\n   \"gadgetsList\":[{            \n       \"gadgetId\": \"d2a4ccdb-bf9f-dcf4-2795-aa95f99e2ec3\",\n            \"gadgetName\":\"Create user BTN\",\n            \"gadgetType\":\"dynamic-btn\",\n            \"gadgetOptions\":\n                {\n                //  url:   \"http://localhost:1881/#/pageBuilder/5bacdd9fb9bf1c120bef1088/page/5bc987181e040202e7b74589\",\n                //  target: \"_blank\",\n                \"types\":\"\",\n                \"styles\":[\"btn-embossed\",\n                \"btn-success\",\"btn-square\"],\n                \"buttonalign\":\"right\",\n                \"textcolor\":\"black\",\n                \"buttonlabel\":\"Create new user\"},\n                \"gadgetData\":{type: \"createUser\"}\n       \n   }]\n\n                // \"gadgetData\":{\"DropdownData\":[{\"label\":\"Employee based\",\"action\":\"Employee\"},{\"label\":\"Project based\",\"action\":\"Project\"}]}}]\n\n} ; \n\nreturn msg ;","outputs":1,"noerr":0,"x":1540,"y":560,"wires":[["df9e1699.b208d8"]]},{"id":"c1a8050f.064128","type":"function","z":"2294209a.0c95b","name":"users acc","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\n// aggregate\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {\n                                  \"type_id\": new ObjectID(msg.RevotioData.FlowData.organization_id),\n                                  \"type\": \"organization\"\n                                }\n                              },\n                              {\n                                $lookup: {\n                                  \"from\": \"user_accounts\",\n                                  \"localField\": \"user\",\n                                  \"foreignField\": \"user\",\n                                  \"as\": \"user_accounts\"\n                                }\n                              },\n                            //   {\n                            //     $project: {\n                            //       \"permission\": 1.0,\n                            //       \"projectData.name\": 1.0\n                            //     }\n                            //   },\n                              {\n                                $unwind: {\n                                  \"path\": \"$user_accounts\",\n                                  \"includeArrayIndex\": \"arrayIndex\",\n                                  \"preserveNullAndEmptyArrays\": false\n                                }\n                              }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_permissions',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    \n                    data = [];\n                    \n                    _.each(res, function(item, index ){\n                        \n                        data.push(\n                            {\n                                  \"state\": \"info\",\n                                  \"title\": item.user_accounts.first_name + \" \" + item.user_accounts.last_name,\n                                  \"rowState\": item.user_accounts.state ,\n                                  \"Avatar\": item.user_accounts.avatar,\n                                  \"buttons\": [\n                                    {\n                                      \"name\": \"\",\n                                      \"type\": \"\",\n                                      \"icon\": \"fas fa-angle-double-right\",\n                                      \"label\": \"\",\n                                      \"color\": \"blue\",\n                                      \"tooltip\": \"tooltip string\",\n                                      \"state\": \"inactive or active\"\n                                    }\n                                  ],\n                                  \"ButtonName\": \"fas fa-angle-double-right\",\n                                  \"keys\": [\n                                    {\n                                      \"state\": \"info\",\n                                      \"title\": \"key title\",\n                                      \"values\": {\n                                        \"prop1\": \"val1\",\n                                        \"prop2\": \"val2\",\n                                        \"prop3\": \"val3\"\n                                      }\n                                    }\n                                  ]\n                                }\n                        )\n                        \n                    })\n                    \n                    msg.payload = {gadgetsList: [{\n                              \"gadgetId\": \"808e98a2-1725-cb8c-5d47-ef95e2e28751\",\n                              \"gadgetName\": \"users acc\",\n                              \"gadgetType\": \"infinite-accordion\",\n                              \"gadgetOptions\": {\n                                \"navigateAll\": false,\n                                \"stickyTree\": false,\n                                \"alignKeys\": false\n                              },\n                              \"gadgetData\":data\n                            }\n                            ]}\n\n\n\n                    node.send(msg) \n            })  \n\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1480,"y":600,"wires":[["f19484dd.a1fe48"]]},{"id":"1c021baa.41b07c","type":"link out","z":"2294209a.0c95b","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","480dae32.8a339","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":1735,"y":520,"wires":[]},{"id":"df9e1699.b208d8","type":"link out","z":"2294209a.0c95b","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","480dae32.8a339","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":1735,"y":560,"wires":[]},{"id":"f19484dd.a1fe48","type":"link out","z":"2294209a.0c95b","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","480dae32.8a339","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":1735,"y":600,"wires":[]},{"id":"dc858fa9.f74248","type":"function","z":"2294209a.0c95b","name":"items gadget","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\n// aggregate\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {\n                                  \"type_id\": new ObjectID(msg.RevotioData.FlowData.organization_id),\n                                  \"type\": \"organization\"\n                                }\n                              },\n                              {\n                                $lookup: {\n                                  \"from\": \"user_accounts\",\n                                  \"localField\": \"user\",\n                                  \"foreignField\": \"user\",\n                                  \"as\": \"user_accounts\"\n                                }\n                              },\n                               {\n                                $lookup: {\n                                  \"from\": \"users\",\n                                  \"localField\": \"user\",\n                                  \"foreignField\": \"_id\",\n                                  \"as\": \"users\"\n                                }\n                              },\n                            //   {\n                            //     $project: {\n                            //       \"permission\": 1.0,\n                            //       \"projectData.name\": 1.0\n                            //     }\n                            //   },\n                              {\n                                $unwind: {\n                                  \"path\": \"$user_accounts\",\n                                  \"includeArrayIndex\": \"arrayIndex\",\n                                  \"preserveNullAndEmptyArrays\": false\n                                }\n                              },\n                              {\n                                $unwind: {\n                                  \"path\": \"$users\",\n                                  \"includeArrayIndex\": \"arrayIndex\",\n                                  \"preserveNullAndEmptyArrays\": false\n                                }\n                              }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_permissions',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    \n                    data = [];\n                    \n                    _.each(res, function(item, index ){\n                        \n                        var color = \"btn-info\"\n                         if (item.users.hasOwnProperty(\"resetPassword\") && item.users.resetPassword === true){\n                              resetPassword = \"Reset required\"\n                              color = \"btn-warning\"\n                          } else {\n                               resetPassword = \"No reset required\"\n                          }\n                          \n                        if (item.users.hasOwnProperty(\"blockAccount\") && item.users.blockAccount === true){\n                               blockAccountName = \"Account blocked\"\n                               blockAccountLabel = \"Unblock account\"\n                                blockAccount = \"unBlockAccount\"\n                               color = \"btn-danger\" \n                          } else {\n                               blockAccountName = \"Account not blocked\"\n                                blockAccountLabel = \"Block account\"\n                                blockAccount = \"blockAccount\"\n                          }\n                          \n                          \n                            var AvatarBtn =   {\n                                        gadgetId: \"b12c4750-6084-2361-cc12-8e3bd4ef54f0\",\n                                        \"gadgetName\":\"user avatar btn\",\n                                        \"gadgetType\":\"dynamic-btn\",\n                        // \"gadgetOptions\": {\n                        //     types:['dropdown'],\n                        //     styles:['btn-embossed', 'btn-success', 'btn-square', ], \n                        //     buttonalign:'left', \n                        //     textcolor:'black', \n                        //     buttonlabel:'Department - ' + ButtonLabel,\n                        // },// icon:{type:'fa fa-plus', align:'left'}                        \n                        \"gadgetOptions\": {\n                            types:['image'],\n                            // imageUrl: global.get(\"DomainProperties.url\") + item.user_accounts.avatar, // \"https;//academicprojects.eu/\" + msg.loopData.payload.avatar,\n                            \n                            imageUrl : global.get(\"functions.fileManagement\")(global.get(\"DomainProperties.rootPath\") +  item.user_accounts.avatar, item.user_accounts.avatar ,msg.RevotioData.session._id, \"copySync\"), // source, destination, operation global.get(\"DomainProperties.url\") + msg.RevotioData.session.UserData.avatar,\n                            filePath : item.user_accounts.avatar,\n                            styles:['img-md', 'img-circle'], // img-circle , img-rounded, img-thumbnail, img-sm, img-md, img-lg\n                            buttonalign:'right', \n                            textcolor:'black', \n                            buttonlabel:'Uploadsy', \n                            action:{type: \"userClick\",  data : {organization_id : msg.RevotioData.FlowData.organization_id, appUserId: item.user}} // starts under app-academicprojects\n                            \n                        },// icon:{type:'fa fa-plus', align:'left'}\n                        \"gadgetData\": {\n                            // \"DropdownData\":[\n                            //                     {label:\"All\", action: 'All'},\n                            //                     {label:\"Conservation Biology\", action: 'ConservationBiology'}, \n                            //                     {label:\"Industrial Ecology\", action:'IndustrialEcology'},\n                            //                     {label:\"Central\", action:'Central'},\n                            //                 ]\n                        }\n                    };\n                          \n                          \n                         \n                            var optionsBtn =   {\n                                        gadgetId: \"c184650b-3842-4533-5c53-f74b098856db\",\n                                        \"gadgetName\":\"user options btn\",\n                                        \"gadgetType\":\"dynamic-btn\",\n                                        \"gadgetOptions\": {\n                                            types:['dropdown'],\n                                            styles:['btn-embossed', color, 'btn-square', ], \n                                            buttonalign:'left', \n                                            textcolor:'black', \n                                            buttonlabel:\"Options\",\n                                        },// icon:{type:'fa fa-plus', align:'left'}                        \n                                        // \"gadgetOptions\": {\n                                        //     types:['image'],\n                                        //     imageUrl: item.user_accounts.avatar, // \"https;//academicprojects.eu/\" + msg.loopData.payload.avatar,\n                                        //     styles:['img-md', 'img-circle'], // img-circle , img-rounded, img-thumbnail, img-sm, img-md, img-lg\n                                        //     buttonalign:'right', \n                                        //     textcolor:'black', \n                                        //     buttonlabel:'Uploadsy', \n                                        //     action:{type: \"userClick\",  data : {organization_id : msg.loopData.payload.organization_id, appUserId: item.user}} // starts under app-academicprojects\n                                            \n                                        // },// icon:{type:'fa fa-plus', align:'left'}\n                                        \"gadgetData\": {\n                                            \"DropdownData\":[    {label:\"Edit user\", action:{type: \"editUser\",  data : {organization_id : msg.RevotioData.FlowData.organization_id, appUserId: item.user}}},\n                                                                {label:\"Reset password\", action: {type: \"resetPassword\",  data : {organization_id : msg.RevotioData.FlowData.organization_id, appUserId: item.user}}},\n                                                                {label:blockAccountLabel, action: {type: blockAccount,  data : {organization_id : msg.RevotioData.FlowData.organization_id, appUserId: item.user}}}, \n                                                                {label:\"Close user session\", action:{type: \"closeUserSessions\",  data : {organization_id : msg.RevotioData.FlowData.organization_id, appUserId: item.user}}},\n                                                                 {label:\"Remove user\", action:{type: \"removeUser\",  data : {organization_id : msg.RevotioData.FlowData.organization_id, appUserId: item.user}}},\n                                                         \n                                                            ]\n                                        }\n                                    };\n                            \n                            var userInfo = {\n                                        gadgetId: '64d99fe2-5cae-ae62-5e81-2ccd8153fb06',\n                                        gadgetName: 'user information text',\n                                        gadgetType: 'dynamic-text-area',\n                                        gadgetData: {\n                                        data: [{\n                                            label: \"User\",\n                                            value: item.user_accounts.first_name + \" \" + item.user_accounts.last_name,\n                                            // options: textFieldOptions\n                                            },\n                                            {\n                                            label:  \"E-mail address\",\n                                            value: item.user_accounts.username ,\n                                            // options: textFieldOptions\n                                            },\n                                            {\n                                            label:  \"Password\",\n                                            value: resetPassword ,\n                                            // options: textFieldOptions\n                                            },\n                                            {\n                                            label:  \"Account\",\n                                            value: blockAccountName,\n                                            // options: textFieldOptions\n                                            },\n                                            {\n                                            label:  \"Last login\",\n                                            value: moment(item.users.login).format(\"dddd, MMMM Do YYYY, h:mm:ss a\") ,\n                                            // options: textFieldOptions\n                                            },\n                                            // {\n                                            // label:  \"\",\n                                            // value: msg.settings[lodash.findIndex(msg.settings, {_id:new ObjectID(msg.loopData.payload.department) })].Name,\n                                            // options: textFieldOptions}\n                                            ],\n                                        options:global.get(\"gadgetObjects['dynamic-text-area'].options\")\n                                        }\n                                    };\n                                    \n                             data.push([AvatarBtn,optionsBtn,userInfo])       \n                                    })\n                    \n                msg.payload = { gadgetsList : [{            \n                   \"gadgetId\": \"100b298e-fa30-fab6-5324-677228e86103\",\n                    \"gadgetType\":\"revotio-custom-item-container\",\n                    \"gadgetData\": data,\n                    \"gadgetOptions\" :{\n                        display:\"row\",\n                        totalGroup:2,\n                        padding : 5,\n                       }\n                    },]}\n                    \n                    node.send(msg) \n            })  \n","outputs":1,"noerr":0,"x":1490,"y":640,"wires":[["5d648f99.e116b8","54978e5a.104c68"]]},{"id":"5db440a.6f3ea4","type":"link in","z":"2294209a.0c95b","name":"users global = items Gagdet","links":["aea25a8a.fa4a58","1dea56ab.df6ad9"],"x":1415,"y":640,"wires":[["dc858fa9.f74248"]]},{"id":"5d648f99.e116b8","type":"link out","z":"2294209a.0c95b","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","480dae32.8a339","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":1735,"y":640,"wires":[]},{"id":"5df13deb.3acd8c","type":"function","z":"2294209a.0c95b","name":"Route btn action","func":"var createUser, editUser,other;\n\n\nif (msg.RevotioData.PostData.hasOwnProperty(\"actionType\") === false  || typeof msg.RevotioData.PostData.actionType  === 'object'){\n    \n\n    if (msg.RevotioData.PostData.actionType.type === \"editUser\"){\n        editUser = msg;\n    }  else { // blockUser, cancelSession, resetPassword\n        other = msg\n    } \n\n}\nelse if (msg.RevotioData.PostData.gadgetData.type === \"createUser\"){\n    createUser = msg;\n}\n\nreturn [createUser, editUser,other];","outputs":3,"noerr":0,"x":2990,"y":480,"wires":[["b4ce0864.df5ff8"],["83d98346.a867"],["f6529164.ebcee"]],"outputLabels":["createUser","editUser","other"]},{"id":"83d98346.a867","type":"function","z":"2294209a.0c95b","name":"Set Form Data","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nfindObj = {\n                    query : {\n                            query :{user:new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId) }, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_accounts',\n                    operation:'findOne',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                   msg.RevotioData.FlowData.Form = {\n                        FormType : \"User\",\n                        FormActionType : \"Edit\",\n                        FormData:res\n                    };\n                    node.send(msg) \n            })   \n","outputs":1,"noerr":0,"x":3400,"y":440,"wires":[["a59768fe.a6a258"]]},{"id":"f6529164.ebcee","type":"function","z":"2294209a.0c95b","name":"update appuseraccounts && remove user sessions of user","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n    updateSessions = {\n                   query : {\n                            query : {\"UserData._id\": new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)},\n                            // update: {\"$set\": {blockAccount: true}},\n                            // options: {upsert: true}\n                        },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'deleteMany',\n                    }\n\n            mongodbTools.resolveAsync(updateSessions, node, function(res){\n\n                node.send(msg);\n\n                    \n            }) \n","outputs":1,"noerr":0,"x":3540,"y":520,"wires":[["8479f9e2.fa6c9"]]},{"id":"1dea56ab.df6ad9","type":"link out","z":"2294209a.0c95b","name":"","links":["5db440a.6f3ea4"],"x":4355,"y":480,"wires":[]},{"id":"8479f9e2.fa6c9","type":"function","z":"2294209a.0c95b","name":"Update appusers collection","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n               \nvar query , noQuery, removeUser;\n\n\nif (msg.RevotioData.PostData.actionType.type === \"resetPassword\"){\n    \n    \n    msg.operation = 'updateOne'\n    msg.payload = [{_id: new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)},\n                   {\"$set\": {\"resetPassword\": true}},\n                   {upsert: true}\n                   ]\n    \n    msg.resetPassword = true\n                                // updateQuery = {\n                                //       query : {\n                                //                 query : {_id: new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)},\n                                //                 update: {\"$set\": {\"resetPassword\": true}},\n                                //                 options: {upsert: true}\n                                //             },\n                                //         connection:global.get(\"DB_data.connection\"),\n                                //         database:global.get(\"DB_data.appDB\"),\n                                //         collection:'users',\n                                //         moperation:'updateOne',\n                                //         }\n                    \n                                // mongodbTools.resolveAsync(updateQuery, node, function(res){\n                                       \n                                       \n                                // })   \n                       query = msg\n} else if (msg.RevotioData.PostData.actionType.type === \"blockAccount\"){\n    \n    msg.operation = 'updateOne'\n    msg.payload = [{_id: new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)},\n                   {\"$set\": {\"blockAccount\": true}},\n                   {upsert: true}\n                   ]\n    \n    // updateQuery = {\n    //               query : {\n    //                         query : {_id: new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)},\n    //                         update: {\"$set\": {blockAccount: true}},\n    //                         options: {upsert: true}\n    //                     },\n    //                 connection:global.get(\"DB_data.connection\"),\n    //                 database:global.get(\"DB_data.appDB\"),\n    //                 collection:'users',\n    //                 operation:'update',\n    //                 }\n\n    //         mongodbTools.resolveAsync(updateQuery, node, function(res){\n                   \n    //                 node.send(msg) \n    //         })   \n    \n    query = msg\n} else if (msg.RevotioData.PostData.actionType.type === \"unBlockAccount\"){\n    \n    msg.operation = 'updateOne'\n    msg.payload = [{_id: new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)},\n                   {\"$set\": {\"blockAccount\": false, loginAttempts : 0}},\n                   {upsert: true}\n                   ]\n    \n    // updateQuery = {\n    //               query : {\n    //                         query : {_id: new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)},\n    //                         update: {\"$set\": {blockAccount: true}},\n    //                         options: {upsert: true}\n    //                     },\n    //                 connection:global.get(\"DB_data.connection\"),\n    //                 database:global.get(\"DB_data.appDB\"),\n    //                 collection:'users',\n    //                 operation:'update',\n    //                 }\n\n    //         mongodbTools.resolveAsync(updateQuery, node, function(res){\n                   \n    //                 node.send(msg) \n    //         })   \n    \n    query = msg\n}else if (msg.RevotioData.PostData.actionType.type === \"closeUserSessions\"){\n    noQuery = msg\n            // node.send(msg) \n} else if (msg.RevotioData.PostData.actionType.type === \"removeUser\"){\n    removeUser = msg\n            // node.send(msg) \n} \n// msg.type = msg.RevotioData.PostData.actionType.type\n\n\nreturn [query , noQuery, removeUser];","outputs":3,"noerr":0,"x":3880,"y":520,"wires":[["35b3b956.affe26"],["1dea56ab.df6ad9"],["6535b938.767ac8"]],"outputLabels":["query , ","noQuery","removeUser"]},{"id":"115dbd4f.d83e53","type":"function","z":"aec22158.fe4e38","name":"Check if account is blocked / password reset is needed","func":"// var crypto = require('crypto');\n\nvar blocked, passwordReset, valid;\n\n\nif (msg.payload.hasOwnProperty(\"blockAccount\") && msg.payload.blockAccount === true ){\n\n   blocked = msg;\n} else if (msg.payload.hasOwnProperty(\"resetPassword\") && msg.payload.resetPassword === true ){\n\n   passwordReset = msg;\n}\nelse {\n    valid = msg;\n}\n\n\n\nreturn [blocked, passwordReset, valid];","outputs":3,"noerr":0,"x":2305,"y":359.99999618530273,"wires":[["5a842d37.e1cabc"],["e2aed4fb.2ddab8"],["62867a86.49ad5c"]],"outputLabels":["blocked","passwordReset","valid"]},{"id":"bdf7ba4.ba0e548","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","ec6395bb.05eb08","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":2870,"y":279.99999618530273,"wires":[]},{"id":"40baac37.1b872c","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":2910,"y":240,"wires":[]},{"id":"e2aed4fb.2ddab8","type":"function","z":"aec22158.fe4e38","name":"Redirect to reset password","func":"// Prepair redirect to chosen project\n\n           msg.payload = { \n               Page:'reset password', \n               RevotioData:{\n                   user: msg.payload._id\n               } \n            };\n        \n\n\nreturn msg;","outputs":1,"noerr":0,"x":2775,"y":319.99999618530273,"wires":[["b42e2891.03848"]]},{"id":"5a842d37.e1cabc","type":"function","z":"aec22158.fe4e38","name":"Prepair error response","func":"\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[0].error =  {\n                                                                    msg: \"This account is blocked, please contact your administrator\"\n                                                                    };\n\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\":  \"349a509d-e145-33a6-7888-e8906915b223\",\n            \"gadgetName\":  \"Login form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":2755,"y":279.99999618530273,"wires":[["bdf7ba4.ba0e548"]]},{"id":"e80a67d5.4cc398","type":"function","z":"aec22158.fe4e38","name":"Set login attempt vars ","func":"msg.RevotioData.FlowData.Data.GadgetsSettings = {\n    loginAttempts : 0,\n    sessionTime: new Date()\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":355,"y":379.99999618530273,"wires":[["cd8c7f3.154188"]]},{"id":"ff257da5.7a778","type":"function","z":"aec22158.fe4e38","name":"update appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// update    \n    updateObj = {\n                    query : {\n                            query :msg.query[0], \n                            update : msg.query[1],\n                            options : msg.query[2]\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    \n            })  \n            \n","outputs":1,"noerr":0,"x":2405,"y":259.99999618530273,"wires":[[]]},{"id":"30a67121.5f2ade","type":"function","z":"aec22158.fe4e38","name":"Check if passwords match","func":"var invalid, valid;\n\nif(String(msg.RevotioData.PostData.gadgetData.formData.passwordOne) === String(msg.RevotioData.PostData.gadgetData.formData.passwordTwo)  ){\n\n  valid = msg;\n}\nelse{\n  invalid =  msg;\n}\n\nreturn [invalid, valid];","outputs":2,"noerr":0,"x":2915,"y":839.9999961853027,"wires":[["40f939cd.5da32"],["42b3aebc.e049d"]],"outputLabels":["invalid, ","valid"]},{"id":"40f939cd.5da32","type":"function","z":"aec22158.fe4e38","name":"Prepair error response","func":"\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[4].error =  {\n                                                                    msg: \"Passwords dont match\"\n                                                                    };\nmsg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[5].error =  {\n                                                                    msg: \"Passwords dont match\"\n                                                                    };\nmsg.payload = {\n    \n    gadgetsList : [{\n            \"gadgetId\":  \"e947591f-f70b-84c4-c2f7-5a78178ad897\",\n            \"gadgetName\":  \"Reset password form\",\n            \"gadgetType\": \"custom-form\",\n            \"gadgetData\": msg.RevotioData.PostData.gadgetData.formObj}]\n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":3215,"y":799.9999961853027,"wires":[["54156eec.b14a88"]]},{"id":"54156eec.b14a88","type":"link out","z":"aec22158.fe4e38","name":"","links":["e158a3eb.e1806","4ac73054.2df2a","1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":3330,"y":799.9999961853027,"wires":[]},{"id":"9e3872b.987979","type":"comment","z":"aec22158.fe4e38","name":"ERROR","info":"","x":3385,"y":799.9999961853027,"wires":[]},{"id":"2e2842dc.490bae","type":"function","z":"aec22158.fe4e38","name":"Trigger disclamer modal","func":"msg.payload = { gadgetsList  : [ {\n            \"gadgetId\":  \"8a3a24ef-ccca-adbd-1cfb-4ab4f0283040\",\n            \"gadgetName\": \"disclamer modal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\n                                \"modalStatus\":\"show\",\n                                \"displayTime\" : 5\n                                \n            },\n    gadgetOptions: {clickOutsideToClose : true}\n},\n            {\n                                        gadgetId: '296015e1-21c9-b349-ef7a-89cf44d02114',\n                                        gadgetName: 'general disclaimer info',\n                                        gadgetType: 'dynamic-text-area',\n                                        gadgetData: {\n                                        data: [{\n                                            label: \"Disclamer\",\n                                            value: \"Voorafgaand aan het aanmelden wordt aan de gebruiker een melding getoond dat alleen geautoriseerd gebruik is toegestaan voor expliciet door de organisatie vastgestelde doeleinden.\",\n                                            // options: textFieldOptions\n                                            },\n                                            // {\n                                            // label:  \"Password\",\n                                            // value: resetPassword ,\n                                            // // options: textFieldOptions\n                                            // },\n                                            // {\n                                            // label:  \"Account\",\n                                            // value: blockAccountName,\n                                            // // options: textFieldOptions\n                                            // },\n                                            // {\n                                            // label:  \"Last login\",\n                                            // value: moment(item.login).format(\"dddd, MMMM Do YYYY, h:mm:ss a\") ,\n                                            // // options: textFieldOptions\n                                            // },\n                                            // {\n                                            // label:  \"\",\n                                            // value: msg.settings[lodash.findIndex(msg.settings, {_id:new ObjectID(msg.loopData.payload.department) })].Name,\n                                            // options: textFieldOptions}\n                                            ],\n                                        options:global.get(\"gadgetObjects['dynamic-text-area'].options\")\n                                        }\n                                    }]};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":765,"y":299.99999618530273,"wires":[["af92a9f3.f2eab"]]},{"id":"7063f25b.94df04","type":"link in","z":"aec22158.fe4e38","name":"user authentication - Custom login form Gadget","links":["cd8c7f3.154188"],"x":650,"y":299.99999618530273,"wires":[["2e2842dc.490bae"]]},{"id":"af92a9f3.f2eab","type":"link out","z":"aec22158.fe4e38","name":"","links":["1766e26.2df601e","15f8aeef.16f7d1","ec6395bb.05eb08","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4","44daecc2.e5b2f4"],"x":890,"y":299.99999618530273,"wires":[]},{"id":"704d4000.20aee","type":"function","z":"45759581.11da84","name":"create element list","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar fs = global.get('fsextra');\n\n\nif (msg.RevotioData.session.UserData.hasOwnProperty(\"avatar\") && fs.existsSync( msg.RevotioData.session.UserData.avatar)){\n    avatar = msg.RevotioData.session.UserData.avatar\n\n} else {\n    avatar = global.get(\"DomainProperties.filesFolder\") +   \"SystemFiles/icons/user.png\"\n\n}\n\nAvatarBTN =  {\n            \"gadgetId\": \"487c2730-43f3-3870-dd7d-60464b992f19\",\n            \"gadgetName\":\"Settings btn\",\n            \"gadgetType\":\"dynamic-btn\",\n            'gadgetData' :\"topbarBTN_action\",\n            \"gadgetOptions\": {\n                            types:['image'],\n                            imageUrl:  global.get(\"functions.fileManagement\")( avatar, avatar ,msg.RevotioData.session._id, \"copySync\"), // source, destination, operation global.get(\"DomainProperties.url\") + msg.RevotioData.session.UserData.avatar,\n                            filePath :avatar,\n                            styles:[' img-small' ,'img-circle' ], //'img-rounded'\n                            buttonalign:'left', \n                            textcolor:'black', \n                            buttonlabel:msg.RevotioData.session.UserData.first_name + \" \" + msg.RevotioData.session.UserData.last_name + \" settings\", \n                            action:\"topbarBTN_action\" // starts under app-academicprojects\n                        },// icon:{type:'fa fa-plus', align:'left'}\n                    };\n// var btn =   {            \n//                   \"gadgetId\": \"487c2730-43f3-3870-dd7d-60464b992f19\",\n//                     \"gadgetName\":\"Settings btn\",\n//                     \"gadgetType\":\"dynamic-btn\",\n//                     \"gadgetOptions\":\n//                         {\"types\":\"\",\n//                         \"styles\":[\"btn-embossed\",\n//                          \"btn-square\",'btn-success' ],\n//                         \"buttonalign\":\"right\",\n//                         \"textcolor\":\"black\",\n//                         \"buttonlabel\":msg.RevotioData.session.UserData.first_name + \" \" + msg.RevotioData.session.UserData.last_name + \" settings\"},\n//                         \"gadgetData\":{_id : msg.RevotioData.session.UserData._id}\n                               \n//             } \n\nvar textOptions = {}\n_.each(global.get(\"gadgetObjects['dynamic-text-area'].options\"), function(value, key){\n    textOptions[key] = value\n})\n\n\ntextOptions[\"label-position\"] = 'left' ;\ntextOptions[\"value-margin-right\"] = '30px' ;\ntextOptions[\"value-font-size\"] = '12px' ;\n \n \ntextOptions[\"label-margin-right\"] = '5px' ;\ntextOptions[\"label-font-size\"] = '12px' ;\n\ntextOptions[\"font-size\"] = '20px' ;\n \n \ntextOptions[\"label-margin-bottom\"] = 0 ;\n\ntextOptions[\"display\"] = 'left' ;\n\nvar text = {\n                                        gadgetId: '3bb9eb3b-f65b-055b-5172-2939d7900ee1',\n                                        gadgetName: 'topbar text',\n                                        gadgetType: 'dynamic-text-area',\n                                        gadgetData: {\n                                        data: [{\n                                            label: \"Last login\",\n                                            value: moment(msg.RevotioData.session.UserData.previousLogin).format(\"dddd, MMMM Do YYYY, h:mm:ss a\") ,\n                                            options: textOptions //{}\n                                            },\n                                            // {\n                                            // label:  \"Password\",\n                                            // value: resetPassword ,\n                                            // // options: textFieldOptions\n                                            // },\n                                            // {\n                                            // label:  \"Account\",\n                                            // value: blockAccountName,\n                                            // // options: textFieldOptions\n                                            // },\n                                            // {\n                                            // label:  \"Last login\",\n                                            // value: moment(item.login).format(\"dddd, MMMM Do YYYY, h:mm:ss a\") ,\n                                            // // options: textFieldOptions\n                                            // },\n                                            // {\n                                            // label:  \"\",\n                                            // value: msg.settings[lodash.findIndex(msg.settings, {_id:new ObjectID(msg.loopData.payload.department) })].Name,\n                                            // options: textFieldOptions}\n                                            ],\n                                        options:textOptions\n                                        }}\n\nvar design = {\n    // '01c6230e-6316-840f-76d7-967523d89e1e': { \n    //         'background-color': '#1D2531',\n    //     // 'background-image': 'url(\"https://img.freepik.com/free-vector/grey-linen-texture-background_1053-253.jpg?size=338c&ext=jpg\")',\n    //     // 'background-repeat': 'repeat',\n    //       'position': '-webkit-sticky',  /* Safari */\n    //         'position': 'sticky',\n    //       'top': 0,\n    //       'z-index': 1,\n    //     },\n    // \"96d3bda5-ec96-00c3-d10e-7ce43b9b92a0\" : { \n    //         // 'background-color': '#f1f1f1',\n    //         'border': '1px solid rgba(0, 0, 0, 0.05)',\n    //         'margin-bottom': '10px',\n    //         'box-shadow': '0 6px 20px 0 rgba(0, 0, 0, 0.19)',\n    //         // \"background-image\" : 'url(\"http://wtctwente.nl/wp-content/uploads/2015/03/WTCTwente_PNO_Consultants_logo2.png\")',\n    //         'background-repeat': 'no-repeat',\n    //         'background-image': 'url(\"https://upload.wikimedia.org/wikipedia/commons/d/d1/Xmas_tree.svg\")',\n    //         // 'transform': 'scale(0.8)'\n    //     },\n    // // \"01c6230e-6316-840f-76d7-967523d89e1e\":{\n    // //     'background-color': '#1D2531',\n    // //     // 'background-image': 'url(\"https://img.freepik.com/free-vector/grey-linen-texture-background_1053-253.jpg?size=338c&ext=jpg\")',\n    // //     // 'background-repeat': 'repeat',\n    // //       'position': '-webkit-sticky',  /* Safari */\n    // //         'position': 'sticky',\n    // //       'top': 0,\n    // //       'z-index': 1,\n    // // }\n}\n// var designObj = \n   \nmsg.topbar  =  [text, design, AvatarBTN, ]\n                                    \nreturn msg;","outputs":1,"noerr":0,"x":1630,"y":1620,"wires":[[]]},{"id":"c36f0764.45994","type":"function","z":"e5822137.be45d","name":"Topbar item container","func":"msg.payload = { gadgetsList : [{            \n                   \"gadgetId\": \"43e53616-0ad3-eacd-e865-1342e2b07000\",\n                   \"gadgetName\": \"topbar\",\n                    \"gadgetType\":\"revotio-custom-item-container\",\n                    \"gadgetData\": msg.topbar,\n                    \"gadgetOptions\" :{\n                        // Type: \"multip\" , // \"multiple\"\n                        // SubType :\"horizontal\" , // }\n                                    }\n                    },]}\n                    \n                    \nreturn msg;","outputs":1,"noerr":0,"x":1580,"y":400,"wires":[["b4a3b5aa.487f6"]]},{"id":"31c0c3b7.aaf214","type":"function","z":"2294209a.0c95b","name":"Topbar item container","func":"msg.payload = { gadgetsList : [{            \n                   \"gadgetId\": \"a2d41bb0-afa1-ad0d-af63-b5443df2fc7a\",\n                   \"gadgetName\": \"topbar\",\n                    \"gadgetType\":\"revotio-custom-item-container\",\n                    \"gadgetData\": msg.topbar,\n                    \"gadgetOptions\" :{\n                        // Type: \"multip\" , // \"multiple\"\n                        // SubType :\"horizontal\" , // }\n                                    }\n                    },]}\n                    \n                    \nreturn msg;","outputs":1,"noerr":0,"x":1620,"y":680,"wires":[["1bc869a3.7eb996"]]},{"id":"38d35469.c1aa9c","type":"subflow:45759581.11da84","z":"2294209a.0c95b","name":"","env":[],"x":1470,"y":680,"wires":[["31c0c3b7.aaf214"]]},{"id":"1bc869a3.7eb996","type":"link out","z":"2294209a.0c95b","name":"","links":["5185c631.530a58","cb87250c.966108","112320ff.7cff6f","d230180f.f3d19","e7f2e3d2.30705","ebf87699.c97f08","98813d9e.bcf0d","90045e69.ebd138","dd373359.040c4","ecd0ecf2.99d41","93aa962f.3144d","e5823b9b.d200f","dda61270.476b9","f0eeb60f.091b78","359e3b04.860634","dc6abb7.ed83248","ff0e6248.29e22","1cff0ac1.dc8705","147f3fb7.690568","f42bf06.8974d1","ef55a0fd.6d311","552f5d9b.570784","498662dd.42a45c","81c0cf07.5ef198","44daecc2.e5b2f4","cb902343.5f03a","e34f6cc2.af5ad8","480dae32.8a339"],"x":1735,"y":680,"wires":[]},{"id":"77ece62a.01347","type":"link in","z":"2294209a.0c95b","name":"users global = ACC Gagdet","links":["aea25a8a.fa4a58"],"x":1415,"y":680,"wires":[["38d35469.c1aa9c"]]},{"id":"4468c444.53ac84","type":"function","z":"4cbbc60.828563c","name":"Set application parameters","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar fs = global.get('fsextra');\n\n//  global.set(\"INIT\", false);\nmsg.INIT = {\n    APP_ID : env.get(\"APP_ID\"),\n    TYPE   : env.get(\"TYPE\"),\n        APP_ID2 : env.get(\"-APP_ID\"),\n    TYPE2   : env.get(\"-TYPE\")\n};\nmsg.INIT.contextState = global.get(\"INIT\")\n\n// if (msg.INIT.hasOwnProperty(\"contextState\") === false || msg.INIT.contextState !== true){\n\n        global.set(\"applicationId\",  env.get(\"APP_ID\"));\n        global.set(\"env\",  {APP_ID:  env.get(\"APP_ID\"), TYPE:  env.get(\"TYPE\")});\n        var globalContextData  =  fs.readdirSync(\"./projects/gadgetsFactory/globalContextData\");\n        _.each(globalContextData, function(Item , index){\n            if (Item === 'generic.json' ||Item === env.get(\"TYPE\")+'.json'){\n                _.each(JSON.parse(fs.readFileSync(\"./projects/gadgetsFactory/globalContextData/\" + Item)), function(globalContextItem, globalContextItemKey){\n                    global.set(globalContextItemKey, globalContextItem);\n                });\n            }\n        });\n        \n        global.set(\"INIT\", true);\n        msg.payload = \"CONTEXT <<<< \" + env.get(\"TYPE\") + \" >>> done\";\n\n// }\n\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":180,"wires":[[]]},{"id":"ce4931e.2eadfd","type":"function","z":"4cbbc60.828563c","name":"Global context functions","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\n\nglobal.set(\"functions\" ,{lastChange : new Date()})\n\nnumberToAlphabet = function(val) {\n\n    return (val + 9).toString(36).toUpperCase()\n};\nglobal.set(\"functions.numberToAlphabet\" ,numberToAlphabet)\n\n// get Data\n// global.get(\"functions.dataTableObject\")(dataTableObject, columns, data, buttons) \ndataTableObject =  function(dataTableObject, columns, data, buttons) {\n    // Get libraries\n    const Moment = global.get('moment');\n    const MomentRange = global.get('momentrange');\n    const moment = MomentRange.extendMoment(Moment)\n    var momentTimezone = global.get('moment_timezone');\n    var lodash = global.get('lodash');\n    var _ = global.get('underscore');\n    var BSON = global.get('bson');\n    var ObjectID = BSON.ObjectID;\n    var accounting = global.get('accounting'); \n    var accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\n  \n    \n    // validate inputs\n    \n    if ( typeof dataTableObject !== 'object'                ||\n            dataTableObject.hasOwnProperty(\"gadgetId\")      ||\n            dataTableObject.hasOwnProperty(\"gadgetName\")    ||\n            dataTableObject.hasOwnProperty(\"gadgetType\")    ||\n            dataTableObject.hasOwnProperty(\"gadgetData\")    ||\n            dataTableObject.hasOwnProperty(\"gadgetOptions\") ){\n        return dataTableObject\n    }\n    else if ( Array.isArray(columns) === false){\n        return dataTableObject\n    }\n    else if ( Array.isArray(data) === false ){\n        return dataTableObject\n    }\n    else {\n    var tableColumnData  =  { \n         \"columnHead\" : columns,\n          \"columnOptions\": {\n            \"columnStyle\": {\n              \"width\": \"30%\"\n            },\n            \"cellStyle\": {\n            //   \"color\": \"red\"\n            },\n            \"allowSort\": true\n          }\n        };\n    \n    // generate rows\n    var tableRowData = []\n            _.each(data, function(dataItem, dataIndex){\n                \n                obj = {\n                       \"rowData\" :[],\n                               \"rowOptions\": {\n                               //   \"state\": \"warning\",\n                                 \"globalClick\": true,\n                                 \"style\": {\n                                   \"width\": \"20%\"\n                                 }\n                               },\n                       }\n                 _.each(columns, function(columnsItem, columnsIndex){\n                        if ( columnsItem.hasOwnProperty('headKey') && dataItem.hasOwnProperty(columnsItem.headKey)\n                            ){\n                              obj.rowData.push({\n                                   \"data\"    : dataItem[columnsItem.headKey],\n                                   \"type\"    : typeof(dataItem[headKey]),\n                                   \"headKey\" : columnsItem.headKey,\n                                   \"hidden\"  : false,\n                                   \"editable\": false\n                              })\n                            }\n            })\n            \n            tableRowData.push(obj)\n        })\n        \n    // define paged value\n    if (tableRowData.length > 10 ){\n        paged = 10;\n    } else {\n        paged = tableRowData.length;\n    }\n    \n    dataTableObject.gadgetOptions = {\n                                          \"allowSearch\": true,\n                                          \"maxItems\": paged,\n                                          \"striped\": true,\n                                          \"export\": true\n                                        };\n    dataTableObject.gadgetData.tableColumnData  =  tableColumnData;\n    dataTableObject.gadgetData.tableRowData     =  tableRowData;\n    // dataTableObject.gadgetData.tableButton =  tableButton;\n    \n    \n    return dataTableObject\n  }\n    \n    }\nglobal.set(\"functions.dataTableObject\" ,dataTableObject)\n\n\nis_dir = function(path) {\n     var fs = global.get('fsextra');\n                            try {\n                                var stat = fs.lstatSync(path);\n                                return stat.isDirectory();\n                            } catch (e) {\n                                // lstatSync throws an error if path doesn't exist\n                                return false;\n                            }\n                        }\nglobal.set(\"functions.is_dir\" ,is_dir)\n\n\nsyncDirlist = function(path) {\n            \n            if (path.substr(path.length - 1) !== \"/\" ){\n                path = path +\"/\"\n            }\n            \n            var _ = global.get('underscore');\n            var fs = global.get('fsextra');\n            var responseObj = { \n                                    path : path,\n                                    parent:{\n                                        filePath : path,\n                                        absolutePath : path,\n                                        isDirectory : global.get(\"functions.is_dir\")(path)\n                                    },\n                                }\n            if (!responseObj.parent.isDirectory){\n                  responseObj.parent.isFile = true\n                 responseObj.parent.type = \"file\" \n            } else if ( responseObj.parent.isDirectory){\n                responseObj.parent.type = \"dir\" \n            }\n           \n        \n        \n        if (responseObj.parent.isDirectory){\n            responseObj.child = []\n            _.each(fs.readdirSync(responseObj.parent.absolutePath), function(item, index){\n                if (item.substr(0,1) !== \".\"){\n                    \n                \n                Obj ={\n                    filePath : item,\n                    absolutePath : responseObj.parent.absolutePath+item +\"/\",\n                    isDirectory : global.get(\"functions.is_dir\")(responseObj.parent.absolutePath+item +\"/\"),\n                }\n                \n                if (!Obj.isDirectory){\n                     Obj.isFile = true\n                     Obj.type = \"file\" \n                } else if ( Obj.isDirectory){\n                    Obj.type = \"dir\" \n                    // Obj.child = global.get(\"functions.syncDirlist\")(Obj.absolutePath)\n                }\n                \n                responseObj.child.push(Obj)\n                   \n                }\n            })\n        } \n        return responseObj;\n}\n\nglobal.set(\"functions.syncDirlist\" ,syncDirlist)\n\n//es5\ncapitalize = function capitalize(string) {\n    return string.slice(0,1).toUpperCase() + string.slice(1).toLowerCase();\n}\nglobal.set(\"functions.capitalize\" ,capitalize)\n\n// get file extention function\n\ngetExtension = function(filename) {\n    var i = filename.lastIndexOf('.');\n    return (i < 0) ? '' : filename.substr(i);\n}\nglobal.set(\"functions.getExtension\" ,getExtension)\n\n\n// get Data\ndaysYear =  function(year) {\n  return global.get(\"functions.isLeapYear\")(year) ? 366 : 365;\n}\nglobal.set(\"functions.daysYear\" ,daysYear)\n\nisLeapYear = function (year) {\n     return year % 400 === 0 || (year % 100 !== 0 && year % 4 === 0);\n}\nglobal.set(\"functions.isLeapYear\" ,isLeapYear)\n\nformatFunction = function(inner){\n    if (inner.length > -1 ){\n        var i;\n        for (i = 0; i < inner.length; i++) {\n             if (inner[i].inner.length > -1){\n                        inner[i].inner = global.get(\"functions.formatFunction\")(inner[i].inner)\n                    } \n            if (inner[i].keys.length > -1){\n                var x;\n                for (x = 0; x < inner[i].keys.length; x++) {\n                            var ObjectKeys = Object.keys(inner[i].keys[x].values)\n                            var y;\n                            for (y = 0; y < ObjectKeys.length; y++) {\n                                 if (\n                                     ObjectKeys[y] !== \"Amount\" && \n                                     ObjectKeys[y] !== \"Number\" &&\n                                     ObjectKeys[y] !== \"Transactions\" &&\n                                     ObjectKeys[y] !== \"Categories\" &&\n                                     ObjectKeys[y] !== \"Work packages\" &&\n                                     ObjectKeys[y] !== \"Projects\" &&\n                                     ObjectKeys[y] !== \"Project\" &&\n                                     ObjectKeys[y] !== \"Memberships\" &&\n                                     ObjectKeys[y] !== \"Employee's\" &&\n                                     ObjectKeys[y] !== \"Users\" &&\n                                     ObjectKeys[y] !== \"Events\" &&\n                                     ObjectKeys[y] !== \"To do\" &&\n                                     ObjectKeys[y] !== \"Processed\" &&\n                                     ObjectKeys[y] !== \"FTE\" &&\n                                     isNaN(inner[i].keys[x].values[ObjectKeys[y]]) === false){\n                                   inner[i].keys[x].values[ObjectKeys[y]] = accounting.formatMoney(inner[i].keys[x].values[ObjectKeys[y]], accountingoptions );\n                                } else  if ((ObjectKeys[y] === \"Amount\" || ObjectKeys[y] === \"Number\") && isNaN(inner[i].keys[x].values[ObjectKeys[y]]) === false){\n                                    inner[i].keys[x].values[ObjectKeys[y]] = Math.round(Number(inner[i].keys[x].values[ObjectKeys[y]])*100)/100;\n                                }\n                            }\n                }\n            } \n        }\n    }\n    return inner;\n};\n\nglobal.set(\"functions.formatFunction\" ,formatFunction)\n\n\ndepartmentConversion =  function(value, type, departments) {\n        \n        var lodash = global.get('lodash');\n        var _ = global.get('underscore');\n        var BSON = global.get('bson');\n        var ObjectID = BSON.ObjectID;\n        \n        if (type === \"id\"){\n         if (value === \"ConservationBiology\" || value === \"Conservation biology\" || value === \"CB\"){\n                    return lodash.find(departments,{name: \"Conservation biology\"})._id\n                   \n                }\n         else if (value === \"EnvironmentalBiology\" || value === \"Environmental Biology\" || value === \"EB\"){\n                    return lodash.find(departments,{name: \"Environmental Biology\"})._id\n                   \n                }\n        else if (value === \"Central\"){\n                    return lodash.find(departments,{name: \"Central\"})._id\n                   \n                    \n         } else  if (value === \"IndustrialEcology\" || value === \"Industrial Ecology\"|| value === \"IE\"){\n                        return lodash.find(departments,{name: \"Industrial Ecology\"})._id\n                       \n                }\n                \n                // return DepartmentObj._id\n        } else if (type === \"name\"){\n            \n            Dept = lodash.find(departments,{_id: new ObjectID(value)})\n            if (Dept){\n                return Dept.name\n            } else {\n                 return \"No department found\"\n            }\n            \n            \n            \n            // _.each(departments, function(Item, Index){\n            //     return {value:value, type:type, departments:departments, Item:Item,Index:Index }\n            //         if (String(Item._id) === String(value) ){\n            //               return Item.Name\n            //         }\n            // })\n            \n        }\n\n    \n}\nglobal.set(\"functions.departmentConversion\" ,departmentConversion)\n\n\nformOptions =  function(array, key, value, type, groupKey,  groupKeyArray, groupKeyArrayKey, groupKeyArrayValue) { \n    \n        var lodash = global.get('lodash');\n        var _ = global.get('underscore');\n        var Moment = global.get('moment');\n        var MomentRange = global.get('momentrange');\n        var moment = MomentRange.extendMoment(Moment);\n        \n        if (Array.isArray(array) === false ||  array.length <= 0){\n          output =  \"array is not an array or has no elements\";  \n        }\n           \n        else if (key === undefined || typeof key !== 'string'){\n               output =  \"key must be present and a string\";\n        }\n        else if (value === undefined || typeof value !== 'string'){\n               output = \"value must be present and a string\";\n           }\n        else if (type === undefined || typeof type !== 'string' || (type !== 'select' &&  type !== 'opt-group')){\n               output = \"type must be present and a string && === select || === opt-group\";} \n        else {\n            \n               \n              if (type === 'select'){\n                   output = {};\n                   \n                   _.each(array, function(Item, Index){\n                       \n                        if (Item.hasOwnProperty(key) && Item.hasOwnProperty(value) ){\n                          output[Item[key]] = Item[value];\n                        } else {\n                            output[\"ERROR \" + Index] = Item\n                        }\n                   })\n                   return output;\n              } \n              else if (type === 'opt-group') {\n                    \n                    if (Array.isArray(groupKeyArray) ){\n                        \n                        if ((groupKeyArrayKey === undefined || typeof groupKeyArrayKey !== 'string') || (groupKeyArrayValue === undefined || typeof groupKeyArrayValue !== 'string')  ){\n                             output =  \"If groupKeyArray presented, groupKeyArrayKey & groupKeyArrayValue is needed and should be type STRING\";\n                        } else {\n                            \n                            groupedArray = lodash.groupBy(array, groupKeyArrayKey);\n                            output = {};\n                            _.each(array , function(Item, Index){\n                                \n                                if (output.hasOwnProperty(groupedArray[Item[groupKey][0][groupKeyArrayValue]]) === false){\n                                    output[groupedArray[Item[groupKey][0][groupKeyArrayValue]]] = {};\n                                }\n                                \n                                output[groupedArray[Item[groupKey][0][groupKeyArrayValue]]][Item.key] = Item.value;\n                            });\n                        }\n               }\n           }\n        }\n    \n}\nglobal.set(\"functions.formOptions\" ,formOptions)\n    \nfileManagement =  function(source, destination, sessionId, operation) {\n        \n        var fs = global.get('fsextra');\n        var _ = global.get('underscore');\n        \n        if (!sessionId ){\n            return \"Required data not present (sessionId)\"\n        }\n        \n        // check if file exists\n        else if (!fs.existsSync(source)){\n            return \"Invalid source\"\n        }\n        \n        \n        else if (!operation || operation === \"copySync\"){\n                \n                if (!source||!destination){\n                     return \"Required data not present (source OR destination) \"\n                } \n                else {\n                            if (destination.slice(0,1) === \"/\"){\n                                newDestination = destination.slice(1)\n                                destination = newDestination\n                            }\n                            destinationFolder = \"\"\n                            _.each(destination.split(\"/\"), function(item , Index){\n                                if (Index +1 !== destination.split(\"/\").length ){\n                                    destinationFolder =  destinationFolder + \"/\" + item\n                                }\n                            })\n                      \n                           \n                            fs.mkdirsSync(String(global.get(\"DomainProperties.rootFolder\") + global.get(\"DomainProperties.filesFolder\") +  sessionId +  \"/TEMP/\" + destinationFolder).replace(/\\/{2}/g, \"/\"));\n                            \n                            fs.copySync(source, String(global.get(\"DomainProperties.rootFolder\") + global.get(\"DomainProperties.filesFolder\") +  sessionId +  \"/TEMP/\" + destination).replace(/\\/{2}/g, \"/\"))\n                    \n                            return global.get(\"DomainProperties.RootDomain\") +    String(global.get(\"DomainProperties.filesFolder\") +  sessionId +  \"/TEMP/\" + destination).replace(/\\/{2}/g, \"/\")\n                                                                              \n                } \n            \n        }\n                else if (!operation || operation === \"copySyncCore\"){\n                \n                if (!source||!destination){\n                     return \"Required data not present (source OR destination) \"\n                } \n                else {\n                            if (destination.slice(0,1) === \"/\"){\n                                newDestination = destination.slice(1)\n                                destination = newDestination\n                            }\n                            \n                      \n                            \n                            fs.copySync(source, global.get(\"DomainProperties.publicFolder\") + global.get(\"DomainProperties.filesFolder\") +  sessionId +  \"/TEMP/\" + destination)\n                    \n                            return global.get(\"DomainProperties.filesFolder\") +  sessionId +  \"/TEMP/\" + destination\n                    \n                }\n            \n        }\n        \n        else if (operation === \"emptyDirSync\")\n                {\n                    fs.emptyDirSync(global.get(\"DomainProperties.publicFolder\") + global.get(\"DomainProperties.filesFolder\") +sessionId + \"/TEMP\")\n                     return {state : 'success', message: \"emptyDirSync - \" + global.get(\"DomainProperties.publicFolder\") + global.get(\"DomainProperties.filesFolder\") +sessionId + \"/TEMP\"+ \" - Success\"}\n                   }\n        else if (operation === \"removeSync\")\n                {\n                    fs.removeSync(global.get(\"DomainProperties.publicFolder\") + global.get(\"DomainProperties.filesFolder\") +sessionId)\n                    return {state : 'success', message: \"removeSync - \" + global.get(\"DomainProperties.publicFolder\") + global.get(\"DomainProperties.filesFolder\") +sessionId + \"/TEMP\"+ \" - Success\"}\n                \n                }\n                \n    \n        else if (operation === \"initSessionFolder\"){\n            \n            fs.ensureDirSync(global.get(\"DomainProperties.publicFolder\") + global.get(\"DomainProperties.filesFolder\") )\n            fs.ensureDirSync(global.get(\"DomainProperties.publicFolder\") + global.get(\"DomainProperties.filesFolder\") + sessionId)\n            // fs.ensureDirSync(global.get(\"DomainProperties.publicFolder\") + sessionId + \"/SystemFiles\" )\n            fs.ensureDirSync(global.get(\"DomainProperties.publicFolder\") + global.get(\"DomainProperties.filesFolder\") + sessionId+ \"/TEMP\" )\n            \n            fs.copySync(global.get(\"DomainProperties.rootPath\") + \"/SystemFiles\" , global.get(\"DomainProperties.publicFolder\") +global.get(\"DomainProperties.filesFolder\") + \"/SystemFiles\" )\n            \n        }\n                \n       \n    \n}\nglobal.set(\"functions.fileManagement\" ,fileManagement)\n\n       \nformatTime = function (time) {\n    var _ = global.get('underscore');\n    //split startTime on \":\"\n    arr = time.split(\":\");\n    \n    newTime = \"\"\n    \n    _.each(arr, function(Item, index){\n        if (Item.length === 1){\n            newTime = newTime + \"0\"+Item\n        } else (\n            newTime = newTime +Item\n        )\n        \n        if (index === 0){\n           newTime = newTime + \":\" \n        }\n    \n    })\n    \n     return newTime;\n}\n\nglobal.set(\"functions.formatTime\" ,formatTime)\nglobal.set(\"functions.lastUpdate\" ,moment().format())\n// global.get(\"functions.fileManagement\")( source, destination, msg.RevotioData, operation) // source, destination, RevotioData, operation\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":140,"wires":[[]]},{"id":"a206fa2f.9bb658","type":"link in","z":"aec22158.fe4e38","name":"User authentication design","links":["84671937.4d3118","e1c31a15.098aa8","c199e887.a6da4"],"x":90,"y":299.99999618530273,"wires":[["827557d5.fcca3"]]},{"id":"a836c292.d3afe","type":"http response","z":"aec22158.fe4e38","name":"","statusCode":"","headers":{},"x":545,"y":299.99999618530273,"wires":[]},{"id":"1c72090c.42333f","type":"function","z":"aec22158.fe4e38","name":"User authentication design","func":"msg.payload.design = \n{\n    \"0b8c4e59-5cc1-f8fe-7714-8d27013939ca\": {\n        \"flex\": \"1 1 0%\",\n        \"box-sizing\": \"border-box\"\n    },\n    \"429ffeb5-0560-0dbe-f639-19662ec25d8c\": {\n        \"width\": \"100%\",\n        \"padding\": \"0px 0px 0px 0px\",\n        \"margin\": \"0px\",\n        \"text-align\": \"left\",\n        \"flex-direction\": \"row\",\n        \"box-sizing\": \"border-box\",\n        \"overflow\": \"hidden\",\n        \"background\": \"url('https://images.unsplash.com/photo-1472289065668-ce650ac443d2?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80')\",\n        \"background-size\": \"cover\"\n    },\n    \"8a4f3f00-a4f7-0402-cf9d-05c293268ff0\": {\n        \"width\": \"400px\",\n        \"min-width\": \"400px\",\n        \"max-width\": \"400px\",\n        \"overflow\": \"hidden !important\",\n        \"overflow-anchor\": \"none\",\n        \"box-shadow\": \"0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12)\",\n        \"background-color\": \"#fff\",\n        \"padding\": \"33px\"\n    },\n    \"c952a30e-7d40-387c-26b3-dd231a2cdca3\": {\n        \"display\": \"none\"\n\n    },\n    \"100ab4f9-91ac-67ff-61d3-35c02540cdaa\": {\n        \"display\": \"none\"\n    }\n}\n// {\n//     // '9e859d4a-16d7-fcf7-9c79-b828bbf1d262': global.get('topbar_design') \n// //     '8a4f3f00-a4f7-0402-cf9d-05c293268ff0': {\n// // 'background-image': 'url(\"https://images.unsplash.com/photo-1472289065668-ce650ac443d2?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80\")',\n// //         // 'background-image': 'url(\"https://www.pnoconsultants.com/nl/wp-content/themes/pno/images/PNO-ouroffice.png\")',\n        \n// //         'background-repeat': 'no-repeat',\n// //         'background-size': 'cover',\n// //         'background-position': 'center center',\n// //         'border': '2px solid #6abf6b'\n// //     },\n//     \"0b8c4e59-5cc1-f8fe-7714-8d27013939ca\":{\n//         'background-image': 'url(\"https://images.unsplash.com/photo-1472289065668-ce650ac443d2?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80\")',\n//         // 'background-image': 'url(\"https://www.pnoconsultants.com/nl/wp-content/themes/pno/images/PNO-ouroffice.png\")',\n        \n//         'background-repeat': 'no-repeat',\n//         'background-size': 'cover',\n//         'background-position': 'center center',\n//     //     'border': '2px solid #6abf6b'\n//     },\n// }\n\n\nreturn msg;","outputs":1,"noerr":0,"x":395,"y":299.99999618530273,"wires":[["a836c292.d3afe"]]},{"id":"dd573c4c.643968","type":"link in","z":"aec22158.fe4e38","name":"User account activation - design","links":["b12e289c.d6ecc8","6d0913e4.ac8bbc","18c634ff.b1dad3"],"x":90,"y":859.9999961853027,"wires":[["c78d53d2.e65ff"]]},{"id":"3ae4ab64.9e2994","type":"http response","z":"aec22158.fe4e38","name":"","statusCode":"","headers":{},"x":625,"y":859.9999961853027,"wires":[]},{"id":"35a2a99e.50eb36","type":"function","z":"aec22158.fe4e38","name":"User account activation -  design","func":"msg.payload.design = \n{\n    \"117f1957-0ced-b87a-9f9e-950419047d14\": { // image \n        \"flex\": \"1 1 0%\",\n        \"box-sizing\": \"border-box\"\n    },\n    \"f9392e7b-875b-15d8-9a16-49c82081707b\": { // container \n        \"width\": \"100%\",\n        \"padding\": \"0px 0px 0px 0px\",\n        \"margin\": \"0px\",\n        \"text-align\": \"left\",\n        \"flex-direction\": \"row\",\n        \"box-sizing\": \"border-box\",\n        \"overflow\": \"hidden\",\n        \"background\": \"url('https://images.unsplash.com/photo-1472289065668-ce650ac443d2?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80')\",\n        \"background-size\": \"cover\"\n    },\n    \"fb9f31b6-9fc2-1a97-3c5e-eeb00e1edd5b\": { // form\n        \"width\": \"400px\",\n        \"min-width\": \"400px\",\n        \"max-width\": \"400px\",\n        \"overflow\": \"hidden !important\",\n        \"overflow-anchor\": \"none\",\n        \"box-shadow\": \"0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12)\",\n        \"background-color\": \"#fff\",\n        \"padding\": \"33px\"\n    },\n    \"c952a30e-7d40-387c-26b3-dd231a2cdca3\": {\n        \"display\": \"none\"\n\n    },\n    \"100ab4f9-91ac-67ff-61d3-35c02540cdaa\": {\n        \"display\": \"none\"\n    }\n}\n// {\n//     // '9e859d4a-16d7-fcf7-9c79-b828bbf1d262': global.get('topbar_design') \n// //     '8a4f3f00-a4f7-0402-cf9d-05c293268ff0': {\n// // 'background-image': 'url(\"https://images.unsplash.com/photo-1472289065668-ce650ac443d2?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80\")',\n// //         // 'background-image': 'url(\"https://www.pnoconsultants.com/nl/wp-content/themes/pno/images/PNO-ouroffice.png\")',\n        \n// //         'background-repeat': 'no-repeat',\n// //         'background-size': 'cover',\n// //         'background-position': 'center center',\n// //         'border': '2px solid #6abf6b'\n// //     },\n//     \"0b8c4e59-5cc1-f8fe-7714-8d27013939ca\":{\n//         'background-image': 'url(\"https://images.unsplash.com/photo-1472289065668-ce650ac443d2?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80\")',\n//         // 'background-image': 'url(\"https://www.pnoconsultants.com/nl/wp-content/themes/pno/images/PNO-ouroffice.png\")',\n        \n//         'background-repeat': 'no-repeat',\n//         'background-size': 'cover',\n//         'background-position': 'center center',\n//     //     'border': '2px solid #6abf6b'\n//     },\n// }\nreturn msg;","outputs":1,"noerr":0,"x":465,"y":859.9999961853027,"wires":[["3ae4ab64.9e2994"]]},{"id":"ce9cd56d.b714d","type":"link in","z":"aec22158.fe4e38","name":"two step authentication - design","links":["e16c485c.ea1fd8","f01f2b5d.c7323","c42395c9.e7a698"],"x":90,"y":1319.9999961853027,"wires":[["cb673224.c23b78"]]},{"id":"a8584b7c.1c2768","type":"http response","z":"aec22158.fe4e38","name":"","statusCode":"","headers":{},"x":605,"y":1319.9999961853027,"wires":[]},{"id":"1121a4d9.54acc3","type":"function","z":"aec22158.fe4e38","name":"two step authentication -  design","func":"\nreturn msg;","outputs":1,"noerr":0,"x":425,"y":1319.9999961853027,"wires":[["a8584b7c.1c2768"]]},{"id":"a885e943.ebfb1","type":"link in","z":"aec22158.fe4e38","name":"Reset password - design","links":["1eeb4e54.0acdd2","32d05b4.8adeca4","e98e6ae3.ce1128"],"x":90,"y":2119.9999961853027,"wires":[["c4b9da22.c433d8"]]},{"id":"42c09172.2ae508","type":"http response","z":"aec22158.fe4e38","name":"","statusCode":"","headers":{},"x":565,"y":2119.9999961853027,"wires":[]},{"id":"777344ad.7bee8c","type":"function","z":"aec22158.fe4e38","name":"Reset password -  design","func":"\nreturn msg;","outputs":1,"noerr":0,"x":405,"y":2119.9999961853027,"wires":[["42c09172.2ae508"]]},{"id":"ec952e8b.ee99","type":"link in","z":"e5822137.be45d","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","5a5da070.ff4398"],"x":695,"y":320,"wires":[["c14b21e1.bdb88"]]},{"id":"df6d2863.899c68","type":"http response","z":"e5822137.be45d","name":"","statusCode":"","headers":{},"x":1270,"y":320,"wires":[]},{"id":"6953bde2.d417fc","type":"function","z":"e5822137.be45d","name":"organization global -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":320,"wires":[["bf03eb39.4bf4a8"]]},{"id":"7d1a67c6.b7534","type":"link in","z":"2294209a.0c95b","name":"users global - design","links":["bd06a339.36197","6860d9bc.c5f048","ff290d23.18df18"],"x":895,"y":380,"wires":[["d7e5d821.5a91a8"]]},{"id":"225467fa.c7f1f","type":"http response","z":"2294209a.0c95b","name":"","statusCode":"","headers":{},"x":1630,"y":380,"wires":[]},{"id":"693f75d0.9e78f4","type":"function","z":"2294209a.0c95b","name":"users global  -  design","func":"msg.topbarContanerId =  \"e9cfb98b-de00-838f-b1f4-570ced8d0504\";\n\nreturn msg;","outputs":1,"noerr":0,"x":1200,"y":380,"wires":[["9293b380.aed2b"]]},{"id":"b59ec926.10591","type":"comment","z":"2294209a.0c95b","name":"DESIGN","info":"","x":880,"y":340,"wires":[]},{"id":"ea7a914b.d9859","type":"comment","z":"2294209a.0c95b","name":"INIT","info":"","x":890,"y":560,"wires":[]},{"id":"7cdd4e0a.69bdb8","type":"comment","z":"e5822137.be45d","name":"DESIGN","info":"","x":700,"y":280,"wires":[]},{"id":"37ab5a6c.a90106","type":"comment","z":"aec22158.fe4e38","name":"DESIGN","info":"","x":135,"y":819.9999961853027,"wires":[]},{"id":"650cfae5.573e4c","type":"comment","z":"aec22158.fe4e38","name":"INIT","info":"","x":105,"y":939.9999961853027,"wires":[]},{"id":"efaa6686.80c558","type":"comment","z":"aec22158.fe4e38","name":"DESIGN","info":"","x":75,"y":259.99999618530273,"wires":[]},{"id":"f79fd07b.c1e458","type":"comment","z":"aec22158.fe4e38","name":"INIT","info":"","x":205,"y":339.99999618530273,"wires":[]},{"id":"d569a771.280e","type":"comment","z":"aec22158.fe4e38","name":"DESIGN","info":"","x":115,"y":1279.9999961853027,"wires":[]},{"id":"18b10abd.bd5515","type":"comment","z":"aec22158.fe4e38","name":"INIT","info":"","x":125,"y":1399.9999961853027,"wires":[]},{"id":"7c65cd91.67188c","type":"comment","z":"aec22158.fe4e38","name":"DESIGN","info":"","x":95,"y":2079.9999961853027,"wires":[]},{"id":"3a71e54.a77a89a","type":"comment","z":"aec22158.fe4e38","name":"INIT","info":"","x":85,"y":2199.9999961853027,"wires":[]},{"id":"2e99f46b.4490ec","type":"function","z":"aec22158.fe4e38","name":"finalize user account","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar crypto = global.get('crypto');\n\n\n\ndelete msg.RevotioData.FlowData.UserObj.hash\ndelete msg.RevotioData.FlowData.UserObj.active\ndelete msg.RevotioData.FlowData.UserObj.activationToken\n\nmsg.payload = [{user: new ObjectID(msg.RevotioData.FlowData.Data.UserData._id)},\n               {\"$set\" : msg.RevotioData.FlowData.UserObj},\n               {upsert:true}\n               \n               ];\nmsg.operation = \"update\"\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":3960,"y":920,"wires":[["62ed20f0.1e896"]],"outputLabels":["invalid, "]},{"id":"36833fec.f99c5","type":"function","z":"2294209a.0c95b","name":"Set Form Data","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nfindObj = {\n                    query : {\n                            query :{user:new ObjectID(msg.RevotioData.PostData.gadgetData.appUserId) }, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_accounts',\n                    operation:'findOne',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                   msg.RevotioData.FlowData.Form = {\n                        FormType : \"User\",\n                        FormActionType : \"Edit\",\n                        FormData:res\n                    };\n                    node.send(msg) \n            })   \n","outputs":1,"noerr":0,"x":2960,"y":760,"wires":[["b0ed4707.f5ac"]]},{"id":"f347dd79.54981","type":"comment","z":"4cbbc60.828563c","name":"Functions","info":"","x":200,"y":80,"wires":[]},{"id":"1c4c9d0e.1060fb","type":"comment","z":"4cbbc60.828563c","name":"settings","info":"","x":190,"y":180,"wires":[]},{"id":"6535b938.767ac8","type":"function","z":"2294209a.0c95b","name":"Prepair delete queries","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nvar user, other;\n \n \nother = {   payload : {user_id: new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)},\n            operation : \"remove\"\n}\n\nmsg.payload = {_id: new ObjectID(msg.RevotioData.PostData.actionType.data.appUserId)}\nmsg.operation = \"remove\"\nuser= msg;\n\nreturn [user, other];","outputs":2,"noerr":0,"x":4120,"y":600,"wires":[["35b3b956.affe26"],["8b08f368.889138"]]},{"id":"a00aba6e.69bb58","type":"link in","z":"e5822137.be45d","name":"** Gadget Name **","links":["2cc71536.88996a"],"x":1395,"y":440,"wires":[["3e910553.3e65aa"]]},{"id":"1bb649ce.6a1376","type":"function","z":"508957a1.dd5398","name":"Get Page object","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\n// set all response data\nmsg.responseObj                     = msg.payload;\nmsg.responseObj.deviceId            = msg.RevotioData.session.deviceId ;\nmsg.responseObj.revotioSessionId    = msg.RevotioData.session.revotioSessionId ;\nmsg.responseObj.user_id             = msg.RevotioData.session.user_id ;\nmsg.responseObj.applicationId       = new ObjectID(global.get(\"applicationId\"));\nmsg.responseObj.token               = msg.RevotioData.session.token;\nmsg.responseObj.Page                = msg.payload.Page.toLowerCase().trim();//.replace(/^\\s*|\\s*$/g, '');\n// msg.payload.Page                    = msg.responseObj.Page;\n\nmsg.headers = {};\nmsg.rejectUnauthorized =  false;\n\nif (    msg.responseObj.Page === \"project overview\" && \n        msg.responseObj.hasOwnProperty(\"RevotioData\") &&\n        msg.responseObj.RevotioData.hasOwnProperty(\"project_id\") ){\n    \n    // get funding_scheme object\n    \n    // aggregate\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {\n                                  \"_id\": new ObjectID(msg.responseObj.RevotioData.project_id),\n                                \n                                }\n                              },\n                              {\n                                $lookup: {\n                                  \"from\": \"settings\",\n                                  \"localField\": \"funding_scheme\",\n                                  \"foreignField\": \"_id\",\n                                  \"as\": \"funding_scheme_data\"\n                                }\n                              },\n                 \n                              {\n                                $unwind: {\n                                  \"path\": \"$funding_scheme_data\",\n                                  \"includeArrayIndex\": \"arrayIndex\",\n                                  \"preserveNullAndEmptyArrays\": false\n                                }\n                              }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'projects',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    // if (Array.isArray(res)=== true && res.length>0 && res[0].funding_scheme_data.hasOwnProperty(\"project_template\")){\n                \n               \n                        \n                    //     msg.responseObj.Page = res[0].funding_scheme_data.project_template + \" \" + msg.responseObj.Page\n                    //     url = \"https://new-services.revotio.com/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page ;\n                        \n                    // } else {\n                         msg.responseObj.Page = \"default \" + msg.responseObj.Page.trim()\n                        url = \"https://new-services.revotio.com/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page.trim() ;\n                     \n                    // }\n                   \n                    // url = \"https://new-services.revotio.com/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page ;\n                    res = encodeURI(url);\n                    \n                    msg.url = res\n\n                    node.send(msg) \n            })\n    \n       \n        \n        \n} else {\n  \n        url = global.get(\"innonation_api\")+ \"/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page ;\n        res = encodeURI(url);\n        \n        msg.url = res\n        node.send(msg)\n\n}\n\n\n\n\n\n\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":900,"wires":[["5ddd0309.2d77fc","3199acdc.5d559c"]]},{"id":"9ceaac27.f3dc2","type":"comment","z":"508957a1.dd5398","name":"Redirect","info":"Expected object :\n\n msg.payload = {\n        DeviceId: ** From publised app **,\n        RevotioSessionId : ** From publised app **,\n        Page:  ** defigned in the Node-Red API **,\n        timestamp :  ** Last update of DB session object **,\n        user_id:  ** suplied by publeshed app **,\n        applicationId : ** applicationId Defigned in global context of the server **,\n    }","x":100,"y":920,"wires":[]},{"id":"bbdc3383.cf54c8","type":"function","z":"508957a1.dd5398","name":"Setup msg.RevotioData obj","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar unauth, auth,activate, reset,   error; \nmsg.RevotioData =\n{\n    session : JSON.parse(msg.dataResult.dataContent.SessionData),\n    type : msg.dataResult.dataContent.payload,\n    BrowserFP : JSON.parse(msg.dataResult.dataContent.PostData)\n}\n\n\n\n        \nif (msg.RevotioData.session.entranceType === \"activate\"){\n    activate = msg;\n} else if (msg.RevotioData.session.entranceType === \"reset\"){\n    reset = msg;\n} \nelse {\n    \n \n  \n    if (typeof msg.tokenResult.TokenContent  === \"object\" &&  msg.tokenResult.TokenContent.type === \"authorized\"){\n        msg.RevotioData.tokenInfo ={\n            deviceId: msg.tokenResult.TokenContent.deviceId,\n            revotioSessionId: msg.tokenResult.TokenContent.revotioSessionId,\n            tokenCreated:  moment.unix(msg.tokenResult.TokenContent.iat),\n            tokenDateNow: moment(),\n            tokenCreatedDiffDays : moment().diff(moment.unix(msg.tokenResult.TokenContent.iat), 'days'),// (msg.RevotioData.tokenCreatedDiff / (1000 * 60 * 60)).toFixed(1);\n            currentTimeZone: msg.RevotioData.session.timezone,\n            tokenData:msg.tokenResult.TokenContent\n        }\n        \n        \n        auth = msg;\n    } else if (typeof msg.tokenResult.TokenContent  === \"object\" && msg.tokenResult.TokenContent.type === \"unauthorized\") {\n        \n        unauth = msg;\n    } \n    else {\n        \n        // msg.tokenData = tokenData;\n        error = msg;\n    }\n    \n}\n\nreturn [unauth, auth , activate ,reset,  error];","outputs":5,"noerr":0,"initialize":"","finalize":"","x":380,"y":340,"wires":[["92449c5.fd42de"],["10e1e3b.d1d519c"],["15c4a8bb.5b28af"],["84c26a9f.683b7"],[]],"outputLabels":["unauth","auth","activate","reset","error"]},{"id":"a6ecac2e.964a9","type":"function","z":"508957a1.dd5398","name":"Check if session exists and is valid or create new one & INIT FS","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif ( msg.payload && msg.payload.hasOwnProperty(\"UserData\") ){\n    \n    msg.SessionObj = msg.payload ;\n\n    Obj =  {\n        _id: new ObjectID(msg.SessionObj._id),\n        token: msg.SessionObj.token,\n        deviceId: msg.SessionObj.deviceId,\n        revotioSessionId :msg.SessionObj.revotioSessionId,\n        Page: msg.SessionObj.Page,\n        timestamp : new Date(),\n        user_id: new ObjectID(msg.RevotioData.session.user_id),\n        applicationId : new ObjectID(global.get(\"applicationId\")),\n        UserData : msg.RevotioData.userData,\n        timezone: msg.RevotioData.session.timezone,\n        currentUserTime: msg.RevotioData.session.currentUserTime ,\n        gmtTime: msg.RevotioData.session.gmtTime\n    }\n\n    operation = 'update'\n    \n} else {\n    \n    Obj = {\n         _id: new ObjectID(),\n        token: msg.RevotioData.session.token,\n        deviceId: msg.RevotioData.session.deviceId,\n        revotioSessionId :msg.RevotioData.session.revotioSessionId,\n        timestamp : new Date(),\n        user_id: new ObjectID(msg.RevotioData.session.user_id),\n        applicationId : new ObjectID(global.get(\"applicationId\")),\n        UserData : msg.RevotioData.session.UserData,\n        timezone: msg.RevotioData.session.timezone,\n        currentUserTime: msg.RevotioData.session.currentUserTime ,\n        gmtTime: msg.RevotioData.session.gmtTime\n    };\n\n    if (msg.RevotioData.session.UserData.UserAccountData.user_type && msg.RevotioData.session.UserData.UserAccountData.user_type === \"Client_User\" ){\n        Obj.Page =  global.get(\"DomainProperties.ClientDefaultPage\");\n        Obj.RevotioData = {organization_id : new ObjectID(msg.RevotioData.session.UserData.organization_id)}\n    }else {\n        Obj.Page =  global.get(\"DomainProperties.PNODefaultPage\");\n    }\n    operation = 'update'\n\n}\n    msg.payload = Obj ; \n// update    \n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(Obj._id)}, \n                            update : { \"$set\" : Obj},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.result = res\n                    node.send(msg) \n            })  \n\n\n\n// return msg;","outputs":1,"noerr":0,"x":2670,"y":340,"wires":[["c8fb96e2.82848"]]},{"id":"4a28c697.d7c878","type":"function","z":"508957a1.dd5398","name":"Prepair msg.RevotioData Obj","func":"\nif (typeof msg.payload.FlowData === 'object' ){\n    FlowData = msg.payload.FlowData\n    delete msg.payload.FlowData\n} else {\n     FlowData = {Data : {}}\n}\n\n\nmsg.RevotioData = {\n    init:msg.INIT,\n    entity: \"INIT\",\n    session : msg.payload,\n    FlowData: FlowData\n    };\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":600,"wires":[["e0a7d33c.5622b"]]},{"id":"65cb1ffa.0f19d","type":"function","z":"508957a1.dd5398","name":"Prepair session lookup","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n//  get session\n\nvar query = {\n    deviceId: msg.RevotioData.session.deviceId,\n    revotioSessionId :msg.RevotioData.session.revotioSessionId,\n};\n\n// find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                if (res.length > 0){\n                    msg.payload = res[0]\n                } else {\n                    msg.payload = {}\n                }\n                    \n                    node.send(msg) \n            })   \n\n// return msg;","outputs":1,"noerr":0,"x":2320,"y":340,"wires":[["a6ecac2e.964a9"]]},{"id":"a6e28b45.2c7798","type":"catch","z":"508957a1.dd5398","name":"","scope":null,"x":100,"y":40,"wires":[["8a7161b7.e34dd"]]},{"id":"8a7161b7.e34dd","type":"debug","z":"508957a1.dd5398","name":"ERROR","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","x":220,"y":40,"wires":[]},{"id":"1a7afd51.7ed1e3","type":"function","z":"508957a1.dd5398","name":"Update Session to match location user","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nresponseObj = msg.responseObj;\n\nObj =  {timestamp : new Date(),\n        applicationId: new ObjectID(global.get(\"applicationId\")),\n        // session : msg.RevotioData.session\n}\n\nif (responseObj.deviceId){\n    Obj.deviceId =  responseObj.deviceId;\n}\n\nif (responseObj.revotioSessionId){\n    Obj.revotioSessionId =  responseObj.revotioSessionId;\n}\n\nif (responseObj.user_id){\n    Obj.user_id =  responseObj.user_id;\n}\n\nif (msg.RevotioData.userData){\n    Obj.userData =  msg.RevotioData.userData;\n}\n\nif (responseObj.Page){\n    Obj.Page =  responseObj.Page;\n}\n\nif (typeof msg.responseObj.RevotioData === 'object'){\n    Obj.FlowData = msg.responseObj.RevotioData\n    Obj.FlowData.Data  = {}\n} else {\n     Obj.FlowData = {Data:{}}\n}\n\nif (responseObj.presentationLayer && responseObj.presentationLayer.container && responseObj.presentationLayer.container !== null){\n    Obj.container =  responseObj.presentationLayer.container;\n}\n\nupdateObj = {\n                    query : {\n                            query :{deviceId: responseObj.deviceId, revotioSessionId: responseObj.revotioSessionId}, \n                            update : {\"$set\" : Obj},\n                            options : {upsert: true, returnOriginal: false}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'findOneAndUpdate', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                \n                if (typeof res === 'object' && res.hasOwnProperty(\"value\")){\n                    \n                     msg.payload = res.value\n                     \n                } else {\n                    msg.payload = {};\n                }\n                \n                node.send(msg)\n            })\n                     \n    // // update    \n    // updateObj = {\n    //                 query : {\n    //                         query :{deviceId: responseObj.deviceId, revotioSessionId: responseObj.revotioSessionId}, \n    //                         update : {\"$set\" : Obj},\n    //                         options : {upsert: true}\n    //                         },\n    //                 connection:global.get(\"DB_data.connection\"),\n    //                 database:global.get(\"DB_data.appDB\"),\n    //                 collection:'sessions',\n    //                 operation:'update', // updateMany , updateOne\n    //                 }\n\n    //                         mongodbTools.resolveAsync(updateObj, node, function(res){\n                                \n    //                             findObj = {\n    //                                 query : {\n    //                                         query :{deviceId: responseObj.deviceId, revotioSessionId: responseObj.revotioSessionId}, \n    //                                         },\n    //                                 connection:global.get(\"DB_data.connection\"),\n    //                                 database:global.get(\"DB_data.appDB\"),\n    //                                 collection:'sessions',\n    //                                 operation:'find', // updateMany , updateOne\n    //                                 }\n                \n    //                         mongodbTools.resolveAsync(findObj, node, function(res){\n    //                                 msg.payload  = res[0]\n    //                                 node.send(msg) \n    //                         })  \n    //         })  \n            \n            \n  \n// return msg;","outputs":1,"noerr":0,"x":930,"y":900,"wires":[["107e8b58.7328f5"]]},{"id":"301e688d.349888","type":"comment","z":"508957a1.dd5398","name":"Initialize post","info":"Expected object :\n\n msg.payload = {\n        DeviceId: ** From publised app **,\n        RevotioSessionId : ** From publised app **,\n   }","x":130,"y":560,"wires":[]},{"id":"7e2e45e5.66251c","type":"function","z":"508957a1.dd5398","name":"Prepair msg.RevotioData Obj","func":"\n\nmsg.RevotioData.session = msg.payload \nmsg.RevotioData.entity = msg.RevotioData.PostData.gadgetId\n\nif (typeof msg.payload.FlowData === 'object' ){\n    msg.RevotioData.FlowData = msg.payload.FlowData\n    delete msg.payload.FlowData\n} else {\n     msg.RevotioData.FlowData = {Data : {}}\n}\n\nmsg.RevotioData.session = msg.payload \n    \nreturn msg;","outputs":1,"noerr":0,"x":800,"y":760,"wires":[["40d072f4.03fce4"]]},{"id":"92449c5.fd42de","type":"function","z":"508957a1.dd5398","name":"prepair redirect to user authentication && update session object","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload  = {\n    Page :global.get(\"DomainProperties.NonAuthDefaultPage\")\n}\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{\n                                    revotioSessionId:msg.RevotioData.session.revotioSessionId, \n                                    deviceId : msg.RevotioData.session.deviceId\n                            }, \n                            update : { \"$set\" : msg.RevotioData.session},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                   \n                    node.send(msg) \n            })  \n\n","outputs":1,"noerr":0,"x":1470,"y":280,"wires":[["3d5d3142.cf1206"]]},{"id":"8ebf17ec.2f4a48","type":"function","z":"508957a1.dd5398","name":"check token content","func":"var jsonwebtoken = global.get('jsonwebtoken');\n\n\nmsg.RevotioData =\n{\n    session : JSON.parse(msg.payload.SessionData),\n    type : msg.payload.payload,\n    BrowserFP : JSON.parse(msg.payload.PostData)\n}\n\n jsonwebtoken.verify(msg.RevotioData.session.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n          if (decoded !== undefined){\n              tokenState = \"valid\"\n              msg.tokenData = decoded\n          }\n        });\n       \n\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":280,"wires":[[]]},{"id":"6b3b5ad8.614bac","type":"function","z":"508957a1.dd5398","name":"check token content","func":"var jsonwebtoken = global.get('jsonwebtoken');\n\n\npayload = JSON.parse(msg.payload.RevotioData)\n\n jsonwebtoken.verify(payload.token , global.get(\"SystemVars.secret\"), function(err, decoded) {\n          if (decoded !== undefined){\n              tokenState = \"valid\"\n              msg.tokenData = decoded\n          }\n        });\n       \n\n\nreturn msg;","outputs":1,"noerr":0,"x":381.6666450500488,"y":561.0833415985107,"wires":[[]]},{"id":"15c4a8bb.5b28af","type":"function","z":"508957a1.dd5398","name":"prepair redirect to user authentication","func":"msg.payload  = {\n    Page :\"user account activation\",\n    RevotioData: {\n        activationToken :  msg.RevotioData.session.activationToken\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":380,"wires":[["5fba24de.5173fc"]]},{"id":"c964af3e.013ae8","type":"function","z":"508957a1.dd5398","name":"Check if token is valid - Action","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar secret = global.get(\"SystemVars.secret\");\n\nvar valid, invalid;\n\n\n// verify a token symmetric\njsonwebtoken.verify(msg.RevotioData.session.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n        valid = msg;\n      } else {\n          invalid = msg;\n      }\n    });\n    \n  \n    \n    \nreturn [valid, invalid];","outputs":2,"noerr":0,"x":530,"y":780,"wires":[["7e2e45e5.66251c"],["e39b5dab.d5db78"]],"outputLabels":["valid","invalid"]},{"id":"e39b5dab.d5db78","type":"function","z":"508957a1.dd5398","name":"Redirect to user authentication","func":"msg.payload  = {\n    Page :\"user authentication\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":800,"wires":[["7167ce92.3c59c"]]},{"id":"8cd48535.9010d8","type":"function","z":"508957a1.dd5398","name":"Check if token is valid - INIT","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar secret = global.get(\"SystemVars.secret\");\nvar request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar valid, invalid;\n//  get session\nmsg.starttime = new Date()\n\n\nmsg.INIT = JSON.parse(msg.dataResult.dataContent.RevotioData);\nvar query =\n    {deviceId : msg.payload.deviceId, \n    revotioSessionId:msg.payload.revotioSessionId}\n\n// msg.operation = 'findOne'\n\n// find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                if (res.length > 0){\n                     msg.payload = res[0]\n                } else {\n                    msg.payload  = {}\n                }\n                    node.send(msg) \n            })   \n\n\n\n// // verify a token symmetric\n// jsonwebtoken.verify(msg.INIT.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n//       if (decoded !== undefined){\n//         valid = msg;\n//       } else {\n//           invalid = msg;\n//       }\n//     });\n    \n  \n    \n    \n// return [valid, invalid];","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":600,"wires":[["4a28c697.d7c878"]],"outputLabels":["valid"]},{"id":"84c26a9f.683b7","type":"function","z":"508957a1.dd5398","name":"prepair redirect to reset ","func":"msg.payload  = {\n    Page :'reset password',\n    RevotioData:{\n        resetToken : msg.RevotioData.session.resetToken\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":420,"wires":[["5fba24de.5173fc"]]},{"id":"2c492795.625c38","type":"function","z":"508957a1.dd5398","name":"Create msg.RevotioData and get UserData","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// Get UserData\n\n// aggregate\n\n\n            aggregateObj = {\n                    query : { query : [\n                                        {$match : { _id : new ObjectID(msg.RevotioData.session.user_id)}},\n                                        \n                                        {    $lookup: {\n                                                from: \"user_accounts\",\n                                                localField: \"_id\",\n                                                foreignField: \"user\",\n                                                as: \"UserAccountData\"\n                                            }},\n                                        {    $lookup: {\n                                            from: \"user_permissions\",\n                                            localField: \"_id\",\n                                            foreignField: \"user\",\n                                            as: \"AppUserPermissionInfo\"\n                                        }},\n                                        {\n                                          $unwind:\"$UserAccountData\"\n                                        },\n                                                ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                if (res.length > 0){\n                     msg.payload = res[0]\n                } else {\n                     msg.payload = {}\n                }\n                   \n                    node.send(msg) \n            }) \n ","outputs":1,"noerr":0,"x":930,"y":340,"wires":[["a45c0a9e.4de0e"]]},{"id":"10e1e3b.d1d519c","type":"function","z":"508957a1.dd5398","name":"Decrypt token","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar tokenState\n\n// Decrypt token\n    jsonwebtoken.verify(msg.RevotioData.session.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n          tokenState = \"valid\"\n          TokenContent = decoded\n      }\n    });\n                \nmsg.RevotioData.session.user_id = new ObjectID(TokenContent.user_id);\n\nmsg.RevotioData.applicationId = new ObjectID(global.get(\"applicationId\"));\n\nmsg.payload = {\n    deviceId: msg.RevotioData.session.deviceId,\n    revotioSessionId :msg.RevotioData.session.revotioSessionId,\n};\n\nmsg.operation = 'findOne'\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":340,"wires":[["2c492795.625c38"]]},{"id":"a45c0a9e.4de0e","type":"function","z":"508957a1.dd5398","name":"Prepair redirect","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nvar PNO , Client, none;\n\n\n// delete msg.RevotioData.SessionData\n// if (msg.payload.length > 0){\nmsg.RevotioData.session.UserData =  msg.payload;\n\nmsg.RevotioData.session.UserData.type = \"NonPNOAdmin\"\n\n_.each(msg.RevotioData.session.UserData.AppUserPermissionInfo, function(Item, Index){\n    \n    if (Item.type === \"organization\"){\n        \n        if (String(Item.type_id) === String(global.get(\"MasterOrganizationData._id\")) && Item.permission === 0){\n            msg.RevotioData.session.UserData.type = \"PNOAdmin\"\n        }\n        \n        \n    }\n    \n})\n\nif (msg.RevotioData.session.UserData.type === \"PNOAdmin\"){\n\nPNO = msg;\n\n} else {\n        \nClient = msg\n        \n}\n\n   \n\n\n\nreturn [PNO , Client, none];","outputs":3,"noerr":0,"x":1180,"y":340,"wires":[["65cb1ffa.0f19d"],["414c3d6c.df3964"],["92449c5.fd42de"]],"outputLabels":["PNO","Client","none"]},{"id":"414c3d6c.df3964","type":"function","z":"508957a1.dd5398","name":"Check user inv","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar resume, login;\n\nUserOrgPermissionObjIndex = lodash.findIndex(msg.RevotioData.session.UserData.AppUserPermissionInfo,{type: \"organization\"} );\n\nif (UserOrgPermissionObjIndex === -1){\n    login = msg;\n}else {\n    UserOrgPermissionObj = msg.RevotioData.session.UserData.AppUserPermissionInfo[UserOrgPermissionObjIndex]\n\nresume = msg \n}\n\n\nreturn [resume, login ];","outputs":2,"noerr":0,"x":1360,"y":400,"wires":[["b0299765.306ab"],["c4762256.4d3218"]],"outputLabels":["resume, ","login"]},{"id":"cd09b08b.c1c3d","type":"function","z":"508957a1.dd5398","name":"Permission check 2/3","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.RevotioData.session.UserData.OrgRepresentativeProjects = msg.payload;\n\nvar query = { project_leader : new ObjectID(msg.RevotioData.session.UserData._id)} ;\n\nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'projects',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n\n// return msg;","outputs":1,"noerr":0,"x":1900,"y":380,"wires":[["d4d30d3a.b0fd78"]]},{"id":"d4d30d3a.b0fd78","type":"function","z":"508957a1.dd5398","name":"Permission check 3/3","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nmsg.RevotioData.session.UserData.ProjectLeaderProjects = msg.payload;\n\nOrgObj = lodash.find(msg.RevotioData.session.UserData.AppUserPermissionInfo, {type: \"organization\"})\n\nif (msg.RevotioData.hasOwnProperty(\"FlowData\") === false){\n    msg.RevotioData.FlowData = {}\n}\n\nif (msg.RevotioData.session.UserData.ProjectLeaderProjects.length === 0 && msg.RevotioData.session.UserData.OrgRepresentativeProjects.length === 0){\n    \n            msg.RevotioData.FlowData.Page = global.get(\"DomainProperties.ClientDefaultPage\")\n            msg.RevotioData.OrganzationId = OrgObj.type_id;\n            msg.RevotioData.FlowData.organization_id = OrgObj.type_id;\n        \n       \n} else {\n        \n                msg.RevotioData.FlowData.Page = global.get(\"DomainProperties.ClientDefaultPage\")\n                msg.RevotioData.OrganzationId = OrgObj.type_id;\n                msg.RevotioData.FlowData.organization_id = OrgObj.type_id;\n         \n         \n\n}\n\n            msg.payload = {\n                    Page :   msg.RevotioData.FlowData.Page,\n                    RevotioData         : {\n                        organization_id : OrgObj.type_id\n                    }\n                }\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2100,"y":380,"wires":[["65cb1ffa.0f19d"]]},{"id":"a37d665a.27b8c8","type":"function","z":"508957a1.dd5398","name":"Parse object","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\n\n\nmsg.responseObj.presentationLayer = JSON.parse(msg.payload).pages[0];\nmsg.appObj = JSON.parse(msg.payload);\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":960,"wires":[["af5c8a5f.64c24"]],"outputLabels":["Items, "]},{"id":"5ddd0309.2d77fc","type":"http request","z":"508957a1.dd5398","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","x":550,"y":960,"wires":[["a37d665a.27b8c8"]]},{"id":"107e8b58.7328f5","type":"function","z":"508957a1.dd5398","name":"manage file system - Manage FS","func":"if (msg.payload.hasOwnProperty(\"value\") && msg.payload.value !== null){\n\nmsg.RevotioData.session._id = msg.payload.value._id\nmsg.RevotioData.session.container = msg.payload.value.container\n\nresult = global.get(\"functions.fileManagement\")( '', '',msg.RevotioData.session._id, \"initSessionFolder\") // source, destination, operation\n\nresult = global.get(\"functions.fileManagement\")( '', '',msg.RevotioData.session._id, \"emptyDirSync\") // source, destination, operation\n\n\nif (result.state === \"success\"){\n    \n} else {\n    \n}\n}\n\nmsg.payload = msg.responseObj;\nmsg.payload.Type = \"Redirect\";\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":940,"wires":[["dee52d4e.18fdb"]]},{"id":"28095b53.fd6c2c","type":"comment","z":"508957a1.dd5398","name":"Action post","info":"Expected object :\n\n msg.payload = {\n        DeviceId: ** From publised app **,\n        RevotioSessionId : ** From publised app **,\n   }","x":110,"y":740,"wires":[]},{"id":"e0a7d33c.5622b","type":"function","z":"508957a1.dd5398","name":"create request ****TEMP FIX**** INIT","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nmessage = {\n    \n    RevotioData: msg.RevotioData,\n    payload : msg.payload,\n    starttime : msg.starttime\n}\nid = new ObjectID()\n// msg = {}\n\nmsg.payload = [{ _id: id},\n    {requestData : message},\n    {upsert : true}\n]\n\nmsg.operation = \"updateOne\"\n\n\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n\nif (msg.RevotioData.session.container && msg.RevotioData.session.container !== null && global.get(\"DomainProperties.routing\") &&  global.get(\"DomainProperties.routing\") !== \"local\"){\n// ******************************************************************\n    msg.url =  msg.RevotioData.session.container + \"/\"\n    // msg.url = global.get(\"DomainProperties.url\")\n// ******************************************************************\n} else {\n    msg.url = global.get(\"DomainProperties.url\")\n}\n\n_.each(message.RevotioData.session.Page.replace(/[^\\w\\s]/gi,\"\").split(\" \"), function(value, index){\n    msg.url = msg.url + capitalizeFirstLetter(value);\n})\n\n\n// msg.url = message.RevotioData.session.Page.replace(/ /g, '');\n\n\n\n\nmsg.requestPayload = {id:id, type :\"init\", data :message}\n\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":600,"wires":[["1aa3f57a.f7d443"]]},{"id":"efdc3569.8d19","type":"http request","z":"508957a1.dd5398","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","authType":"basic","x":1270,"y":600,"wires":[["4912f95d.e12f"]]},{"id":"1aa3f57a.f7d443","type":"function","z":"508957a1.dd5398","name":"create request","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nmsg.payload = msg.requestPayload\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":600,"wires":[["efdc3569.8d19"]]},{"id":"4912f95d.e12f","type":"json","z":"508957a1.dd5398","name":"","property":"payload","action":"","pretty":false,"x":1390,"y":600,"wires":[["96960c1b.0a5558"]]},{"id":"5a048ebe.6b364","type":"http in","z":"aec22158.fe4e38","name":"UserAuthentication","url":"/UserAuthentication","method":"post","upload":false,"swaggerDoc":"","x":145,"y":539.9999961853027,"wires":[["ecd2c396.4d9af"]]},{"id":"2927f5ef.05639a","type":"function","z":"a55f7aee.572be","name":"Prepair flow","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nmsg.communicationData = msg.payload\n\nif (msg.payload.hasOwnProperty(\"data\")){\n   _.each(msg.payload.data, function(value, key ){\n                        if (key !== \"_id\"){\n                            msg[key] = value\n                        }\n                    })\n    node.send(msg) \n} else {\n\n// find \n            findObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.payload.id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'temp_sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                \n                if (Array.isArray(res)){\n                    temp  = res[0];\n                    res = temp\n                }\n                \n                \n                    _.each(res.requestData, function(value, key ){\n                        if (key !== \"_id\"){\n                            msg[key] = value\n                        }\n                    })\n                    \n                    \n                    \n                    node.send(msg) \n            }) \n}\n// return msg;","outputs":1,"noerr":0,"x":150,"y":80,"wires":[["4e19b9ea.51eff8"]]},{"id":"96960c1b.0a5558","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":1490,"y":600,"wires":[]},{"id":"d65791.a28bc07","type":"http in","z":"aec22158.fe4e38","name":"UserAccountActivation","url":"/UserAccountActivation","method":"post","upload":false,"swaggerDoc":"","x":155,"y":1059.9999961853027,"wires":[["f467989a.2c7b"]]},{"id":"c8f85a27.6c8cf","type":"http in","z":"aec22158.fe4e38","name":"TwoStepAuthentication","url":"/TwoStepAuthentication","method":"post","upload":false,"swaggerDoc":"","x":195,"y":1539.9999961853027,"wires":[["fc712911.f455d8"]]},{"id":"77af50e2.589c78","type":"http in","z":"aec22158.fe4e38","name":"ResetPassword","url":"/ResetPassword","method":"post","upload":false,"swaggerDoc":"","x":175,"y":2339.9999961853027,"wires":[["3f566bdd.bca52c"]]},{"id":"3e12189a.39eac","type":"http in","z":"2294209a.0c95b","name":"UsersGlobal","url":"/UsersGlobal","method":"post","upload":false,"swaggerDoc":"","x":90,"y":480,"wires":[["e5a5de01.a1ac3"]]},{"id":"c199e887.a6da4","type":"link out","z":"aec22158.fe4e38","name":"","links":["a206fa2f.9bb658"],"x":510,"y":499.99999618530273,"wires":[]},{"id":"e130563c.567048","type":"link out","z":"aec22158.fe4e38","name":"","links":["ffb8ad05.fe04"],"x":510,"y":539.9999961853027,"wires":[]},{"id":"82e73790.6bba78","type":"link out","z":"aec22158.fe4e38","name":"","links":["3ab682ae.10e656"],"x":510,"y":579.9999961853027,"wires":[]},{"id":"4e19b9ea.51eff8","type":"switch","z":"a55f7aee.572be","name":" Route","property":"communicationData.type","propertyType":"msg","rules":[{"t":"eq","v":"design","vt":"str"},{"t":"eq","v":"init","vt":"str"},{"t":"eq","v":"action","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":310,"y":80,"wires":[[],[],[]],"outputLabels":["design","init","action"]},{"id":"c6521856.c46ec","type":"comment","z":"aec22158.fe4e38","name":"INIT","info":"","x":585,"y":539.9999961853027,"wires":[]},{"id":"ffbabbe8.5d0cb","type":"comment","z":"aec22158.fe4e38","name":"DESIGN","info":"","x":595,"y":499.99999618530273,"wires":[]},{"id":"215a6aa.6a2d296","type":"comment","z":"aec22158.fe4e38","name":"ROUTE","info":"","x":585,"y":579.9999961853027,"wires":[]},{"id":"18c634ff.b1dad3","type":"link out","z":"aec22158.fe4e38","name":"","links":["dd573c4c.643968"],"x":530,"y":1019.9999961853027,"wires":[]},{"id":"6537bec2.9226e8","type":"link out","z":"aec22158.fe4e38","name":"","links":["f08a12de.bf0fd"],"x":530,"y":1059.9999961853027,"wires":[]},{"id":"e8682458.5b8fb","type":"link out","z":"aec22158.fe4e38","name":"","links":["579313d7.2430dc"],"x":530,"y":1099.9999961853027,"wires":[]},{"id":"86aac31e.60e968","type":"comment","z":"aec22158.fe4e38","name":"INIT","info":"","x":605,"y":1059.9999961853027,"wires":[]},{"id":"d26e6d75.630648","type":"comment","z":"aec22158.fe4e38","name":"DESIGN","info":"","x":615,"y":1019.9999961853027,"wires":[]},{"id":"bbd839b4.9edf48","type":"comment","z":"aec22158.fe4e38","name":"ROUTE","info":"","x":605,"y":1099.9999961853027,"wires":[]},{"id":"c42395c9.e7a698","type":"link out","z":"aec22158.fe4e38","name":"","links":["ce9cd56d.b714d"],"x":570,"y":1499.9999961853027,"wires":[]},{"id":"839b0669.2a35d","type":"link out","z":"aec22158.fe4e38","name":"","links":["a27da0ef.7fe0c8"],"x":570,"y":1539.9999961853027,"wires":[]},{"id":"e84a1d06.e6f258","type":"link out","z":"aec22158.fe4e38","name":"","links":["e8c424c8.a91d3"],"x":570,"y":1579.9999961853027,"wires":[]},{"id":"77b5177.8cc3ae8","type":"comment","z":"aec22158.fe4e38","name":"INIT","info":"","x":645,"y":1539.9999961853027,"wires":[]},{"id":"7423e4f2.3972ec","type":"comment","z":"aec22158.fe4e38","name":"DESIGN","info":"","x":655,"y":1499.9999961853027,"wires":[]},{"id":"9304d6af.5a4b1","type":"comment","z":"aec22158.fe4e38","name":"ROUTE","info":"","x":645,"y":1579.9999961853027,"wires":[]},{"id":"e98e6ae3.ce1128","type":"link out","z":"aec22158.fe4e38","name":"","links":["a885e943.ebfb1"],"x":550,"y":2299.9999961853027,"wires":[]},{"id":"8b9609e7.cfa4c8","type":"link out","z":"aec22158.fe4e38","name":"","links":["d431a2e4.6d283","cae94cae.9e3458"],"x":550,"y":2339.9999961853027,"wires":[]},{"id":"32198700.e5b5b8","type":"link out","z":"aec22158.fe4e38","name":"","links":["e298dd8d.cbd328"],"x":550,"y":2379.9999961853027,"wires":[]},{"id":"29a350c1.e1c58","type":"comment","z":"aec22158.fe4e38","name":"INIT","info":"","x":625,"y":2339.9999961853027,"wires":[]},{"id":"a9ec6176.11b33","type":"comment","z":"aec22158.fe4e38","name":"DESIGN","info":"","x":635,"y":2299.9999961853027,"wires":[]},{"id":"63484a7a.f6eca4","type":"comment","z":"aec22158.fe4e38","name":"ROUTE","info":"","x":625,"y":2379.9999961853027,"wires":[]},{"id":"ff290d23.18df18","type":"link out","z":"2294209a.0c95b","name":"","links":["7d1a67c6.b7534"],"x":355,"y":440,"wires":[]},{"id":"b0ae31e0.11c9e8","type":"link out","z":"2294209a.0c95b","name":"","links":["32bc6eb7.c073aa"],"x":355,"y":480,"wires":[]},{"id":"be4224db.bfd728","type":"link out","z":"2294209a.0c95b","name":"","links":["3a23c4b4.bdc8a4"],"x":355,"y":520,"wires":[]},{"id":"e9eab74e.5cd3c","type":"comment","z":"2294209a.0c95b","name":"INIT","info":"","x":430,"y":480,"wires":[]},{"id":"354b4b47.56bff4","type":"comment","z":"2294209a.0c95b","name":"DESIGN","info":"","x":440,"y":440,"wires":[]},{"id":"b3b838e8.1d485","type":"comment","z":"2294209a.0c95b","name":"ROUTE","info":"","x":430,"y":520,"wires":[]},{"id":"ab8b9205.06cbe","type":"http request","z":"508957a1.dd5398","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1910,"y":1000,"wires":[["917b5262.1f0b9"]]},{"id":"3f2e4a2d.25f27e","type":"function","z":"508957a1.dd5398","name":"create request","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nmsg.payload = msg.requestPayload\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1820,"y":940,"wires":[["ab8b9205.06cbe","7300eaa0.fbf76c"]]},{"id":"917b5262.1f0b9","type":"json","z":"508957a1.dd5398","name":"","property":"payload","action":"","pretty":false,"x":2010,"y":1000,"wires":[["4c1b020f.633964"]]},{"id":"cf8d96f9.9c98d","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":2170,"y":960,"wires":[]},{"id":"975f47b0.683f3","type":"http request","z":"508957a1.dd5398","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","authType":"basic","x":1470,"y":760,"wires":[["4d37f804.d37c5"]]},{"id":"6965c6fa.5073d8","type":"function","z":"508957a1.dd5398","name":"create request","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nmsg.payload = msg.requestPayload\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1320,"y":760,"wires":[["975f47b0.683f3"]]},{"id":"4d37f804.d37c5","type":"json","z":"508957a1.dd5398","name":"","property":"payload","action":"","pretty":false,"x":1590,"y":760,"wires":[["a6042701.1dde"]]},{"id":"a6042701.1dde","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":1690,"y":760,"wires":[]},{"id":"40d072f4.03fce4","type":"function","z":"508957a1.dd5398","name":"create request ****TEMP FIX**** ACTION","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nmessage = {\n    RevotioData: msg.RevotioData,\n    payload : msg.payload,\n    starttime : msg.starttime\n}\nid = new ObjectID()\n// msg = {}\n\nmsg.payload = [{ _id: id},\n    {requestData : message},\n    {upsert : true}\n]\n\nmsg.operation = \"updateOne\"\n\n\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n\nif (msg.RevotioData.session.container && msg.RevotioData.session.container !== null && global.get(\"DomainProperties.routing\") &&  global.get(\"DomainProperties.routing\") !== \"local\"){\n// ******************************************************************\n    msg.url = msg.RevotioData.session.container + \"/\"\n    // msg.url = global.get(\"DomainProperties.url\")\n// ******************************************************************\n} else {\n    msg.url = global.get(\"DomainProperties.url\")\n}\n\n_.each(message.payload.Page.replace(/[^\\w\\s]/gi,\"\").split(\" \"), function(value, index){\n    msg.url = msg.url + capitalizeFirstLetter(value);\n})\n\n\n// msg.url = message.RevotioData.session.Page.replace(/ /g, '');\n\n\n\n\nmsg.requestPayload = {id:id, type :\"action\", data :message}\n\nreturn msg;","outputs":1,"noerr":0,"x":1080,"y":760,"wires":[["6965c6fa.5073d8"]]},{"id":"dee52d4e.18fdb","type":"function","z":"508957a1.dd5398","name":"create request ****TEMP FIX**** REDIRECT","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nmessage = {\n    // RevotioData: msg.RevotioData,\n    payload : msg.payload\n}\n\n// _.each(msg.payload, function(Item, key){\n    \n//     if (typeof Item === \"object\"){\n//         message[key] = {}\n//     } else {\n//         message[key] = Item\n//     }\n// })\nid = new ObjectID()\n// msg = {}\n\n// msg.payload = [{ _id: id},\n//     {requestData : message},\n//     {upsert : true}\n// ]\n\n// msg.operation = \"updateOne\"\n\n\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nif (msg.payload.hasOwnProperty(\"presentationLayer\") === true && msg.payload.presentationLayer.hasOwnProperty(\"container\") === true && msg.RevotioData.session.container !== null  && global.get(\"DomainProperties.routing\") &&  global.get(\"DomainProperties.routing\") !== \"local\"){\n// ******************************************************************\n    msg.url =message.payload.presentationLayer.container + \"/\"\n    // msg.url = global.get(\"DomainProperties.url\")\n// ******************************************************************\n} else {\n    msg.url = global.get(\"DomainProperties.url\")\n}\n\n\n// if (msg.payload.presentationLayer.hasOwnProperty(\"groupedObject\") === true ){\n//     message.payload.presentationLayer = {\n//         groupedObject : msg.payload.presentationLayer.groupedObject\n//     }\n//         // groupedObject = msg.payload.presentationLayer.groupedObject\n// // groupedObject = groupedObject\n//     // msg.url = global.get(\"DomainProperties.url\")\n// // ******************************************************************\n// } \n\n\n_.each(message.payload.Page.replace(/[^\\w\\s]/gi,\"\").split(\" \"), function(value, index){\n    msg.url = msg.url + capitalizeFirstLetter(value);\n})\n\n//  msg.url.replace(/-/, \"\")\n\n// msg.url = message.RevotioData.session.Page.replace(/ /g, '');\n\n\n\n\nmsg.requestPayload = {id:id, type :\"design\", data : message}\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":940,"wires":[["3f2e4a2d.25f27e"]]},{"id":"fb965307.f2bdc","type":"http in","z":"e5822137.be45d","name":"OrganizationsGlobal","url":"/OrganizationsGlobal","method":"post","upload":false,"swaggerDoc":"","x":110,"y":360,"wires":[["5ad96e17.a754f8"]]},{"id":"5a5da070.ff4398","type":"link out","z":"e5822137.be45d","name":"","links":["ec952e8b.ee99"],"x":495,"y":320,"wires":[]},{"id":"e6c8f68c.3a8fd","type":"link out","z":"e5822137.be45d","name":"","links":["90f055d0.958ee8"],"x":495,"y":360,"wires":[]},{"id":"c44b4bde.0df218","type":"link out","z":"e5822137.be45d","name":"","links":["91850e71.061e1"],"x":495,"y":400,"wires":[]},{"id":"3e417daa.0d1532","type":"comment","z":"e5822137.be45d","name":"INIT","info":"","x":570,"y":360,"wires":[]},{"id":"b90601a5.f77f68","type":"comment","z":"e5822137.be45d","name":"DESIGN","info":"","x":580,"y":320,"wires":[]},{"id":"2d03ba7a.8f386e","type":"comment","z":"e5822137.be45d","name":"ROUTE","info":"","x":570,"y":400,"wires":[]},{"id":"bc77063b.1d43c8","type":"comment","z":"2294209a.0c95b","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2470,"y":860.9998779296875,"wires":[]},{"id":"827557d5.fcca3","type":"subflow:39834eee.0dd5a2","z":"aec22158.fe4e38","name":"","env":[],"x":195,"y":299.99999618530273,"wires":[["1c72090c.42333f"]]},{"id":"c78d53d2.e65ff","type":"subflow:39834eee.0dd5a2","z":"aec22158.fe4e38","name":"","x":195,"y":859.9999961853027,"wires":[["35a2a99e.50eb36"]]},{"id":"cb673224.c23b78","type":"subflow:39834eee.0dd5a2","z":"aec22158.fe4e38","name":"","x":215,"y":1319.9999961853027,"wires":[["1121a4d9.54acc3"]]},{"id":"c4b9da22.c433d8","type":"subflow:39834eee.0dd5a2","z":"aec22158.fe4e38","name":"","x":215,"y":2119.9999961853027,"wires":[["777344ad.7bee8c"]]},{"id":"d7e5d821.5a91a8","type":"subflow:39834eee.0dd5a2","z":"2294209a.0c95b","name":"","x":1000,"y":380,"wires":[["693f75d0.9e78f4"]]},{"id":"c14b21e1.bdb88","type":"subflow:39834eee.0dd5a2","z":"e5822137.be45d","name":"","env":[],"x":800,"y":320,"wires":[["6953bde2.d417fc"]]},{"id":"66ac4ed4.7ee12","type":"http in","z":"508957a1.dd5398","name":"redirect","url":"/redirect","method":"post","upload":false,"swaggerDoc":"","x":90,"y":960,"wires":[["da7d3a96.7d58e"]]},{"id":"da7d3a96.7d58e","type":"function","z":"508957a1.dd5398","name":"Setup msg object","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\npayload = msg.payload ;\n\ndelete msg.payload ;\n\n_.each(payload, function(value, key){\n    // if (typeof value ===  'string'){\n    //     msg[key] = value.trim()\n    // } else {\n        msg[key] = value\n    // }\n})\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":960,"wires":[["1bb649ce.6a1376"]]},{"id":"3d5d3142.cf1206","type":"subflow:5e9b9c1d.bbe4a4","z":"508957a1.dd5398","name":"","env":[],"x":1780,"y":280,"wires":[]},{"id":"c8fb96e2.82848","type":"subflow:5e9b9c1d.bbe4a4","z":"508957a1.dd5398","name":"","env":[],"x":3020,"y":340,"wires":[]},{"id":"5fba24de.5173fc","type":"subflow:5e9b9c1d.bbe4a4","z":"508957a1.dd5398","name":"","env":[],"x":1000,"y":420,"wires":[]},{"id":"7167ce92.3c59c","type":"subflow:5e9b9c1d.bbe4a4","z":"508957a1.dd5398","name":"","env":[],"x":1000,"y":800,"wires":[]},{"id":"aee578b.d1a4a88","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":1635,"y":359.99999618530273,"wires":[]},{"id":"c374e685.14751","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":1895,"y":839.9999961853027,"wires":[]},{"id":"fa60834f.7ab0f","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":2035,"y":919.9999961853027,"wires":[]},{"id":"50553c0.ca774c4","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":4380,"y":920,"wires":[]},{"id":"4a4fa343.c95144","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":2855,"y":1339.9999961853027,"wires":[]},{"id":"74c995c2.07940c","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":3000,"y":2360,"wires":[]},{"id":"85e06edd.f24208","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":4640,"y":400,"wires":[]},{"id":"c0f97a1f.81ffc8","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":4640,"y":320,"wires":[]},{"id":"b42e2891.03848","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":2955,"y":299.99999618530273,"wires":[]},{"id":"5e3c68e9.35887","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":1340,"y":2240,"wires":[]},{"id":"6f35ce9c.ca2728","type":"subflow:5e9b9c1d.bbe4a4","z":"e5822137.be45d","name":"","env":[],"x":3760,"y":360,"wires":[]},{"id":"6e95417b.0deff","type":"subflow:5e9b9c1d.bbe4a4","z":"e5822137.be45d","name":"","env":[],"x":3880,"y":420,"wires":[]},{"id":"ecd2c396.4d9af","type":"subflow:a55f7aee.572be","z":"aec22158.fe4e38","name":"","env":[],"x":305,"y":539.9999961853027,"wires":[["c199e887.a6da4"],["e130563c.567048"],["82e73790.6bba78"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"f467989a.2c7b","type":"subflow:a55f7aee.572be","z":"aec22158.fe4e38","name":"","env":[],"x":345,"y":1059.9999961853027,"wires":[["18c634ff.b1dad3"],["6537bec2.9226e8"],["e8682458.5b8fb"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"fc712911.f455d8","type":"subflow:a55f7aee.572be","z":"aec22158.fe4e38","name":"","env":[],"x":445,"y":1539.9999961853027,"wires":[["c42395c9.e7a698"],["839b0669.2a35d"],["e84a1d06.e6f258"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"3f566bdd.bca52c","type":"subflow:a55f7aee.572be","z":"aec22158.fe4e38","name":"","env":[],"x":385,"y":2339.9999961853027,"wires":[["e98e6ae3.ce1128"],["8b9609e7.cfa4c8"],["32198700.e5b5b8"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"e5a5de01.a1ac3","type":"subflow:a55f7aee.572be","z":"2294209a.0c95b","name":"","env":[],"x":230,"y":480,"wires":[["ff290d23.18df18"],["b0ae31e0.11c9e8"],["be4224db.bfd728"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"5ad96e17.a754f8","type":"subflow:a55f7aee.572be","z":"e5822137.be45d","name":"","env":[],"x":330,"y":360,"wires":[["5a5da070.ff4398"],["e6c8f68c.3a8fd"],["c44b4bde.0df218"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"8a98de87.332c38","type":"comment","z":"508957a1.dd5398","name":"Global gadgets","info":"","x":160,"y":2000,"wires":[]},{"id":"a6bb1f75.b71ea","type":"function","z":"508957a1.dd5398","name":"Trigger remove actions per entity","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\n// delete all sub entities first\n_.each(msg.payload,function(SubItem, SubIndex){\n    node.send({organization_id:new ObjectID(SubItem._id)})\n} )\n\n// continue with main entity removal\n\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":2060,"wires":[["e4a2cb6b.ee4418","b842fe40.90a778","9c1da85e.48053"]]},{"id":"9548cd04.dd18","type":"function","z":"508957a1.dd5398","name":"Trigger delete project data","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif (msg.done === false ){\n    node.send(msg)\n}\n","outputs":1,"noerr":0,"x":1860,"y":2020,"wires":[["1b541ac0.d02bb5"]]},{"id":"772ffe54.54c5e8","type":"function","z":"508957a1.dd5398","name":"check if msg.organization_id is present and prepair child lookup","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\nvar valid, invalid\nif (msg.payload.hasOwnProperty(\"organization_id\")){\n\n    payload = {\"$or\": [{parent_id : new ObjectID(msg.payload.organization_id)}, {_id : new ObjectID(msg.payload.organization_id)} ] }\n    msg.operation = 'find.toArray'\n    msg.payload = payload\n    valid = msg\n} else {\n    invalid = msg\n}\n\nreturn [valid, invalid]","outputs":2,"noerr":0,"x":650,"y":2080,"wires":[["49d18cf3.10bffc"],["84581731.46c528"]],"outputLabels":["valid, ","invalid"]},{"id":"5e3674f6.75785c","type":"comment","z":"508957a1.dd5398","name":"Delete all organization Data","info":"","x":280,"y":2040,"wires":[]},{"id":"96251a.42faa2e8","type":"link in","z":"508957a1.dd5398","name":"Delete all organization Data","links":["755fb71d.d2028","bfc74af8.6937b"],"x":415,"y":2040,"wires":[["772ffe54.54c5e8","92f7b82b.753758"]]},{"id":"95fbcc07.06d0d8","type":"function","z":"508957a1.dd5398","name":"Get all app pages ","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// find  \nfindObj = {\n                    query : {\n                            query : {\tapplication_id : new ObjectID(msg.payload.application_id)},\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n// return msg;","outputs":1,"noerr":0,"x":990,"y":2140,"wires":[["58489cdd.d68c94"]]},{"id":"470f9615.b75dc","type":"comment","z":"508957a1.dd5398","name":"Delete all application data","info":"","x":310,"y":2160,"wires":[]},{"id":"7a432a0c.79afbc","type":"link in","z":"508957a1.dd5398","name":"Delete all project data","links":["1b541ac0.d02bb5","b298aff4.badb78","e9fb6492.5b068"],"x":395,"y":2160,"wires":[["5991555.e1515ac","1ea0e68c.3991f9"]]},{"id":"6a22c9d1.d1b99","type":"function","z":"508957a1.dd5398","name":"Libs","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif ( Array.isArray(msg.payload)){\n   _.each(msg.payload, function(Item, Index){\n    \n    msg.page_id = Item._id\n    node.send(msg);\n    \n    \n}); \n} else if (msg.payload.hasOwnProperty(\"page_id\")) {\n    msg.page_id = msg.payload.page_id\n    node.send(msg);\n} else{\n      msg.page_id = msg.payload._id\n    node.send(msg);\n}\n\n\n\n// return msg;","outputs":1,"noerr":0,"x":450,"y":2280,"wires":[["7ceb5cfd.26cd9c"]]},{"id":"cfb9798c.de63c8","type":"comment","z":"508957a1.dd5398","name":"Remove all page data","info":"","x":280,"y":2240,"wires":[]},{"id":"1c315256.30db66","type":"link in","z":"508957a1.dd5398","name":"Remove all wp data","links":["58489cdd.d68c94","5bc91a39.2b348c","cf312f50.45a118","148a291d.254577"],"x":375,"y":2240,"wires":[["6a22c9d1.d1b99","7af2cd05.9b0044"]]},{"id":"1b541ac0.d02bb5","type":"link out","z":"508957a1.dd5398","name":"","links":["7a432a0c.79afbc"],"x":1995,"y":2020,"wires":[]},{"id":"58489cdd.d68c94","type":"link out","z":"508957a1.dd5398","name":"","links":["1c315256.30db66"],"x":1115,"y":2140,"wires":[]},{"id":"73343394.a4587c","type":"http in","z":"508957a1.dd5398","name":"removeOrganization","url":"/removeOrganization","method":"post","upload":false,"swaggerDoc":"","x":310,"y":2080,"wires":[["772ffe54.54c5e8","92f7b82b.753758"]]},{"id":"834dea4d.06b3a8","type":"http in","z":"508957a1.dd5398","name":"removeApplication","url":"/removeApplication","method":"post","upload":false,"swaggerDoc":"","x":270,"y":2200,"wires":[["5991555.e1515ac","1ea0e68c.3991f9"]]},{"id":"9aa58cd7.cd31b","type":"http in","z":"508957a1.dd5398","name":"removePage","url":"/removePage","method":"post","upload":false,"swaggerDoc":"","x":270,"y":2280,"wires":[["6a22c9d1.d1b99","7af2cd05.9b0044"]]},{"id":"521fb03f.d3a258","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":770,"y":2280,"wires":[]},{"id":"84581731.46c528","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":950,"y":2100,"wires":[]},{"id":"5991555.e1515ac","type":"function","z":"508957a1.dd5398","name":"check if msg.application_id is present and prepair child lookup","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar valid, invalid\nif (msg.payload.hasOwnProperty(\"application_id\")){\n\n    // payload = {parent_id : new ObjectID(msg.payload.project_id)}\n    // msg.operation = 'find.toArray'\n    // msg.payload = payload\n    valid = msg\n} else {\n    invalid = msg\n}\n\nreturn [valid, invalid]","outputs":2,"noerr":0,"x":650,"y":2200,"wires":[["95fbcc07.06d0d8","6fd6f4e9.852dfc"],["71ca154d.fb77fc"]],"outputLabels":["valid, ","invalid"]},{"id":"71ca154d.fb77fc","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":950,"y":2220,"wires":[]},{"id":"b742db6e.8148f","type":"link out","z":"2294209a.0c95b","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","6a41100.61cc07","480dae32.8a339"],"x":3035,"y":600,"wires":[]},{"id":"c6410018.e4f6e","type":"http request","z":"152aab03.7a806d","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","authType":"basic","x":510,"y":380,"wires":[["58c085e7.5e88a4","8366c6b2.7951b8"]]},{"id":"b4440fc5.ad787","type":"function","z":"152aab03.7a806d","name":"menu call","func":"\npayload = {\n    payload : msg.payload,\n    RevotioData: msg.RevotioData\n}\n\nmsg.payload = payload\n\nmsg.url = global.get(\"DomainProperties.form-menu\")+ \"menu\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":380,"wires":[["c6410018.e4f6e"]]},{"id":"de32b4e0.6e0cb","type":"subflow:152aab03.7a806d","z":"2294209a.0c95b","name":"","env":[],"x":2960,"y":600,"wires":[["b742db6e.8148f"]]},{"id":"301d64c9.14362c","type":"function","z":"3170c4ab.fadb9c","name":"Form call","func":"\npayload = {\n    payload : msg.payload,\n    RevotioData: msg.RevotioData\n}\nmsg.payload = payload\nmsg.url = global.get(\"DomainProperties.form-menu\")+ \"form\"\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":260,"wires":[["9f77dd79.1dfd58"]]},{"id":"9f77dd79.1dfd58","type":"http request","z":"3170c4ab.fadb9c","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","authType":"basic","x":630,"y":340,"wires":[["4cf371cf.b278d8"]]},{"id":"a59768fe.a6a258","type":"subflow:3170c4ab.fadb9c","z":"2294209a.0c95b","name":"","x":3560,"y":420,"wires":[["da96270c.50aa4"]]},{"id":"da96270c.50aa4","type":"link out","z":"2294209a.0c95b","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","6a41100.61cc07","480dae32.8a339"],"x":3635,"y":420,"wires":[]},{"id":"6db87728.a54d58","type":"subflow:3170c4ab.fadb9c","z":"2294209a.0c95b","name":"","env":[],"x":3120,"y":540,"wires":[["2a3f6b04.a7f3bc"]]},{"id":"2a3f6b04.a7f3bc","type":"link out","z":"2294209a.0c95b","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","6a41100.61cc07","480dae32.8a339"],"x":3195,"y":540,"wires":[]},{"id":"b0ed4707.f5ac","type":"subflow:3170c4ab.fadb9c","z":"2294209a.0c95b","name":"","env":[],"x":3100,"y":760,"wires":[["f438ead1.51c198"]]},{"id":"f438ead1.51c198","type":"link out","z":"2294209a.0c95b","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","6a41100.61cc07","480dae32.8a339"],"x":3175,"y":760,"wires":[]},{"id":"e7a48cc8.cc60d8","type":"link out","z":"e5822137.be45d","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","a6ee6331.070228","6a41100.61cc07","c76409e8.f61b3"],"x":3735,"y":400,"wires":[]},{"id":"b4232b59.fc3c9","type":"subflow:152aab03.7a806d","z":"e5822137.be45d","name":"","env":[],"x":3640,"y":400,"wires":[["e7a48cc8.cc60d8","783e2299.1db02c"]]},{"id":"229e849a.2b771c","type":"subflow:3170c4ab.fadb9c","z":"e5822137.be45d","name":"","env":[],"x":3800,"y":280,"wires":[["402f0b1e.b2f10c"]]},{"id":"402f0b1e.b2f10c","type":"link out","z":"e5822137.be45d","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","a6ee6331.070228","6a41100.61cc07","c76409e8.f61b3"],"x":3915,"y":280,"wires":[]},{"id":"bcb372ba.8288e8","type":"subflow:3170c4ab.fadb9c","z":"e5822137.be45d","name":"","env":[],"x":3880,"y":460,"wires":[["4e30d34a.94d17c"]]},{"id":"4e30d34a.94d17c","type":"link out","z":"e5822137.be45d","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","a6ee6331.070228","6a41100.61cc07","c76409e8.f61b3"],"x":3955,"y":460,"wires":[]},{"id":"3e910553.3e65aa","type":"subflow:152aab03.7a806d","z":"e5822137.be45d","name":"","env":[],"x":1480,"y":440,"wires":[["ec6b9f6a.c0a41"]]},{"id":"ec6b9f6a.c0a41","type":"link out","z":"e5822137.be45d","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","a6ee6331.070228","6a41100.61cc07","c76409e8.f61b3"],"x":1735,"y":440,"wires":[]},{"id":"58c085e7.5e88a4","type":"json","z":"152aab03.7a806d","name":"","property":"payload","action":"","pretty":false,"x":630,"y":380,"wires":[["f4360e46.6f855","a8aa2565.f73818"]]},{"id":"4cf371cf.b278d8","type":"json","z":"3170c4ab.fadb9c","name":"","property":"payload","action":"","pretty":false,"x":750,"y":260,"wires":[["3ca50242.9fc416"]]},{"id":"4602b7fe.7067e8","type":"subflow:5e9b9c1d.bbe4a4","z":"152aab03.7a806d","name":"","x":1080,"y":260,"wires":[]},{"id":"a7b9f68.e4bd088","type":"http response","z":"152aab03.7a806d","name":"","statusCode":"","headers":{},"x":1090,"y":300,"wires":[]},{"id":"6fec3c3b.ef2c44","type":"function","z":"152aab03.7a806d","name":"Route response menu","func":"var redirect,logout, other;\n\nif (msg.payload.hasOwnProperty(\"payload\")){\n    payload = msg.payload.payload\n    msg.RevotioData = msg.payload.RevotioData\n    msg.payload = payload\n}\n\n\nif (msg.payload.hasOwnProperty(\"Page\")){\n    redirect = msg;\n} else if (msg.payload.hasOwnProperty(\"RevotioData\")  && msg.payload.RevotioData.hasOwnProperty(\"logout\")  &&msg.payload.RevotioData.logout === true){\n    logout = msg;\n} else {\n    other = msg;\n}\n\nreturn [redirect,logout, other];","outputs":3,"noerr":0,"x":860,"y":280,"wires":[["4602b7fe.7067e8"],["a7b9f68.e4bd088"],[]],"outputLabels":["redirect","logout","other"]},{"id":"3ca50242.9fc416","type":"function","z":"3170c4ab.fadb9c","name":"Route response form","func":"\nif (msg.payload.hasOwnProperty('Form')){\n    payload = msg.payload.payload\n    msg.RevotioData.FlowData.Form = msg.payload.Form\n    msg.payload = payload\n}\n\n\nvar redirect, other\nif (msg.payload.hasOwnProperty(\"presentationLayer\") || msg.payload.hasOwnProperty(\"data\") ){\n   redirect = msg; \n} else {\n    other = msg;\n}\nreturn [redirect, other];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":920,"y":260,"wires":[["63027655.f17e48"],[]],"outputLabels":["redirect, ","other"]},{"id":"63027655.f17e48","type":"http response","z":"3170c4ab.fadb9c","name":"","statusCode":"","headers":{},"x":1150,"y":240,"wires":[]},{"id":"62aa0677.77b8f","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":1650,"y":1980,"wires":[]},{"id":"e4a2cb6b.ee4418","type":"function","z":"508957a1.dd5398","name":"Remove Organization","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// remove \n            removeObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.organization_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    msg.result = res\n                    node.send(msg) \n            }) ","outputs":1,"noerr":0,"x":1500,"y":1980,"wires":[["62aa0677.77b8f"]]},{"id":"b5118d30.e7abd","type":"comment","z":"e25f5e2d.45871","name":"Push Gadgets to frontend","info":"","x":170,"y":160,"wires":[]},{"id":"242f58f1.b6c22","type":"function","z":"e25f5e2d.45871","name":"Get gadgetContainers Object","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar response, sessionUpdate , timer ;\nvar totalNumberOfGadgets, currentNumberOfGadgets;\nvar deviceId = msg.session.deviceId;\nvar revotioSessionId = msg.session.revotioSessionId ;\nvar token = msg.session.token\n\nmsg.test = []\n\nmsg.endtime = new Date()\n\n\n// if ( msg.session.Gadgets.length === 0  ){\n//     timer = msg;\n// }\n\n// msg.test.push({level:1})\n// _.each(msg.payload.gadgetsList, function(item, Index){\n//     item.endtime = new Date()\n//     item.starttime = msg.starttime\n//     item.diff = new Date(item.endtime) - new Date(msg.starttime)\n//     // GadgetArray = global.get('gadgetGroups.' + deviceId + \".\" + revotioSessionId+\".Gadgets\")\n    \n//     msg.session.Gadgets.push(item)\n    \n//     // update    \n\n \n\n// })\n\n\n\n// *********************\n// msg.test.push({Gadgets :global.get('gadgetGroups.' + deviceId + \".\" + revotioSessionId+\".Gadgets\"), Type:\"stage 1\" })\n// *********************\n\ncurrentNumberOfGadgets = msg.session.Gadgets.length;\n\n// msg.test.push({level:2})\nif (msg.session.groupedObject.hasOwnProperty(msg.RevotioData.entity)){\n    msg.test.push({level:3.1})\n    totalNumberOfGadgets = msg.session.groupedObject[msg.RevotioData.entity].length\n    msg.test.push({level:3.2})\n    \n} else {\n     msg.test.push({level:4.1})\n    totalNumberOfGadgets = msg.session.groupedObject.INIT.length\n    // totalNumberOfGadgets = global.get('gadgetGroups.' + deviceId + \".\" + revotioSessionId+\".groupedObject.INIT\").length\n    msg.test.push({level:4.2})\n    \n}\n\n// *********************\n// msg.test.push({             Gadgets :global.get('gadgetGroups.' + deviceId + \".\" + revotioSessionId+\".Gadgets\"), \n//                             Type:\"stage 2\", \n//                             totalNumberOfGadgets:totalNumberOfGadgets, \n//                             currentNumberOfGadgets:currentNumberOfGadgets })\n// *********************\n\nif (  \n        (totalNumberOfGadgets <= currentNumberOfGadgets) ){\n    \n    msg.payload = {\n        deviceId: deviceId,\n        revotioSessionId: revotioSessionId,\n        token: token,\n        gadgetsList : msg.session.Gadgets,\n        Type: \"Update\"\n        \n    }\n    \n    msg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\n\n    response = msg; \n    \n\n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.session._id)}, \n                            update : { \"$set\" : {Gadgets : [],\n                                                timestamp: new Date(),\n                                                responseSend : false\n                            }},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n            \n                \n            })  \n\n\n\n \nresponse = {\n    req : msg.req,\n    res : msg.res,\n    payload : msg.payload,\n    headers : msg.headers,\n}\nsessionUpdate = {RevotioData : msg.RevotioData}\n\nreturn [response, sessionUpdate] } \n\nelse {\n    return [response, sessionUpdate,timer];\n}\n\n    \n\n","outputs":3,"noerr":0,"initialize":"","finalize":"","x":430,"y":220,"wires":[["54a1b615.985f98"],["c87843fd.57c39"],["20224679.81494a"]],"outputLabels":["response","sessionUpdate",""]},{"id":"9690ddef.823e3","type":"http response","z":"e25f5e2d.45871","name":"","statusCode":"","headers":{},"x":1570,"y":120,"wires":[]},{"id":"5d28c909.86bda","type":"comment","z":"e25f5e2d.45871","name":"Generate response Object","info":"","x":190,"y":80,"wires":[]},{"id":"c87843fd.57c39","type":"function","z":"e25f5e2d.45871","name":"Update DB Session object","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nObj =  {FlowData: msg.RevotioData.FlowData, timestamp : new Date()\n};\n// msg.payload = [{deviceId: msg.RevotioData.session.deviceId, revotioSessionId: msg.RevotioData.session.revotioSessionId},{\"$set\" : Obj},{upsert : true}];\n\n// msg.operation = 'updateOne';\n\n// update    \n    updateObj = {\n                    query : {\n                            query :{deviceId: msg.RevotioData.session.deviceId, revotioSessionId: msg.RevotioData.session.revotioSessionId}, \n                            update : {\"$set\" : Obj},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.result = res\n                    // node.send(msg) \n            })  \n            \n            \n// return msg;","outputs":1,"noerr":0,"x":1200,"y":240,"wires":[[]]},{"id":"20224679.81494a","type":"delay","z":"e25f5e2d.45871","name":"Variable delay || 5000 milliseconds","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":280,"wires":[["6c4dc95f.5f22c"]]},{"id":"6267a6f2.146138","type":"function","z":"e25f5e2d.45871","name":"`check if response needs to be enforced","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar delay, response, sessionUpdate;\nvar deviceId = msg.sessionNew.deviceId ; \nvar revotioSessionId = msg.sessionNew.revotioSessionId ;\n\n\nif (        msg.sessionNew.hasOwnProperty(\"timestamp\") && \n        moment().diff(moment(msg.sessionNew.timestamp) > global.get(\"SystemVars.responseTimeout\"))){\n            \n       \n    \n        payload = {\n            deviceId: deviceId,\n            revotioSessionId: revotioSessionId,\n            gadgetsList :msg.sessionNew.Gadgets,\n            Type: \"Update\",\n            TimeOut : true\n            \n        }\n    \n        headers = {\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type',\n            'content-type': 'application/json',\n        };\n\n       \n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.sessionNew._id)}, \n                            update : { \"$set\" : {Gadgets : [],\n                                                timestamp: new Date(),\n                                                responseSend : false\n                            }},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n            }) \n \n        response = {\n            req : msg.req,\n            res : msg.res,\n            payload : payload,\n            headers : headers,\n        }\n        \n        sessionUpdate = {RevotioData : msg.RevotioData}\n\n            \n        } else if (msg.sessionNew.hasOwnProperty(\"timestamp\")) {\n            msg.time = moment().diff(moment(msg.sessionNew.timestamp))\n            \n            if ( global.get(\"SystemVars\").hasOwnProperty(\"delaySize\") ){\n                 msg.delay = global.get(\"SystemVars.delaySize\") \n            }\n          \n            delay = msg;\n        }\n   \n   \nreturn [delay, response, sessionUpdate];","outputs":3,"noerr":0,"x":740,"y":380,"wires":[["20224679.81494a"],["54a1b615.985f98"],["c87843fd.57c39"]],"outputLabels":["delay","response","sessionUpdate"]},{"id":"d6bad25b.32468","type":"catch","z":"a2b40f09.d18fd8","name":"","scope":null,"x":180,"y":60,"wires":[["a33af86.64c9d08"]]},{"id":"a33af86.64c9d08","type":"debug","z":"a2b40f09.d18fd8","name":"ERROR","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","x":300,"y":60,"wires":[]},{"id":"1a55a0c3.a8f35f","type":"link out","z":"508957a1.dd5398","name":"","links":["dc664b4f.0d82e","a1a4c9c0.c43b6"],"x":275,"y":400,"wires":[]},{"id":"9dfd3d8b.23a038","type":"comment","z":"508957a1.dd5398","name":"CHECK GC state","info":"","x":360,"y":400,"wires":[]},{"id":"d2a7b91c.174a08","type":"link out","z":"508957a1.dd5398","name":"","links":["dc664b4f.0d82e","a1a4c9c0.c43b6"],"x":295,"y":640,"wires":[]},{"id":"89012a78.5078c","type":"comment","z":"508957a1.dd5398","name":"CHECK GC state","info":"","x":400,"y":640,"wires":[]},{"id":"77a61ff7.3ac9d","type":"link out","z":"508957a1.dd5398","name":"","links":["dc664b4f.0d82e","a1a4c9c0.c43b6"],"x":235,"y":820,"wires":[]},{"id":"1212e3b2.f2f924","type":"comment","z":"508957a1.dd5398","name":"CHECK GC state","info":"","x":320,"y":820,"wires":[]},{"id":"f6d62ac3.629338","type":"function","z":"aec22158.fe4e38","name":"Cancel reset btn","func":"// Admin buttons\n\nmsg.payload = {\n    gadgetsList : [{            \n      \"gadgetId\": \"de786f35-541f-0e64-fc3f-089677920985\",\n      \"gadgetName\": \"Cancel reset btn\",\n      \"gadgetType\": \"dynamic-btn\",\n            \"gadgetOptions\":\n                {\"types\":\"\",\n                \"styles\":[\"btn-info\"],\n                \"buttonalign\":\"right\",\n                \"textcolor\":\"black\",\n                \"buttonlabel\":\"Cancel password reset\"},\n                // \"gadgetData\":\"create_project\"\n       \n   }]\n}\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":2180,"wires":[["b62f16e5.5c7998"]]},{"id":"cae94cae.9e3458","type":"link in","z":"aec22158.fe4e38","name":"","links":["8b9609e7.cfa4c8"],"x":615,"y":2180,"wires":[["f6d62ac3.629338"]]},{"id":"b62f16e5.5c7998","type":"link out","z":"aec22158.fe4e38","name":"","links":["1766e26.2df601e","15f8aeef.16f7d1","6510415f.c64d6","14c789ed.fd90f6","172bf3ee.b9865c","e6548cdd.b0501","43e1a714.c877a8","228b07a6.f5d6a8","101c6a60.58ca1e","b0f61403.73aa18","d6cfe34e.7be1d","2f3e87cf.a0111","5171869d.c0b8a8","ffc46262.694388","3356ae90.b06682","1f447df2.f79d1a","84cfac4f.42a868","3a82fd2b.90627a","4809e15c.231538","4675a1ec.757c6","82336b76.b7c958","b824f5cf.104838","6a1ab5fc.dff14c","692c6501.32656c","14264b85.6baf9c","e358d072.f3562","6cc00ce9.6960a4"],"x":795,"y":2180,"wires":[]},{"id":"ba5ecdcd.97009","type":"function","z":"aec22158.fe4e38","name":"prepair redirect to NonAuthDefaultPage","func":"\nmsg.payload  = {\n    Page :global.get(\"DomainProperties.NonAuthDefaultPage\"),\n}\nreturn msg;","outputs":1,"noerr":0,"x":2240,"y":2380,"wires":[["f374ea1a.cac74"]]},{"id":"f374ea1a.cac74","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":2440,"y":2380,"wires":[]},{"id":"dc2349a8.d26158","type":"http in","z":"508957a1.dd5398","name":"entrance","url":"/entrance","method":"post","upload":false,"swaggerDoc":"","x":120,"y":340,"wires":[["1a55a0c3.a8f35f","f6b3771f.d41548"]]},{"id":"180d6542.0d51fb","type":"http in","z":"508957a1.dd5398","name":"initialize","url":"/initialize","method":"post","upload":false,"swaggerDoc":"","x":110,"y":600,"wires":[["d2a7b91c.174a08","13c4294b.23613f"]]},{"id":"f0e5ba26.618eb8","type":"http in","z":"508957a1.dd5398","name":"action","url":"/action","method":"post","upload":false,"swaggerDoc":"","x":90,"y":780,"wires":[["77a61ff7.3ac9d","1d0b4bad.c78bcc"]]},{"id":"2780dc99.05adfc","type":"function","z":"2ef93158.ae5276","name":"Generic topbar design settings","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nif (msg.payload.hasOwnProperty(\"design\") === false ){\n    msg.payload.design = {}\n}\n\n_.each(global.get('topbar_design') , function(value, key){\n    \n    if (key === \"pageSpecificContanerPlaceholder\"){\n        msg.payload.design[msg.topbarContanerId] = value\n    } else {\n       msg.payload.design[key] = value\n    }\n    \n})\n\n\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":80,"wires":[[]]},{"id":"bf03eb39.4bf4a8","type":"subflow:2ef93158.ae5276","z":"e5822137.be45d","name":"","env":[],"x":1170,"y":320,"wires":[["df6d2863.899c68"]]},{"id":"9293b380.aed2b","type":"subflow:2ef93158.ae5276","z":"2294209a.0c95b","name":"","env":[],"x":1440,"y":380,"wires":[["225467fa.c7f1f"]]},{"id":"ef28ebcf.e11cc8","type":"function","z":"2294209a.0c95b","name":"Gadget payload","func":"msg.payload = {gadgetsList : [ {\n    \"gadgetId\":\"4c0935bb-b3da-51bd-8a74-c952f4272193\",\n      \"gadgetName\":\"Scope tabs\",\n      \"gadgetType\":\"revotio-tabs-select\",\n      \"gadgetData\":{\n         \"dropdown\":{\n            // \"value\": msg.RevotioData.FlowData.gadgetOptions.ReportingPeriod,\n            // \"options\":DropDown\n         },\n         \"tabs\":[ {\n               \"dropdownKey\":msg.RevotioData.session.Page,\n               \"fields\":\"\"\n         }],\n          \n      }}]};\n      \nmsg.tabsSettings = {\n    entity : \"organization\" ,\n    entityId : msg.RevotioData.FlowData.organization_id,\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1500,"y":760,"wires":[[]]},{"id":"56a2b4a6.6d588c","type":"link out","z":"2294209a.0c95b","name":"","links":["5185c631.530a58","cb87250c.966108","112320ff.7cff6f","d230180f.f3d19","e7f2e3d2.30705","ebf87699.c97f08","98813d9e.bcf0d","90045e69.ebd138","dd373359.040c4","ecd0ecf2.99d41","93aa962f.3144d","e5823b9b.d200f","dda61270.476b9","f0eeb60f.091b78","359e3b04.860634","dc6abb7.ed83248","ff0e6248.29e22","1cff0ac1.dc8705","147f3fb7.690568","f42bf06.8974d1","ef55a0fd.6d311","552f5d9b.570784","498662dd.42a45c","81c0cf07.5ef198","44daecc2.e5b2f4","cb902343.5f03a","e34f6cc2.af5ad8","480dae32.8a339"],"x":1775,"y":760,"wires":[]},{"id":"c114b448.029c4","type":"link in","z":"2294209a.0c95b","name":"users global = ACC Gagdet","links":["aea25a8a.fa4a58"],"x":1375,"y":760,"wires":[["ef28ebcf.e11cc8"]]},{"id":"54978e5a.104c68","type":"debug","z":"2294209a.0c95b","name":"Post Items gadgets","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2100,"y":720,"wires":[]},{"id":"ca597086.b35f6","type":"function","z":"d8703926.e2eca","name":"INIT org overview flow","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n// aggregate\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {\n                                  \"_id\": new ObjectID(\"5d9b21fe2f5aa895d791985f\"),\n                                 \n                                }\n                              },\n                                { \n                                    \"$lookup\" : {\n                                        \"from\" : \"organizations\", \n                                        \"localField\" : \"_id\", \n                                        \"foreignField\" : \"parent_id\", \n                                        \"as\" : \"childOrganizations\"\n                                    }\n                                }, \n                                { \n                                    \"$lookup\" : {\n                                        \"from\" : \"organizations\", \n                                        \"localField\" : \"parent_id\", \n                                        \"foreignField\" : \"_id\", \n                                        \"as\" : \"masterOrganizations\"\n                                    }\n                                }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    msg.result = res\n                    \n                    \n                    node.send(msg)\n                  })  \n","outputs":1,"noerr":0,"x":640,"y":80,"wires":[["148b695d.d56a1f"]]},{"id":"5ebca25f.80df2c","type":"inject","z":"d8703926.e2eca","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":380,"y":80,"wires":[["ca597086.b35f6"]]},{"id":"148b695d.d56a1f","type":"debug","z":"d8703926.e2eca","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":890,"y":100,"wires":[]},{"id":"85d38adc.97a99","type":"function","z":"2294209a.0c95b","name":"Breadcrumb organizations","func":"\n    \n    \nmsg.payload = {\n    gadgetsList: [{\n                gadgetId: 'd9a375f6-bdc7-f288-e831-6db2f4a76270',\n                gadgetName: 'Generic breadcrumb',\n                gadgetType: 'revotio-breadcrumbs',\n                gadgetData: {\n                  data: msg.data,\n                  options: {\n                    separatorIcon: 'fas fa-angle-right', // if null it will display \">\" by default\n                    // separatorIconColor: 'pink'\n                  }\n                }\n              }]}\n\nreturn msg;","outputs":1,"noerr":0,"x":1720,"y":820,"wires":[["e5361ca5.ccabf"]]},{"id":"449e3134.053a68","type":"link in","z":"2294209a.0c95b","name":"users global = ACC Gagdet","links":["aea25a8a.fa4a58"],"x":1355,"y":800,"wires":[[]]},{"id":"e5361ca5.ccabf","type":"link out","z":"2294209a.0c95b","name":"","links":["5185c631.530a58","cb87250c.966108","112320ff.7cff6f","d230180f.f3d19","e7f2e3d2.30705","ebf87699.c97f08","98813d9e.bcf0d","90045e69.ebd138","dd373359.040c4","ecd0ecf2.99d41","93aa962f.3144d","e5823b9b.d200f","dda61270.476b9","f0eeb60f.091b78","359e3b04.860634","dc6abb7.ed83248","ff0e6248.29e22","1cff0ac1.dc8705","147f3fb7.690568","f42bf06.8974d1","ef55a0fd.6d311","552f5d9b.570784","498662dd.42a45c","81c0cf07.5ef198","44daecc2.e5b2f4","cb902343.5f03a","e34f6cc2.af5ad8","480dae32.8a339"],"x":1975,"y":800,"wires":[]},{"id":"78e9ce03.4f11c","type":"function","z":"aec22158.fe4e38","name":"prepair redirect to NonAuthDefaultPage","func":"\nmsg.payload  = {\n    Page :global.get(\"DomainProperties.NonAuthDefaultPage\"),\n}\nreturn msg;","outputs":1,"noerr":0,"x":3200,"y":2140,"wires":[["df66ca95.228cd8"]]},{"id":"df66ca95.228cd8","type":"subflow:5e9b9c1d.bbe4a4","z":"aec22158.fe4e38","name":"","env":[],"x":3400,"y":2140,"wires":[]},{"id":"85b62822.f16cf8","type":"template","z":"aec22158.fe4e38","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!doctype html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width\">\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<title>{{payload.title}}</title>\n<style>\n@media  only screen and (max-width: 620px) {\ntable[class=body] h1 {\nfont-size: 28px !important;\nmargin-bottom: 10px !important;\n}\ntable[class=body] p,\ntable[class=body] ul,\ntable[class=body] ol,\ntable[class=body] td,\ntable[class=body] span,\ntable[class=body] a {\nfont-size: 16px !important;\n}\ntable[class=body] .wrapper,\ntable[class=body] .article {\npadding: 10px !important;\n}\ntable[class=body] .content {\npadding: 0 !important;\n}\ntable[class=body] .container {\npadding: 0 !important;\nwidth: 100% !important;\n}\ntable[class=body] .main {\nborder-left-width: 0 !important;\nborder-radius: 0 !important;\nborder-right-width: 0 !important;\n}\ntable[class=body] .btn table {\nwidth: 100% !important;\n}\ntable[class=body] .btn a {\nwidth: 100% !important;\n}\ntable[class=body] .img-responsive {\nheight: auto !important;\nmax-width: 100% !important;\nwidth: auto !important;\n}\n}\n@media  all {\n.ExternalClass {\nwidth: 100%;\n}\n.ExternalClass,\n.ExternalClass p,\n.ExternalClass span,\n.ExternalClass font,\n.ExternalClass td,\n.ExternalClass div {\nline-height: 100%;\n}\n.btn-primary table td:hover {\nbackground-color: #34495e !important;\n}\n.btn-primary a:hover {\nbackground-color: #34495e !important;\nborder-color: #34495e !important;\n}\n.button {\n  text-decoration: none;\n  background-color: #20a7db;\n  color: #333333;\n  padding: 2px 6px 2px 6px;\n  border: none;\n  border-radius: 2px;\n}\n}\n</style>\n</head>\n<body class=\"\" style=\"background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"body\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; background-color: #f6f6f6;\">\n<tr>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">&nbsp;</td>\n<td class=\"container\" style=\"font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; Margin: 0 auto; max-width: 580px; padding: 10px; width: 580px;\">\n<div class=\"content\" style=\"box-sizing: border-box; display: block; Margin: 0 auto; max-width: 580px; padding: 10px;\">\n\n<!-- START CENTERED WHITE CONTAINER -->\n<span class=\"preheader\" style=\"color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;\">{{payload.title}}</span>\n<table class=\"main\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; background: #ffffff; border-radius: 3px;\">\n\n<!-- START MAIN CONTENT AREA -->\n<tr>\n<td class=\"wrapper\" style=\"font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 40px;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td style=\"font-family: sans-serif; vertical-align: top; padding-bottom: 40px;\">\n<a href={{payload.activation_link}} target=\"_blank\">\n<img style=\"display: block; margin: auto; width: 150px;\" width=\"150\" src=\"data:image/png;base64,{{payload.base64data}}\" alt=\"{{payload.title}}\">\n</a>\n</td>\n</tr>\n</table>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">\n\n<p>Hi {{payload.firstname}} {{payload.lastname}},</p>\n<p>{{payload.message}}</p>\n<p>{{payload.activate_text}} <a class=\"button\" href=\"{{payload.activation_link}}\">{{payload.activate_click}}</a></p>\n<p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; Margin-bottom: 15px;\">\n{{payload.closing}}\n</p>\n<p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; Margin-bottom: 15px;\">\n{{payload.signature}}\n</p>\n</td>\n</tr>\n</table>\n</td>\n</tr>\n\n<!-- END MAIN CONTENT AREA -->\n</table>\n\n<!-- START FOOTER -->\n<div class=\"footer\" style=\"clear: both; Margin-top: 10px; text-align: center; width: 100%;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td class=\"content-block\" style=\"font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; font-size: 12px; color: #999999; text-align: center;\">\n<span style=\"color: #999999; font-size: 12px; text-align: center;\">{{payload.footer_text}}</span>\n<br> Don't like these emails? <a href=\"{{payload.settings_link}}\" style=\"text-decoration: underline; color: #999999; font-size: 12px; text-align: center;\">{{payload.settings_text}}</a>.\n</td>\n</tr>\n\n</table>\n</div>\n<!-- END FOOTER -->\n\n<!-- END CENTERED WHITE CONTAINER -->\n</div>\n</td>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">&nbsp;</td>\n</tr>\n</table>\n</body>\n</html>","output":"str","x":3240,"y":2180,"wires":[["80ee1d38.5041f8"]]},{"id":"16731a52.126fe6","type":"function","z":"aec22158.fe4e38","name":"Trigger email","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nmsg.payload = {\n  \"title\":\"Password reset\",\n  \"logo\":\"logo.png\",\n  \"firstname\":msg.RevotioData.FlowData.Data.UserData.first_name,\n  \"lastname\":msg.RevotioData.FlowData.Data.UserData.last_name,\n//   \"attachment\" : global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\",\n  \"message\":\"Welcome to the project management application!\",\n  \"closing\":\"Cheerfully yours,\",\n  \"signature\":\"Team Grant tools projects.\",\n  \"activate_text\":\"You can reset your password by clicking on this link:\",\n  \"activation_link\":global.get(\"DomainProperties.RootDomain\")+ \"/reset=\" + msg.RevotioData.FlowData.Data.UserData.resetToken,\n  \"activate_click\":\"Reset!\",\n  \"footer_text\":\"Grant tools B.V. | Rijswijk, Netherlands\",\n  \"settings_link\":global.get(\"DomainProperties.prodUrl\"),\n  \"settings_text\":\"Reset your password\",\n//   data:fs.readFileSync(global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\"),\n  base64data : fs.readFileSync(global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\").toString('base64'),\n}\n\nmsg.data = msg.payload\nreturn msg;\n\n","outputs":1,"noerr":0,"x":3110,"y":2180,"wires":[["85b62822.f16cf8"]]},{"id":"80ee1d38.5041f8","type":"function","z":"aec22158.fe4e38","name":"nodemailer_mailgun_transport && nodemailer","func":"// var request = global.get('request'); \nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar request = global.get('request');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// This is your API key that you retrieve from www.mailgun.com/cp (free up to 10K monthly emails)\nconst auth = {\n  auth: {\n    api_key: global.get(\"mailgun.apiKey\"),\n    domain: global.get(\"mailgun.domain\")\n  },\n//   proxy: 'http://user:pass@localhost:8080' // optional proxy, default is false\n}\n \nconst nodemailerMailgun = nodemailer.createTransport(mg(auth));\n \n\n// base64Attachment =  msg.payload.data.toString('base64');\n\nnodemailerMailgun.sendMail({\n  from: global.get(\"mailgun.from\"),\n  to: msg.RevotioData.FlowData.Data.UserData.email, // An array if you have multiple recipients.\n//   cc:'second@domain.com',\n//   bcc:'secretagent@company.gov',\n  subject: msg.data.title,\n//   'h:Reply-To': 'reply2this@company.com',\n  //You can use \"html:\" to send HTML email content. It's magic!\n  html: msg.payload,\n  //You can use \"text:\" to send plain-text content. It's oldschool!\n//   text: 'Mailgun rocks, pow pow!',\n//   attachments: [\n//         {\n//             cid: 'logo.png',\n//             content: base64Attachment,\n//             encoding: 'base64'\n//         },]\n}, (err, info) => {\n  if (err) {\n    console.log(`Error: ${err}`);\n  }\n  else {\n    console.log(`Response: ${info}`);\n  }\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":3480,"y":2180,"wires":[[]]},{"id":"5234ac38.c9d60c","type":"template","z":"aec22158.fe4e38","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!doctype html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width\">\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<title>{{data.title}}</title>\n<style>\n@media  only screen and (max-width: 620px) {\ntable[class=body] h1 {\nfont-size: 28px !important;\nmargin-bottom: 10px !important;\n}\ntable[class=body] p,\ntable[class=body] ul,\ntable[class=body] ol,\ntable[class=body] td,\ntable[class=body] span,\ntable[class=body] a {\nfont-size: 16px !important;\n}\ntable[class=body] .wrapper,\ntable[class=body] .article {\npadding: 10px !important;\n}\ntable[class=body] .content {\npadding: 0 !important;\n}\ntable[class=body] .container {\npadding: 0 !important;\nwidth: 100% !important;\n}\ntable[class=body] .main {\nborder-left-width: 0 !important;\nborder-radius: 0 !important;\nborder-right-width: 0 !important;\n}\ntable[class=body] .btn table {\nwidth: 100% !important;\n}\ntable[class=body] .btn a {\nwidth: 100% !important;\n}\ntable[class=body] .img-responsive {\nheight: auto !important;\nmax-width: 100% !important;\nwidth: auto !important;\n}\n}\n@media  all {\n.ExternalClass {\nwidth: 100%;\n}\n.ExternalClass,\n.ExternalClass p,\n.ExternalClass span,\n.ExternalClass font,\n.ExternalClass td,\n.ExternalClass div {\nline-height: 100%;\n}\n.btn-primary table td:hover {\nbackground-color: #34495e !important;\n}\n.btn-primary a:hover {\nbackground-color: #34495e !important;\nborder-color: #34495e !important;\n}\n.token_container {\n  padding: 5px; \n  width: 90%; \n  margin: auto; \n  border: 1px solid #ccc; \n  margin-bottom: 20px\n}\n.token_text {\n  text-align: center\n}\n.token {\n  background-color: #5eb7da; \n  text-align: center; \n  font-size: 30px; \n  width: 50%; \n  margin: auto;\n}\n}\n</style>\n</head>\n<body class=\"\" style=\"background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"body\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; background-color: #f6f6f6;\">\n<tr>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">&nbsp;</td>\n<td class=\"container\" style=\"font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; Margin: 0 auto; max-width: 580px; padding: 10px; width: 580px;\">\n<div class=\"content\" style=\"box-sizing: border-box; display: block; Margin: 0 auto; max-width: 580px; padding: 10px;\">\n\n<!-- START CENTERED WHITE CONTAINER -->\n<span class=\"preheader\" style=\"color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;\">{{data.title}}</span>\n<table class=\"main\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; background: #ffffff; border-radius: 3px;\">\n\n<!-- START MAIN CONTENT AREA -->\n<tr>\n<td class=\"wrapper\" style=\"font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 40px;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td style=\"font-family: sans-serif; vertical-align: top; padding-bottom: 40px;\">\n<a href=\"http://revotio.com\" target=\"_blank\">\n<img style=\"display: block; margin: auto; width: 150px;\" width=\"150\" src=\"{{data.logo}}\" alt=\"{{data.title}}\">\n</a>\n</td>\n</tr>\n</table>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">\n\n<p>Hi {{data.firstname}} {{data.lastname}},</p>\n<p>{{data.message}}</p>\n<p>{{data.activate_text}}</p>\n<div class=\"token_container\">\n<p class=\"token_text\">Type an MFA token below for verification.</p>\n<p class=\"token\">\n\t{{data.token}}\n</p>\n<p class=\"token_text\">Use an MFA-enabled device with Google Authenticator<br>\n(Android or iPhone) or any two-factor authentication app.</p>\n</div>\n<p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; Margin-bottom: 15px;\">\n{{data.closing}}\n</p>\n<p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; Margin-bottom: 15px;\">\n{{data.signature}}\n</p>\n</td>\n</tr>\n</table>\n</td>\n</tr>\n\n<!-- END MAIN CONTENT AREA -->\n</table>\n\n<!-- START FOOTER -->\n<div class=\"footer\" style=\"clear: both; Margin-top: 10px; text-align: center; width: 100%;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td class=\"content-block\" style=\"font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; font-size: 12px; color: #999999; text-align: center;\">\n<span style=\"color: #999999; font-size: 12px; text-align: center;\">{{data.footer_text}}</span>\n<br> Don't like these emails? <a href=\"{{data.settings_link}}\" style=\"text-decoration: underline; color: #999999; font-size: 12px; text-align: center;\">{{data.settings_text}}</a>.\n</td>\n</tr>\n\n</table>\n</div>\n<!-- END FOOTER -->\n\n<!-- END CENTERED WHITE CONTAINER -->\n</div>\n</td>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">&nbsp;</td>\n</tr>\n</table>\n</body>\n</html>","output":"str","x":3040,"y":1520,"wires":[["7f34ab1f.8cea44"]]},{"id":"ef7031df.f8f2b","type":"function","z":"aec22158.fe4e38","name":"Trigger email","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nmsg.payload = {\n  \"title\":\"Two step authentication\",\n  \"logo\":\"logo.png\",\n  email : msg.RevotioData.session.userData.email,\n  \"firstname\":msg.RevotioData.session.userData.first_name,\n  token: msg.RevotioData.FlowData.Token,\n  \"lastname\":msg.RevotioData.session.userData.last_name,\n//   \"attachment\" : global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\",\n  \"message\":\"Welcome to the project management application!\",\n  \"closing\":\"Cheerfully yours,\",\n  \"signature\":\"Team Grant tools projects.\",\n  \"activate_text\":\"Please enter the this token: \" + msg.RevotioData.FlowData.Token ,\n  \"activation_link\":\"\",\n  \"activate_click\":\"\",\n  \"footer_text\":\"Grant tools B.V. | Rijswijk, Netherlands\",\n  \"settings_link\":global.get(\"DomainProperties.prodUrl\"),\n  \"settings_text\":\"Two step authentication\",\n//   data:fs.readFileSync(global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\"),\n  base64data : fs.readFileSync(global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\").toString('base64'),\n}\n\nmsg.data = msg.payload\nreturn msg;\n\n","outputs":1,"noerr":0,"x":2910,"y":1520,"wires":[["5234ac38.c9d60c"]]},{"id":"7f34ab1f.8cea44","type":"function","z":"aec22158.fe4e38","name":"nodemailer_mailgun_transport && nodemailer","func":"// var request = global.get('request'); \nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar request = global.get('request');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// This is your API key that you retrieve from www.mailgun.com/cp (free up to 10K monthly emails)\nconst auth = {\n  auth: {\n    api_key: global.get(\"mailgun.apiKey\"),\n    domain: global.get(\"mailgun.domain\")\n  },\n//   proxy: 'http://user:pass@localhost:8080' // optional proxy, default is false\n}\n \nconst nodemailerMailgun = nodemailer.createTransport(mg(auth));\n \n\n// base64Attachment =  msg.payload.data.toString('base64');\n\nnodemailerMailgun.sendMail({\n  from: global.get(\"mailgun.from\"),\n  to: msg.data.email, // An array if you have multiple recipients.\n//   cc:'second@domain.com',\n//   bcc:'secretagent@company.gov',\n  subject: msg.data.title,\n//   'h:Reply-To': 'reply2this@company.com',\n  //You can use \"html:\" to send HTML email content. It's magic!\n  html: msg.payload,\n  //You can use \"text:\" to send plain-text content. It's oldschool!\n//   text: 'Mailgun rocks, pow pow!',\n//   attachments: [\n//         {\n//             cid: 'logo.png',\n//             content: base64Attachment,\n//             encoding: 'base64'\n//         },]\n}, (err, info) => {\n  if (err) {\n    console.log(`Error: ${err}`);\n  }\n  else {\n    console.log(`Response: ${info}`);\n  }\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":3280,"y":1520,"wires":[[]]},{"id":"7d86f895.37fe","type":"template","z":"aec22158.fe4e38","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!doctype html>\n<html>\n<head>\n<meta name=\"viewport\" content=\"width=device-width\">\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n<title>{{payload.title}}</title>\n<style>\n@media  only screen and (max-width: 620px) {\ntable[class=body] h1 {\nfont-size: 28px !important;\nmargin-bottom: 10px !important;\n}\ntable[class=body] p,\ntable[class=body] ul,\ntable[class=body] ol,\ntable[class=body] td,\ntable[class=body] span,\ntable[class=body] a {\nfont-size: 16px !important;\n}\ntable[class=body] .wrapper,\ntable[class=body] .article {\npadding: 10px !important;\n}\ntable[class=body] .content {\npadding: 0 !important;\n}\ntable[class=body] .container {\npadding: 0 !important;\nwidth: 100% !important;\n}\ntable[class=body] .main {\nborder-left-width: 0 !important;\nborder-radius: 0 !important;\nborder-right-width: 0 !important;\n}\ntable[class=body] .btn table {\nwidth: 100% !important;\n}\ntable[class=body] .btn a {\nwidth: 100% !important;\n}\ntable[class=body] .img-responsive {\nheight: auto !important;\nmax-width: 100% !important;\nwidth: auto !important;\n}\n}\n@media  all {\n.ExternalClass {\nwidth: 100%;\n}\n.ExternalClass,\n.ExternalClass p,\n.ExternalClass span,\n.ExternalClass font,\n.ExternalClass td,\n.ExternalClass div {\nline-height: 100%;\n}\n.btn-primary table td:hover {\nbackground-color: #34495e !important;\n}\n.btn-primary a:hover {\nbackground-color: #34495e !important;\nborder-color: #34495e !important;\n}\n.button {\n  text-decoration: none;\n  background-color: #20a7db;\n  color: #333333;\n  padding: 2px 6px 2px 6px;\n  border: none;\n  border-radius: 2px;\n}\n}\n</style>\n</head>\n<body class=\"\" style=\"background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"body\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; background-color: #f6f6f6;\">\n<tr>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">&nbsp;</td>\n<td class=\"container\" style=\"font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; Margin: 0 auto; max-width: 580px; padding: 10px; width: 580px;\">\n<div class=\"content\" style=\"box-sizing: border-box; display: block; Margin: 0 auto; max-width: 580px; padding: 10px;\">\n\n<!-- START CENTERED WHITE CONTAINER -->\n<span class=\"preheader\" style=\"color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;\">{{payload.title}}</span>\n<table class=\"main\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; background: #ffffff; border-radius: 3px;\">\n\n<!-- START MAIN CONTENT AREA -->\n<tr>\n<td class=\"wrapper\" style=\"font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 40px;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td style=\"font-family: sans-serif; vertical-align: top; padding-bottom: 40px;\">\n<a href={{payload.activation_link}} target=\"_blank\">\n<img style=\"display: block; margin: auto; width: 150px;\" width=\"150\" src=\"data:image/png;base64,{{payload.base64data}}\" alt=\"{{payload.title}}\">\n</a>\n</td>\n</tr>\n</table>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">\n\n<p>Hi {{payload.firstname}} {{payload.lastname}},</p>\n<p>{{payload.message}}</p>\n<p>{{payload.activate_text}} <a class=\"button\" href=\"{{payload.activation_link}}\">{{payload.activate_click}}</a></p>\n<p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; Margin-bottom: 15px;\">\n{{payload.closing}}\n</p>\n<p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; Margin-bottom: 15px;\">\n{{payload.signature}}\n</p>\n</td>\n</tr>\n</table>\n</td>\n</tr>\n\n<!-- END MAIN CONTENT AREA -->\n</table>\n\n<!-- START FOOTER -->\n<div class=\"footer\" style=\"clear: both; Margin-top: 10px; text-align: center; width: 100%;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\">\n<tr>\n<td class=\"content-block\" style=\"font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; font-size: 12px; color: #999999; text-align: center;\">\n<span style=\"color: #999999; font-size: 12px; text-align: center;\">{{payload.footer_text}}</span>\n<br> Don't like these emails? <a href=\"{{payload.settings_link}}\" style=\"text-decoration: underline; color: #999999; font-size: 12px; text-align: center;\">{{payload.settings_text}}</a>.\n</td>\n</tr>\n\n</table>\n</div>\n<!-- END FOOTER -->\n\n<!-- END CENTERED WHITE CONTAINER -->\n</div>\n</td>\n<td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\">&nbsp;</td>\n</tr>\n</table>\n</body>\n</html>","output":"str","x":1400,"y":1380,"wires":[["57bfa1d.e37346"]]},{"id":"4d7aeb07.6c37fc","type":"function","z":"aec22158.fe4e38","name":"Trigger email","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nmsg.payload = {\n  \"title\":\"Two step authentication\",\n  \"logo\":\"logo.png\",\n  email : msg.RevotioData.session.userData.email,\n  \"firstname\":msg.RevotioData.session.userData.first_name,\n  token: msg.RevotioData.FlowData.Token,\n  \"lastname\":msg.RevotioData.session.userData.last_name,\n//   \"attachment\" : global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\",\n  \"message\":\"Welcome to the project management application!\",\n  \"closing\":\"Cheerfully yours,\",\n  \"signature\":\"Team Grant tools projects.\",\n  \"activate_text\":\"Please enter the this token: \" + msg.RevotioData.FlowData.Token ,\n  \"activation_link\":\"\",\n  \"activate_click\":\"\",\n  \"footer_text\":\"Grant tools B.V. | Rijswijk, Netherlands\",\n  \"settings_link\":global.get(\"DomainProperties.prodUrl\"),\n  \"settings_text\":\"Two step authentication\",\n//   data:fs.readFileSync(global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\"),\n  base64data : fs.readFileSync(global.get(\"DomainProperties.filesFolder\")+\"SystemFiles/logo.png\").toString('base64'),\n}\n\nmsg.data = msg.payload\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1270,"y":1380,"wires":[["7d86f895.37fe"]]},{"id":"57bfa1d.e37346","type":"function","z":"aec22158.fe4e38","name":"nodemailer_mailgun_transport && nodemailer","func":"// var request = global.get('request'); \nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar request = global.get('request');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// This is your API key that you retrieve from www.mailgun.com/cp (free up to 10K monthly emails)\nconst auth = {\n  auth: {\n    api_key: global.get(\"mailgun.apiKey\"),\n    domain: global.get(\"mailgun.domain\")\n  },\n//   proxy: 'http://user:pass@localhost:8080' // optional proxy, default is false\n}\n \nconst nodemailerMailgun = nodemailer.createTransport(mg(auth));\n \n\n// base64Attachment =  msg.payload.data.toString('base64');\n\nnodemailerMailgun.sendMail({\n  from: global.get(\"mailgun.from\"),\n  to: msg.data.email, // An array if you have multiple recipients.\n//   cc:'second@domain.com',\n//   bcc:'secretagent@company.gov',\n  subject: msg.data.title,\n//   'h:Reply-To': 'reply2this@company.com',\n  //You can use \"html:\" to send HTML email content. It's magic!\n  html: msg.payload,\n  //You can use \"text:\" to send plain-text content. It's oldschool!\n//   text: 'Mailgun rocks, pow pow!',\n//   attachments: [\n//         {\n//             cid: 'logo.png',\n//             content: base64Attachment,\n//             encoding: 'base64'\n//         },]\n}, (err, info) => {\n  if (err) {\n    console.log(`Error: ${err}`);\n  }\n  else {\n    console.log(`Response: ${info}`);\n  }\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":1640,"y":1380,"wires":[[]]},{"id":"3f6e998d.3c36b6","type":"comment","z":"d8703926.e2eca","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2450,"y":360,"wires":[]},{"id":"bb744419.3b4b","type":"function","z":"508957a1.dd5398","name":"Get session data ACTION","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar secret = global.get(\"SystemVars.secret\");\nvar request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\nvar valid, invalid;\nmsg.starttime = new Date()\n\n\nvar PostData = JSON.parse(msg.dataResult.dataContent.PostData);\n\n\n\nvar SessionData = JSON.parse(msg.dataResult.dataContent.SessionData);\n\nquery = {\n    deviceId : SessionData.deviceId,\n    revotioSessionId : SessionData.revotioSessionId,\n}\nmsg.RevotioData = {\n    SessionData:SessionData,\n    // startTime : new Date(),\n    PostData:PostData,\n    session : SessionData\n};\n// find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                \n                if (res.length > 0 ){\n                    msg.payload = res[0]\n                } else {\n                    msg.payload = {}\n                }\n                    \n                    node.send(msg) \n            })  \n\n  \n    \n    \nreturn [valid, invalid];","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":780,"wires":[["c964af3e.013ae8"]]},{"id":"49d18cf3.10bffc","type":"function","z":"508957a1.dd5398","name":"get organizations","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n    // query = {\"$or\": [{parent_id : new ObjectID(msg.payload.organization_id)}, {_id : new ObjectID(msg.payload.organization_id)} ] }\n    // msg.operation = 'find.toArray'\n                    \n                // find  \n                findObj = {\n                    query : {\n                            query :msg.payload, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n\n   ","outputs":1,"noerr":0,"x":990,"y":2060,"wires":[["a6bb1f75.b71ea"]],"outputLabels":["valid, "]},{"id":"b842fe40.90a778","type":"function","z":"508957a1.dd5398","name":"Remove all users && users data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// find  \nfindObj = {\n                    query : {\n                            query :{organization_id: new ObjectID(msg.organization_id)}, \n                            projection:{_id :1}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_accounts',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                \n                _.each(res, function(user, index){\n                    \n                    // removeusers \n                        removeusers = {\n                                query : {\n                                        query :{_id:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'users',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeusers, node, function(res){\n                                \n                        }) \n                        \n                        // removeuser_accounts \n                        removeuser_accounts = {\n                                query : {\n                                        query :{user:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'user_accounts',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeuser_accounts, node, function(res){\n                                \n                        }) \n                        \n                         // removeuser_permissions\n                        removeuser_permissions = {\n                                query : {\n                                        query :{user:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'user_permissions',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeuser_permissions, node, function(res){\n                                \n                        }) \n                        \n                       \n                      \n                })\n                \n                    // msg.payload = res\n                    node.send(msg) \n            }) \n            \n// return msg;\n","outputs":1,"noerr":0,"x":1530,"y":2020,"wires":[[]]},{"id":"6fd6f4e9.852dfc","type":"function","z":"508957a1.dd5398","name":"Remove all application records && files","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n // removequery\n            pages = {\n                    query : {\n                            query :{application_id : new ObjectID(msg.payload.application_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(pages, node, function(res){\n                   \n            })  \n            \n \n          \n // removequery\n            application = {\n                    query : {\n                            query :{_id : new ObjectID(msg.payload.application_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'applications',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(application, node, function(res){\n                   \n            })  \n            \n            \n            \n    // remove all app files\n    fs.removeSync(global.get(\"DomainProperties.filesFolder\")+ \"applications/\" + msg.payload.application_id)\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1050,"y":2180,"wires":[["30870895.0a2d28"]]},{"id":"30870895.0a2d28","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":1230,"y":2180,"wires":[]},{"id":"7ceb5cfd.26cd9c","type":"function","z":"508957a1.dd5398","name":"Remove all page records && files","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n \n // get page obj\n  findOneObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.page_id) }\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.page = res[0]\n                } else {\n                    msg.page = {}\n                }\n                    \n                // remove all app files\n                fs.removeSync(global.get(\"DomainProperties.filesFolder\")+ \"applications/\" + msg.page.application_id+\"/pages/\"+msg.page_id)\n\n                 // removequery\n                            pages = {\n                                    query : {\n                                            query :{_id : new ObjectID(msg.page_id)},\n                                            },\n                                    connection:global.get(\"DB_data.connection\"),\n                                    database:global.get(\"DB_data.appDB\"),\n                                    collection:'pages',\n                                    operation:'remove',\n                                    }\n                \n                            mongodbTools.resolveAsync(pages, node, function(res){\n                                   node.send(msg)\n                            })  \n            })  \n            ","outputs":1,"noerr":0,"x":640,"y":2280,"wires":[["521fb03f.d3a258"]]},{"id":"a1a4c9c0.c43b6","type":"link in","z":"508957a1.dd5398","name":"","links":["f6894ee3.d056c","1a55a0c3.a8f35f","d2a7b91c.174a08","97b5b868.e751e","77a61ff7.3ac9d","100e6adf.f1c21d","884fb8a9.ab74f","171e9659.88660a","ffa0792b.b11698"],"x":75,"y":100,"wires":[["811b099c.ef816"]]},{"id":"811b099c.ef816","type":"subflow:4cbbc60.828563c","z":"508957a1.dd5398","name":"","env":[],"x":240,"y":100,"wires":[]},{"id":"a433961e.6ba03","type":"comment","z":"508957a1.dd5398","name":"Entrance post","info":"Expected object :\n\n msg.payload = {\n        DeviceId: ** From publised app **,\n        RevotioSessionId : ** From publised app **,\n   }","x":130,"y":300,"wires":[]},{"id":"a69f99b5.f05038","type":"http in","z":"508957a1.dd5398","name":"","url":"/Exit","method":"post","upload":false,"swaggerDoc":"","x":80,"y":1300,"wires":[["ffa0792b.b11698","b5530b8c.66e958","728e249.bd3ca5c"]]},{"id":"733e9957.70c7b","type":"comment","z":"508957a1.dd5398","name":"Exit ","info":"","x":90,"y":1260,"wires":[]},{"id":"afec1277.c01c3","type":"http in","z":"508957a1.dd5398","name":"","url":"/token","method":"post","upload":false,"swaggerDoc":"","x":110,"y":1140,"wires":[["996a3cfa.05bf8"]]},{"id":"5a06a076.96d368","type":"comment","z":"508957a1.dd5398","name":"Token","info":"msg.payload = {\n    type: \n    content: { // start with DeviceId && RevotioSessionId\n        DeviceId: \"123456789\",\n        RevotioSessionId : \"123456789\"\n    }\n}","x":90,"y":1040,"wires":[]},{"id":"f6135ee3.d67718","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":450,"y":1420,"wires":[]},{"id":"52b73dc3.bb92a4","type":"http in","z":"508957a1.dd5398","name":"","url":"/upload","method":"post","upload":true,"swaggerDoc":"","x":90,"y":1400,"wires":[["ea54b5fe.1e48c"]]},{"id":"ea54b5fe.1e48c","type":"function","z":"508957a1.dd5398","name":"","func":"var Remove, Upload; \n\nif (msg.req.uploadData.fields.type === \"create\"){\n    Upload = msg;\n} else {\n    Remove = msg;\n}\nreturn [Remove, Upload];","outputs":2,"noerr":0,"x":230,"y":1400,"wires":[[],["77473f2e.d022e","ee2f7762.ef776"]],"outputLabels":["Remove, ","Upload"]},{"id":"77473f2e.d022e","type":"function","z":"508957a1.dd5398","name":"","func":"var fs = global.get('fsextra');\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\n\n// fs.ensureDirSync(global.get(\"DomainProperties.filesFolder\")+ msg.req.uploadData.fields.appFolder)\n// fs.moveSync(msg.req.uploadData.fileData.path, global.get(\"DomainProperties.filesFolder\")+ msg.req.uploadData.fields.appFolder + msg.req.uploadData.fields.name , { overwrite: true })\n\n\nfs.ensureDirSync(msg.req.uploadData.fields.appFolder)\nfs.moveSync(msg.req.uploadData.fileData.path, msg.req.uploadData.fields.appFolder + msg.req.uploadData.fields.name , { overwrite: true })\n\n\n\n\n\n// msg.move = msg.req.uploadData.fields.appFolder + msg.req.uploadData.fields.name\n\n// date = moment().format(\"MM DD MM YYYY\")\n// msg.date = date\n\n// msg.source =  msg.req.uploadData.fields.appFolder + msg.req.uploadData.fields.name\n// msg.destination = global.get(\"DomainProperties.publicFolder\")+\"files/upload/\"+ date +\"/\"+ msg.req.uploadData.fields.name\n\n// fs.copySync(global.get(\"DomainProperties.filesFolder\")+ msg.req.uploadData.fields.appFolder + msg.req.uploadData.fields.name , global.get(\"DomainProperties.publicFolder\")+\"/files/upload/\"+ date +\"/\"+ msg.req.uploadData.fields.name )\n\n// msg.payload = global.get(\"DomainProperties.RootDomain\")+\"files/upload/\"+ date +\"/\"+ msg.req.uploadData.fields.name\nmsg.payload = {\n    // url     : global.get(\"DomainProperties.RootDomain\")+\"files/upload/\"+ date +\"/\"+ msg.req.uploadData.fields.name,\n    path    : msg.req.uploadData.fields.appFolder + msg.req.uploadData.fields.name,\n    size    : msg.req.uploadData.fileData.size,\n    name    : msg.req.uploadData.fileData.name,\n    uploadFileType : msg.req.uploadData.fileData.type,\n    type    : msg.req.uploadData.fileData.type\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1420,"wires":[["f6135ee3.d67718"]]},{"id":"822b78e3.84827","type":"comment","z":"508957a1.dd5398","name":"Upload","info":"msg.payload = {\n    type: \n    content: { // start with DeviceId && RevotioSessionId\n        DeviceId: \"123456789\",\n        RevotioSessionId : \"123456789\"\n    }\n}","x":90,"y":1360,"wires":[]},{"id":"74516ee2.700d","type":"http in","z":"508957a1.dd5398","name":"fileToken","url":"/fileToken","method":"post","upload":false,"swaggerDoc":"","x":100,"y":1500,"wires":[["846d586a.608af8"]]},{"id":"846d586a.608af8","type":"function","z":"508957a1.dd5398","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":1500,"wires":[["80e68dd7.0ac748"]]},{"id":"80e68dd7.0ac748","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":310,"y":1500,"wires":[]},{"id":"c679425d.2bf16","type":"comment","z":"508957a1.dd5398","name":"","info":"payload :{\n    fileToken   : STRING\n    RevotioToken: STRING,\n    fileName    : STRING,\n    filePath    : STRING,\n    \n}","x":100,"y":1460,"wires":[]},{"id":"4cb3a645.51e71","type":"http in","z":"508957a1.dd5398","name":"download","url":"/download","method":"get","upload":false,"swaggerDoc":"","x":100,"y":1600,"wires":[["b5c2646a.c43b78"]]},{"id":"b5c2646a.c43b78","type":"function","z":"508957a1.dd5398","name":"Get file","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar fs = global.get('fsextra');\nvar mime = global.get('mime');\n\n\n// msg.payload.token = \"valid token\"\n\n msg.payload.tokenValid = false\n\nTokenContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.payload[\"revotio-token\"], global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n           msg.payload.tokenValid = true\n          TokenContent = decoded\n      }\n    });\n    \nif ( msg.payload.tokenValid === true ){\n\n        // check if file exists\n        var state = false\n        if (msg.payload.hasOwnProperty(\"file\") &&  fs.existsSync(msg.payload.file)) { \n            state = true\n        } \n        \n        if (state === true){\n            // msg.payload.fileExtension = msg.payload.file.split(\".\")[msg.payload.file.split(\".\").length - 1]\n            msg.payload.fileType = mime.getType(msg.payload.file); \n             msg.payload.fileExtension = mime.getExtension(msg.payload.fileType); \n            msg.payload.folder = \"\"\n            \n            _.each(msg.payload.file.split(\"/\"), function(string, index){\n                if (index === 0){\n                     msg.payload.folder = string\n                } else {\n                    if (msg.payload.file.split(\"/\").length > index + 1){\n                        msg.payload.folder = msg.payload.folder +\"/\"+ string\n                    }\n                }\n            })\n        \n                    if (msg.payload.type === \"thumbnail\"){\n                         data = fs.readFileSync(msg.payload.file);\n                            msg.payload.base64 =  data.toString('base64');\n                                  \n                                \n                                  fs.stat(msg.payload.file, function(err, stats) {\n                                     \n                                      msg.payload.stats = stats;\n                                        \n                                            node.send(msg);\n                                  })\n                       \n                    } else {\n                            data = fs.readFileSync(msg.payload.file);\n                            msg.payload.base64 =  data.toString('base64');\n                                  \n                                \n                                  fs.stat(msg.payload.file, function(err, stats) {\n                                     \n                                      msg.payload.stats = stats;\n                                       \n                                            node.send(msg);\n                                  })\n                    }\n        \n        } else {\n            msg.payload.error = \"file does not exists\"\n            node.send(msg)\n        }\n} \nelse {\n       msg.payload.error = \"Invalid token\"\n      node.send(msg) \n}\n\n\n\n// return msg;","outputs":1,"noerr":0,"x":210,"y":1600,"wires":[["4ae456b9.0c53b8"]]},{"id":"4ae456b9.0c53b8","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":320,"y":1600,"wires":[]},{"id":"bdb3ec6a.81d3c","type":"comment","z":"508957a1.dd5398","name":"","info":"payload :{\n    fileToken   : STRING\n    RevotioToken: STRING,\n    fileName    : STRING,\n    filePath    : STRING,\n    \n}","x":100,"y":1560,"wires":[]},{"id":"920da7ee.18772","type":"function","z":"508957a1.dd5398","name":"Remove Session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar Data = msg.payload;\n\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\n\nif (Data.revotioSessionId){\n    query= {\n        deviceId : Data.deviceId,\n        revotioSessionId : Data.revotioSessionId,\n    }\n    \n   \n} else {\n    query = {\n        deviceId : Data.deviceId,\n    }\n} \n\n// remove \n            removeObj = {\n                    query : {\n                            query :query,\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'session',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    // msg.result = res\n                    node.send(msg) \n            })   \n\n\n\n// return msg;","outputs":1,"noerr":0,"x":370,"y":1320,"wires":[["98d04544.eac7e"]]},{"id":"98d04544.eac7e","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":510,"y":1300,"wires":[]},{"id":"ffa0792b.b11698","type":"link out","z":"508957a1.dd5398","name":"","links":["dc664b4f.0d82e","a1a4c9c0.c43b6"],"x":175,"y":1340,"wires":[]},{"id":"c1f038ae.f7faa","type":"comment","z":"508957a1.dd5398","name":"CHECK GC state","info":"","x":260,"y":1340,"wires":[]},{"id":"7300eaa0.fbf76c","type":"debug","z":"508957a1.dd5398","name":"Pre Request","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2060,"y":860,"wires":[]},{"id":"12a86303.f876ed","type":"debug","z":"508957a1.dd5398","name":"INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":920,"y":520,"wires":[]},{"id":"7951c57e.e01884","type":"function","z":"aec22158.fe4e38","name":"update appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\npayload = [{_id : new ObjectID(msg.RevotioData.session.UserData._id)},\n                {\"$set\": {\n                            previousLogin : msg.RevotioData.session.UserData.previousLogin,\n                            login           : msg.RevotioData.session.UserData.login\n                }},\n                {upsert : true}]\n// update    \n    updateObj = {\n                    query : {\n                            query :payload[0], \n                            update : payload[1],\n                            options : payload[2]\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    \n            })  \n            \n","outputs":1,"noerr":0,"x":2930,"y":580,"wires":[[]]},{"id":"2c8a0c62.86d694","type":"function","z":"aec22158.fe4e38","name":"update appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\npayload = [\n    {_id: new ObjectID(msg.RevotioData.session.UserData._id)},\n    {\"$set\": {loginAttempts:0}},\n    {upsert: true}\n    ]\n    \n// update    \n    updateObj = {\n                    query : {\n                            query :payload[0], \n                            update : payload[1],\n                            options : payload[2]\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    \n            })  \n            \n","outputs":1,"noerr":0,"x":4510,"y":280,"wires":[[]]},{"id":"2df202d2.7f9f2e","type":"function","z":"aec22158.fe4e38","name":"update sessions","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// update    \n    updateObj = {\n                    query : {\n                            query :msg.payload[0], \n                            update : msg.payload[1],\n                            options : msg.payload[2]\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'updateMany', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                 msg.payload = {\n                        setToken : true,\n                    };\n                \n                // get organization_id \n                \n                OrgPermossionOBJ = lodash.find(msg.RevotioData.session.UserData.AppUserPermissionInfo, {type: 'organization'})\n                \n                    if (msg.RevotioData.session.UserData.type === \"PNOAdmin\" ){\n                        msg.payload.Page =  global.get(\"DomainProperties.PNODefaultPage\"); \n                        msg.payload.RevotioData = {organization_id : new ObjectID(OrgPermossionOBJ.type_id), Type: \"justLogedIn\"}\n                        \n                        } else {\n                        \n                        \n                        \n                        msg.payload.Page =  global.get(\"DomainProperties.ClientDefaultPage\");\n                        msg.payload.RevotioData = {organization_id : new ObjectID(OrgPermossionOBJ.type_id), Type: \"justLogedIn\"}\n                    }\n                    node.send(msg)\n            })  \n            \n","outputs":1,"noerr":0,"x":4500,"y":320,"wires":[["c0f97a1f.81ffc8"]]},{"id":"ab3ed11a.d5793","type":"function","z":"aec22158.fe4e38","name":"update sessions","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// update    \n    updateObj = {\n                    query : {\n                            query :msg.payload[0], \n                            update : msg.payload[1],\n                            options : msg.payload[2]\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                 msg.payload = {\n                        Page :  \"two step authentication\",\n                        setToken : true,\n                        RevotioData: {\n                        }\n                    };\n        \n                    node.send(msg)\n            })  \n            \n","outputs":1,"noerr":0,"x":4500,"y":400,"wires":[["85e06edd.f24208"]]},{"id":"2329b1df.ff9cde","type":"function","z":"aec22158.fe4e38","name":"update appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n    \n// update    \n    updateObj = {\n                    query : {\n                            query :msg.payload[0], \n                            update : msg.payload[1],\n                            options : msg.payload[2]\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                node.send(msg)    \n            })  \n            \n","outputs":1,"noerr":0,"x":3730,"y":920,"wires":[["2e99f46b.4490ec"]]},{"id":"62ed20f0.1e896","type":"function","z":"aec22158.fe4e38","name":"update appuseraccounts","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n    \n// update    \n    updateObj = {\n                    query : {\n                            query :msg.payload[0], \n                            update : msg.payload[1],\n                            options : msg.payload[2]\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_accounts',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                 msg.payload = {\n                        Page :  global.get(\"DomainProperties.NonAuthDefaultPage\"),\n                        // setToken : true,\n                        RevotioData: {\n                        }\n                    };\n                node.send(msg)    \n            })  \n            \n","outputs":1,"noerr":0,"x":4190,"y":920,"wires":[["50553c0.ca774c4"]]},{"id":"f3baa581.b4119","type":"function","z":"aec22158.fe4e38","name":"Get appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n    \n    findOneObj = {\n                    query : {\n                            query :{activationToken :msg.RevotioData.FlowData.activationToken} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.payload = res[0]\n                } else {\n                    msg.payload = {}\n                }\n                    \n                    node.send(msg) \n            })  \n            \n    \n            \n","outputs":1,"noerr":0,"x":1160,"y":860,"wires":[["e54d16bc.54e4f"]]},{"id":"d554894d.135478","type":"function","z":"aec22158.fe4e38","name":"Get appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n    \n// findObj   \n\nfindOneObj = {\n                    query : {\n                            query :{resetToken : msg.RevotioData.FlowData.resetToken} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.payload = res[0]\n                } else {\n                    msg.payload = {}\n                }\n                    \n                    node.send(msg) \n            })  \n\n            \n","outputs":1,"noerr":0,"x":500,"y":2220,"wires":[["8f35e986.f06c78"]]},{"id":"fbfb1b97.df21f8","type":"function","z":"aec22158.fe4e38","name":"Get appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (msg.RevotioData.FlowData.user){\n    \n// findObj    \n\n\n\nfindOneObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.RevotioData.FlowData.user)} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.payload = res[0]\n                } else {\n                    msg.payload = {}\n                }\n                    \n                    node.send(msg) \n            })  \n        \n            \n} else {\n     node.send(msg)  \n}\n            \n","outputs":1,"noerr":0,"x":500,"y":2260,"wires":[["25e60b9d.f35b14"]]},{"id":"35b3b956.affe26","type":"function","z":"2294209a.0c95b","name":"Update/ remove appusers","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nif (msg.operation === \"update\"){\n// update    \n    updateObj = {\n                    query : {\n                            query :msg.payload[0], \n                            update : msg.payload[1],\n                            options : msg.payload[2]\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n}\nelse if (msg.operation === \"remove\"){\n    \n\n// remove \n            removeObj = {\n                    query : {\n                            query :msg.payload, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'users',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            }) \n            \n}","outputs":1,"noerr":0,"x":4190,"y":420,"wires":[["1dea56ab.df6ad9"]]},{"id":"8b08f368.889138","type":"function","z":"2294209a.0c95b","name":"Remove appuserpermissions && appuseraccounts","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\n    \n\n// remove \n            removeObj = {\n                    query : {\n                            query :msg.payload, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_accounts',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    // msg.payload = res\n                    // node.send(msg) \n            }) \n            \n// remove \n            removeObj = {\n                    query : {\n                            query :msg.payload, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_permissions',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    // msg.payload = res\n                    // node.send(msg) \n            }) \n            \n","outputs":1,"noerr":0,"x":4470,"y":640,"wires":[[]]},{"id":"ee2f7762.ef776","type":"debug","z":"508957a1.dd5398","name":"UPLOAD post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":460,"y":1360,"wires":[]},{"id":"164710f3.bf3fef","type":"inject","z":"508957a1.dd5398","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":200,"wires":[["811b099c.ef816"]]},{"id":"b0299765.306ab","type":"function","z":"508957a1.dd5398","name":"Check user inv","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nUserOrgPermissionObjIndex = lodash.findIndex(msg.RevotioData.session.UserData.AppUserPermissionInfo,{type: \"organization\"} );\n\nif (UserOrgPermissionObjIndex === -1){\n    \n}else {\n    UserOrgPermissionObj = msg.RevotioData.session.UserData.AppUserPermissionInfo[UserOrgPermissionObjIndex]\n\n    var query = {organization_id:new ObjectID(UserOrgPermissionObj.type_id), contact_person_organization:new ObjectID(msg.RevotioData.session.UserData._id) };\n// msg.operation = 'find.toArray';\n\n// find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'participants',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n}\n\n\n// return msg;","outputs":1,"noerr":0,"x":1620,"y":380,"wires":[["cd09b08b.c1c3d"]]},{"id":"c4762256.4d3218","type":"function","z":"508957a1.dd5398","name":"Remove user sessions","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// remove \n            removeObj = {\n                    query : {\n                            query :{\n                                        deviceId : msg.RevotioData.session.deviceId ,\n                                        revotioSessionId: msg.RevotioData.session.revotioSessionId\n                                    }, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            })   ","outputs":1,"noerr":0,"x":1640,"y":460,"wires":[["5679a59d.ef0854"]]},{"id":"5679a59d.ef0854","type":"function","z":"508957a1.dd5398","name":"remove global comntext sessions","func":"global.set(\"gadgetGroups.\"+ msg.RevotioData.session.deviceId)\n\nmsg.payload = {\n    Page : global.get(\"DomainProperties.NonAuthDefaultPage\"),\n    RevotioData:{}\n    // revotioSessionId : msg.RevotioData.session.revotioSessionId\n}\n\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\nreturn msg;","outputs":1,"noerr":0,"x":1900,"y":460,"wires":[["7cd14cd3.6f2414"]]},{"id":"7cd14cd3.6f2414","type":"subflow:5e9b9c1d.bbe4a4","z":"508957a1.dd5398","name":"","env":[],"x":2120,"y":460,"wires":[]},{"id":"1feffcb9.f3a723","type":"comment","z":"d8703926.e2eca","name":"Menu actions","info":"","x":350,"y":600,"wires":[]},{"id":"14418773.9dfa29","type":"link in","z":"d8703926.e2eca","name":"menu gadget action","links":["6b04d965.f4ff08","251c3325.01a81c","6791272e.924708","d2b7e8de.99a408","2e80c09b.871748","e1b79af1.56d8e8","51dda61c.ac9718","f153a1c1.46c398","2506b5b0.53f782","60a2e26e.b6eb9c","ebd730b3.40708","20eae4f4.2bbcbc","44a83e5f.f1a268","544ff177.c49c88","54194603.a74dc","32c6796f.75544e","b8c3f06c.7e8c3","d2414ca5.fa2e3","7c0cf08e.f15c18","3d333da.6b8cec2","d6832ca6.6661a","5fd7688e.0e2548","c1e0ef09.006d6","49cbfa03.323154","a4311a51.a3b6d","3c2ea246.1ea72e","c17c74ab.5523f8","7b2a1b7c.b8e0e4","a87efb23.d267c8","7bc8a353.17418c","ab190608.5a8ee8","5466cf91.54dc2","4dbe6b41.f5a484","4c3324ec.47a1c4","dee478a9.de00b8","4a21c1a8.d17068","20f2669c.4040b2","4a10319.1c6b95","8578d779.0dafc8","359e3c32.9c6c9c","e182ab9b.75ab38","e78584f8.5f054","f017f314.5a372","67655cae.661fbc","28bb1cd1.a4b2fc","7197d7b9.7e3728","65df0a7c.9772ac","da3b3f79.6265e","714fa6a7.14b968","8fdad0c3.88b488","9dfabc7b.4c502","cc978341.da37b8","c60460c0.c24d08","d33781a5.20c05","644d78e.69a8e08"],"x":335,"y":640,"wires":[["5b7fb22f.8de844"]]},{"id":"5b7fb22f.8de844","type":"function","z":"d8703926.e2eca","name":"Menu Action","func":"var _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar lodash = global.get('lodash');\n\nvar Load , Redirect, Button,lazyload, LogOut ;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\nif (msg.RevotioData.hasOwnProperty(\"PostData\")=== false){\n    Load = msg;\n} else {\n\n    if ( PostData.gadgetData.hasOwnProperty(\"redirect\") && PostData.gadgetData.redirect === true ){\n        \n       \n        RevotioData = {}\n        _.each(PostData.gadgetData, function(value, key ){\n            if (lodash.includes(key, \"id\") || lodash.includes(key, \"Id\") || lodash.includes(key, \"ID\" )){\n                RevotioData[key] = new ObjectID(value);\n            } else if (key === 'level'){\n                 RevotioData[key] = value;\n            }\n        })\n        \n        if (PostData.gadgetData.name === 'Log out'){\n            LogOut = msg;\n        } else {\n            msg.payload = {\n                Page :  PostData.gadgetData.Page,\n                RevotioData: RevotioData\n            };\n        Redirect = msg;\n        }\n    } else if (msg.RevotioData.PostData.gadgetData.hasOwnProperty(\"lazyload\")){\n        lazyload = msg;\n    } else  {\n        Button = msg;\n    }\n}\nreturn [Load , Redirect, Button,lazyload, LogOut ];","outputs":5,"noerr":0,"initialize":"","finalize":"","x":450,"y":700,"wires":[["4d6e8aaa.054e84"],["d95079f7.8dc1d8","582d3ca5.214004"],["7b9b867f.a3c968"],["d83737b2.6834a"],["679d95fb.063114"]],"outputLabels":["Load , , ,,  ","Redirect","Button","lazyload","LogOut"]},{"id":"7b9b867f.a3c968","type":"function","z":"d8703926.e2eca","name":"Route menu button action","func":"var CreateOrg, CreateProject, CreateEmployee, CreateWorkPackage, CreateUser \nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n\n\n msg.RevotioData.FlowData.Form = {\n        \n            participant_id: PostData.gadgetData.participant_id,\n            employee_id: PostData.gadgetData.employee_id,\n            user_id: PostData.gadgetData.user_id,\n            work_package_id: PostData.gadgetData.work_package_id,\n            project_id: PostData.gadgetData.project_id,\n            Page: PostData.gadgetData.Page,\n            organization_id:PostData.gadgetData.organization_id,\n            FormActionType  : \"Create\",\n    };\n    \n    \nvar label = PostData.gadgetData.label\n\nif (label === \"Create organization\"){\n    \n    msg.RevotioData.FlowData.Form.FormType  =  \"Organization\";\n    \n} else if (label === \"Create project\"){\n    msg.RevotioData.FlowData.Form.FormType  =  \"Project\";\n    \n} else if (label === \"Create employee\"){\n    msg.RevotioData.FlowData.Form.FormType  =  \"Employee\";\n   \n} else if (label === \"Create work package\"){\n    msg.RevotioData.FlowData.Form.FormType  =  \"WorkPackage\";\n  \n} else if (label === \"Create user\"){\n    msg.RevotioData.FlowData.Form.FormType  =  \"User\";\n    \n} else if (label === \"Create participant\"){\n    msg.RevotioData.FlowData.Form.FormType  =  \"Participant\";\n    \n}\n\n\n\n\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":760,"wires":[["94ef6924.94c9"]]},{"id":"39ddf0ca.0692a","type":"comment","z":"d8703926.e2eca","name":"*************************************************************************************************************** MENU ***************************************************************************************************************","info":"","x":660,"y":380,"wires":[]},{"id":"7d24cd64.3083e4","type":"comment","z":"d8703926.e2eca","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2510,"y":440,"wires":[]},{"id":"d83737b2.6834a","type":"function","z":"d8703926.e2eca","name":"Route lazyload actions","func":"var global , admin_users, organization, organization_users, sub_organizations;\n\nif (msg.RevotioData.PostData.gadgetData.lazyload === \"global\"){\n    global = msg;\n} else if (msg.RevotioData.PostData.gadgetData.lazyload === \"admin_users\"){\n    admin_users = msg;\n}else if (msg.RevotioData.PostData.gadgetData.lazyload === \"organizations\"){\n   organization = msg;\n} else if ( msg.RevotioData.PostData.gadgetData.lazyload === \"organization_users\"){\n    organization_users = msg;\n} else if ( msg.RevotioData.PostData.gadgetData.lazyload === \"sub_organizations\"){\n    sub_organizations = msg;\n}\n\n\n\n\nreturn [global,admin_users, organization, organization_users, sub_organizations];","outputs":5,"noerr":0,"x":760,"y":880,"wires":[["4d6e8aaa.054e84"],["386024ac.f579bc"],["fe6bd026.750e2"],["8c0473e0.6063c8"],["1dfc0e60.c5afa2"]],"outputLabels":["global","admin_users","organization","organization_users","sub_organization"]},{"id":"e7218436.a12638","type":"comment","z":"d8703926.e2eca","name":"Global","info":"","x":1570,"y":600,"wires":[]},{"id":"6e83b2ce.9f7a8c","type":"comment","z":"d8703926.e2eca","name":"Users","info":"","x":1410,"y":860,"wires":[]},{"id":"5e9c7d87.c185c4","type":"inject","z":"d8703926.e2eca","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1300,"y":580,"wires":[[]]},{"id":"386024ac.f579bc","type":"function","z":"d8703926.e2eca","name":"Create response obj","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\n\n\n// filter work_package items\n\n\n\n\nvar Childs = [ ]\n\n\n\n// _.each(lodash.orderBy(msg.payload, [\"UserAccountData.first_name\", \"UserAccountData.last_name\"], [\"asc\", \"asc\"]), function(Item, index){\n    \n//     UserAccountData = Item.UserAccountData[0]\n//     // projectData = Item.projectData\n    \n\n    \n    \n//     Childs.push(  {\n//             name:  Item.UserAccountData[0].first_name + \" \" +  Item.UserAccountData[0].last_name,\n//             label: Item.UserAccountData[0].first_name + \" \" +  Item.UserAccountData[0].last_name,\n//             group : false,\n//             button: false,\n//             Type: \"Admin_Users\",\n//             buttonType: \"warning\",\n//             iconUrl: Item.UserAccountData[0].avatar,\n//             iconState: true,\n//             redirect : true,\n//             Page : \"users overview\",\n//             organization_id:new ObjectID(global.get(\"MasterOrganizationData._id\")),\n//             Appuser_id : Item.user,\n//             inner:[]\n//             })\n            \n// })\n\n  \n\n    \n\n\n\n\n              \n\n// msg.payload = {\n//     gadgetsList:[{\n//         gadgetName: \"menu\",\n//         gadgetType: \"Menu\",\n//         gadgetId: \"menu\",\n//         gadgetData : \n//             Childs\n        \n//     }]\n// }\n// node.send(msg)\n\n\nmsg.payload = {\n    gadgetsList:[{\n        gadgetName: \"menu\",\n        gadgetType: \"Menu\",\n        gadgetId: \"menu\",\n        gadgetData : {\n                parent :msg.RevotioData.PostData.gadgetData,\n                 child : Childs}\n                 \n                  \n        // {\n        //     parent: msg.RevotioData.PostData.gadgetData,\n        //     childs : Childs\n        // }\n    }]\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1580,"y":820,"wires":[["b8cba8eb.07bea8"]]},{"id":"fe6bd026.750e2","type":"function","z":"d8703926.e2eca","name":"Prepair msg.menu && route based on UserType","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\nmsg.menu = []           ;\nmsg.BreadCrumbData = {\n    Org : [],\n    Pro : [],\n    WP  : [],\n} ;\n\n\n\nvar OrgIds = [];\n\nindex = -1\n_.each(msg.RevotioData.session.UserData.AppUserPermissionInfo, function(Item, Index ){\n    // if (Item.type_id === global.get(\"MasterOrganizationData._id\")){\n  if (String(Item.type_id) === String(global.get(\"MasterOrganizationData._id\")) ){\n//   if (new ObjectID(Item.type_id) === new ObjectID(global.get(\"MasterOrganizationData._id\")) ){\n       index =  Index\n    }\n})\nif (index > -1 || msg.RevotioData.session.UserData.UserAccountData.user_type === \"Admin_Users\" ){\n   match = {parent_id: { $exists: false} ,\"_id\": {\"$ne\": new ObjectID(global.get(\"MasterOrganizationData._id\"))}};\n    // msg.operation = \"find.toArray\";\n    \n} else {\n    // get organization ID's\n    \n    var ids = [];\n    \n    _.each(msg.RevotioData.session.UserData.AppUserPermissionInfo, function(Item, Index){\n        if (Item.type === \"organization\"){\n            ids.push(new ObjectID(Item.type_id))\n        }\n       \n       \n    })\n    match = {  _id: {\"$in\": ids}}; // parent_id: { $exists: false} ,\n    \n}\nmsg.time = {start : new Date()}\n// find \n            // findObj = {\n            //         query : {\n            //                 query :match, \n            //                 },\n            //         connection:global.get(\"DB_data.connection\"),\n            //         database:global.get(\"DB_data.appDB\"),\n            //         collection:'organizations',\n            //         operation:'find',\n            //         }\n\n// aggregate\n            aggregateObj = {\n                    query : { query : [{\n                                $match: match\n                              },\n                              {\n                                $lookup: {\n                                  \"from\": \"organizations\",\n                                  \"localField\": \"_id\",\n                                  \"foreignField\": \"parent_id\",\n                                  \"as\": \"childOrganizations\"\n                                }\n                              },\n                            //   {\n                            //     $project: {\n                            //       \"permission\": 1.0,\n                            //       \"projectData.name\": 1.0\n                            //     }\n                            //   },\n                            //   {\n                            //     $unwind: {\n                            //       \"path\": \"$projectData\",\n                            //       \"includeArrayIndex\": \"arrayIndex\",\n                            //       \"preserveNullAndEmptyArrays\": false\n                            //     }\n                            //   }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'aggregate',\n                    }\n\n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n            \n            \n\n\n\n\n\n// return msg;","outputs":1,"noerr":0,"x":1660,"y":860,"wires":[["586b1b7b.fd31c4"]],"outputLabels":["PNO, "]},{"id":"586b1b7b.fd31c4","type":"function","z":"d8703926.e2eca","name":"Create response object - users","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\n\n\nvar Childs = [ ]\n\n\n\n_.each(lodash.orderBy(msg.payload, [\"name\"], [\"asc\"]), function(Item, index){\n    \n    projects    = 0\n    employee    = 0\n    user        = 0\n    \n    // if (Item.hasOwnProperty(\"participants\")){\n        \n    //     if (lodash.groupBy(Item.participants, \"type\").hasOwnProperty(\"project\")){\n    //          projects = lodash.groupBy(Item.participants, \"type\").project.length ;\n    //     }   else {\n    //          projects = 0 ;\n    //     }\n       \n    // }\n    // if (Item.hasOwnProperty(\"employee\")){\n    //     employee = Item.employee.length\n    // }\n    // if (Item.hasOwnProperty(\"user\")){\n    //     user = Item.user.length\n    // }\n        \n        OrgObj = {    \n                name: Item.name,\n                label: Item.name,\n                group : true,\n                \n                // iconUrl: 'https://revotio.nl/api/app/images/menu/icon_organization.svg',\n                iconState: true,\n                organization_id : Item._id,\n                bubble: 0,\n                inner:[{\n                  \n                    name: \"Projects\",\n                    label: \"Projects\",\n                    button: true,\n                    lazyload : \"projects\",\n                    buttonType: \"success\",\n                    group : true,\n                    organization_id : Item._id,\n                    // iconName: global.get(\"icons.images.project\"),\n                    iconUrl: global.get(\"DomainProperties.prodUrl\") + \"/files/SystemFiles/icons/icon_rocket.svg\", // global.get(\"icons.images.user\"),\n                    filePath :global.get(\"icons.images.project\") ,\n                    // iconUrl: 'https://revotio.nl/api/app/images/menu/icon_rocket.svg',\n                    iconState: true,\n                    bubble : projects,\n                    inner:[]\n                        },\n                        {\n                   \n                    name: \"Employees\",\n                    label: \"Employees\",\n                    button: true,\n                    lazyload : \"employees\",\n                    organization_id : Item._id,\n                    buttonType: \"success\",\n                    group : true,\n                    // iconName: global.get(\"icons.images.employee\"),\n                    iconUrl: global.get(\"DomainProperties.prodUrl\") + \"/files/SystemFiles/icons/icon_user.svg\", // global.get(\"icons.images.user\"),\n                    filePath :global.get(\"icons.images.user\") ,\n                    bubble : employee, \n                    // iconUrl: 'https://revotio.nl/api/app/images/menu/icon_rocket.svg',\n                    iconState: true,\n                    inner:[]\n                        },\n                        {               \n                   \n                    name: 'Organization',\n                    label: 'Organization',\n                    group : true, \n                    iconName: global.get(\"icons.fas.organization\"),\n                    // iconUrl: 'https://revotio.com/webpages/Icons/Airplane.svg', \n                    iconState: true,\n                    bubble: '',\n                      organization_id : Item._id,\n                    redirect : false,\n                    inner: [\n                        {               \n                            name: 'Overview',\n                            label: 'Overview',\n                            group : false,\n                            iconName: global.get(\"icons.fas.organization\"),\n                            iconState: true,\n                            bubble: '',\n                            Page : 'organization overview',\n                              organization_id : Item._id,\n                            redirect : true,\n                            inner: []\n                        },\n                        \n                        // {               \n                        //     name: 'Cost',\n                        //     label: 'Cost',\n                        //     group : false,\n                        //     iconName: global.get(\"icons.fas.organization\"),\n                        //     iconState: true,\n                        //       organization_id : Item._id,\n                        //     bubble: '',\n                        //     Page : 'organization cost',\n                        //     redirect : true,\n                        //     inner: []\n                        // },\n                        \n                        {               \n                            name: 'University contribution',\n                            label: 'University contribution',\n                            group : false,\n                            iconName: global.get(\"icons.fas.organization\"),\n                            iconState: true,\n                              organization_id : Item._id,\n                            bubble: '',\n                            Page : 'organization university contribution',\n                            redirect : true,\n                            inner: []\n                        },\n                        {               \n                            name: 'Finances',\n                            label: 'Finances',\n                            group : false,\n                            iconName: global.get(\"icons.fas.organization\"),\n                            iconState: true,\n                            bubble: '',\n                              organization_id : Item._id,\n                            Page : 'organization finances',\n                            redirect : true,\n                            inner: []\n                        },\n                        // {               \n                        //     name: 'Result',\n                        //     label: 'Result',\n                        //     group : false,\n                        //     iconName: global.get(\"icons.fas.organization\"),\n                        //     iconState: true,\n                        //       organization_id : Item._id,\n                        //     bubble: '',\n                        //     Page : \"organization result\",\n                        //     redirect : true,\n                        //     inner: []\n                        // },\n                        ] },\n                        {\n                   \n                    name: \"Users\",\n                    label: \"Users\",\n                    button: true,\n                    lazyload : \"organization_users\",\n                    organization_id : Item._id,\n                    buttonType: \"success\",\n                    group : true,\n                    // iconName: global.get(\"icons.images.user\"),\n                    iconUrl: global.get(\"DomainProperties.prodUrl\") + \"/files/SystemFiles/icons/icon_user.svg\", // global.get(\"icons.images.user\"),\n                     filePath :global.get(\"icons.images.user\") ,\n                    // iconUrl: 'https://revotio.nl/api/app/images/menu/icon_rocket.svg',\n                    iconState: true,\n                    bubble : user, \n                    inner:[]\n                        },\n                    {\n                    name: \"Dashboards\",\n                    label: \"Dashboards\",\n                    button: true,\n                    organization_id : Item._id,\n                    buttonType: \"success\",\n                    group : true,\n                    bubble : 4, \n                    iconName: global.get(\"icons.fas.dashboard\"),\n                    // iconUrl: 'https://revotio.nl/api/app/images/menu/icon_rocket.svg',\n                    iconState: true,\n                    inner:[ {    \n                            name: \"Involvement dashboard\",\n                            label: \"Involvement dashboard\",\n                            group : true,\n                            iconName: global.get(\"icons.fas.dashboard\"),\n                            // iconUrl: 'https://revotio.nl/webpages/Icons/Checklist.svg', \n                            iconState: true,\n                            bubble: '',\n                            redirect : true,\n                            Page: 'dashboard - involvement',\n                            organization_id : Item._id,\n                            scope: '',\n                            inner: [],\n                        },{    \n                            name: \"Time reporting dashboard\",\n                            label: \"Time reporting dashboard\",\n                            group : true,\n                            iconName: global.get(\"icons.fas.dashboard\"),\n                            // iconUrl: 'https://revotio.nl/webpages/Icons/Checklist.svg', \n                            iconState: true,\n                            bubble: '',\n                            redirect : true,\n                            Page: 'dashboard - time reporting',\n                            organization_id : Item._id,\n                            scope: '',\n                            inner: [],\n                        },\n                                                {    \n                            name: \"PM vs TM\",\n                            label: \"PM vs TM\",\n                            group : true,\n                            iconName: global.get(\"icons.fas.dashboard\"),\n                            // iconUrl: 'https://revotio.nl/webpages/Icons/Checklist.svg', \n                            iconState: true,\n                            bubble: '',\n                            redirect : true,\n                            Page: 'dashboard - pf vs tm ',\n                            organization_id : Item._id,\n                            scope: '',\n                            inner: [],\n                        },\n                        \n                        \n                        {    \n                            name: \"organization cockpit dashboard\",\n                            label: \"Organization cockpit dashboard\",\n                            group : true,\n                            iconName: global.get(\"icons.fas.dashboard\"),\n                            // iconUrl: 'https://revotio.nl/webpages/Icons/Checklist.svg', \n                            iconState: true,\n                            bubble: '',\n                            redirect : true,\n                            Page: 'organization cockpit dashboard',\n                            organization_id : Item._id,\n                            scope: '',\n                            inner: [],\n                        },\n                        {    \n                            name: \"Transactions dashboard\",\n                            label: \"Transactions dashboard\",\n                            group : true,\n                            iconName: global.get(\"icons.fas.dashboard\"),\n                            // iconUrl: 'https://revotio.nl/webpages/Icons/Checklist.svg', \n                            iconState: true,\n                            bubble: '',\n                            redirect : true,\n                            Page: 'Transactions dashboard',\n                            organization_id : Item._id,\n                            scope: '',\n                            inner: [],\n                        },\n                        \n                        ]\n                    },\n                     {\n                    name: \"Settings\",\n                    label: \"Settings\",\n                    button: false,\n                    buttonType: \"success\",\n                    group : true,\n                    // iconUrl: 'https://revotio.com/api/app/images/menu/icon_settings.svg',\n                    iconName: global.get(\"icons.fas.settings\"),\n                     organization_id : Item._id,\n                    iconState: true,\n                    redirect : false,\n                    inner:[\n                            {\n                            name: 'Project management',\n                            label: 'Project management',\n                            group : true,\n                            Page : 'setting project management',\n                            // iconName:  global.get(\"DomainProperties.prodUrl\") + \"/icons/icon_rocket.svg\", // global.get(\"icons.fas.project\"),\n                            iconName: global.get(\"icons.fas.settings\"),\n                            iconState: true,\n                            bubble: '',\n                             organization_id : Item._id,\n                            // organization_id : msg.loopData.OrgData._id,\n                            redirect : true,\n                            inner: []\n                            },\n                            {               \n                            name: \"Employee management\",\n                            label: \"Employee management\",\n                            group : false,\n                            iconName: global.get(\"icons.fas.settings\"),\n                            Page : \"settings - employee management\",\n                            // iconUrl: 'https://revotio.com/webpages/Icons/Airplane.svg', \n                            iconState: true,\n                             organization_id : Item._id,\n                            bubble: '',\n                            // organization_id : msg.loopData.OrgData._id,\n                            redirect : true,\n                            inner: []\n                            },\n                            {               \n                            name: 'Financials management',\n                            label: 'Financials management',\n                            group : false,\n                            iconName: global.get(\"icons.fas.settings\"),\n                            iconState: true,\n                             organization_id : Item._id,\n                            bubble: '',\n                            Page : 'settings - financials management',\n                            redirect : true,\n                            inner: []\n                            },\n                            {               \n                            name: 'File import',\n                            label: 'File import',\n                            group : false,\n                             organization_id : Item._id,\n                            iconName: global.get(\"icons.fas.settings\"),\n                            iconState: true,\n                            Page : \"settings - file import\", // \n                            bubble: '',\n                            redirect : true,\n                            inner: []\n                            },\n                                                        {               \n                            name: 'File export',\n                            label: 'File export',\n                            group : false,\n                            organization_id : Item._id,\n                            iconName: global.get(\"icons.fas.settings\"),\n                            iconState: true,\n                            Page : \"settings - export\", // \n                            bubble: '',\n                            redirect : true,\n                            inner: []\n                            },\n                            ]\n},\n                        {    \n                            name: \"file management\",\n                            label: \"File management\",\n                            group : true,\n                            iconName: global.get(\"icons.fas.file_management\"),\n                            // iconUrl: 'https://revotio.nl/webpages/Icons/Checklist.svg', \n                            iconState: true,\n                            bubble: '',\n                            redirect : true,\n                            Page: 'file management',\n                            organization_id : Item._id,\n                            level : 'organization',\n                            scope: '',\n                            inner: [],\n},  {    \n                            name: \"Calendar\",\n                            label: \"Calendar\",\n                            group : true,\n                            iconName: global.get(\"icons.fas.calendar\"),\n                            // iconUrl: 'https://revotio.nl/webpages/Icons/Checklist.svg', \n                            iconState: true,\n                            bubble: '',\n                            redirect : true,\n                            Page: 'calendar',\n                            organization_id : Item._id,\n                            level : 'organization',\n                            scope: '',\n                            inner: [],\n}]\n            }\n    if (Item.hasOwnProperty(\"logo\")){\n            OrgObj.iconUrl =   global.get(\"functions.fileManagement\")(  Item.logo.url, Item.logo.url ,msg.RevotioData.session._id, \"copySync\"), \n            OrgObj.filePath = Item.logo.url;\n        } else {\n            OrgObj.iconName =  global.get(\"icons.fas.organization\");\n        }\n    if (Item.hasOwnProperty(\"childOrganizations\") && Item.childOrganizations.length > 0){\n        \n        OrgObj.inner.unshift({\n                    name: \"Sub organizations\",\n                    label: \"Sub organizations\",\n                    button: true,\n                    lazyload : \"sub_organizations\",\n                    buttonType: \"success\",\n                    group : true,\n                    organization_id : Item._id,\n                    // iconName: global.get(\"icons.images.project\"),\n                    iconUrl: global.get(\"DomainProperties.prodUrl\") + \"/files/SystemFiles/icons/icon_organization.svg\", // global.get(\"icons.images.user\"),\n                    filePath :global.get(\"icons.images.organization\") ,\n                    // iconUrl: 'https://revotio.nl/api/app/images/menu/icon_rocket.svg',\n                    iconState: true,\n                    bubble : Item.childOrganizations.length ,\n                    inner:[]\n                        })\n     \n    }\n    \n    // if (Item.hasOwnProperty(\"parent_id\") === true){\n    //     OrgObj.ParentId = new ObjectID(Item.parent_id );\n    // }\n        Childs.push(OrgObj)\n})\n\n\n\n\n// filter work_package items\n\ngroup = lodash.groupBy(Childs, \"ParentId\");\ngroupedPayload= []\n\n_.each(group.undefined, function(parentValue, parentIndex){\n    if (group.hasOwnProperty(parentValue.organization_id)){\n        \n        // check if childs are active\n        _.each(group[parentValue.organization_id], function(Item, Index){\n            if (Item.State === \"Active\"){\n                parentValue.State = Item.State;\n            }\n        });\n        parentValue.inner.unshift({\n            State : parentValue.State,\n            name: \"sub_organizations\",\n            label: \"Sub organizations\",\n            group: true,\n            iconUrl : global.get(\"DomainProperties.prodUrl\") + \"/files/SystemFiles/icons/icon_organization.svg\", // global.get(\"icons.fas.organization\"),\n             filePath :global.get(\"icons.images.organization\") ,\n            inner:lodash.orderBy(group[parentValue.organization_id], ['name','bubble' ], ['asc', 'desc'])\n            })\n    }\n    groupedPayload.push(parentValue)\n})\n\n    \n\n\n\n\n              \n\n// msg.payload = {\n//     gadgetsList:[{\n//         gadgetName: \"menu\",\n//         gadgetType: \"Menu\",\n//         gadgetId: \"menu\",\n//         gadgetData : \n//             groupedPayload\n        \n//     }]\n// }\n// node.send(msg)\n\n\nmsg.payload = {\n    gadgetsList:[{\n        gadgetName: \"menu\",\n        gadgetType: \"Menu\",\n        gadgetId: \"menu\",\n        gadgetData : {\n                parent :msg.RevotioData.PostData.gadgetData,\n                 child : groupedPayload}\n                  \n        // {\n        //     parent: msg.RevotioData.PostData.gadgetData,\n        //     childs : Childs\n        // }\n    }]\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2310,"y":940,"wires":[["b8cba8eb.07bea8"]]},{"id":"8c0473e0.6063c8","type":"function","z":"d8703926.e2eca","name":"Create response obj","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\n\n\n// filter work_package items\n\n\n\n\nvar Childs = [ ]\n\n\n\n// _.each(lodash.orderBy(msg.payload, [\"UserAccountData.first_name\", \"UserAccountData.last_name\"], [\"asc\", \"asc\"]), function(Item, index){\n    \n//     UserAccountData = Item.UserAccountData[0]\n//     // projectData = Item.projectData\n    \n\n    \n    \n//     Childs.push(  {\n//             name:  Item.UserAccountData[0].first_name + \" \" +  Item.UserAccountData[0].last_name,\n//             label: Item.UserAccountData[0].first_name + \" \" +  Item.UserAccountData[0].last_name,\n//             group : false,\n//             button: true,\n//             Type: \"Users\",\n//             buttonType: \"warning\",\n//             iconUrl: global.get(\"functions.fileManagement\")( global.get(\"DomainProperties.rootPath\") + \"/organization/\"+ Item.organization_id +\"/\"+ Item.UserAccountData[0].avatar, Item.UserAccountData[0].avatar ,msg.RevotioData.session._id, \"copySync\"), \n     \n//             iconState: true,\n//             redirect : true,\n//             Page : \"users global\",\n//             organization_id:msg.RevotioData.PostData.gadgetData.organization_id,\n//             Appuser_id : Item.user,\n//             inner:[]\n//             })\n            \n// })\n\ndata = [{\n            name: \"Create user\",\n            label: \"Create user\",\n            UserType: \"Admin_Users\",\n            button: true,\n            buttonType: \"success\",\n            iconName: global.get(\"icons.fas.create\"),\n            // iconUrl: 'https://revotio.nl/webpages/Icons/Plus.svg', \n            iconState: true,\n            organization_id:msg.RevotioData.PostData.gadgetData.organization_id,\n            // Page: 'users overview',\n            inner:[]\n},{\n            name: \"Open user management\",\n            label: \"Open user management\",\n            Type: \"Admin_Users\",\n            button: true,\n            buttonType: \"success\",\n            iconName: global.get(\"icons.fas.open\"),\n            // iconUrl: 'https://revotio.nl/webpages/Icons/Airplane.svg', \n            iconState: true,\n            redirect : true,\n            Page : \"users global\",\n            organization_id:msg.RevotioData.PostData.gadgetData.organization_id,\n            // page: 'users overview',\n            inner:[]\n},\n// {\n//             name: \"Users\",\n//             label: \"users\",\n//             Type: \"Users\",\n//             button: true,\n//             buttonType: \"success\",\n//             iconName: global.get(\"icons.fas.users\"),\n//             // iconUrl: 'https://revotio.nl/webpages/Icons/Airplane.svg', \n//             iconState: true,\n//             group : true,\n//             redirect : false,\n//             // Page : \"users global\",\n//             // lazyload: \"admin_users\",\n//             organization_id:msg.RevotioData.PostData.gadgetData.organization_id,\n//             // page: 'users overview',\n//             inner:Childs\n// }\n]\n\n    \n\n\n\n\n              \n\n// msg.payload = {\n//     gadgetsList:[{\n//         gadgetName: \"menu\",\n//         gadgetType: \"Menu\",\n//         gadgetId: \"menu\",\n//         gadgetData : \n//             Childs\n        \n//     }]\n// }\n// node.send(msg)\n\n\nmsg.payload = {\n    gadgetsList:[{\n        gadgetName: \"menu\",\n        gadgetType: \"Menu\",\n        gadgetId: \"menu\",\n        gadgetData : {\n                parent :msg.RevotioData.PostData.gadgetData,\n                 child : data}\n                 \n                  \n        // {\n        //     parent: msg.RevotioData.PostData.gadgetData,\n        //     childs : Childs\n        // }\n    }]\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1580,"y":900,"wires":[["b8cba8eb.07bea8"]]},{"id":"185b7877.16f478","type":"inject","z":"d8703926.e2eca","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1760,"y":520,"wires":[["e8bc643c.5b91f"]]},{"id":"e8bc643c.5b91f","type":"function","z":"d8703926.e2eca","name":"Libs","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\nfindObj = {\n                query : {\n                        query :{\"$or\" : [{Type : \"ProjectType\"}, {Type : \"JobTitle\"},{Type : \"Department\"} ]}, \n                        },\n                connection:\"mongodb://admin:lADOodCgW0vDAKbE@proddb-shard-00-00-mkgff.mongodb.net:27017,proddb-shard-00-01-mkgff.mongodb.net:27017,proddb-shard-00-02-mkgff.mongodb.net:27017/admin?ssl=true&replicaSet=ProdDB-shard-0\",\n                database:\"test\",\n                collection:'devices',\n                operation:'find',\n                }\n\n        mongodbTools.resolveAsync(findObj, node, function(res){\n                msg.result = res\n                node.send(msg) \n        })   \n\n","outputs":1,"noerr":0,"x":1870,"y":520,"wires":[[]]},{"id":"679d95fb.063114","type":"function","z":"d8703926.e2eca","name":"Remove user sessions","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// remove \n            removeObj = {\n                    query : {\n                            query :{\n                                        deviceId : msg.RevotioData.session.deviceId ,\n                                        revotioSessionId: msg.RevotioData.session.revotioSessionId\n                                    }, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            })   ","outputs":1,"noerr":0,"x":720,"y":1120,"wires":[["73743298.29765c"]]},{"id":"73743298.29765c","type":"function","z":"d8703926.e2eca","name":"remove global comntext sessions","func":"global.set(\"gadgetGroups.\"+ msg.RevotioData.session.deviceId)\n\nmsg.payload = {\n    RevotioData:{\n    logout : true,},\n    deviceId: msg.RevotioData.session.deviceId,\n    // revotioSessionId : msg.RevotioData.session.revotioSessionId\n}\n\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\nreturn msg;","outputs":1,"noerr":0,"x":960,"y":1120,"wires":[["45f70413.21ab2c"]]},{"id":"45f70413.21ab2c","type":"http response","z":"d8703926.e2eca","name":"","statusCode":"","headers":{},"x":1170,"y":1120,"wires":[]},{"id":"16e26d9e.c0ac62","type":"http in","z":"d8703926.e2eca","name":"Menu","url":"/Menu","method":"post","upload":false,"swaggerDoc":"","x":170,"y":700,"wires":[["9728bf20.e6f3d"]]},{"id":"d95079f7.8dc1d8","type":"subflow:5e9b9c1d.bbe4a4","z":"d8703926.e2eca","name":"","env":[],"x":660,"y":720,"wires":[]},{"id":"9728bf20.e6f3d","type":"function","z":"d8703926.e2eca","name":"Prepair flow","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\npayload = msg.payload\n_.each(payload, function(item, key){\n    msg[key] = item\n})\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":700,"wires":[["5b7fb22f.8de844","4314eee4.f4e7f"]]},{"id":"b8cba8eb.07bea8","type":"http response","z":"d8703926.e2eca","name":"","statusCode":"","headers":{},"x":2330,"y":700,"wires":[]},{"id":"94ef6924.94c9","type":"subflow:3170c4ab.fadb9c","z":"d8703926.e2eca","name":"","env":[],"x":880,"y":760,"wires":[["71636367.1aba4c"]]},{"id":"71636367.1aba4c","type":"function","z":"d8703926.e2eca","name":"Set RevotioData","func":"\npayload = {\n    payload : msg.payload,\n    RevotioData: msg.RevotioData\n}\n\nmsg.payload = payload\nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":760,"wires":[["e74b4e81.9065d8"]]},{"id":"e74b4e81.9065d8","type":"http response","z":"d8703926.e2eca","name":"","statusCode":"","headers":{},"x":1130,"y":760,"wires":[]},{"id":"1dfc0e60.c5afa2","type":"function","z":"d8703926.e2eca","name":"Prepair msg.menu && sub_organizations","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\nmsg.menu = []           ;\nmsg.BreadCrumbData = {\n    Org : [],\n    Pro : [],\n    WP  : [],\n} ;\n\n\n// \n\n\n// aggregate\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {parent_id : new ObjectID(msg.RevotioData.PostData.gadgetData.organization_id)}\n                              },\n                              {\n                                $lookup: {\n                                  \"from\": \"organizations\",\n                                  \"localField\": \"_id\",\n                                  \"foreignField\": \"parent_id\",\n                                  \"as\": \"childOrganizations\"\n                                }\n                              },\n                            //   {\n                            //     $project: {\n                            //       \"permission\": 1.0,\n                            //       \"projectData.name\": 1.0\n                            //     }\n                            //   },\n                            //   {\n                            //     $unwind: {\n                            //       \"path\": \"$projectData\",\n                            //       \"includeArrayIndex\": \"arrayIndex\",\n                            //       \"preserveNullAndEmptyArrays\": false\n                            //     }\n                            //   }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'aggregate',\n                    }\n\n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n            \n            \n\n\n\n\n\n// return msg;","outputs":1,"noerr":0,"x":1640,"y":940,"wires":[["586b1b7b.fd31c4"]],"outputLabels":["PNO, "]},{"id":"47fdbeb5.4211e","type":"comment","z":"aec22158.fe4e38","name":"Global context data","info":"","x":410,"y":20,"wires":[]},{"id":"bec51817.848ff8","type":"subflow:e25f5e2d.45871","z":"aec22158.fe4e38","name":"","env":[],"x":180,"y":80,"wires":[[]]},{"id":"4809e15c.231538","type":"link in","z":"aec22158.fe4e38","name":"Push gadgets to frontend","links":["22600218.5f17ce","237dc0d6.55ce58","2d570acc.402cee","4d2f5f49.74d588","4f069602.986148","54156eec.b14a88","6b7d9d4c.4f7de4","6b8fb4fa.663c8c","7bd715c1.48678c","7d81d17c.aaecb8","881d9107.af00e","98c425c5.4b0328","a9e514e2.43afa8","ad59d764.8f538","af92a9f3.f2eab","b62f16e5.5c7998","ba29073e.8adb","bdf7ba4.ba0e548","fb679d51.f23358"],"x":55,"y":80,"wires":[["bec51817.848ff8"]]},{"id":"192fce41.a964e2","type":"comment","z":"2294209a.0c95b","name":"Global context data","info":"","x":350,"y":40,"wires":[]},{"id":"d98d965c.e5c518","type":"subflow:e25f5e2d.45871","z":"2294209a.0c95b","name":"","env":[],"x":420,"y":100,"wires":[[]]},{"id":"480dae32.8a339","type":"link in","z":"2294209a.0c95b","name":"Push gadgets to frontend","links":["1bc869a3.7eb996","1c021baa.41b07c","2a3f6b04.a7f3bc","56a2b4a6.6d588c","5d648f99.e116b8","b742db6e.8148f","d6f75efd.0ef05","da96270c.50aa4","df9e1699.b208d8","e5361ca5.ccabf","f19484dd.a1fe48","f438ead1.51c198"],"x":295,"y":100,"wires":[["d98d965c.e5c518"]]},{"id":"c91bfeb6.105ee8","type":"comment","z":"e5822137.be45d","name":"Global context data","info":"","x":490,"y":20,"wires":[]},{"id":"195b9b9c.a972dc","type":"subflow:e25f5e2d.45871","z":"e5822137.be45d","name":"","env":[],"x":740,"y":120,"wires":[[]]},{"id":"a6ee6331.070228","type":"link in","z":"e5822137.be45d","name":"Push Gadget to Frontend","links":["1414db5.9477225","332fcebf.47e5ea","402f0b1e.b2f10c","473575ea.f2ca9c","4e30d34a.94d17c","5a1bf7f9.3cce7","5d9d62c1.c97ae4","63f480be.65ed78","6c372d2d.56f66c","726136cc.ee23e","72f5dc66.d27994","887ec7cf.104c1","950e082d.458a48","9a43c1cc.c7e6a8","9ab04a2a.f2bec","a64310c4.2429c8","b0cd1861.02c32","b5b81ae2.4e6f3","c16d9a0c.c46d58","cc93af00.839ed","d17b5e28.efa078","e7a48cc8.cc60d8","ec6b9f6a.c0a41","f0a7f951.ad708","33287b30.e85ea4","b51910ff.83ca18","6c9f0870.13af78","324de421.bf1f2c","6f9cee85.74eff8","1da04cb0.06c6d3","56a732b2.20accc","6a9882ea.91bdbc","960027a2.514268","e539d89b.9f3b08"],"x":395,"y":80,"wires":[["e5f1ee6f.1b3268"]]},{"id":"42ee5df0.7ac9b4","type":"link in","z":"e5822137.be45d","name":"Push gadget to frontend","links":["6c1fc1e4.18153","71a75c31.72c3c4","8915c09f.764ff","2c7cb1db.77396e","a46f6b54.9146e8","9380426d.7e2f8","dd17eedc.661de","b6af783.489bb88","bcf32a29.9d22c8","e49f3be7.3f3e98","17bd5710.330e29","b54de25e.224c9","c8128f27.83f0c","5b8d4cf6.ca32a4","8e11c1d1.ada8b","d4ed1cc8.5a11f","34e3a2a7.c7936e","aa4a5c67.21ed7","671679df.f85b58","ba7265f.9e92f98","34d8dd6f.00fb92","17630ade.28bd95","f0aa4719.022068","f5c57219.73ea9","1c3a6655.a06b7a","5b59ec64.44982c","18c9fe9e.5f6899"],"x":435,"y":80,"wires":[["e5f1ee6f.1b3268"]]},{"id":"4fe5a76.5bcfd58","type":"link in","z":"e5822137.be45d","name":"Push Gadgets to frontend","links":["13bcb907.ca42ef","286a4834.8ee44","6800f9d5.3dff58","7e394d6c.c2831c","9906fb19.b9b47","9bc60dce.db6568","c62e0e45.48a2c8"],"x":375,"y":120,"wires":[["e5f1ee6f.1b3268"]]},{"id":"eefe6ecb.492078","type":"link in","z":"e5822137.be45d","name":"Return to Frontend","links":["2ef1becf.7da1b2","a65bd864.ee1828","23e4ed49.681a62","52cac6c8.8f6018","878ed43d.f6c348","16d8ff69.d71e71","4ae71785.1c5fc","5002c494.80c03c","5dba0abb.3b9dbc","fb03028f.7d0f4","44b32d37.175e74","f94c825a.6795a","47f74ceb.d79b1c","32d5e9f1.b935f6","1f8e3f90.84a298","5f1a385c.edb14","37562fb5.4313a","b4a3b5aa.487f6","f10a8582.df74b","f70e748a.df179","30650656.001a8a","b9d6160.16eb6e8","e995ed62.c5e138","4e3d365f.e1d8f","4d639347.c27a34","c2c17e7a.3ca688","69c8a744.a0827","55f4828f.4fb3b4","d4c53ab.5c3e3c8","4c49a90c.d02c48","9e47ec67.076808","ba6eeef0.503198","47b5eaad.ade484","7766b2b7.7570dc","33d4041f.3ee46c","cf5ee563.e9a7","c1f9d0b7.2a065","57c5062c.523b38","56f4c565.9de3f4","66f48d18.a2d8fc","7ea38e7d.370328","76a831f8.cf2bc8","b300552.bc2f128","244b0842.7f8878","fa510cbe.abfd88","ad6f24d.a8f1758","1bc37531.9d52bb","b2731052.a9087","ce0aa294.a809d","8f3ccf44.4192a","d57bc5e4.c556c8","bdcbb946.3f6a78"],"x":375,"y":80,"wires":[["e5f1ee6f.1b3268"]]},{"id":"656ec53c.6bb344","type":"link in","z":"e5822137.be45d","name":"organization global ==> Push gadget frontend","links":["d0895998.b221d8","9198d989.635538","589647d4.40b338","4b07fc0a.2f3c64","243bd25a.1dddce","a79d9a84.9e87e8","44496033.f380b","89e07cb5.9ceff","3dfbfbc5.ae5004","c1bbd831.582ba8","62127a31.57f32c","774bc9c9.58a1c","9ecfa92f.c28c9","2eca442d.4fc91c","9909108a.a8f2b8","41e59027.48e72","aafa8726.1d31f8","f786d66a.a9421","aa7b16f6.fea1b","f8555133.f61438","99aa8f9e.07ed8","4b702acd.895cf4","214f3437.be9504","c28406bc.ba45","a42b3aa1.c42c48","164a8d01.4eb1c3","8b0c5b93.fa7688","96028ac8.026ff8","2272d450.d6f004","1d19be79.2f946a","a3794f83.51c8d8","8d6a210f.640ba","57277aec.3334fc","1c35b137.b4b267","3406b068.d2d0c8","ebd47a0c.f53a88","72785794.bda1c8"],"x":395,"y":120,"wires":[["e5f1ee6f.1b3268"]]},{"id":"d95f4281.738d6","type":"link in","z":"e5822137.be45d","name":"organization global ==> Push gadget frontend","links":["9cb9a896.aa1d68","c78a9002.ce20e","767d4c28.0d0bf4","1effa21b.e3429e","30cb18ad.79a6d8","92084dab.74935","9b1164dc.d1ac98","e8ba36c6.b04a48","5573b262.5cb4ac","17ad68.49713299","8462b834.d9dd78","3646efc7.b16e08","66a93ca.a947544","446825fb.8b9704","c0822dfb.e6597","6e3e8606.38dd4","c75c9dc0.0e26c"],"x":395,"y":100,"wires":[["e5f1ee6f.1b3268"]]},{"id":"e5f1ee6f.1b3268","type":"function","z":"e5822137.be45d","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":120,"wires":[["195b9b9c.a972dc"]]},{"id":"d746445.12ff338","type":"comment","z":"d8703926.e2eca","name":"Global context data","info":"","x":1450,"y":120,"wires":[]},{"id":"b2b8b6e9.e3583","type":"subflow:e25f5e2d.45871","z":"d8703926.e2eca","name":"","env":[],"x":1780,"y":220,"wires":[[]]},{"id":"85ce669.6b97d18","type":"link in","z":"d8703926.e2eca","name":"Push Gadget to Frontend","links":["192ccb9.8f0e834","2daf070a.78ed98","31cfbc66.cc8804","50d2a4eb.931acc","55f75812.d4147","6e19fdf0.93f8ac","7e5248cb.e2b4e8","b8d4d51b.d27168","ca0414d.a9c7a68","ccb5aebf.1b12a","17cb9f85.7d739","ae27717a.40c71","c6737cff.792a3","dce08cc.269497","491fd505.fc69fc","5d41711e.3f589","7056c137.30e85","ed25e04e.d3e8d","4755e621.8087d8","5e8e4c17.eb0474","dd5d1f3e.91b73","d93ac4.0a65554","bcf796c9.8de8f8","f416fa4d.8a69b8"],"x":1315,"y":180,"wires":[["232c062f.9308ca"]]},{"id":"232c062f.9308ca","type":"function","z":"d8703926.e2eca","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1610,"y":220,"wires":[["b2b8b6e9.e3583"]]},{"id":"71332273.c1870c","type":"debug","z":"aec22158.fe4e38","name":"debug - Reset password INIT","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1070,"y":2160,"wires":[]},{"id":"3199acdc.5d559c","type":"debug","z":"508957a1.dd5398","name":"TOKEN post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":670,"y":1540,"wires":[]},{"id":"a16ff674.24bb78","type":"function","z":"39834eee.0dd5a2","name":"Update session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// update    \n\nupdateObj = {\n                    query : {\n                            query :{\n                                    deviceId:msg.payload.deviceId,\n                                    revotioSessionId:msg.payload.revotioSessionId\n                            }, \n                            update : { \"$set\" : {\n                                                    timestamp : new Date(),\n                                                    token: msg.payload.token,\n                                                    Gadgets: [],\n                                                    Page: msg.payload.Page,\n                                                    groupedObject: msg.payload.presentationLayer.groupedObject}},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            }) ","outputs":1,"noerr":0,"x":140,"y":80,"wires":[[]]},{"id":"e343bb91.2fe0a8","type":"function","z":"e25f5e2d.45871","name":"Update && Get session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nif (msg.payload.gadgetsList){\n\nupdateObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.RevotioData.session._id)}, \n                            update : { \"$push\": { Gadgets: { \"$each\": msg.payload.gadgetsList } }},\n                            options : {upsert: true, returnOriginal: false}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'findOneAndUpdate', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                \n                if (typeof res === 'object' && res.hasOwnProperty(\"value\")){\n                     msg.session = res.value\n              \n               \n                \n                        //     findOneObj = {\n                        //         query : {\n                        //                 query :{\n                        //                       _id:new ObjectID(msg.RevotioData.session._id)\n                        //                 } \n                        //                 },\n                        //         connection:global.get(\"DB_data.connection\"),\n                        //         database:global.get(\"DB_data.appDB\"),\n                        //         collection:'sessions',\n                        //         operation:'find',\n                        //         }\n            \n                        // mongodbTools.resolveAsync(findOneObj, node, function(res){\n                        //     if (res.length > 0){\n                        //         msg.session = res[0]\n                        //     } else {\n                        //         msg.session = {}\n                        //     }\n                                \n                                node.send(msg) \n                        // })  \n                } \n                else {\n                    \n                    msg.session = msg.RevotioData.session\n                    msg.response = res\n                    node.send(msg) \n                }\n            \n            \n            }) \n            \n} else {\n    console.log({\n        error : \"no msg.payload.gadgetsList present\",\n        RevotioData : msg.RevotioData,\n        payload : msg.payload\n    })\n    // msg.error = \"no msg.payload.gadgetsList present\"\n     node.send(msg) \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":220,"wires":[["242f58f1.b6c22"]]},{"id":"6c4dc95f.5f22c","type":"function","z":"e25f5e2d.45871","name":"Get session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n   delete msg.sessionNew\n   \nfindOneObj = {\n                    query : {\n                            query :{\n                                        _id:new ObjectID(msg.RevotioData.session._id)\n                            } \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.sessionNew = res[0]\n                } else {\n                    msg.sessionNew = {}\n                }\n                    \n                    if (    msg.sessionNew.hasOwnProperty(\"Gadgets\") &&\n                            msg.sessionNew.Gadgets.length ===  msg.session.Gadgets.length \n                    ){\n                        node.send(msg) \n                    }\n            })  ","outputs":1,"noerr":0,"x":470,"y":380,"wires":[["6267a6f2.146138"]]},{"id":"7934527d.c7f0ec","type":"debug","z":"e25f5e2d.45871","name":"1-B","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":500,"wires":[]},{"id":"4bcaefa7.bd4c7","type":"debug","z":"e25f5e2d.45871","name":"2-A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":280,"wires":[]},{"id":"9ca782e7.f308b8","type":"debug","z":"e25f5e2d.45871","name":"1-C","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":240,"wires":[]},{"id":"260e7564.997072","type":"debug","z":"e25f5e2d.45871","name":"2-B","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":630,"y":440,"wires":[]},{"id":"7e4884c3.ec091c","type":"debug","z":"e25f5e2d.45871","name":"2-C","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":990,"y":440,"wires":[]},{"id":"de21f442.f2c1e","type":"debug","z":"e25f5e2d.45871","name":"2-D","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1110,"y":360,"wires":[]},{"id":"54a1b615.985f98","type":"function","z":"e25f5e2d.45871","name":"get && check response","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\n\n// check if its dev env\n// if (env.get(\"PREFORMANCE_CHECK\") && env.get(\"PREFORMANCE_CHECK\") === true){\n    msg.payload.endtime         = new Date() \n    msg.payload.starttime       = msg.payload.starttime\n    msg.payload.timediff        = moment(msg.payload.endtime).diff(moment(msg.payload.starttime))\n    \n    gadgetsList = lodash.orderBy(msg.payload.gadgetsList, [\"endtime\"], [\"desc\"]);\n    \n    \n    msg.payload.gadgetsList = gadgetsList;\n    msg.payload.included = []\n    _.each(gadgetsList, function(item, index){\n        msg.payload.included.push(item.gadgetName)\n    })\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":120,"wires":[["2dee3212.2703a6"]]},{"id":"c54784cc.a6c3a8","type":"inject","z":"a2b40f09.d18fd8","name":"","repeat":"","crontab":"00 00 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":200,"wires":[["e2b8eccb.0397b8"]]},{"id":"e2b8eccb.0397b8","type":"function","z":"a2b40f09.d18fd8","name":"Get all emplyee","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar fs = global.get('fsextra');\n      \n// distinct\n\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {}\n                              },\n                                 { \n                                        \"$group\" : { \n                                            \"_id\" : \"$_id\"\n                                        }\n                                    }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'employee',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                     msg.employee_id = [] ; \n                    \n                    _.each(res, function(Item, Index ){\n                         msg.employee_id.push(new ObjectID(Item._id))\n                    })\n                    node.send(msg) \n            }) \n                   \n\n            ","outputs":1,"noerr":0,"x":340,"y":200,"wires":[[]]},{"id":"7d81ff72.bad3e","type":"comment","z":"a2b40f09.d18fd8","name":"Recalc all employee's","info":"","x":140,"y":160,"wires":[]},{"id":"7232508b.9067a","type":"inject","z":"a2b40f09.d18fd8","name":"","repeat":"","crontab":"00 00 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":340,"wires":[["5fceb272.c1085c"]]},{"id":"5fceb272.c1085c","type":"function","z":"a2b40f09.d18fd8","name":"Get all emplyee","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar fs = global.get('fsextra');\n      \n// distinct\n\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {}\n                              },\n                                 { \n                                        \"$group\" : { \n                                            \"_id\" : \"$_id\"\n                                        }\n                                    }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'employee',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                     msg.employee_id = [] ; \n                    \n                    _.each(res, function(Item, Index ){\n                         msg.employee_id.push(new ObjectID(Item._id))\n                    })\n                    node.send(msg) \n            }) \n                   \n\n            ","outputs":1,"noerr":0,"x":340,"y":340,"wires":[[]]},{"id":"85bbaefb.c8db08","type":"comment","z":"a2b40f09.d18fd8","name":"Session management","info":"","x":120,"y":300,"wires":[]},{"id":"59fb872e.5902f8","type":"function","z":"508957a1.dd5398","name":"Add session to session_stats","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// _id management\nObj = msg.current_session;\nObj.session_id = new ObjectID(msg.current_session._id)\nmsg.current_session._id = new ObjectID();\n\n// Add redirect data\n\nObj.destination_page =  msg.responseObj.Page\nObj.redirect_time =  new Date()\n\n// remove current session flowData\n\ndelete Obj.FlowData\nObj.redirect_revotio_data =  msg.responseObj.RevotioData\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :Obj, \n                            update : { \"$set\" : Obj},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'session_stats',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    // node.send(msg) \n            })  ","outputs":1,"noerr":0,"x":1020,"y":1500,"wires":[[]]},{"id":"af5c8a5f.64c24","type":"function","z":"508957a1.dd5398","name":"Get session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// findOne \nfindOneObj = {\n                    query : {\n                            query :{revotioSessionId: msg.responseObj.revotioSessionId, deviceId:msg.responseObj.deviceId} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.current_session = res[0]\n                } else {\n                    msg.current_session = {}\n                }\n                    \n                    node.send(msg) \n            })  ","outputs":1,"noerr":0,"x":770,"y":1020,"wires":[["59fb872e.5902f8","1a7afd51.7ed1e3"]]},{"id":"e8e83204.ecdd18","type":"subflow:5e9b9c1d.bbe4a4","z":"19457c3b.7f3ba4","name":"","env":[],"x":420,"y":60,"wires":[]},{"id":"75a214b5.1247dc","type":"function","z":"19457c3b.7f3ba4","name":"Prepair redirect (breadcrumbs)","func":"msg.payload = {\n    Page : msg.RevotioData.PostData.gadgetData.selected.Page,\n    RevotioData : msg.RevotioData.PostData.gadgetData.selected.RevotioData,\n}\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":80,"wires":[["e8e83204.ecdd18"]]},{"id":"9c1da85e.48053","type":"function","z":"508957a1.dd5398","name":"Get all org's applications ","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar query = {organization_id : new ObjectID(msg.organization_id)}\nmsg.done = false\n // find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'applications',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n\n                    _.each(res, function(AppItem,AppItemIndex ){\n                        node.send({application_id :AppItem._id })\n                    })\n                   \n                    msg.done = true\n                    node.send(msg) \n            }) \n","outputs":1,"noerr":0,"x":1510,"y":2060,"wires":[["9548cd04.dd18","b964d4be.164298"]]},{"id":"b964d4be.164298","type":"function","z":"508957a1.dd5398","name":"Send response","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif (msg.done === true ){\n    node.send(msg)\n}\n","outputs":1,"noerr":0,"x":1820,"y":2060,"wires":[["2e59826a.d8a256"]]},{"id":"2e59826a.d8a256","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":2130,"y":2060,"wires":[]},{"id":"7af2cd05.9b0044","type":"debug","z":"508957a1.dd5398","name":"Remove page","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":2420,"wires":[]},{"id":"1ea0e68c.3991f9","type":"debug","z":"508957a1.dd5398","name":"Remove app","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":2160,"wires":[]},{"id":"92f7b82b.753758","type":"debug","z":"508957a1.dd5398","name":"Remove org","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":1980,"wires":[]},{"id":"820eb5ef.100fd8","type":"function","z":"73dff3ad.4e7f84","name":"convert IDs","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (msg.payload.organizationId){\n    msg.payload.organization_id =new ObjectID(msg.payload.organizationId)\n}\n\nif (msg.payload.applicationId){\n    msg.payload.application_id = new ObjectID(msg.payload.applicationId)\n}\nif (msg.payload.pageId){\n    msg.payload.page_id = new ObjectID(msg.payload.pageId)\n}\nif (msg.payload.itemId){\n    msg.payload.item_id = new ObjectID(msg.payload.itemId)\n}\nif (msg.payload.userId){\n    msg.payload.user_id = new ObjectID(msg.payload.userId)\n}\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":80,"wires":[[]]},{"id":"c456991.34d5368","type":"function","z":"5c6b8786.2f63d","name":"Init org level","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// makesure FlowData.Data exists\n\nif (!msg.RevotioData.FlowData ){\n    msg.RevotioData.FlowData  = {}\n}\n\nif (!msg.RevotioData.FlowData.Data ){\n    msg.RevotioData.FlowData.Data  = {}\n}\n\n\n findOneObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.RevotioData.FlowData.organization_id)} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n               if (res.length > 0){\n                    msg.RevotioData.FlowData.Data.OrganizationData = res[0]\n                } else {\n                    msg.RevotioData.FlowData.Data.OrganizationData  = {}\n                }\n                    \n                    node.send(msg) \n            })  ","outputs":1,"noerr":0,"x":190,"y":80,"wires":[[]]},{"id":"12877cee.3216e3","type":"subflow:5c6b8786.2f63d","z":"2294209a.0c95b","name":"","env":[],"x":1070,"y":620,"wires":[["aea25a8a.fa4a58"]]},{"id":"91d23ba1.ffd018","type":"debug","z":"e25f5e2d.45871","name":"IN Gen. Response","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":170,"y":180,"wires":[]},{"id":"d9a31cb4.de7588","type":"debug","z":"508957a1.dd5398","name":"ACTION post A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":700,"y":680,"wires":[]},{"id":"e4b702f8.2026a","type":"function","z":"8db3b81a.693fd","name":"Route BreadCrumb action","func":"var redirect, newEntity , formAction;\nif (msg.RevotioData.PostData.gadgetData.type &&\n    msg.RevotioData.PostData.gadgetData.type === \"button\" &&\n    msg.RevotioData.PostData.gadgetData.selected){\n    \n     msg.RevotioData.FlowData.Form = msg.RevotioData.PostData.gadgetData.selected;\n    \n  formAction = msg;  \n}\nelse if (msg.RevotioData.PostData.gadgetData.selected){\n     msg.payload = {\n        Page : msg.RevotioData.PostData.gadgetData.selected.Page,\n        RevotioData : {\n            organization_id : msg.RevotioData.PostData.gadgetData.selected.organization_id,\n            page_id : msg.RevotioData.PostData.gadgetData.selected.page_id,\n            application_id : msg.RevotioData.PostData.gadgetData.selected.application_id,\n            item_id : msg.RevotioData.PostData.gadgetData.selected.item_id,\n        }\n    }\n    \n    redirect= msg\n} else if (msg.RevotioData.PostData.gadgetData.Page) {\n    \n     msg.payload = {\n        Page : msg.RevotioData.PostData.gadgetData.Page,\n        RevotioData : {\n            organization_id : msg.RevotioData.PostData.gadgetData.data[0].organization_id,\n            page_id : msg.RevotioData.PostData.gadgetData.data[0].page_id,\n            application_id : msg.RevotioData.PostData.gadgetData.data[0].application_id,\n            item_id : msg.RevotioData.PostData.gadgetData.data[0].item_id,\n            // employee_id : msg.RevotioData.PostData.gadgetData.data[0].employee_id,\n        }\n    }\n    \n    \n   redirect= msg\n} else {\n     newEntity = msg;\n}\n\n\nreturn [redirect, newEntity, formAction];","outputs":3,"noerr":0,"x":200,"y":80,"wires":[[],["f2f17cd0.7f59a8"],[]],"outputLabels":["redirect","newEntity","formAction"]},{"id":"f2f17cd0.7f59a8","type":"function","z":"8db3b81a.693fd","name":"Prepair form","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\n\n\nmsg.RevotioData.FlowData.Form = {\n        FormType  :  msg.RevotioData.PostData.gadgetData.FormType,\n        FormActionType: \"Create\"\n    }\n    \n    if (msg.RevotioData.PostData.gadgetData.organization_id){\n       msg.RevotioData.FlowData.Form.organization_id = new ObjectID(msg.RevotioData.PostData.gadgetData.organization_id)\n    }else if (msg.RevotioData.FlowData.organization_id){\n       msg.RevotioData.FlowData.Form.organization_id = new ObjectID(msg.RevotioData.FlowData.organization_id)\n    }\n    \n    if (msg.RevotioData.PostData.gadgetData.project_id){\n       msg.RevotioData.FlowData.Form.project_id = new ObjectID(msg.RevotioData.PostData.gadgetData.project_id)\n    }else if (msg.RevotioData.FlowData.project_id){\n       msg.RevotioData.FlowData.Form.project_id = new ObjectID(msg.RevotioData.FlowData.project_id)\n    }    \n    \n    if (msg.RevotioData.PostData.gadgetData.work_package_id){\n       msg.RevotioData.FlowData.Form.work_package_id = new ObjectID(msg.RevotioData.PostData.gadgetData.work_package_id)\n    }else if (msg.RevotioData.FlowData.work_package_id){\n       msg.RevotioData.FlowData.Form.work_package_id = new ObjectID(msg.RevotioData.FlowData.work_package_id)\n    }  \n    \n    if (msg.RevotioData.PostData.gadgetData.participant_id){\n       msg.RevotioData.FlowData.Form.participant_id = new ObjectID(msg.RevotioData.PostData.gadgetData.participant_id)\n    }else if (msg.RevotioData.FlowData.participant_id){\n       msg.RevotioData.FlowData.Form.participant_id = new ObjectID(msg.RevotioData.FlowData.participant_id)\n    } \n    \n    \n    // organization_id : \n    //      : new ObjectID(msg.RevotioData.FlowData.project_id),\n    //      : new ObjectID(msg.RevotioData.FlowData.work_package_id),\n    //      : new ObjectID(msg.RevotioData.FlowData.participant_id),\n     \n\n\n// if (msg.RevotioData.session.Page === \"project overview\"){\n//     msg.RevotioData.FlowData.Form = {\n//         organization_id : new ObjectID(msg.RevotioData.FlowData.organization_id),\n//         project_id : new ObjectID(msg.RevotioData.FlowData.project_id),\n//         FormType  :  \"WorkPackage\",\n//         FormActionType: \"Create\"\n//     }\n// } else if (msg.RevotioData.session.Page === \"organization overview\"){\n//     msg.RevotioData.FlowData.Form = {\n//         organization_id : new ObjectID(msg.RevotioData.FlowData.organization_id),\n//         FormType  :  \"Project\",\n//         FormActionType: \"Create\"\n//     }\n// } else if (msg.RevotioData.session.Page === \"organization global\"){\n//     msg.RevotioData.FlowData.Form = {\n//         FormType  :  \"Organization\",\n//         FormActionType: \"Create\"\n//     }\n// } else if (msg.RevotioData.session.Page === \"work package overview\"){\n//     msg.RevotioData.FlowData.Form = {\n//         FormType  :  \"Organization\",\n//         FormActionType: \"Create\"\n//     }\n// }\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":80,"wires":[[]]},{"id":"860d2caf.36873","type":"subflow:8db3b81a.693fd","z":"e5822137.be45d","name":"BreadCrumbsAction","env":[],"x":3680,"y":440,"wires":[["6e95417b.0deff"],["bcb372ba.8288e8"]]},{"id":"6bfbfd2b.204aec","type":"subflow:5e9b9c1d.bbe4a4","z":"2294209a.0c95b","name":"","env":[],"x":3220,"y":640,"wires":[]},{"id":"42bc1f60.995e2","type":"subflow:3170c4ab.fadb9c","z":"2294209a.0c95b","name":"","x":3220,"y":680,"wires":[["6f9cee85.74eff8"]]},{"id":"6f9cee85.74eff8","type":"link out","z":"2294209a.0c95b","name":"Topbar  frontend post","links":["23272508.4d696a","2475f18f.18f84e","f85b9845.a955d","8b4ff2ec.3247b","bfe4a65b.e868c","68a613e1.7d23cc","a8407940.280928","cd2e935f.5b6348","c6ab18b6.cf792","915fe08d.d804b","839882ba.4c8cf8","4248f1d.8cffc1","fa74879d.d6538","dfb2e790.ced988","5152dc4f.eabc94","271f0775.5ac628","7b149429.0d56fc","7a011268.2223d4","26dc0660.b1e4ba","59afb9fb.3ba0c8","9c32caf9.c7e008","8be6a719.2a64e","a6ee6331.070228","6a41100.61cc07","c76409e8.f61b3"],"x":3295,"y":680,"wires":[]},{"id":"de0a486c.213f5","type":"subflow:8db3b81a.693fd","z":"2294209a.0c95b","name":"BreadCrumbsAction","env":[],"x":3020,"y":660,"wires":[["6bfbfd2b.204aec"],["42bc1f60.995e2"]]},{"id":"b5530b8c.66e958","type":"debug","z":"508957a1.dd5398","name":"EXIT post post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":260,"y":1240,"wires":[]},{"id":"728e249.bd3ca5c","type":"json","z":"508957a1.dd5398","name":"","property":"payload","action":"","pretty":false,"x":210,"y":1300,"wires":[["920da7ee.18772","b5530b8c.66e958"]]},{"id":"9c6fb265.83a68","type":"inject","z":"a2b40f09.d18fd8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":620,"y":500,"wires":[["894b9def.6e6e08"]]},{"id":"894b9def.6e6e08","type":"function","z":"a2b40f09.d18fd8","name":"get pages","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// findMany\n\nfindManyObj = {\n                    query : {\n                            query :{application_id: new ObjectID(\"5f22ab9e5c29cbe8cc52540c\")},\n                            // query :{application_id: \"test styles\"},\n                           \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findManyObj, node, function(res){\n                \n                \n                    msg.payload = res\n                    node.send(msg) \n            }) \n\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":500,"wires":[["2740f15f.cbea9e","93a104c5.6d253"]]},{"id":"7445b821.81b84","type":"debug","z":"a2b40f09.d18fd8","name":"B","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":890,"y":460,"wires":[]},{"id":"2740f15f.cbea9e","type":"function","z":"a2b40f09.d18fd8","name":"CLEAR styles","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nstylesUpdate = function(array) {\n\n   _.each(array, function(arrayItem, arrayIndex){\n       if (arrayItem.hasOwnProperty(\"styles\") &&\n       typeof arrayItem.styles === 'object'\n       ){\n           array[arrayIndex].styles_old = arrayItem.styles\n           oldWidth = array[arrayIndex].styles.width\n           delete  array[arrayIndex].styles\n           array[arrayIndex].styles = {\n               width : oldWidth\n           }\n       }\n       \n       if ( arrayItem.hasOwnProperty(\"columns\") &&\n            Array.isArray(arrayItem.columns)  &&\n            arrayItem.columns.length >  0)\n            {\n               array[arrayIndex].columns =   stylesUpdate( array[arrayIndex].columns)\n            }\n        \n        if ( arrayItem.hasOwnProperty(\"container\") &&\n            Array.isArray(arrayItem.container)  &&\n            arrayItem.container.length >  0)\n            {\n               array[arrayIndex].container =   stylesUpdate( array[arrayIndex].container)\n            }\n        if ( arrayItem.hasOwnProperty(\"content\") &&\n            Array.isArray(arrayItem.content)  &&\n            arrayItem.content.length >  0)\n            {\n               array[arrayIndex].content =   stylesUpdate( array[arrayIndex].content)\n            }\n        if ( arrayItem.hasOwnProperty(\"content\") &&\n            typeof arrayItem.content === \"object\"  &&\n            arrayItem.content.hasOwnProperty(\"container\") &&\n            Array.isArray(arrayItem.content.container)  &&\n            arrayItem.content.container.length >  0\n            )\n            {\n               array[arrayIndex].content.container =   stylesUpdate( array[arrayIndex].content.container)\n            }\n            \n            if ( arrayItem.hasOwnProperty(\"customContent\") &&\n            Array.isArray(arrayItem.customContent)  &&\n            arrayItem.customContent.length >  0)\n            {\n               array[arrayIndex].customContent =   stylesUpdate( array[arrayIndex].customContent)\n            }\n            \n             if ( arrayItem.hasOwnProperty(\"screenProfiles\") &&\n            typeof arrayItem.screenProfiles === \"object\" ){\n                _.each(Object.keys(arrayItem.screenProfiles), function(key, index){\n                    if (arrayItem.screenProfiles[key].hasOwnProperty(\"content\") &&\n                        arrayItem.screenProfiles[key].content.hasOwnProperty(\"container\") &&\n                        Array.isArray(arrayItem.screenProfiles[key].content.container)  &&\n                        arrayItem.screenProfiles[key].content.container.length >  0 )\n                        {\n                           array[arrayIndex].screenProfiles[key].content.container =   stylesUpdate( array[arrayIndex].screenProfiles[key].content.container)\n                        }\n                })\n                \n            }  \n   })\n   \n   \n   \n   return array\n};\n\nmsg.oldPayload = msg.payload\n\nmsg.payload = stylesUpdate(msg.oldPayload)\n\n\n\nreturn msg\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":500,"wires":[["7445b821.81b84","d006d01c.64c73"]]},{"id":"93a104c5.6d253","type":"debug","z":"a2b40f09.d18fd8","name":"A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":460,"wires":[]},{"id":"d786c21a.7337e","type":"function","z":"a2b40f09.d18fd8","name":"Update page","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n    // updateObj = {\n    //                 query : {\n    //                         query :{name:\"Guam\"}, \n    //                         update : { \"$set\" : {newName : new Date()}},\n    //                         options : {upsert: true}\n    //                         },\n    //                 connection:global.get(\"DB_data.connection\"),\n    //                 database:global.get(\"DB_data.appDB\"),\n    //                 collection:'countries',\n    //                 operation:'update', // updateMany , updateOne\n    //                 }\n\n    //         mongodbTools.resolveAsync(updateObj, node, function(res){\n    //                 msg.payload = res\n    //                 node.send(msg) \n    //         }) \n            \nif (msg.payload.hasOwnProperty(\"content\") && \n    msg.payload.hasOwnProperty(\"_id\")\n    ){\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.payload._id)}, \n                            update : {\"$set\":{content: msg.payload.content}}, \n                            options :{upsert:true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'update', // updateMany , updateOne\n                    }\n            \n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            })  \n            \n} else {\n    return msg\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":460,"wires":[["d006d01c.64c73"]]},{"id":"d006d01c.64c73","type":"function","z":"a2b40f09.d18fd8","name":"Loop through page records ","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":1120,"y":500,"wires":[["d786c21a.7337e"],["45e2cc70.b316ec","da1a8b28.ae983"]]},{"id":"45e2cc70.b316ec","type":"debug","z":"a2b40f09.d18fd8","name":"C","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1470,"y":580,"wires":[]},{"id":"2bca907.ccc3ff","type":"function","z":"a2b40f09.d18fd8","name":"Update old_page","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n    // updateObj = {\n    //                 query : {\n    //                         query :{name:\"Guam\"}, \n    //                         update : { \"$set\" : {newName : new Date()}},\n    //                         options : {upsert: true}\n    //                         },\n    //                 connection:global.get(\"DB_data.connection\"),\n    //                 database:global.get(\"DB_data.appDB\"),\n    //                 collection:'countries',\n    //                 operation:'update', // updateMany , updateOne\n    //                 }\n\n    //         mongodbTools.resolveAsync(updateObj, node, function(res){\n    //                 msg.payload = res\n    //                 node.send(msg) \n    //         }) \n            \nif (msg.payload.hasOwnProperty(\"content\") && \n    msg.payload.hasOwnProperty(\"_id\")\n    ){\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.payload._id)}, \n                            update : {\"$set\": msg.payload}, \n                            options :{upsert:true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages_old',\n                    operation:'update', // updateMany , updateOne\n                    }\n            \n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            })  \n            \n} else {\n    return msg\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1630,"y":460,"wires":[["16fc021f.6e6ae6"]]},{"id":"16fc021f.6e6ae6","type":"function","z":"a2b40f09.d18fd8","name":"Loop through page records ","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":1640,"y":500,"wires":[["2bca907.ccc3ff"],["bd6c6da6.ff5d58"]]},{"id":"da1a8b28.ae983","type":"function","z":"a2b40f09.d18fd8","name":"Set oldPayload to msg.payload","func":"msg.payload = msg.oldPayload\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1390,"y":500,"wires":[["16fc021f.6e6ae6"]]},{"id":"bd6c6da6.ff5d58","type":"debug","z":"a2b40f09.d18fd8","name":"DONE CRON","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1910,"y":440,"wires":[]},{"id":"daa9a8e9.835f08","type":"inject","z":"a2b40f09.d18fd8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":680,"y":680,"wires":[["eb57492b.32a1f8"]]},{"id":"eb57492b.32a1f8","type":"function","z":"a2b40f09.d18fd8","name":"get pages ","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nfindManyObj = {\n                    query : {\n                            query :{application_id: new ObjectID(\"5f22ab9e5c29cbe8cc52540c\")}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findManyObj, node, function(res){\n                \n                \n                    msg.payload = res\n                    node.send(msg) \n            }) \n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":680,"wires":[["44b48788.999c48"]]},{"id":"c9ea9e0e.2daa3","type":"function","z":"a2b40f09.d18fd8","name":"Update page","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// check if gouped object key exists\n    var key = \"aa41fd57-1b4d-22d6-3065-a7023676903a\"\n    var newKey = \"8e6ecdb0-ca21-8847-0de3-ae9352d8bd2a\"\n    if (msg.payload.hasOwnPropery(\"groupedObject\") && \n        msg.payload.groupedObject.hasOwnProperty(key)\n            ){\n                msg.payload.groupedObject[newKey] = msg.payload.groupedObject[key]\n                  updateObj = {\n                        query : {\n                                query :{_id:new ObjectID(msg.payload._id)}, \n                                update : {\"$set\":{groupedObject: msg.payload.groupedObject}}, \n                                options :{upsert:true}\n                                },\n                        connection:global.get(\"DB_data.connection\"),\n                        database:global.get(\"DB_data.appDB\"),\n                        collection:'pages',\n                        operation:'update', // updateMany , updateOne\n                        }\n                \n                mongodbTools.resolveAsync(updateObj, node, function(res){\n                        // msg.payload = res\n                        node.send(msg) \n                })  \n            } else {\n         node.send(msg) \n    }\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":660,"wires":[["44b48788.999c48"]]},{"id":"44b48788.999c48","type":"function","z":"a2b40f09.d18fd8","name":"Loop through page records ","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":1160,"y":700,"wires":[["c9ea9e0e.2daa3"],["51132278.37cdec"]]},{"id":"51132278.37cdec","type":"debug","z":"a2b40f09.d18fd8","name":"C DONE","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1420,"y":760,"wires":[]},{"id":"3eaaac4f.be9de4","type":"function","z":"53926ffd.c5a74","name":"Validate","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n        \ntokenState = \"invalid\"\nTokenContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n          \n          TokenContent = decoded\n      }\n    });\n    \n    if (TokenContent.hasOwnProperty(\"key\")){\n       tokenState = \"valid\" \n    }\n    \n    msg.tokenResult = {\n        \n        token : msg.token  ,\n        tokenState : tokenState,\n        key: TokenContent.key, \n        TokenContent:TokenContent\n    }\n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":80,"wires":[[]]},{"id":"41552a5.922cdd4","type":"function","z":"508957a1.dd5398","name":"Generate","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n            msg.PostPayload.content.type = \"unauthorized\"\n            msg.PostPayload.content.key  = new ObjectID()\n            \n            payload = {type : msg.PostPayload.type, token : jsonwebtoken.sign(msg.PostPayload.content, global.get(\"SystemVars.secret\"))};\n            \n            msg.PostPayload.content.token = payload.token\n            \n            msg.payload = payload\n            \n            // update     \n            \n            msg.payload.key =  msg.PostPayload.content.key\n           \nreturn msg;\n    // updateObj = {\n    //                 query : {\n    //                         query :{\n    //                                 revotioSessionId:msg.PostPayload.content.revotioSessionId, \n    //                                 deviceId : msg.PostPayload.content.deviceId\n    //                         }, \n    //                         update : { \"$set\" : msg.PostPayload.content},\n    //                         options : {upsert: true}\n    //                         },\n    //                 connection:global.get(\"DB_data.connection\"),\n    //                 database:global.get(\"DB_data.appDB\"),\n    //                 collection:'sessions',\n    //                 operation:'update', // updateMany , updateOne\n    //                 }\n\n    //         mongodbTools.resolveAsync(updateObj, node, function(res){\n    //               findOneObj = {\n    //                             query : {\n    //                                     query :{revotioSessionId:msg.PostPayload.content.revotioSessionId, \n    //                                             deviceId : msg.PostPayload.content.deviceId} \n    //                                     },\n    //                             connection:global.get(\"DB_data.connection\"),\n    //                             database:global.get(\"DB_data.appDB\"),\n    //                             collection:'sessions',\n    //                             operation:'find',\n    //                             }\n            \n    //                     mongodbTools.resolveAsync(findOneObj, node, function(res){\n    //                         if (res.length > 0){\n    //                             msg.payload.key = res[0]._id\n    //                         } \n                                \n    //                             node.send(msg) \n    //                     })  \n    //         })  \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":1080,"wires":[["ed8a39bb.178cb8","de8d58b0.db8028"]]},{"id":"8cd256fa.8b7098","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":990,"y":1140,"wires":[]},{"id":"ed8a39bb.178cb8","type":"debug","z":"508957a1.dd5398","name":"TOKEN post GENERATE","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":1040,"wires":[]},{"id":"de8d58b0.db8028","type":"function","z":"508957a1.dd5398","name":"Get /Set key","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\nreturn msg;\n// Get key\n\n// if ( typeof msg.payload.TokenContent === \"object\" && \n//     msg.payload.TokenContent.deviceId   && \n//     msg.payload.TokenContent.revotioSessionId\n//     ){\n    \n    \n    \n\n//     findOneObj = {\n//                         query : {\n//                                 query :{\n//                                     revotioSessionId:msg.payload.TokenContent.revotioSessionId,\n//                                     deviceId:msg.payload.TokenContent.deviceId\n//                                 } \n//                                 },\n//                         connection:global.get(\"DB_data.connection\"),\n//                         database:global.get(\"DB_data.appDB\"),\n//                         collection:'sessions',\n//                         operation:'find',\n//                         }\n    \n//                 mongodbTools.resolveAsync(findOneObj, node, function(res){\n//                     if (res.length > 0){\n//                         msg.payload.key = res[0]._id\n//                     } \n    \n//                         node.send(msg) \n//                 })  \n\n// } else {\n//     node.send(msg)\n// }\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1140,"wires":[["8cd256fa.8b7098","4ce2ca4d.4241f4"]]},{"id":"4ce2ca4d.4241f4","type":"debug","z":"508957a1.dd5398","name":"TOKEN post 11","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":860,"y":1080,"wires":[]},{"id":"996a3cfa.05bf8","type":"function","z":"508957a1.dd5398","name":"Token API","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar jsonwebtoken = global.get('jsonwebtoken');\n\nvar generate, validate, key, error;\n\nif (typeof msg.payload === 'string'){\n    payload = JSON.parse(msg.payload)\n    msg.payload = payload;\n} \nif (typeof msg.payload === 'string'){\n    payload = JSON.parse(msg.payload)\n    msg.payload = payload;\n} \nif (typeof msg.payload.content === 'string'){\n    var content = JSON.parse(msg.payload.content)\n    msg.payload.content = content;\n} \n\nmsg.PostPayload  = msg.payload;\n\nmsg.token = msg.PostPayload.token\n\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\n\n        if (msg.PostPayload.type === \"generate\"  && msg.PostPayload.content && msg.PostPayload.content.deviceId){\n\n            generate = msg;\n        } else if (msg.PostPayload.type === \"validate\" &&  msg.PostPayload.token){\n            validate = msg;\n            \n        } else if (msg.PostPayload.type === \"key\" &&  msg.PostPayload.token ){\n            key = msg;\n            \n        } else {\n          error = msg\n        }\n\nreturn [generate, validate, key, error];","outputs":4,"noerr":0,"initialize":"","finalize":"","x":240,"y":1140,"wires":[["41552a5.922cdd4"],["f8b44c33.0e10e8"],["226f35a1.a26af2"],["1d43c493.374b03"]],"outputLabels":["generate","validate","key","error"]},{"id":"379f923d.b717b6","type":"function","z":"508957a1.dd5398","name":"KEY","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ntokenState = \"invalid\"\nTokenContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.PostPayload.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n          tokenState = \"valid\"\n          TokenContent = decoded\n      }\n    });\n    \n    payload = { type:msg.PostPayload.type, token : msg.PostPayload.token  , tokenState : tokenState,key: TokenContent.key }; //, TokenContent:TokenContent\n    \n    msg.payload = payload ;\n    return msg;\n    // findOneObj = {\n    //                             query : {\n    //                                     query :{revotioSessionId:msg.PostPayload.content.revotioSessionId, \n    //                                             deviceId : msg.PostPayload.content.deviceId} \n    //                                     },\n    //                             connection:global.get(\"DB_data.connection\"),\n    //                             database:global.get(\"DB_data.appDB\"),\n    //                             collection:'sessions',\n    //                             operation:'find',\n    //                             }\n            \n    //                     mongodbTools.resolveAsync(findOneObj, node, function(res){\n    //                         if (res.length > 0){\n    //                             msg.payload.key = res[0]._id\n    //                         } \n                        //   node.send(msg)  \n                        // })\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":1160,"wires":[["de8d58b0.db8028","362e9b63.4d47e4"]]},{"id":"1d43c493.374b03","type":"function","z":"508957a1.dd5398","name":"error","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = \"invalid post request - type\";\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":1200,"wires":[["8cd256fa.8b7098"]]},{"id":"981105c.76618f8","type":"debug","z":"508957a1.dd5398","name":"TOKEN post Validate","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":660,"y":1080,"wires":[]},{"id":"362e9b63.4d47e4","type":"debug","z":"508957a1.dd5398","name":"TOKEN post KEY","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":1180,"wires":[]},{"id":"f8b44c33.0e10e8","type":"subflow:53926ffd.c5a74","z":"508957a1.dd5398","name":"","env":[],"x":400,"y":1120,"wires":[["981105c.76618f8","14c396a8.50ea69"]]},{"id":"14c396a8.50ea69","type":"function","z":"508957a1.dd5398","name":"Validate","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n    \n    msg.payload = { type:msg.PostPayload.type, token : msg.tokenResult.token  , tokenState : msg.tokenResult.tokenState,key: msg.tokenResult.key }; // TokenContent:TokenContent\n    \n   \n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":1120,"wires":[["de8d58b0.db8028"]]},{"id":"226f35a1.a26af2","type":"subflow:53926ffd.c5a74","z":"508957a1.dd5398","name":"","env":[],"x":400,"y":1160,"wires":[["379f923d.b717b6"]]},{"id":"7eafc839.978f28","type":"http response","z":"508957a1.dd5398","name":"","statusCode":"","headers":{},"x":450,"y":1040,"wires":[]},{"id":"f17c765e.408ab8","type":"function","z":"508957a1.dd5398","name":"Token API","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar jsonwebtoken = global.get('jsonwebtoken');\n\n\n\nif (typeof msg.payload === 'string'){\n    var payload = JSON.parse(msg.payload)\n    msg.payload = payload;\n} \nif (typeof msg.payload === 'string'){\n    payload = JSON.parse(msg.payload)\n    msg.payload = payload;\n} \nif (typeof msg.payload.content === 'string'){\n    var content = JSON.parse(msg.payload.content)\n    msg.payload.content = content;\n} \n\nPostPayload = msg.payload;\n\n        if (PostPayload.type === \"generate\"  && PostPayload.content && PostPayload.content.deviceId){\n          \n            PostPayload.content.type = \"unauthorized\"\n            payload = {token : jsonwebtoken.sign(PostPayload.content, global.get(\"SystemVars.secret\"))};\n            \n            msg.payload = payload\n        } else if (PostPayload.type === \"validate\" &&  PostPayload.token){\n        \n            tokenState = \"invalid\"\n            TokenContent = {};\n            // verify a token symmetric\n                jsonwebtoken.verify(PostPayload.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n                  if (decoded !== undefined){\n                      tokenState = \"valid\"\n                      TokenContent = decoded\n                  }\n                });\n                \n                payload = { token : PostPayload.token  , tokenState : tokenState, TokenContent:TokenContent };\n                \n                msg.payload = payload ;\n        } else {\n            msg.payload = \"invalid post request - type\";\n        }\n\n\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\n\n   msg.PostPayload = PostPayload \n    \n\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":1040,"wires":[["7eafc839.978f28"]]},{"id":"f6b3771f.d41548","type":"function","z":"508957a1.dd5398","name":"Set msg.token","func":"\nmsg.token = msg.payload.token\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":200,"wires":[["64e3cabd.69b9a4"]]},{"id":"c56320d9.082008","type":"function","z":"508957a1.dd5398","name":"Decrypt","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n        \ndataState = \"invalid\"\ndataContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.payload.data, msg.tokenResult.key, function(err, decoded) {\n      if (decoded !== undefined){\n          dataState = \"valid\"\n          dataContent = decoded\n      }\n    });\n    \n    msg.dataResult = {\n        \n        data : msg.payload.data  ,\n        dataState : dataState,\n        key: msg.tokenResult.key, \n        dataContent:dataContent\n    }\n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":200,"wires":[["bbdc3383.cf54c8","eed30f49.b6e39"]]},{"id":"64e3cabd.69b9a4","type":"subflow:53926ffd.c5a74","z":"508957a1.dd5398","name":"","env":[],"x":800,"y":200,"wires":[["c56320d9.082008"]]},{"id":"13c4294b.23613f","type":"function","z":"508957a1.dd5398","name":"Set msg.token","func":"\nmsg.token = msg.payload.token\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":520,"wires":[["e9fecf9f.d34c5"]]},{"id":"de8fb949.f20788","type":"function","z":"508957a1.dd5398","name":"Decrypt","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n        \ndataState = \"invalid\"\ndataContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.payload.data, msg.tokenResult.key, function(err, decoded) {\n      if (decoded !== undefined){\n          dataState = \"valid\"\n          dataContent = decoded\n      }\n    });\n    \n    msg.dataResult = {\n        \n        data : msg.payload.data  ,\n        dataState : dataState,\n        key: msg.tokenResult.key, \n        dataContent:dataContent\n    }\n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":520,"wires":[["8cd48535.9010d8","12a86303.f876ed"]]},{"id":"e9fecf9f.d34c5","type":"subflow:53926ffd.c5a74","z":"508957a1.dd5398","name":"","env":[],"x":500,"y":520,"wires":[["de8fb949.f20788"]]},{"id":"1d0b4bad.c78bcc","type":"function","z":"508957a1.dd5398","name":"Set msg.token","func":"\nmsg.token = msg.payload.token\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":720,"wires":[["89178cce.64905"]]},{"id":"7f2dce42.419168","type":"function","z":"508957a1.dd5398","name":"Decrypt","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n        \ndataState = \"invalid\"\ndataContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.payload.data, msg.tokenResult.key, function(err, decoded) {\n      if (decoded !== undefined){\n          dataState = \"valid\"\n          dataContent = decoded\n      }\n    });\n    \n    msg.dataResult = {\n        \n        data : msg.payload.data  ,\n        dataState : dataState,\n        key: msg.tokenResult.key, \n        dataContent:dataContent\n    }\n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":720,"wires":[["bb744419.3b4b","d9a31cb4.de7588"]]},{"id":"89178cce.64905","type":"subflow:53926ffd.c5a74","z":"508957a1.dd5398","name":"","env":[],"x":490,"y":720,"wires":[["7f2dce42.419168"]]},{"id":"843a9ad4.9424b8","type":"function","z":"508957a1.dd5398","name":"Encrypt data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\npayload = {\n    data : jsonwebtoken.sign(msg.payload, msg.tokenResult.key),\n    token:msg.payload.token,\n    // revotioSessionId:msg.payload.revotioSessionId ,\n    // deviceId: msg.payload.deviceId\n}\n\nmsg.payload = payload\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":1100,"wires":[["cf8d96f9.9c98d"]]},{"id":"4c1b020f.633964","type":"function","z":"508957a1.dd5398","name":"Set msg.token","func":"msg.token = msg.payload.token\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1920,"y":1100,"wires":[["eb4d6343.533e18"]]},{"id":"eb4d6343.533e18","type":"subflow:53926ffd.c5a74","z":"508957a1.dd5398","name":"","env":[],"x":2080,"y":1100,"wires":[["843a9ad4.9424b8"]]},{"id":"2dee3212.2703a6","type":"function","z":"e25f5e2d.45871","name":"Set msg.token","func":"msg.token = msg.payload.token\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":120,"wires":[["6d7694a6.cb54cc"]]},{"id":"b991d80a.80afa","type":"function","z":"e25f5e2d.45871","name":"Encrypt data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\npayload = {\n    \n    data : jsonwebtoken.sign(msg.payload, msg.tokenResult.key),\n    token:msg.payload.token,\n    // revotioSessionId:msg.payload.revotioSessionId ,\n    // deviceId: msg.payload.deviceId\n}\n// msg.payload.data = payload.data\n\nmsg.payload = payload\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1430,"y":120,"wires":[["9690ddef.823e3"]]},{"id":"6d7694a6.cb54cc","type":"subflow:53926ffd.c5a74","z":"e25f5e2d.45871","name":"","x":1280,"y":120,"wires":[["b991d80a.80afa"]]},{"id":"eed30f49.b6e39","type":"debug","z":"508957a1.dd5398","name":"ENTERANCE post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1230,"y":180,"wires":[]},{"id":"3fabef5c.663f88","type":"inject","z":"508957a1.dd5398","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":780,"y":1900,"wires":[["89d60b53.ef9038"]]},{"id":"89d60b53.ef9038","type":"function","z":"508957a1.dd5398","name":"Libs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\nvar unzipper =  global.get('unzipper')","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":1860,"wires":[[]]},{"id":"f271110d.9e9e4","type":"comment","z":"e25f5e2d.45871","name":"Push Gadgets to frontend","info":"","x":430,"y":780,"wires":[]},{"id":"219babd.a507d54","type":"function","z":"e25f5e2d.45871","name":"Get gadgetContainers Object","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar response, sessionUpdate , timer ;\nvar totalNumberOfGadgets, currentNumberOfGadgets;\nvar deviceId = msg.session.deviceId ; \nvar revotioSessionId = msg.session.revotioSessionId ;\nvar token = msg.session.token ;\n\nmsg.test = []\n\nmsg.page =  msg.session.Page\n\nmsg.endtime = new Date()\n\nglobal.set(\"communication.lastMessage\",new Date())\nif (global.get(\"communication\").hasOwnProperty(msg.session._id) === false\n){\n    if (msg.timer === false){\n        global.set(\"communication.lastIDSet\",new Date())\n        global.set(\"communication.\"+msg.session._id,{date: new Date(), diff :0, counter : 0})\n        msg.first = true\n    }\n    \n} else {\n    if (msg.hasOwnProperty(\"first\") === false){\n        msg.first = false\n    }\n    diff = moment(new Date()).diff(moment(global.get(\"communication.\"+msg.session._id+\".date\")))\n    global.set(\"communication.\"+msg.session._id +\".diff\",diff)\n    global.set(\"communication.\"+msg.session._id +\".counter\", global.get(\"communication.\"+msg.session._id+\".counter\")+ 1)\n   \n}\n\n\n// msg.test.push({level:2})\nif (msg.session.groupedObject.hasOwnProperty(msg.RevotioData.entity) === true){\n    msg.test.push({level:3.1})\n    totalNumberOfGadgets = msg.session.groupedObject[msg.RevotioData.entity].length\n    msg.test.push({level:3.2})\n} else {\n    msg.test.push({level:4.1})\n    totalNumberOfGadgets = msg.session.groupedObject.INIT.length\n    totalNumberOfGadgets = global.get('gadgetGroups.' + deviceId + \".\" + revotioSessionId+\".groupedObject.INIT\").length\n    msg.test.push({level:4.2})\n}\n\ncurrentNumberOfGadgets = msg.session.Gadgets.length\n\nif (    global.get(\"communication\").hasOwnProperty(msg.session._id) === true &&\n        ( totalNumberOfGadgets <= currentNumberOfGadgets  || \n        global.get(\"communication.\"+msg.session._id+\".diff\" )> global.get(\"SystemVars.responseTimeout\"))\n){\n  \n    global.set(\"communication.\"+msg.session._id)\n    msg.payload = {\n        deviceId: deviceId,\n        revotioSessionId: revotioSessionId,\n        token: token,\n        starttime: msg.starttime,\n        gadgetsList : msg.session.Gadgets,\n        Type: \"Update\"\n    }\n    \n    msg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n    };\n\n    response = msg; \n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.session._id)}, \n                            update : { \"$set\" : {Gadgets : [],\n                                                timestamp: new Date(),\n                                                responseSend : false\n                            }},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n            })  \n   \n\nresponse = {\n    pageName: msg.RevotioData.FlowData.pageName,\n    req : msg.req,\n    res : msg.res,\n    payload : msg.payload,\n    headers : msg.headers,\n    page:msg.page,\n    session_id : msg.session._id,\n    page_session_id : msg.page_session_id\n}\nsessionUpdate = msg;\n\nreturn [response, sessionUpdate] } \n\nelse if (global.get(\"communication\").hasOwnProperty(msg.session._id) === true && msg.first === true){ \n    \n        msg.timer = true\n        timer = msg;\n    return [response, sessionUpdate,timer];\n}\n\n","outputs":3,"noerr":0,"initialize":"","finalize":"","x":950,"y":860,"wires":[["ef1059a8.d05948"],["dbf0599f.517e68"],["a1856f5c.b3ab5"]],"outputLabels":["response","sessionUpdate","timer"]},{"id":"908c12c2.38f67","type":"http response","z":"e25f5e2d.45871","name":"","statusCode":"","headers":{},"x":1790,"y":780,"wires":[]},{"id":"84eaf62d.794378","type":"comment","z":"e25f5e2d.45871","name":"Generate response Object","info":"","x":450,"y":700,"wires":[]},{"id":"dbf0599f.517e68","type":"function","z":"e25f5e2d.45871","name":"Update DB Session object","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nObj =  {FlowData: msg.RevotioData.FlowData, timestamp : new Date(), Gadgets:[], \n};\n\n if (msg.session.groupedObject.hasOwnProperty(msg.RevotioData.entity)){\n                                     grouped_object_gadgets =  msg.session.groupedObject[msg.RevotioData.entity].length\n                                } else {\n                                    grouped_object_gadgets = -1\n                                }\n\nstats_obj = {\n                                page : msg.RevotioData.session.Page,\n                                application_id : global.get(\"applicationId\"), \n                                entity : msg.RevotioData.entity,\n                                gadgets: msg.payload.gadgetsList.length,\n                                grouped_object_gadgets:grouped_object_gadgets,\n                                starttime : new Date(msg.starttime),\n                                reponse_send_at : new Date(),\n                                reponse_send : true,\n                                time_needed_ms :  moment().diff(moment(msg.starttime)),\n                                session : new ObjectID(msg.session._id),\n                            }\n                            \nif (msg.session.user_id && msg.session.user_id){\n    stats_obj.user  =  new ObjectID(msg.session.user_id)\n}\n// msg.payload = [{deviceId: msg.RevotioData.session.deviceId, revotioSessionId: msg.RevotioData.session.revotioSessionId},{\"$set\" : Obj},{upsert : true}];\n\n// msg.operation = 'updateOne';\n\n// update    \n    updateObj = {\n                    query : {\n                            query :{deviceId: msg.RevotioData.session.deviceId, revotioSessionId: msg.RevotioData.session.revotioSessionId}, \n                            update : {\"$set\" : Obj,\n                                     \"$unset\": {last_gadgets_update :''}\n                            },\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n                     \n                        mongodbTools.resolveAsync(updateObj, node, function(res){\n                            \n                              \n                        \n               \n                           updateObj = {\n                                query : {\n                                        query : stats_obj , \n                                        update : {\"$set\" : stats_obj\n                                                \n                                        },\n                                        options : {upsert: true}\n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'system_stats',\n                                operation:'update', // updateMany , updateOne\n                                }\n            \n                        mongodbTools.resolveAsync(updateObj, node, function(res){\n                                // msg.result = res\n                                // node.send(msg) \n                        })  \n            })  \n            \n            \n// return msg;","outputs":1,"noerr":0,"x":1580,"y":860,"wires":[[]]},{"id":"e0bfa97f.699338","type":"function","z":"e25f5e2d.45871","name":"Update && Get session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// reset msg object\n\nRevotioData = msg.RevotioData\npayload = msg.payload\nres = msg.res\nreq = msg.req\nstarttime = msg.starttime\nstarttime2 = msg.starttime2\nstarttime3= msg.starttime3\ncommunicationData = msg.communicationData\n\nmsg = {\n    payload:payload,\n    RevotioData:RevotioData,\n    res : res,\n    req : req,\n    starttime : starttime,\n    starttime2:starttime2,\n    starttime3:msg.starttime3,\n    communicationData : communicationData\n}\n\n// check if its dev env\n// if (env.get(\"PREFORMANCE_CHECK\") && env.get(\"PREFORMANCE_CHECK\") === true){\n    _.each(msg.payload.gadgetsList, function(item,index){\n        item.starttime      = msg.starttime \n        item.starttime2      = msg.starttime2 \n        item.starttime3      = msg.starttime3\n        item.starttime_2_diff       = moment(item.starttime2).diff(moment(msg.starttime))\n         item.starttime2_3_diff       = moment(item.starttime3).diff(moment(msg.starttime2))\n        item.endtime        = new Date() \n        // item.endtimeMS      = item.endtime.getTime()\n        \n        // if (msg.starttime && typeof  msg.starttime === \"date\"){\n        item.timediff       = moment(item.endtime).diff(moment(msg.starttime))\n        // }\n    })\n\n// }\n\nmsg.timer = false\n\nupdateObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.RevotioData.session._id)}, \n                            update : { \"$set\": {last_gadgets_update : new Date()}, \"$push\": { Gadgets: { \"$each\": msg.payload.gadgetsList } }},\n                            options : {upsert: true, returnOriginal: false}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'findOneAndUpdate', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                \n                if (typeof res === 'object' && res.hasOwnProperty(\"value\")){\n                     msg.session = res.value\n \n                    node.send(msg) \n                   \n                }\n            \n            \n            }) \n            \n            \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":840,"wires":[["2c50c9cd.f23216"]]},{"id":"ef1059a8.d05948","type":"function","z":"e25f5e2d.45871","name":"Set response","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\n\n// check if its dev env\n// if (env.get(\"PREFORMANCE_CHECK\") && env.get(\"PREFORMANCE_CHECK\") === true){\n    msg.payload.endtime         = new Date() \n    msg.payload.starttime       = msg.payload.starttime\n    msg.payload.timediff        = moment(msg.payload.endtime).diff(moment(msg.payload.starttime))\n    \n    gadgetsList = lodash.orderBy(msg.payload.gadgetsList, [\"endtime\"], [\"desc\"]);\n    \n    \n    msg.payload.gadgetsList = gadgetsList;\n    msg.payload.included = []\n    _.each(gadgetsList, function(item, index){\n        msg.payload.included.push(item.gadgetName)\n    })\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":780,"wires":[["42e145ce.35792c"]]},{"id":"a1856f5c.b3ab5","type":"delay","z":"e25f5e2d.45871","name":"","pauseType":"delayv","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":640,"y":940,"wires":[["e867f54d.fd61b8"]]},{"id":"e867f54d.fd61b8","type":"function","z":"e25f5e2d.45871","name":"Get session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nfindOneObj = {\n                    query : {\n                            query :{\n                                        _id:new ObjectID(msg.RevotioData.session._id)\n                            } \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.session = res[0]\n                } else {\n                    msg.session = {}\n                }\n                    \n                    // if (    msg.sessionNew.hasOwnProperty(\"Gadgets\") &&\n                    //         msg.sessionNew.Gadgets.length ===  msg.session.Gadgets.length \n                    // ){\n                        node.send(msg) \n                    // }\n            })  ","outputs":1,"noerr":0,"x":970,"y":940,"wires":[["219babd.a507d54"]]},{"id":"70b60a73.38b344","type":"function","z":"e25f5e2d.45871","name":"Encrypt data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar a,b \ntime = new Date()\npayload = {\n    pageName : msg.pageName,\n    data : jsonwebtoken.sign(msg.payload, msg.tokenResult.key),\n    token:msg.payload.token,\n    // revotioSessionId:msg.payload.revotioSessionId ,\n    // deviceId: msg.payload.deviceId\n}\nb =  {payload : msg.payload, pageName : msg.pageName ,time:time,page:msg.page, page_session_id:msg.page_session_id}\n\nmsg.payload = payload\na = msg\nreturn [a,b];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1510,"y":780,"wires":[["908c12c2.38f67"],["883ea83c.e0ee48"]]},{"id":"42e145ce.35792c","type":"function","z":"e25f5e2d.45871","name":"Set msg.token && Remove sessin","func":"msg.token = msg.payload.token\n global.set(\"userData.\"+msg.session_id)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":780,"wires":[["16db64b2.5ab03b"]]},{"id":"883ea83c.e0ee48","type":"function","z":"e25f5e2d.45871","name":"save payload to fs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// generate json title\nfs.ensureDirSync('/files/renderFiles/')\n\nfs.removeSync('/files/renderFiles/'+msg.page+'.json')\n\ntimeDiffs = {timediff: msg.payload.timediff}\n\n_.each(msg.payload.gadgetsList, function(gadget, index){\n   timeDiffs[gadget.gadgetName] = {\n       type: gadget.gadgetType,\n       starttime : gadget.starttime,\n       starttime2 : gadget.starttime2,\n       starttime3 : gadget.starttime3,\n       starttime_2_diff : gadget.starttime_2_diff,\n       starttime2_3_diff : gadget.starttime2_3_diff,\n       endtime : gadget.endtime,\n       timediff : gadget.timediff,\n   }\n})\n\nfs.writeJsonSync('/files/renderFiles/'+msg.page+'.json', {timeDiffs:timeDiffs,\n                                                            payload: msg.payload,\n                                                            startEnc : msg.time,\n                                                            writefile : new Date()\n})\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{page:msg.page,date:new Date()}, \n                            update : { \"$set\" : timeDiffs},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'preformance',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    // node.send(msg) \n            })  \n\n\n\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{_id :new ObjectID(msg.page_session_id)}, \n                            update : { \"$set\" : {pageName : msg.pageName , gadgetsList : msg.payload.gadgetsList}},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'page_load_sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                //   msg.payload = payload\n                //     node.send(msg) \n            })  \n            \n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1830,"y":820,"wires":[[]]},{"id":"2c50c9cd.f23216","type":"function","z":"e25f5e2d.45871","name":"Get page_load_session_id","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n   \n   if (msg.RevotioData.FlowData.hasOwnProperty(\"page_session_id\")){\n        msg.page_session_id = msg.RevotioData.FlowData.page_session_id\n        node.send(msg) \n   } else {\n       \n       // aggregate\n\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {deviceId: msg.RevotioData.session.deviceId, revotioSessionId: msg.RevotioData.session.revotioSessionId} ,\n                                },\n                                 { \n                                    \"$sort\" : { \n                                        \"date\" : 1.0\n                                    }\n                                },\n                                 { \n                                    \"$limit\" : 1.0\n                                }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'page_load_sessions',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    if (res.length > 0){\n                         msg.page_session_id = res[0]._id\n                    } else {\n                         msg.page_session_id = \"\"\n                    }\n                   \n                    node.send(msg) \n            })  \n            \n   }     \n \n         ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":840,"wires":[["219babd.a507d54"]]},{"id":"2968cd86.c7a2e2","type":"function","z":"8e853889.7b4f78","name":"prepair redirect","func":"\n\nmsg.payload = {\n    Page : msg.RevotioData.session.Page,\n    RevotioData :{\n        organization_id: msg.RevotioData.FlowData.organization_id,\n        application_id : msg.RevotioData.FlowData.application_id,\n        page_id : msg.RevotioData.FlowData.page_id,\n        item_id : msg.RevotioData.FlowData.item_id,\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":80,"wires":[[]]},{"id":"929d18e2.fbc3d8","type":"http request","z":"5e9b9c1d.bbe4a4","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","authType":"basic","x":870,"y":320,"wires":[["51296018.a353e"]]},{"id":"c84e6b09.3e90f8","type":"function","z":"5e9b9c1d.bbe4a4","name":"Prepair redirect (subflow)","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nmsg.payload = {\n    RevotioData : msg.RevotioData,\n    payload : msg.payload\n}\n\nif (!msg.payload.payload.Page ){\n    msg.payload.payload.Page = global.get(\"DomainProperties.DefaultPage\")\n    msg.test123 = new Date()\n}\n\n msg.url = global.get(\"DomainProperties.url\") + \"/redirect\"\n \n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":320,"wires":[["929d18e2.fbc3d8","a8ff24ce.78ef88"]]},{"id":"51296018.a353e","type":"json","z":"5e9b9c1d.bbe4a4","name":"","property":"payload","action":"","pretty":false,"x":1030,"y":320,"wires":[["63d247bf.b18858"]]},{"id":"ed71d4e8.3fb4c8","type":"function","z":"5e9b9c1d.bbe4a4","name":"Encrypt data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\npayload = {\n    data : jsonwebtoken.sign(msg.payload, msg.tokenResult.key),\n    token:msg.payload.token,\n    pageSessionId:msg.page_session_id,\n    pageName :global.get(\"env.TYPE\")\n};\n\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{_id :new ObjectID(msg.page_session_id)}, \n                            update : { \"$set\" : {pageObject : msg.payload,}},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'page_load_sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                  msg.payload = payload\n                    node.send(msg) \n            })  \n            \n            \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":560,"wires":[["fbd33a95.d055b8"]]},{"id":"63d247bf.b18858","type":"function","z":"5e9b9c1d.bbe4a4","name":"Set msg.token","func":"msg.token = msg.payload.token\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":480,"wires":[["b56ba393.ca4dc"]]},{"id":"3df42567.71eeca","type":"function","z":"5e9b9c1d.bbe4a4","name":"Get page_load_session_id","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n   \n   if (msg.payload.hasOwnProperty(\"RevotioData\") && \n        msg.payload.RevotioData.hasOwnProperty(\"page_session_id\")){\n        msg.page_session_id = msg.payload.RevotioData.page_session_id \n        node.send(msg) \n   } else {\n       \n       // aggregate\n\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {deviceId: msg.payload.deviceId, revotioSessionId: msg.payload.revotioSessionId} ,\n                                },\n                                 { \n                                    \"$sort\" : { \n                                        \"date\" : 1.0\n                                    }\n                                },\n                                 { \n                                    \"$limit\" : 1.0\n                                }\n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'page_load_sessions',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                    if (res.length > 0){\n                         msg.page_session_id = res[0]._id\n                    } else {\n                         msg.page_session_id = \"\"\n                    }\n                   \n                    node.send(msg) \n            })  \n            \n   }     \n \n         ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1127,"y":595,"wires":[["ed71d4e8.3fb4c8"]]},{"id":"b56ba393.ca4dc","type":"subflow:53926ffd.c5a74","z":"5e9b9c1d.bbe4a4","name":"","env":[],"x":970,"y":500,"wires":[["3df42567.71eeca"]]},{"id":"fbd33a95.d055b8","type":"http response","z":"5e9b9c1d.bbe4a4","name":"","statusCode":"","headers":{},"x":1570,"y":560,"wires":[]},{"id":"4d81e47d.d8780c","type":"function","z":"d237f7f5.48aae8","name":"google translate","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar Translate = global.get('google_translate.v2.Translate')\nCREDENTIALS= fs.readJsonSync(global.get(\"DomainProperties.rootBackendFolder\")+\"googleFiles/pno-pmt-credentials.json\");\n\n// Configuration for the client\ntranslate = new Translate({\n    credentials: CREDENTIALS,\n    projectId: CREDENTIALS.project_id\n});\n\n// check && set globalContext object\n\nif (global.get(\"translateArrays\") === false){\n  global.set(\"translateArrays\", {})  \n}\n\narray = msg.payload\n\nvar contextID = new ObjectID()\n\nvar contextObject = {\n    input:msg.payload,\n    output:[],\n    counter:0,\n    started:new Date(),\n    errors:[]\n}\n\nmsg.contextID = contextID\n\nglobal.set(\"translateArrays.\"+contextID, contextObject)\n\n\n_.each(global.get(\"translateArrays.\"+contextID+\".input\"), function(item, index){\n              \n                const detectLanguage = async (text) => {\n                \n                    try {\n                        let response = await translate.detect(text);\n                        return response[0].language;\n                    } catch (error) {\n                        console.log(`Error at detectLanguage --> ${error}`);\n                        return 0;\n                    }\n                }\n                var textVar = item.key\n                var targetLanguageVar = \"nl\"\n                \n                \n                // detectLanguage(textVar)\n                //     .then((res) => {\n                //         global.set(\"translateArrays.\"+contextID+'.input['+index+'].keyLang', res)\n                //         global.set(\"translateArrays.\"+contextID+'.input['+index+'].keyLangState', \"success\")\n                //     })\n                //     .catch((err) => {\n                //         global.set(\"translateArrays.\"+contextID+'.errors['+index+']', item)\n                //         global.set(\"translateArrays.\"+contextID+'.errors['+index+'].keyLang', \"unknown\")\n                //         global.set(\"translateArrays.\"+contextID+'.errors['+index+'].keyLangState', err)\n                //         global.set(\"translateArrays.\"+contextID+\".[\"+index+\"]\", \"error\")\n                //     });\n                \n                const translateText = async (text, targetLanguage) => {\n                \n                    try {\n                        let [response] = await translate.translate(text, targetLanguage);\n                        return response;\n                    } catch (error) {\n                        console.log(`Error at translateText --> ${error}`);\n                        return 0;\n                    }\n                };\n\n              translateText(textVar, targetLanguageVar)\n                              .then((res) => {\n                                  item.value = res;\n                                  item.valueState = \"success\";\n                                  item.ended = new Date();\n                                  global.set(\"translateArrays.\"+contextID+'.output['+Number(global.get(\"translateArrays.\"+contextID+'.output').length)+']',item);\n                                    // global.set(\"translateArrays.\"+contextID+'.output['+index+'].', ) \n                                    // global.set(\"translateArrays.\"+contextID+'.output['+index+'].valueState', \"success\")\n                                    // global.set(\"translateArrays.\"+contextID+'.output['+index+'].ended', new Date())\n                                    // global.set(\"translateArrays.\"+contextID+'.counter', Number(global.get(\"translateArrays.\"+contextID+'.counter') + 1))\n                                         })\n                                .catch((err) => {\n                                    item.value =  \"unknown\";\n                                    item.valueState =err;\n                                    item.ended = new Date();\n                                    global.set(\"translateArrays.\"+contextID+'.errors['+ Number(global.set(\"translateArrays.\"+contextID+'.errors').length)+']',  item);\n                                    // global.set(\"translateArrays.\"+contextID+'.errors['+index+']',  global.get(\"translateArrays.\"+contextID+'.output['+index+']'))\n                                    // global.get(\"translateArrays.\"+contextID+'.output['+index+']')\n                                    // global.set(\"translateArrays.\"+contextID+'.errors['+index+'].value', \"unknown\")\n                                    // global.set(\"translateArrays.\"+contextID+'.errors['+index+'].valueState', err)\n                    });\n         \n})\n\n// global.set(\"translateArrays.\"+contextID)\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":100,"wires":[["fc945726.b18378"]]},{"id":"fc945726.b18378","type":"delay","z":"d237f7f5.48aae8","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":430,"y":140,"wires":[["7a7fc4.02c9e03c"]]},{"id":"7a7fc4.02c9e03c","type":"function","z":"d237f7f5.48aae8","name":"check if done","func":"var done, notDone;\nif (global.get(\"translateArrays.\"+msg.contextID+\".input\").length ===( global.get(\"translateArrays.\"+msg.contextID+\".output\").length + global.get(\"translateArrays.\"+msg.contextID+\".errors\").length)){\n    payload = global.get(\"translateArrays.\"+msg.contextID)\n    msg.payload = {\n        input:payload.input,\n        output:payload.output,\n        errors: payload.errors,\n        counter: payload.counter,\n    }\n    global.set(\"translateArrays.\"+msg.contextID)\n    delete msg.contextID\n    done = msg\n}else {\n     notDone = msg\n}\n\nreturn [ done, notDone];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":440,"y":80,"wires":[[],["fc945726.b18378","79caccb8.54f4b4"]],"outputLabels":[" done,","notDone"]},{"id":"79caccb8.54f4b4","type":"debug","z":"d237f7f5.48aae8","name":"Delay","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":600,"y":220,"wires":[]},{"id":"cc51476b.f74068","type":"function","z":"ab79407.ded3ec","name":"Remove user sessions","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// remove \n            removeObj = {\n                    query : {\n                            query :{\n                                        deviceId : msg.RevotioData.session.deviceId ,\n                                        revotioSessionId: msg.RevotioData.session.revotioSessionId\n                                    }, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            })   ","outputs":1,"noerr":0,"x":200,"y":80,"wires":[["8079266c.457568"]]},{"id":"8079266c.457568","type":"function","z":"ab79407.ded3ec","name":"remove global comntext sessions","func":"global.set(\"gadgetGroups.\"+ msg.RevotioData.session.deviceId)\n\nmsg.payload = {\n    RevotioData:{\n    logout : true,},\n    deviceId: msg.RevotioData.session.deviceId,\n    // revotioSessionId : msg.RevotioData.session.revotioSessionId\n}\n\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":80,"wires":[["fffbd167.a730d"]]},{"id":"fffbd167.a730d","type":"http response","z":"ab79407.ded3ec","name":"","statusCode":"","headers":{},"x":650,"y":80,"wires":[]},{"id":"c2d92f7a.f4f5e","type":"function","z":"be61da9a.8b3cd8","name":"save error in error collection","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar fs = global.get('fsextra');\nvar mime = global.get('mime');\n\nObj = {\n        data:{\n            payload:msg.payload,\n            RevotioData:msg.RevotioData,\n            error : msg.error,\n            statusCode:msg.statusCode,\n            url:msg.url,\n            starttime : msg.starttime,\n            \n        },\n        date  :new Date(),\n        app : global.get(\"applicationId\"),\n        type:\"backend_error\"\n}\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :Obj, \n                            update : { \"$set\" : Obj},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'errors',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    // msg.payload =   {\n                    //                     msg: payload,\n                    //                     state:  \"error processed\"\n                    //                 }\n                       \n                    node.send(msg) \n            })  ","outputs":1,"noerr":0,"x":680,"y":60,"wires":[[]]},{"id":"e3d59bbe.0b2068","type":"function","z":"be61da9a.8b3cd8","name":"Create ERROR json file ","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// ensure error dir\nfs.ensureDirSync(global.get(\"DomainProperties.rootPath\")+\"errors\")\n\nerrorFileName = new Date()\n\nfs.writeJsonSync(global.get(\"DomainProperties.rootPath\")+\"errors/\" + errorFileName +\".json\", JSON.stringify({error : msg.error, RevotioData: msg.RevotioData, payload: msg.payload}))\n\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":260,"wires":[[]]},{"id":"dd5ad5f8.cf8828","type":"function","z":"be61da9a.8b3cd8","name":"Route error","func":"var logout , other;\n\nif (msg.error.source.name === \"Get session data\"){\n    msg.RevotioData = {session : {\n        deviceId:msg.tokenResult.TokenContent.deviceId,\n        revotioSessionId:msg.tokenResult.TokenContent.revotioSessionId\n    }}\n    logout = msg\n} else {\n    other = msg\n}\nreturn [logout , other];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":270,"y":180,"wires":[["c698c66.c151138"],["e3d59bbe.0b2068"]],"outputLabels":["logout","other"]},{"id":"c698c66.c151138","type":"subflow:ab79407.ded3ec","z":"be61da9a.8b3cd8","name":"","env":[],"x":450,"y":120,"wires":[]},{"id":"5abccab0.40a034","type":"function","z":"22428f45.8ab","name":"Get Page object","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\n// set all response data\nmsg.responseObj                     = msg.payload;\nmsg.responseObj.deviceId            = msg.RevotioData.session.deviceId ;\nmsg.responseObj.revotioSessionId    = msg.RevotioData.session.revotioSessionId ;\nmsg.responseObj.user_id             = msg.RevotioData.session.user_id ;\nmsg.responseObj.applicationId       = new ObjectID(global.get(\"applicationId\"));\nmsg.responseObj.token               = msg.RevotioData.session.token;\nmsg.responseObj.Page                = msg.payload.Page.toLowerCase().trim();//.replace(/^\\s*|\\s*$/g, '');\n// msg.payload.Page                    = msg.responseObj.Page;\n\nmsg.headers = {};\nmsg.rejectUnauthorized =  false;\n\n\n\nreturn msg;\n\n// if (    msg.responseObj.Page === \"project overview\" && \n//         msg.responseObj.hasOwnProperty(\"RevotioData\") &&\n//         msg.responseObj.RevotioData.hasOwnProperty(\"project_id\") ){\n    \n//     // get funding_scheme object\n    \n//     // aggregate\n//             aggregateObj = {\n//                     query : { query : [{\n//                                 $match: {\n//                                   \"_id\": new ObjectID(msg.responseObj.RevotioData.project_id),\n                                \n//                                 }\n//                               },\n//                               {\n//                                 $lookup: {\n//                                   \"from\": \"settings\",\n//                                   \"localField\": \"funding_scheme\",\n//                                   \"foreignField\": \"_id\",\n//                                   \"as\": \"funding_scheme_data\"\n//                                 }\n//                               },\n                 \n//                               {\n//                                 $unwind: {\n//                                   \"path\": \"$funding_scheme_data\",\n//                                   \"includeArrayIndex\": \"arrayIndex\",\n//                                   \"preserveNullAndEmptyArrays\": false\n//                                 }\n//                               }\n//                             ],},\n//                     connection:global.get(\"DB_data.connection\"),\n//                     database:global.get(\"DB_data.appDB\"),\n//                     collection:'projects',\n//                     operation:'aggregate',\n//                     }\n                    \n//             mongodbTools.resolveAsync(aggregateObj, node, function(res){\n//                     // if (Array.isArray(res)=== true && res.length>0 && res[0].funding_scheme_data.hasOwnProperty(\"project_template\")){\n                \n               \n                        \n//                     //     msg.responseObj.Page = res[0].funding_scheme_data.project_template + \" \" + msg.responseObj.Page\n//                     //     url = \"https://new-services.revotio.com/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page ;\n                        \n//                     // } else {\n//                          msg.responseObj.Page = \"default \" + msg.responseObj.Page.trim()\n//                         url = \"https://new-services.revotio.com/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page.trim() ;\n                     \n//                     // }\n                   \n//                     // url = \"https://new-services.revotio.com/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page ;\n//                     res = encodeURI(url);\n                    \n//                     msg.url = res\n\n//                     node.send(msg) \n//             })\n    \n       \n        \n        \n// } else {\n  \n//         url = global.get(\"page_api\")+ \"/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page ;\n//         res = encodeURI(url);\n        \n//         msg.url = res\n//         node.send(msg)\n\n// }\n\n\n\n\n\n\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":920,"wires":[["bd6bfd6d.c939b"]]},{"id":"3609d434.3284bc","type":"comment","z":"22428f45.8ab","name":"Redirect","info":"Expected object :\n\n msg.payload = {\n        DeviceId: ** From publised app **,\n        RevotioSessionId : ** From publised app **,\n        Page:  ** defigned in the Node-Red API **,\n        timestamp :  ** Last update of DB session object **,\n        user_id:  ** suplied by publeshed app **,\n        applicationId : ** applicationId Defigned in global context of the server **,\n    }","x":100,"y":880,"wires":[]},{"id":"d25f097e.01e458","type":"function","z":"22428f45.8ab","name":"Setup msg.RevotioData obj","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar unauth, auth,activate, reset,pageSession,   error; \nmsg.RevotioData =\n{\n    session : JSON.parse(msg.dataResult.dataContent.SessionData),\n    type : msg.dataResult.dataContent.payload,\n    BrowserFP : JSON.parse(msg.dataResult.dataContent.PostData)\n}\n\n\n\n        \nif (msg.RevotioData.session.entranceType === \"activate\"){\n    activate = msg;\n} else if (msg.RevotioData.session.entranceType === \"reset\"){\n    reset = msg;\n} else if (msg.RevotioData.session.entranceType === \"pageSession\"){\n    pageSession = msg;\n} \n\nelse {\n    \n \n  \n    if (typeof msg.tokenResult.TokenContent  === \"object\" &&  msg.tokenResult.TokenContent.type === \"authorized\"){\n        msg.RevotioData.tokenInfo ={\n            deviceId: msg.tokenResult.TokenContent.deviceId,\n            revotioSessionId: msg.tokenResult.TokenContent.revotioSessionId,\n            tokenCreated:  moment.unix(msg.tokenResult.TokenContent.iat),\n            tokenDateNow: moment(),\n            tokenCreatedDiffDays : moment().diff(moment.unix(msg.tokenResult.TokenContent.iat), 'days'),// (msg.RevotioData.tokenCreatedDiff / (1000 * 60 * 60)).toFixed(1);\n            currentTimeZone: msg.RevotioData.session.timezone,\n            tokenData:msg.tokenResult.TokenContent\n        }\n        \n        \n        auth = msg;\n    } else if (typeof msg.tokenResult.TokenContent  === \"object\" && msg.tokenResult.TokenContent.type === \"unauthorized\") {\n        \n        unauth = msg;\n    } \n    else {\n        \n        // msg.tokenData = tokenData;\n        error = msg;\n    }\n    \n}\n\nreturn [unauth, auth , activate ,reset,pageSession,  error];","outputs":6,"noerr":0,"initialize":"","finalize":"","x":600,"y":340,"wires":[["be00a65c.28f788"],["8258e7f0.7010b8","346559fb.3bd3e6"],["414fbb78.f981c4"],["e450621c.319d"],["3330057.39240fa"],[]],"outputLabels":["unauth","auth","activate","reset","pageSession","error"]},{"id":"884ebcd8.a7d85","type":"function","z":"22428f45.8ab","name":"Check if session exists and is valid or create new one & INIT FS","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// Decide twoStepState\n\nvar threshold \n\nif (global.get(\"DomainProperties.twoStepThreshold\")){\n    threshold = global.get(\"DomainProperties.twoStepThreshold\")\n    \n} else {\n    threshold = 7\n}\n    \n\nif ( msg.payload && msg.payload.hasOwnProperty(\"UserData\") ){\n    \n    msg.SessionObj = msg.payload ;\n\n    Obj =  {\n        \n        _id: new ObjectID(msg.SessionObj._id),\n        token: msg.SessionObj.token,\n        deviceId: msg.SessionObj.deviceId,\n        revotioSessionId :msg.SessionObj.revotioSessionId,\n        Page: msg.SessionObj.Page,\n        timestamp : new Date(),\n        user_id: new ObjectID(msg.RevotioData.session.user_id),\n        applicationId : new ObjectID(global.get(\"applicationId\")),\n        UserData : msg.RevotioData.userData,\n        timezone: msg.RevotioData.session.timezone,\n        currentUserTime: msg.RevotioData.session.currentUserTime ,\n        gmtTime: msg.RevotioData.session.gmtTime,\n        \n    }\n\n    operation = 'update'\n    \n} else {\n    \n    Obj = {\n         _id: new ObjectID(),\n        token: msg.RevotioData.session.token,\n        deviceId: msg.RevotioData.session.deviceId,\n        revotioSessionId :msg.RevotioData.session.revotioSessionId,\n        timestamp : new Date(),\n        user_id: new ObjectID(msg.RevotioData.session.user_id),\n        applicationId : new ObjectID(global.get(\"applicationId\")),\n        UserData : msg.RevotioData.session.UserData,\n        timezone: msg.RevotioData.session.timezone,\n        currentUserTime: msg.RevotioData.session.currentUserTime ,\n        gmtTime: msg.RevotioData.session.gmtTime\n    };\n\n\n    operation = 'update'\n\n}\n\n// check if token age is within boundries\nif (    msg.RevotioData.tokenInfo.tokenCreatedDiffDays ||\n        msg.RevotioData.tokenInfo.tokenCreatedDiffDays > 7\n        ){\n      Obj.Page = global.get(\"DomainProperties.NonAuthDefaultPage\")\n} else {\n        Obj.Page =  global.get(\"DomainProperties.ClientDefaultPage\");\n}\n      \n        Obj.RevotioData = {organization_id : new ObjectID(msg.RevotioData.session.permission.organizationData._id)}\n\n    msg.payload = Obj ; \n// update    \n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(Obj._id)}, \n                            update : { \"$set\" : Obj},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.result = res\n                    node.send(msg) \n            })  \n\n\n\n// return msg;","outputs":1,"noerr":0,"x":3070,"y":320,"wires":[["beee4a6.d97e5b8","ed062582.39fc48"]]},{"id":"28c05ee6.7acc72","type":"function","z":"22428f45.8ab","name":"Prepair msg.RevotioData Obj","func":"\nif (typeof msg.payload.FlowData === 'object' ){\n    FlowData = msg.payload.FlowData\n    delete msg.payload.FlowData\n} else {\n     FlowData = {Data : {}}\n}\n\n\nmsg.RevotioData = {\n    init:msg.INIT,\n    entity: \"INIT\",\n    session : msg.payload,\n    FlowData: FlowData\n    };\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":600,"wires":[["d4600974.fefad8"]]},{"id":"98133071.a2f0d","type":"function","z":"22428f45.8ab","name":"Prepair session lookup","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n//  get session\n\nvar query = {\n    deviceId: msg.RevotioData.session.deviceId,\n    revotioSessionId :msg.RevotioData.session.revotioSessionId,\n};\n\nmsg.query = query\n// find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                if (res.length > 0){\n                    msg.payload = lodash.orderBy(res,[\"timestamp\"],[\"desc\"])[0]\n                } else {\n                    msg.resultSessionQuery = res\n                    msg.payload = {}\n                }\n                    \n                    node.send(msg) \n            })   \n\n// return msg;","outputs":1,"noerr":0,"x":2700,"y":320,"wires":[["884ebcd8.a7d85","35b6d281.c3180e"]]},{"id":"8f0ae280.249e6","type":"catch","z":"22428f45.8ab","name":"","scope":null,"x":100,"y":40,"wires":[["370f35d5.83dd6a"]]},{"id":"8653bb23.0e7148","type":"debug","z":"22428f45.8ab","name":"ERROR","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":600,"y":40,"wires":[]},{"id":"4310a895.50d9d8","type":"function","z":"22428f45.8ab","name":"Update Session to match location user && gen page_session_id -- Redirect --","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nresponseObj = msg.responseObj;\n\nObj =  {timestamp : new Date(),\n        applicationId: new ObjectID(global.get(\"applicationId\")),\n        // session : msg.RevotioData.session\n}\n\nif (responseObj.deviceId){\n    Obj.deviceId =  responseObj.deviceId;\n}\n\nif (responseObj.revotioSessionId){\n    Obj.revotioSessionId =  responseObj.revotioSessionId;\n}\n\nif (responseObj.user_id){\n    Obj.user_id =  responseObj.user_id;\n}\n\nif (msg.RevotioData.userData){\n    Obj.userData =  msg.RevotioData.userData;\n}\n\nif (responseObj.Page){\n    Obj.Page =  responseObj.Page;\n}\n\nif (typeof msg.responseObj.RevotioData === 'object'){\n    Obj.FlowData = msg.responseObj.RevotioData\n    Obj.FlowData.Data  = {}\n} else {\n     Obj.FlowData = {Data:{}}\n}\nObj.FlowData.page_session_id = new ObjectID()\n\n\n\nif (responseObj.presentationLayer && responseObj.presentationLayer.container && responseObj.presentationLayer.container !== null){\n    Obj.container =  responseObj.presentationLayer.container;\n}\n\nupdateObj = {\n                    query : {\n                            query :{deviceId: responseObj.deviceId, revotioSessionId: responseObj.revotioSessionId}, \n                            update : {\"$set\" : Obj},\n                            options : {upsert: true, returnOriginal: false}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'findOneAndUpdate', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                \n                if (typeof res === 'object' && res.hasOwnProperty(\"value\")){\n                    \n                     msg.payload = res.value\n                     \n                } else {\n                    msg.payload = {};\n                }\n                \n                // update    \n\n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(Obj.FlowData.page_session_id)}, \n                            update : { \"$set\" : {date : new Date(), token :responseObj.token,  deviceId: responseObj.deviceId, revotioSessionId: responseObj.revotioSessionId}},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'page_load_sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            })  \n            \n            \n            })\n                    ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1920,"y":860,"wires":[["c2121202.789ff"]]},{"id":"c319320c.f16ce","type":"comment","z":"22428f45.8ab","name":"Initialize post","info":"Expected object :\n\n msg.payload = {\n        DeviceId: ** From publised app **,\n        RevotioSessionId : ** From publised app **,\n   }","x":130,"y":560,"wires":[]},{"id":"50eaa1a2.760b7","type":"function","z":"22428f45.8ab","name":"Prepair msg.RevotioData Obj","func":"\n\nmsg.RevotioData.session = msg.payload \nmsg.RevotioData.entity = msg.RevotioData.PostData.gadgetId\n\nif (typeof msg.payload.FlowData === 'object' ){\n    msg.RevotioData.FlowData = msg.payload.FlowData\n    delete msg.payload.FlowData\n} else {\n     msg.RevotioData.FlowData = {Data : {}}\n}\n\nmsg.RevotioData.session = msg.payload \n    \nreturn msg;","outputs":1,"noerr":0,"x":800,"y":760,"wires":[["822e5f6e.662b"]]},{"id":"be00a65c.28f788","type":"function","z":"22428f45.8ab","name":"prepair redirect to user authentication && update session object","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload  = {\n    Page :global.get(\"DomainProperties.NonAuthDefaultPage\")\n}\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{\n                                    revotioSessionId:msg.RevotioData.session.revotioSessionId, \n                                    deviceId : msg.RevotioData.session.deviceId\n                            }, \n                            update : { \"$set\" : msg.RevotioData.session},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                   \n                    node.send(msg) \n            })  \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1930,"y":260,"wires":[["45278fd1.18e39"]]},{"id":"43520b5c.2da5e4","type":"function","z":"22428f45.8ab","name":"Set msg.token","func":"\nmsg.token = msg.payload.token\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":260,"wires":[["358ba198.43c70e"]]},{"id":"414fbb78.f981c4","type":"function","z":"22428f45.8ab","name":"prepair redirect to user authentication","func":"msg.payload  = {\n    Page :\"user account activation\",\n    RevotioData: {\n        activationToken :  msg.RevotioData.session.activationToken\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":360,"wires":[["d890936b.19c77"]]},{"id":"e28da19.5cad66","type":"function","z":"22428f45.8ab","name":"Check if token is valid - Action","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar secret = global.get(\"SystemVars.secret\");\n\nvar valid,  invalid, validNoSession;\n\n\n// verify a token symmetric\njsonwebtoken.verify(msg.RevotioData.session.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n          if (msg.payload.hasOwnProperty(\"_id\")){\n                valid = msg;\n          }else{\n                validNoSession = msg;\n          }\n          \n      } else {\n          invalid = msg;\n      }\n    });\n    \n  \n    \n    \nreturn [valid, invalid, validNoSession];","outputs":3,"noerr":0,"x":530,"y":780,"wires":[["50eaa1a2.760b7"],["7bab6a6a.1cae04"],["8873bf3d.db5de"]],"outputLabels":["valid","invalid","validNoSession"]},{"id":"7bab6a6a.1cae04","type":"function","z":"22428f45.8ab","name":"Redirect to user authentication","func":"msg.payload  = {\n    Page :\"user authentication\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":800,"wires":[["534fed46.ceb0f4"]]},{"id":"91f18bc9.521138","type":"function","z":"22428f45.8ab","name":"Check if token is valid - INIT","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar secret = global.get(\"SystemVars.secret\");\nvar request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar valid, invalid;\n//  get session\nmsg.starttime = new Date()\n\n\nmsg.INIT = JSON.parse(msg.dataResult.dataContent.RevotioData);\nvar query =\n    {deviceId : msg.payload.deviceId, \n    revotioSessionId:msg.payload.revotioSessionId}\n\n// msg.operation = 'findOne'\n\n// find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                if (res.length > 0){\n                     msg.payload = res[0]\n                } else {\n                    msg.payload  = {}\n                }\n                    node.send(msg) \n            })   \n\n\n\n// // verify a token symmetric\n// jsonwebtoken.verify(msg.INIT.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n//       if (decoded !== undefined){\n//         valid = msg;\n//       } else {\n//           invalid = msg;\n//       }\n//     });\n    \n  \n    \n    \n// return [valid, invalid];","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":600,"wires":[["28c05ee6.7acc72"]],"outputLabels":["valid"]},{"id":"e450621c.319d","type":"function","z":"22428f45.8ab","name":"prepair redirect to reset ","func":"msg.payload  = {\n    Page :'reset password',\n    RevotioData:{\n        resetToken : msg.RevotioData.session.resetToken\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":400,"wires":[["d890936b.19c77"]]},{"id":"8258e7f0.7010b8","type":"function","z":"22428f45.8ab","name":"Decrypt token","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar tokenState\n\n// Decrypt token\n    jsonwebtoken.verify(msg.RevotioData.session.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n          tokenState = \"valid\"\n          TokenContent = decoded\n      }\n    });\n                \nmsg.RevotioData.session.user_id = new ObjectID(TokenContent.user_id);\n\nmsg.RevotioData.applicationId = new ObjectID(global.get(\"applicationId\"));\n\nmsg.payload = {\n    deviceId: msg.RevotioData.session.deviceId,\n    revotioSessionId :msg.RevotioData.session.revotioSessionId,\n};\n\nmsg.operation = 'findOne'\n\n// get last session\nfindOneObj = {\n                    query : {\n                            query :{\"UserData._id\": new ObjectID(msg.RevotioData.session.user_id)} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.RevotioData.userSession = res[0]\n                } \n                \n                else {\n                     msg.RevotioData.userSession = res\n                }\n                    \n                    node.send(msg) \n            })  \n\n\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":320,"wires":[["7e246bb3.a4bdc4"]]},{"id":"a568dd87.1b6dc","type":"function","z":"22428f45.8ab","name":"Prepair redirect","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nvar client , partner, prospect, error;\n\n\nif (msg.RevotioData.session &&\n    msg.RevotioData.session.permission &&\n    msg.RevotioData.session.permission.organizationData &&\n    msg.RevotioData.session.permission.organizationData.type){\n\n        if ( msg.RevotioData.session.permission.organizationData.type === \"client\"){\n        \n        client = msg;\n        \n        } else if ( msg.RevotioData.session.permission.organizationData.type === \"partner\"){\n        \n        partner = msg;\n        \n        \n        } else if ( msg.RevotioData.session.permission.organizationData.type === \"Master\"){\n        \n        client = msg;\n        \n        } else {\n        \n            prospect = msg;\n            \n        } \n}else {\n    error = msg\n}\n\n   \n\n\n\nreturn [client , partner, prospect, error];","outputs":4,"noerr":0,"x":1500,"y":320,"wires":[["98133071.a2f0d","22a7057b.fcb6ba"],["dd649bf4.cbffb8"],["be00a65c.28f788"],["62109c28.38f404"]],"outputLabels":["client","partner","prospect","error"]},{"id":"dd649bf4.cbffb8","type":"function","z":"22428f45.8ab","name":"Check user inv","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1820,"y":360,"wires":[["4324a1f8.df305"]],"outputLabels":["resume, "]},{"id":"39e92084.90cc6","type":"function","z":"22428f45.8ab","name":"Permission check 2/3","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (!msg.RevotioData.session.UserData){\n    msg.RevotioData.session.UserData = {}\n}\n\nmsg.RevotioData.session.UserData.OrgRepresentativeProjects = msg.payload;\n\nprojects = []\n_.each(msg.RevotioData.session.UserData.OrgRepresentativeProjects, function(projectItem,projectItemIndex ){\n    projects.push(new ObjectID(projectItem.project_id))\n})\n\nvar query = { _id :{\"$in\":projects}} ;\n\nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'projects',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n\n// return msg;","outputs":1,"noerr":0,"x":2240,"y":360,"wires":[["fae60a3c.dc9ff8"]]},{"id":"fae60a3c.dc9ff8","type":"function","z":"22428f45.8ab","name":"Permission check 3/3","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif (!msg.RevotioData.FlowData){\n    msg.RevotioData.FlowData = {}\n}\n        \n    msg.RevotioData.FlowData.Page = global.get(\"DomainProperties.ClientDefaultPage\")\n    msg.RevotioData.FlowData.organization_id =  msg.RevotioData.session.permission.organizationData._id;\n\n         \n\n\n\n            msg.payload = {\n                    Page :msg.RevotioData.FlowData.Page ,\n                    RevotioData         : {\n                        organization_id :  msg.RevotioData.session.permission.organizationData._id\n                    }\n                }\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2460,"y":360,"wires":[["98133071.a2f0d","22a7057b.fcb6ba"]]},{"id":"c2121202.789ff","type":"function","z":"22428f45.8ab","name":"manage file system - Manage FS","func":"if (msg.payload.hasOwnProperty(\"value\") && msg.payload.value !== null){\n\nmsg.RevotioData.session._id = msg.payload.value._id\nmsg.RevotioData.session.container = msg.payload.value.container\n\nresult = global.get(\"functions.fileManagement\")( '', '',msg.RevotioData.session._id, \"initSessionFolder\") // source, destination, operation\n\nresult = global.get(\"functions.fileManagement\")( '', '',msg.RevotioData.session._id, \"emptyDirSync\") // source, destination, operation\n\n\nif (result.state === \"success\"){\n    \n} else {\n    \n}\n}\n\nmsg.payload = msg.responseObj;\nmsg.payload.Type = \"Redirect\";\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":2080,"y":920,"wires":[["41ffde50.902ca"]]},{"id":"ac1b812a.32ef3","type":"comment","z":"22428f45.8ab","name":"Action post","info":"Expected object :\n\n msg.payload = {\n        DeviceId: ** From publised app **,\n        RevotioSessionId : ** From publised app **,\n   }","x":110,"y":740,"wires":[]},{"id":"d4600974.fefad8","type":"function","z":"22428f45.8ab","name":"create request ****TEMP FIX**** INIT","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nmessage = {\n    \n    RevotioData: msg.RevotioData,\n    payload : msg.payload,\n    starttime : msg.starttime\n}\nid = new ObjectID()\n// msg = {}\n\nmsg.payload = [{ _id: id},\n    {requestData : message},\n    {upsert : true}\n]\n\nmsg.operation = \"updateOne\"\n\n\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n\nif (msg.RevotioData.session.container && msg.RevotioData.session.container !== null && global.get(\"DomainProperties.routing\") &&  global.get(\"DomainProperties.routing\") !== \"local\"){\n// ******************************************************************\n    msg.url =  msg.RevotioData.session.container + \"/\"\n   \n// ******************************************************************\n} else {\n    msg.url = global.get(\"DomainProperties.url\") +\"/\"\n}\nif (message.RevotioData.session.hasOwnProperty(\"Page\")){\n   _.each(message.RevotioData.session.Page.replace(/[^\\w\\s]/gi,\"\").split(\" \"), function(value, index){\n    msg.url = msg.url + capitalizeFirstLetter(value);\n}) \n} else if (message.RevotioData.hasOwnProperty(\"init\") && \n        message.RevotioData.init.hasOwnProperty(\"Page\") ){\n       _.each( message.RevotioData.init.Page.replace(/[^\\w\\s]/gi,\"\").split(\" \"), function(value, index){\n            msg.url = msg.url + capitalizeFirstLetter(value);\n        })\n} \n        \n        \n\n\n// msg.url = message.RevotioData.session.Page.replace(/ /g, '');\n\n\n\n\nmsg.requestPayload = {id:id, type :\"init\", data :message}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":600,"wires":[["89fafe6e.d4c59"]]},{"id":"6ab5c826.324318","type":"http request","z":"22428f45.8ab","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","authType":"basic","x":1270,"y":600,"wires":[["3ed9f7bb.ee86e8"]]},{"id":"89fafe6e.d4c59","type":"function","z":"22428f45.8ab","name":"create request","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nmsg.payload = msg.requestPayload\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":600,"wires":[["6ab5c826.324318","8eb478dc.adf1e8"]]},{"id":"3ed9f7bb.ee86e8","type":"json","z":"22428f45.8ab","name":"Post INIT request","property":"payload","action":"","pretty":false,"x":1430,"y":600,"wires":[["99986e5d.dcdfb"]]},{"id":"99986e5d.dcdfb","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1570,"y":600,"wires":[]},{"id":"586893fe.fa4a9c","type":"http request","z":"22428f45.8ab","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":2790,"y":920,"wires":[["1ea620e9.25d94f"]]},{"id":"32ecb9e7.055c96","type":"function","z":"22428f45.8ab","name":"create request","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nmsg.payload = msg.requestPayload\n\n\nreturn msg;","outputs":1,"noerr":0,"x":2640,"y":920,"wires":[["586893fe.fa4a9c","eeabaf73.14d32"]]},{"id":"1ea620e9.25d94f","type":"json","z":"22428f45.8ab","name":"Post redirect request","property":"payload","action":"","pretty":false,"x":2940,"y":920,"wires":[["ac2bdb01.167c78","639c54a7.45bdac"]]},{"id":"ac2bdb01.167c78","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":3090,"y":1080,"wires":[]},{"id":"22e61321.b47d2c","type":"http request","z":"22428f45.8ab","name":"","method":"POST","ret":"txt","paytoqs":false,"url":"","tls":"","proxy":"","authType":"basic","x":1470,"y":760,"wires":[["d0e2cdc0.f2986"]]},{"id":"12657b3a.3f8365","type":"function","z":"22428f45.8ab","name":"create request","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nmsg.payload = msg.requestPayload\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1320,"y":760,"wires":[["22e61321.b47d2c","4bb16b7e.2206a4"]]},{"id":"d0e2cdc0.f2986","type":"json","z":"22428f45.8ab","name":"Post action request","property":"payload","action":"","pretty":false,"x":1670,"y":760,"wires":[["e438a44d.9aaed8"]]},{"id":"e438a44d.9aaed8","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1810,"y":760,"wires":[]},{"id":"822e5f6e.662b","type":"function","z":"22428f45.8ab","name":"create request ****TEMP FIX**** ACTION","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\nmessage = {\n    RevotioData: msg.RevotioData,\n    payload : msg.payload,\n    starttime : msg.starttime\n}\nid = new ObjectID()\n// msg = {}\n\nmsg.payload = [{ _id: id},\n    {requestData : message},\n    {upsert : true}\n]\n\nmsg.operation = \"updateOne\"\n\n\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n\nif (msg.RevotioData.session.container && msg.RevotioData.session.container !== null && global.get(\"DomainProperties.routing\") &&  global.get(\"DomainProperties.routing\") !== \"local\"){\n// ******************************************************************\n    msg.url = msg.RevotioData.session.container + \"/\"\n\n// ******************************************************************\n} else {\n    msg.url = global.get(\"DomainProperties.url\") +\"/\"\n}\n\n_.each(message.payload.Page.replace(/[^\\w\\s]/gi,\"\").split(\" \"), function(value, index){\n    msg.url = msg.url + capitalizeFirstLetter(value);\n})\n\n\n// msg.url = message.RevotioData.session.Page.replace(/ /g, '');\n\n\n\n\nmsg.requestPayload = {id:id, type :\"action\", data :message}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":760,"wires":[["12657b3a.3f8365"]]},{"id":"41ffde50.902ca","type":"function","z":"22428f45.8ab","name":"create request ****TEMP FIX**** REDIRECT","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\nmessage = {\n    // RevotioData: msg.RevotioData,\n    payload : msg.payload\n}\n\n// _.each(msg.payload, function(Item, key){\n    \n//     if (typeof Item === \"object\"){\n//         message[key] = {}\n//     } else {\n//         message[key] = Item\n//     }\n// })\nid = new ObjectID()\n// msg = {}\n\n// msg.payload = [{ _id: id},\n//     {requestData : message},\n//     {upsert : true}\n// ]\n\n// msg.operation = \"updateOne\"\n\n\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nif (msg.payload.hasOwnProperty(\"presentationLayer\") === true && msg.payload.presentationLayer.hasOwnProperty(\"container\") === true && msg.RevotioData.session.container !== null  && global.get(\"DomainProperties.routing\") &&  global.get(\"DomainProperties.routing\") !== \"local\"){\n  msg.url =message.payload.presentationLayer.container + \"/\"\n\n} else {\n    msg.url = global.get(\"DomainProperties.url\") +\"/\"\n}\n\n\n_.each(message.payload.Page.replace(/[^\\w\\s]/gi,\"\").split(\" \"), function(value, index){\n    msg.url = msg.url + capitalizeFirstLetter(value);\n})\n\n//  msg.url.replace(/-/, \"\")\n\n// msg.url = message.RevotioData.session.Page.replace(/ /g, '');\n\n\n\n\nmsg.requestPayload = {id:id, type :\"design\", data : message}\n\nreturn msg;","outputs":1,"noerr":0,"x":2390,"y":920,"wires":[["32ecb9e7.055c96"]]},{"id":"64af574f.98bfc8","type":"http in","z":"22428f45.8ab","name":"redirect","url":"/redirect","method":"post","upload":false,"swaggerDoc":"","x":90,"y":920,"wires":[["68c3fc9b.be0a54"]]},{"id":"68c3fc9b.be0a54","type":"function","z":"22428f45.8ab","name":"Setup msg object","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\npayload = msg.payload ;\n\ndelete msg.payload ;\n\n_.each(payload, function(value, key){\n    // if (typeof value ===  'string'){\n    //     msg[key] = value.trim()\n    // } else {\n        msg[key] = value\n    // }\n})\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":920,"wires":[["5abccab0.40a034"]]},{"id":"6e4ddf7c.7028e","type":"comment","z":"22428f45.8ab","name":"Global gadgets","info":"","x":100,"y":1600,"wires":[]},{"id":"c3c61d5b.a60c1","type":"function","z":"22428f45.8ab","name":"Trigger remove actions per entity","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\n// delete all sub entities first\n_.each(msg.payload,function(SubItem, SubIndex){\n    msg.organization_id = new ObjectID(SubItem._id)\n    node.send(msg)\n} )\n\n// continue with main entity removal\n\n// return msg;","outputs":1,"noerr":0,"x":1160,"y":1660,"wires":[["9cc33062.f4863","b8db24fd.dacbe8","a158228d.87d82","b2174cdf.41a82","7efed04a.a697c"]]},{"id":"9cc33062.f4863","type":"function","z":"22428f45.8ab","name":"Get all org's participants ","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar query = {organization_id : new ObjectID(msg.organization_id)}\nmsg.done = false\n // find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'participants',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n\n                    GroupedByProjects = lodash.groupBy(res, 'project_id')\n\n                    _.each(GroupedByProjects, function(ProjectArray, project_id){\n                            // find  \n                            findObj = {\n                                        query : {\n                                                query :{project_id :new ObjectID(project_id), type : \"project\"}, \n                                                },\n                                        connection:global.get(\"DB_data.connection\"),\n                                        database:global.get(\"DB_data.appDB\"),\n                                        collection:'participants',\n                                        operation:'find',\n                                        }\n                            \n                                        mongodbTools.resolveAsync(findObj, node, function(res){\n                                            \n                                                if (res.length > 0 ){\n                                                    state = false\n                                                    _.each(res, function(participantItem, participantItemIndex){\n                                                        if (participantItem.hasOwnProperty(organization_id) &&\n                                                           String(participantItem.organization_id) !== String(msg.organization_id)){\n                                                                    state = true\n                                                                }\n                                                    })\n                                                    \n                                                    if (state === false ){\n                                                         msg.payload = {project_id : project_id}\n                                                         node.send(msg)\n                                                    }\n                                                } else {\n                                                    msg.payload = {project_id : project_id}\n                                                    node.send(msg)\n                                                }\n                                        })   \n                        })\n                    msg.done = true\n                    node.send(msg) \n            }) \n","outputs":1,"noerr":0,"x":1450,"y":1660,"wires":[["49f94e2e.aea01","57016505.1fe21c"]]},{"id":"49f94e2e.aea01","type":"function","z":"22428f45.8ab","name":"Trigger delete project data","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif (msg.done === false ){\n    node.send(msg)\n}\n","outputs":1,"noerr":0,"x":1800,"y":1620,"wires":[["149fd266.f5eb8e"]]},{"id":"57016505.1fe21c","type":"function","z":"22428f45.8ab","name":"Remove all participants records","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (msg.done === true){\n// remove \n            removeObj = {\n                    query : {\n                            query :{organization_id:new ObjectID(msg.organization_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'participants',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    msg.result = res\n                    node.send(msg) \n            }) \n}\n// return msg;","outputs":1,"noerr":0,"x":1810,"y":1660,"wires":[[]]},{"id":"dffc6582.288718","type":"function","z":"22428f45.8ab","name":"check if msg.organization_id is present and prepair child lookup","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\nvar valid, invalid\nif (msg.payload.hasOwnProperty(\"organization_id\")){\n\n    payload = {\"$or\": [{parent_id : new ObjectID(msg.payload.organization_id)}, {_id : new ObjectID(msg.payload.organization_id)} ] }\n    msg.operation = 'find.toArray'\n    msg.payload = payload\n    valid = msg\n} else {\n    invalid = msg\n}\n\nreturn [valid, invalid]","outputs":2,"noerr":0,"x":590,"y":1680,"wires":[["f6eefc54.fc37c"],["365a5f20.a86b5"]],"outputLabels":["valid, ","invalid"]},{"id":"50304bb2.49eea4","type":"comment","z":"22428f45.8ab","name":"Delete all organization Data","info":"","x":220,"y":1640,"wires":[]},{"id":"bf3bde62.30336","type":"link in","z":"22428f45.8ab","name":"Delete all organization Data","links":["755fb71d.d2028","bfc74af8.6937b"],"x":355,"y":1640,"wires":[["dffc6582.288718"]]},{"id":"12193ffb.13a1c","type":"function","z":"22428f45.8ab","name":"Get all project WP's","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// find  \nfindObj = {\n                    query : {\n                            query : {\tproject_id : new ObjectID(msg.payload.project_id)},\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'work_packages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n// return msg;","outputs":1,"noerr":0,"x":940,"y":1740,"wires":[["d28d462b.e1b878"]]},{"id":"77df955.b71eb6c","type":"comment","z":"22428f45.8ab","name":"Delete all project data","info":"","x":240,"y":1760,"wires":[]},{"id":"c797a7a6.1f3fc8","type":"link in","z":"22428f45.8ab","name":"Delete all project data","links":["149fd266.f5eb8e","b298aff4.badb78","e9fb6492.5b068"],"x":335,"y":1760,"wires":[["9355e507.c564b8"]]},{"id":"a50c82cc.286c7","type":"function","z":"22428f45.8ab","name":"Libs","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif ( Array.isArray(msg.payload)){\n   _.each(msg.payload, function(Item, Index){\n    \n    msg.work_package_id = Item._id\n    node.send(msg);\n    \n    \n}); \n} else if (msg.payload.hasOwnProperty(\"work_package_id\")) {\n    msg.work_package_id = msg.payload.work_package_id\n    node.send(msg);\n} else{\n      msg.work_package_id = msg.payload._id\n    node.send(msg);\n}\n\n\n\n// return msg;","outputs":1,"noerr":0,"x":390,"y":1880,"wires":[["cfe71090.7a22d"]]},{"id":"f452512d.9e37f","type":"comment","z":"22428f45.8ab","name":"Remove all wp data","info":"","x":210,"y":1840,"wires":[]},{"id":"d3c8d505.589408","type":"link in","z":"22428f45.8ab","name":"Remove all wp data","links":["d28d462b.e1b878","5bc91a39.2b348c","cf312f50.45a118","148a291d.254577"],"x":315,"y":1840,"wires":[["a50c82cc.286c7"]]},{"id":"149fd266.f5eb8e","type":"link out","z":"22428f45.8ab","name":"","links":["c797a7a6.1f3fc8"],"x":1935,"y":1620,"wires":[]},{"id":"d28d462b.e1b878","type":"link out","z":"22428f45.8ab","name":"","links":["d3c8d505.589408"],"x":1055,"y":1740,"wires":[]},{"id":"b8db24fd.dacbe8","type":"function","z":"22428f45.8ab","name":"Remove all with organization_id","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar query= {organization_id : new ObjectID(msg.organization_id)}\n \n // removequery\n            settings = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'settings',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(settings, node, function(res){\n                   \n            })  \n            \n // removetime_sheet_records\n            time_sheet_records = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'time_sheet_records',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(time_sheet_records, node, function(res){\n                   \n            })  \n            \n // removequery\n            salary_data = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'salary_data',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(salary_data, node, function(res){\n                   \n            })  \n            \n            \n // removequery\n            organization_records = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organization_records',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(organization_records, node, function(res){\n                   \n            })  \n            \n            \n // removequery\n            file_import_records = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'file_import_records',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(file_import_records, node, function(res){\n                   \n            })  \n            \n            \n // removequery\n            events = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'events',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(events, node, function(res){\n                   \n            })  \n","outputs":1,"noerr":0,"x":1470,"y":1700,"wires":[[]]},{"id":"1eb336ea.ac0f39","type":"function","z":"22428f45.8ab","name":"Remove all employee records","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n \n\n\nquery = {employee_id: new ObjectID(msg.payload.employee_id)}\n\n\n // removequery\n            employee_cost_cal = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'employee_cost_cal',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(employee_cost_cal, node, function(res){\n                // removequery\n                                    employee_cost = {\n                                            query : {\n                                                    query :query, \n                                                    },\n                                            connection:global.get(\"DB_data.connection\"),\n                                            database:global.get(\"DB_data.appDB\"),\n                                            collection:'employee_cost',\n                                            operation:'remove',\n                                            }\n                            \n                                        mongodbTools.resolveAsync(employee_cost, node, function(res){\n                                         // removequery\n                                                    employee_department_involvement = {\n                                                            query : {\n                                                                    query :query, \n                                                                    },\n                                                            connection:global.get(\"DB_data.connection\"),\n                                                            database:global.get(\"DB_data.appDB\"),\n                                                            collection:'employee_department_involvement',\n                                                            operation:'remove',\n                                                            }\n                                        \n                                                    mongodbTools.resolveAsync(employee_department_involvement, node, function(res){\n                                                        // removequery\n                                                            employee_involvement = {\n                                                                    query : {\n                                                                            query :query, \n                                                                            },\n                                                                    connection:global.get(\"DB_data.connection\"),\n                                                                    database:global.get(\"DB_data.appDB\"),\n                                                                    collection:'employee_involvement',\n                                                                    operation:'remove',\n                                                                    }\n                                                \n                                                            mongodbTools.resolveAsync(employee_involvement, node, function(res){\n                                                         // removequery\n                                                            members = {\n                                                                    query : {\n                                                                            query :query, \n                                                                            },\n                                                                    connection:global.get(\"DB_data.connection\"),\n                                                                    database:global.get(\"DB_data.appDB\"),\n                                                                    collection:'members',\n                                                                    operation:'remove',\n                                                                    }\n                                                \n                                                            mongodbTools.resolveAsync(members, node, function(res){\n                                                                // removequery\n                                                                    employee = {\n                                                                            query : {\n                                                                                    query :{_id : new ObjectID(query.employee_id)}, \n                                                                                    },\n                                                                            connection:global.get(\"DB_data.connection\"),\n                                                                            database:global.get(\"DB_data.appDB\"),\n                                                                            collection:'employee',\n                                                                            operation:'remove',\n                                                                            }\n                                                        \n                                                                    mongodbTools.resolveAsync(employee, node, function(res){\n                                                                           node.send(msg)\n                                                                    })   \n                                                            }) \n                                                    })\n                                        }) \n                            })  \n            })  \n  \n                    \n\n\n            \n\n\n\n\n            \n","outputs":1,"noerr":0,"x":470,"y":1960,"wires":[["9f168e2b.14869"]]},{"id":"fa3bdcb8.acff5","type":"comment","z":"22428f45.8ab","name":"Remove all employee data","info":"","x":190,"y":1920,"wires":[]},{"id":"1df715f3.e1249a","type":"link in","z":"22428f45.8ab","name":"Remove all employee data","links":["ebc5286.2020ad8","ec0700d4.b0391"],"x":315,"y":1920,"wires":[["1eb336ea.ac0f39"]]},{"id":"a158228d.87d82","type":"function","z":"22428f45.8ab","name":"Get all employee","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n // find  \nfindObj = {\n                    query : {\n                            query :{organization_id : new ObjectID(msg.organization_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'employee',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload  = res\n                    node.send(msg) \n            }) \n// return msg;","outputs":1,"noerr":0,"x":1430,"y":1740,"wires":[["ed7338a3.cb3008"]]},{"id":"ed7338a3.cb3008","type":"function","z":"22428f45.8ab","name":"check if employee exists","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\nif (msg.payload.length > 0){\n    _.each(msg.payload, function(Item, Index){\n        node.send({payload: {employee_id : Item._id}})\n    })\n} \n\n// return msg;","outputs":1,"noerr":0,"x":1630,"y":1740,"wires":[["ebc5286.2020ad8"]]},{"id":"ebc5286.2020ad8","type":"link out","z":"22428f45.8ab","name":"","links":["1df715f3.e1249a"],"x":1755,"y":1740,"wires":[]},{"id":"ef2e1e19.d2dd9","type":"http in","z":"22428f45.8ab","name":"removeOrganization","url":"/removeOrganization","method":"post","upload":false,"swaggerDoc":"","x":270,"y":1680,"wires":[["dffc6582.288718"]]},{"id":"5f3bcf7d.f4aa5","type":"http in","z":"22428f45.8ab","name":"removeProject","url":"/removeProject","method":"post","upload":false,"swaggerDoc":"","x":270,"y":1800,"wires":[["9355e507.c564b8"]]},{"id":"ac771839.18ab68","type":"http in","z":"22428f45.8ab","name":"removeWorkPackage","url":"/removeWorkPackage","method":"post","upload":false,"swaggerDoc":"","x":240,"y":1880,"wires":[["a50c82cc.286c7"]]},{"id":"26381dab.c32ea2","type":"http in","z":"22428f45.8ab","name":"removeEmployee","url":"/removeEmployee","method":"post","upload":false,"swaggerDoc":"","x":260,"y":1960,"wires":[["1eb336ea.ac0f39"]]},{"id":"9f168e2b.14869","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":650,"y":1960,"wires":[]},{"id":"26a3ef3f.f39c2","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":710,"y":1880,"wires":[]},{"id":"365a5f20.a86b5","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":890,"y":1700,"wires":[]},{"id":"9355e507.c564b8","type":"function","z":"22428f45.8ab","name":"check if msg.project_id is present and prepair child lookup","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar valid, invalid\nif (msg.payload.hasOwnProperty(\"project_id\")){\n\n    // payload = {parent_id : new ObjectID(msg.payload.project_id)}\n    // msg.operation = 'find.toArray'\n    // msg.payload = payload\n    valid = msg\n} else {\n    invalid = msg\n}\n\nreturn [valid, invalid]","outputs":2,"noerr":0,"x":580,"y":1800,"wires":[["12193ffb.13a1c","b425a878.b75b38"],["1b89457d.f1d23b"]],"outputLabels":["valid, ","invalid"]},{"id":"1b89457d.f1d23b","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":890,"y":1820,"wires":[]},{"id":"c6e7b89c.afd158","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1590,"y":1580,"wires":[]},{"id":"b2174cdf.41a82","type":"function","z":"22428f45.8ab","name":"Remove Organization","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// remove \n            removeObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.organization_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    msg.result = res\n                    node.send(msg) \n            }) ","outputs":1,"noerr":0,"x":1440,"y":1580,"wires":[["c6e7b89c.afd158"]]},{"id":"e5326123.a02c","type":"link out","z":"22428f45.8ab","name":"","links":["dc664b4f.0d82e","561c8154.e2038"],"x":495,"y":400,"wires":[]},{"id":"ff26ef50.08ab1","type":"comment","z":"22428f45.8ab","name":"CHECK GC state","info":"","x":580,"y":400,"wires":[]},{"id":"94ed091e.5e27a8","type":"link out","z":"22428f45.8ab","name":"","links":["dc664b4f.0d82e","561c8154.e2038"],"x":295,"y":640,"wires":[]},{"id":"36ec32bb.18d62e","type":"comment","z":"22428f45.8ab","name":"CHECK GC state","info":"","x":400,"y":640,"wires":[]},{"id":"3ce52d3e.8ba9f2","type":"link out","z":"22428f45.8ab","name":"","links":["dc664b4f.0d82e","561c8154.e2038"],"x":235,"y":820,"wires":[]},{"id":"49adfa88.001214","type":"comment","z":"22428f45.8ab","name":"CHECK GC state","info":"","x":320,"y":820,"wires":[]},{"id":"6e4b6e8.51d319","type":"http in","z":"22428f45.8ab","name":"entrance","url":"/entrance","method":"post","upload":false,"swaggerDoc":"","x":120,"y":340,"wires":[["e5326123.a02c","43520b5c.2da5e4","18300eee.bc13f1"]]},{"id":"905a77be.95de78","type":"http in","z":"22428f45.8ab","name":"initialize","url":"/initialize","method":"post","upload":false,"swaggerDoc":"","x":90,"y":600,"wires":[["94ed091e.5e27a8","16987802.9cc1b8"]]},{"id":"7195cbce.e4ee04","type":"http in","z":"22428f45.8ab","name":"action","url":"/action","method":"post","upload":false,"swaggerDoc":"","x":90,"y":780,"wires":[["3ce52d3e.8ba9f2","95c91e78.e2e0d"]]},{"id":"ad02ca99.ed0958","type":"function","z":"22428f45.8ab","name":"Get session data","func":"var jsonwebtoken = global.get('jsonwebtoken');\nvar secret = global.get(\"SystemVars.secret\");\nvar request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\nvar valid, invalid;\nmsg.starttime = new Date()\n\n\nvar PostData = JSON.parse(msg.dataResult.dataContent.PostData);\n\n\n\nvar SessionData = JSON.parse(msg.dataResult.dataContent.SessionData);\n\nquery = {\n    deviceId : SessionData.deviceId,\n    revotioSessionId : SessionData.revotioSessionId,\n}\nmsg.RevotioData = {\n    SessionData:SessionData,\n    // startTime : new Date(),\n    PostData:PostData,\n    session : SessionData\n};\n// find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                \n                if (res.length > 0 ){\n                    msg.payload = res[0]\n                } else {\n                    msg.payload = {}\n                }\n                    \n                    node.send(msg) \n            })  \n\n  \n    \n    \nreturn [valid, invalid];","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":780,"wires":[["e28da19.5cad66"]]},{"id":"f6eefc54.fc37c","type":"function","z":"22428f45.8ab","name":"get organizations","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n    // query = {\"$or\": [{parent_id : new ObjectID(msg.payload.organization_id)}, {_id : new ObjectID(msg.payload.organization_id)} ] }\n    // msg.operation = 'find.toArray'\n                    \n                // find  \n                findObj = {\n                    query : {\n                            query :msg.payload, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n\n   ","outputs":1,"noerr":0,"x":930,"y":1660,"wires":[["c3c61d5b.a60c1"]],"outputLabels":["valid, "]},{"id":"7efed04a.a697c","type":"function","z":"22428f45.8ab","name":"Remove all users && users data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// find  \nfindObj = {\n                    query : {\n                            query :{organization_id: new ObjectID(msg.organization_id)}, \n                            projection:{_id :1}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_accounts',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                \n                _.each(res, function(user, index){\n                    \n                    // removeusers \n                        removeusers = {\n                                query : {\n                                        query :{_id:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'users',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeusers, node, function(res){\n                                \n                        }) \n                        \n                        // removeuser_accounts \n                        removeuser_accounts = {\n                                query : {\n                                        query :{user:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'user_accounts',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeuser_accounts, node, function(res){\n                                \n                        }) \n                        \n                         // removeuser_permissions\n                        removeuser_permissions = {\n                                query : {\n                                        query :{user:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'user_permissions',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeuser_permissions, node, function(res){\n                                \n                        }) \n                        \n                        // removeMembers\n                        removeMembers = {\n                                query : {\n                                        query :{user:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'members',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeMembers, node, function(res){\n                                \n                        }) \n                    \n                })\n                \n                    // msg.payload = res\n                    node.send(msg) \n            }) \n            \n// return msg;\n","outputs":1,"noerr":0,"x":1470,"y":1620,"wires":[[]]},{"id":"b425a878.b75b38","type":"function","z":"22428f45.8ab","name":"Remove all project records","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n // removequery\n            members = {\n                    query : {\n                            query :{project_id : new ObjectID(msg.payload.project_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'members',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(members, node, function(res){\n                   \n            })  \n            \n // removeuser_permissions\n            user_permissions = {\n                    query : {\n                            query :{type_id : new ObjectID(msg.payload.project_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_permissions',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(user_permissions, node, function(res){\n                   \n            })  \n            \n // removequery\n            projects = {\n                    query : {\n                            query :{_id : new ObjectID(msg.payload.project_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'projects',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(projects, node, function(res){\n                   \n            })  \n            \n            \n // removequery\n            participants = {\n                    query : {\n                            query :{project_id : new ObjectID(msg.payload.project_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'participants',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(participants, node, function(res){\n                   \n            })  \n            \n            \n // removequery\n            time_sheet_records = {\n                    query : {\n                            query :{project_id : new ObjectID(msg.payload.project_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'time_sheet_records',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(time_sheet_records, node, function(res){\n                   \n            })  \n            \n            \n // removequery\n            events = {\n                    query : {\n                            query :{project_id : new ObjectID(msg.payload.project_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'events',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(events, node, function(res){\n                   \n            })  \n            \n // removequery\n            transactions = {\n                    query : {\n                            query :{project_id : new ObjectID(msg.payload.project_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'transactions',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(transactions, node, function(res){\n                   \n            })  \n // removequery\n            payments = {\n                    query : {\n                            query :{project_id : new ObjectID(msg.payload.project_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'payments',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(payments, node, function(res){\n                   \n            })  \n\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":960,"y":1780,"wires":[["33e7fff3.45dd"]]},{"id":"33e7fff3.45dd","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1130,"y":1780,"wires":[]},{"id":"cfe71090.7a22d","type":"function","z":"22428f45.8ab","name":"Remove all WP records","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n \n\n // removeuser_permissions\n            user_permissions = {\n                    query : {\n                            query :{type_id : new ObjectID(msg.work_package_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_permissions',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(user_permissions, node, function(res){\n                   \n            })  \n            \n // removequery\n            work_packages = {\n                    query : {\n                            query :{_id : new ObjectID(msg.work_package_id)},\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'work_packages',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(work_packages, node, function(res){\n                   \n            })  \n            \n            \n // removequery\n            participants = {\n                    query : {\n                            query :{\twork_package_id : new ObjectID(msg.work_package_id)},\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'participants',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(participants, node, function(res){\n                   \n            })  \n            \n            \n\n            \n            \n // removequery\n            events = {\n                    query : {\n                            query :{\twork_package_id : new ObjectID(msg.work_package_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'events',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(events, node, function(res){\n                   \n            })  \n            \n // removequery\n            transactions = {\n                    query : {\n                            query :{\twork_package_id : new ObjectID(msg.work_package_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'transactions',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(transactions, node, function(res){\n                   \n            })  \n\n // removequery\n            person_months = {\n                    query : {\n                            query :{\twork_package_id : new ObjectID(msg.work_package_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'person_months',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(person_months, node, function(res){\n                   \n            })  \n            \n            \n\nreturn msg;\n","outputs":1,"noerr":0,"x":550,"y":1880,"wires":[["26a3ef3f.f39c2"]]},{"id":"561c8154.e2038","type":"link in","z":"22428f45.8ab","name":"","links":["f6894ee3.d056c","e5326123.a02c","94ed091e.5e27a8","97b5b868.e751e","3ce52d3e.8ba9f2","100e6adf.f1c21d","884fb8a9.ab74f","171e9659.88660a","d376f67a.c86588"],"x":75,"y":100,"wires":[["5d156f35.b0e81"]]},{"id":"e31df0ab.bcd2c","type":"comment","z":"22428f45.8ab","name":"Entrance post","info":"Expected object :\n\n msg.payload = {\n        DeviceId: ** From publised app **,\n        RevotioSessionId : ** From publised app **,\n   }","x":130,"y":300,"wires":[]},{"id":"18144838.76c328","type":"http in","z":"22428f45.8ab","name":"","url":"/Exit","method":"post","upload":false,"swaggerDoc":"","x":80,"y":1180,"wires":[["d376f67a.c86588","f207746d.fc46e8"]]},{"id":"d836d846.a603d8","type":"comment","z":"22428f45.8ab","name":"Exit ","info":"","x":90,"y":1140,"wires":[]},{"id":"cc7b0818.e77588","type":"http in","z":"22428f45.8ab","name":"","url":"/token","method":"post","upload":false,"swaggerDoc":"","x":90,"y":1080,"wires":[["67297d5e.1f59a4"]]},{"id":"5cc34c91.c06a64","type":"function","z":"22428f45.8ab","name":"Generate token","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (msg.PostPayload.content.hasOwnProperty(\"pageSessionId\") && ObjectID.isValid(msg.PostPayload.content.pageSessionId)){\n    \n    findOneObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.PostPayload.content.pageSessionId)} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'page_load_sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    page_load_session = res[0]\n                \n                  \n                    TokenContent = {};\n                    // verify a token symmetric\n                        jsonwebtoken.verify(page_load_session.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n                          if (decoded !== undefined){\n                              \n                              TokenContent = decoded\n                          }\n                        });\n                        \n                       \n                        \n                        msg.PostPayload.content.type = TokenContent.type\n                        \n                        msg.PostPayload.content.key  = global.get(\"SystemVars.tokenSecret\")//new ObjectID()\n                        \n                        payload = {type : msg.PostPayload.type, token : jsonwebtoken.sign(msg.PostPayload.content, global.get(\"SystemVars.secret\"))};\n                        \n                        msg.PostPayload.content.token = payload.token\n                        \n                        msg.payload = payload\n                        \n                        // update     \n                        \n                        // msg.payload.key =  msg.PostPayload.content.key\n                    \n                    \n                } else {\n                    \n                    \n                    msg.PostPayload.content.type = \"unauthorized\"\n                    msg.PostPayload.content.key  = global.get(\"SystemVars.tokenSecret\") //new ObjectID()\n                    \n                    payload = {type : msg.PostPayload.type, token : jsonwebtoken.sign(msg.PostPayload.content, global.get(\"SystemVars.secret\"))};\n                    \n                    msg.PostPayload.content.token = payload.token\n                    \n                    msg.payload = payload\n                    \n                    // update     \n                    \n                    // msg.payload.key =  msg.PostPayload.content.key\n                   \n                }\n                    \n                    node.send(msg) \n            })  \n            \n} else {\n    \n            msg.PostPayload.content.type = \"unauthorized\"\n            msg.PostPayload.content.key  = global.get(\"SystemVars.tokenSecret\") //new ObjectID()\n            \n            payload = {type : msg.PostPayload.type, token : jsonwebtoken.sign(msg.PostPayload.content, global.get(\"SystemVars.secret\"))};\n            \n            msg.PostPayload.content.token = payload.token\n            \n            msg.payload = payload\n            \n            // update     \n            \n            // msg.payload.key =  msg.PostPayload.content.key\n            node.send(msg)\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":1040,"wires":[["f26cc4af.43ec38"]]},{"id":"21e2fb63.940c44","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1350,"y":1100,"wires":[]},{"id":"a11eedb8.ddaab","type":"comment","z":"22428f45.8ab","name":"Token","info":"msg.payload = {\n    type: \n    content: { // start with DeviceId && RevotioSessionId\n        DeviceId: \"123456789\",\n        RevotioSessionId : \"123456789\"\n    }\n}","x":90,"y":1040,"wires":[]},{"id":"3070fb61.e8ead4","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":450,"y":1300,"wires":[]},{"id":"c3ac50a5.c0713","type":"http in","z":"22428f45.8ab","name":"","url":"/upload","method":"post","upload":true,"swaggerDoc":"","x":90,"y":1280,"wires":[["2257fda3.f40772"]]},{"id":"2257fda3.f40772","type":"function","z":"22428f45.8ab","name":"","func":"var Remove, Upload; \n\nif (msg.req.uploadData.fields.type === \"create\"){\n    Upload = msg;\n} else {\n    Remove = msg;\n}\nreturn [Remove, Upload];","outputs":2,"noerr":0,"x":230,"y":1280,"wires":[[],["d3495579.2015e8","f78a0942.6bb1d8"]],"outputLabels":["Remove, ","Upload"]},{"id":"d3495579.2015e8","type":"function","z":"22428f45.8ab","name":"","func":"var fs = global.get('fsextra');\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\n\nfs.ensureDirSync(msg.req.uploadData.fields.appFolder)\nfs.moveSync(msg.req.uploadData.fileData.path, msg.req.uploadData.fields.appFolder + msg.req.uploadData.fields.name , { overwrite: true })\n\nmsg.payload = {\n    path    : msg.req.uploadData.fields.appFolder + msg.req.uploadData.fields.name,\n    size    : msg.req.uploadData.fileData.size,\n    name    : msg.req.uploadData.fileData.name,\n    uploadFileType : msg.req.uploadData.fileData.type,\n    type    : msg.req.uploadData.fileData.type\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":1300,"wires":[["3070fb61.e8ead4"]]},{"id":"6251e115.c02e5","type":"comment","z":"22428f45.8ab","name":"Upload","info":"msg.payload = {\n    type: \n    content: { // start with DeviceId && RevotioSessionId\n        DeviceId: \"123456789\",\n        RevotioSessionId : \"123456789\"\n    }\n}","x":90,"y":1240,"wires":[]},{"id":"2409812a.fed21e","type":"http in","z":"22428f45.8ab","name":"fileToken","url":"/fileToken","method":"post","upload":false,"swaggerDoc":"","x":100,"y":1380,"wires":[["792d587f.710968"]]},{"id":"792d587f.710968","type":"function","z":"22428f45.8ab","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":1380,"wires":[["7250dc5f.760624"]]},{"id":"7250dc5f.760624","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":310,"y":1380,"wires":[]},{"id":"34064a7f.c391a6","type":"comment","z":"22428f45.8ab","name":"","info":"payload :{\n    fileToken   : STRING\n    RevotioToken: STRING,\n    fileName    : STRING,\n    filePath    : STRING,\n    \n}","x":100,"y":1340,"wires":[]},{"id":"97591da2.87f82","type":"http in","z":"22428f45.8ab","name":"download","url":"/download","method":"get","upload":false,"swaggerDoc":"","x":100,"y":1480,"wires":[["29e81316.44426c"]]},{"id":"29e81316.44426c","type":"function","z":"22428f45.8ab","name":"Get file","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar fs = global.get('fsextra');\nvar mime = global.get('mime');\n\n\n// msg.payload.token = \"valid token\"\n\n msg.payload.tokenValid = false\n\nTokenContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.payload[\"token\"], global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n           msg.payload.tokenValid = true\n          TokenContent = decoded\n      }\n    });\n    \nif ( msg.payload.tokenValid === true ){\n\n        // check if file exists\n        var state = false\n        if (msg.payload.hasOwnProperty(\"file\") &&  fs.existsSync(msg.payload.file)) { \n            state = true\n        } \n        \n        if (state === true){\n            // msg.payload.fileExtension = msg.payload.file.split(\".\")[msg.payload.file.split(\".\").length - 1]\n            msg.payload.fileType = mime.getType(msg.payload.file); \n             msg.payload.fileExtension = mime.getExtension(msg.payload.fileType); \n            msg.payload.folder = \"\"\n            \n            _.each(msg.payload.file.split(\"/\"), function(string, index){\n                if (index === 0){\n                     msg.payload.folder = string\n                } else {\n                    if (msg.payload.file.split(\"/\").length > index + 1){\n                        msg.payload.folder = msg.payload.folder +\"/\"+ string\n                    }\n                }\n            })\n        \n                    if (msg.payload.type === \"thumbnail\"){\n                         data = fs.readFileSync(msg.payload.file);\n                            msg.payload.base64 =  data.toString('base64');\n                                  \n                                \n                                  fs.stat(msg.payload.file, function(err, stats) {\n                                     \n                                      msg.payload.stats = stats;\n                                        \n                                            node.send(msg);\n                                  })\n                       \n                    } else {\n                            data = fs.readFileSync(msg.payload.file);\n                            msg.payload.base64 =  data.toString('base64');\n                                  \n                                \n                                  fs.stat(msg.payload.file, function(err, stats) {\n                                     \n                                      msg.payload.stats = stats;\n                                       \n                                            node.send(msg);\n                                  })\n                    }\n        \n        } else {\n            msg.payload.error = \"file does not exists\"\n            node.send(msg)\n        }\n} \nelse {\n       msg.payload.error = \"Invalid token\"\n      node.send(msg) \n}\n\n\n\n// return msg;","outputs":1,"noerr":0,"x":210,"y":1480,"wires":[["3a83d709.2a89f8","8d13220a.064cb","10876916.4d4127"]]},{"id":"3a83d709.2a89f8","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":430,"y":1480,"wires":[]},{"id":"ae618d7a.66202","type":"comment","z":"22428f45.8ab","name":"","info":"payload :{\n    fileToken   : STRING\n    RevotioToken: STRING,\n    fileName    : STRING,\n    filePath    : STRING,\n    \n}","x":100,"y":1440,"wires":[]},{"id":"53c36d8e.ef37d4","type":"function","z":"22428f45.8ab","name":"Remove Session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar Data = msg.payload;\n\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\n\nif (Data.revotioSessionId){\n    query= {\n        deviceId : Data.deviceId,\n        revotioSessionId : Data.revotioSessionId,\n    }\n    \n   \n} else {\n    query = {\n        deviceId : Data.deviceId,\n    }\n} \n\n// get session\n\nfindOneObj = {\n                    query : {\n                            query :query\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    session = res[0]\n                } else {\n                    session = {}\n                }\n                \n                session.closed = new Date()\n                // Save session in closed sessions\n                    updateObj = {\n                                    query : {\n                                            query :query, \n                                            update : { \"$set\" : session},\n                                            options : {upsert: true}\n                                            },\n                                    connection:global.get(\"DB_data.connection\"),\n                                    database:global.get(\"DB_data.appDB\"),\n                                    collection:'sessions_closed',\n                                    operation:'update', // updateMany , updateOne\n                                    }\n                \n                            mongodbTools.resolveAsync(updateObj, node, function(res){\n                                    \n                                    // remove \n                                    removeObj = {\n                                            query : {\n                                                    query :query,\n                                                    },\n                                            connection:global.get(\"DB_data.connection\"),\n                                            database:global.get(\"DB_data.appDB\"),\n                                            collection:'sessions',\n                                            operation:'remove',\n                                            }\n                        \n                                    mongodbTools.resolveAsync(removeObj, node, function(res){\n                                             // remove \n                                            removeObj = {\n                                                    query : {\n                                                            query :query,\n                                                            },\n                                                    connection:global.get(\"DB_data.connection\"),\n                                                    database:global.get(\"DB_data.appDB\"),\n                                                    collection:'page_load_sessions',\n                                                    operation:'remove',\n                                                    }\n                                \n                                            mongodbTools.resolveAsync(removeObj, node, function(res){\n                                                    // msg.payload = {\n                                                    //     state : \"success\"\n                                                    // }\n                                                    node.send(msg) \n                                            })   \n                                    })   \n                            })  \n\n                   \n            })  \n            ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":1180,"wires":[["bdf80280.f7416","57f0ceaa.0ac0b"]]},{"id":"bdf80280.f7416","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":550,"y":1180,"wires":[]},{"id":"d376f67a.c86588","type":"link out","z":"22428f45.8ab","name":"","links":["dc664b4f.0d82e","561c8154.e2038"],"x":175,"y":1220,"wires":[]},{"id":"845ccdd6.1fbfe","type":"comment","z":"22428f45.8ab","name":"CHECK GC state","info":"","x":260,"y":1220,"wires":[]},{"id":"eeabaf73.14d32","type":"debug","z":"22428f45.8ab","name":"Pre Request","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2850,"y":780,"wires":[]},{"id":"2051aa96.2da936","type":"debug","z":"22428f45.8ab","name":"INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":940,"y":500,"wires":[]},{"id":"4e8bb101.951b7","type":"debug","z":"22428f45.8ab","name":"ACTION post","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":660,"wires":[]},{"id":"18300eee.bc13f1","type":"debug","z":"22428f45.8ab","name":"ENTERANCE post","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":550,"y":140,"wires":[]},{"id":"f78a0942.6bb1d8","type":"debug","z":"22428f45.8ab","name":"UPLOAD post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":460,"y":1240,"wires":[]},{"id":"48bfdd4e.c29a24","type":"inject","z":"22428f45.8ab","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":200,"wires":[["18300eee.bc13f1","5d156f35.b0e81"]]},{"id":"4324a1f8.df305","type":"function","z":"22428f45.8ab","name":"Check user inv","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n       \n    var query = {type: \"project\", organization_id:new ObjectID( msg.RevotioData.session.permission.organizationData._id)};\n// find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'participants',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n// }\n\n\n// return msg;","outputs":1,"noerr":0,"x":2040,"y":360,"wires":[["39e92084.90cc6"]]},{"id":"516e0d62.dc0d14","type":"debug","z":"22428f45.8ab","name":"TOKEN post FILE","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1130,"y":900,"wires":[]},{"id":"3566286.33b3cd8","type":"function","z":"22428f45.8ab","name":"Add session to session_stats","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// _id management\nObj = msg.current_session;\nObj.session_id = new ObjectID(msg.current_session._id)\nmsg.current_session._id = new ObjectID();\n\n// Add redirect data\n\nObj.destination_page =  msg.responseObj.Page\nObj.redirect_time =  new Date()\n\n// remove current session flowData\n\ndelete Obj.FlowData\nObj.redirect_revotio_data =  msg.responseObj.RevotioData\nObj.user_id = new ObjectID(Obj.user_id)\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :Obj, \n                            update : { \"$set\" : Obj},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'session_stats',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    // node.send(msg) \n            })  ","outputs":1,"noerr":0,"x":1760,"y":960,"wires":[[]]},{"id":"3dbe8cdf.cfd5b4","type":"function","z":"22428f45.8ab","name":"Get session","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// findOne \nfindOneObj = {\n                    query : {\n                            query :{revotioSessionId: msg.responseObj.revotioSessionId, deviceId:msg.responseObj.deviceId} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.current_session = res[0]\n                } else {\n                    msg.current_session = {}\n                }\n                    \n                    node.send(msg) \n            })  ","outputs":1,"noerr":0,"x":1550,"y":940,"wires":[["3566286.33b3cd8","4310a895.50d9d8"]]},{"id":"dab1e7c8.d77be8","type":"http in","z":"22428f45.8ab","name":"error","url":"/error","method":"post","upload":false,"swaggerDoc":"","x":90,"y":1560,"wires":[["46d21342.624c3c"]]},{"id":"7d86d135.960c5","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":550,"y":1560,"wires":[]},{"id":"9b803e79.d335c","type":"comment","z":"22428f45.8ab","name":"","info":"payload :{\n    fileToken   : STRING\n    RevotioToken: STRING,\n    fileName    : STRING,\n    filePath    : STRING,\n    \n}","x":100,"y":1520,"wires":[]},{"id":"46d21342.624c3c","type":"function","z":"22428f45.8ab","name":"save error in error collection","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar fs = global.get('fsextra');\nvar mime = global.get('mime');\n\npayload = msg.payload;\npostData = JSON.parse(msg.payload.postData)\nerror = msg.payload.error\nObj = {\n        data : {\n            postData:postData,\n            error:error,\n        },\n        date  :new Date(),\n        app : global.get(\"applicationId\"),\n        type:\"publisher\"\n}\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :Obj, \n                            update : { \"$set\" : Obj},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'errors',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    msg.payload =   {\n                                        msg: payload,\n                                        state:  \"error processed\"\n                                    }\n                       \n                    node.send(msg) \n            })  ","outputs":1,"noerr":0,"x":320,"y":1540,"wires":[["7d86d135.960c5"]]},{"id":"370f35d5.83dd6a","type":"subflow:be61da9a.8b3cd8","z":"22428f45.8ab","name":"","env":[],"x":320,"y":40,"wires":[["8653bb23.0e7148"]]},{"id":"62109c28.38f404","type":"function","z":"22428f45.8ab","name":"prepair redirect to user authentication && update session object","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload  = {\n    Page :global.get(\"DomainProperties.NonAuthDefaultPage\")\n}\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{\n                                    revotioSessionId:msg.RevotioData.session.revotioSessionId, \n                                    deviceId : msg.RevotioData.session.deviceId\n                            }, \n                            update : { \"$set\" : msg.RevotioData.session},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                   \n                    node.send(msg) \n            })  \n\n","outputs":1,"noerr":0,"x":2070,"y":420,"wires":[["4f77ff18.3df8f"]]},{"id":"346559fb.3bd3e6","type":"debug","z":"22428f45.8ab","name":"ENTERANCE post A","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":900,"y":280,"wires":[]},{"id":"22a7057b.fcb6ba","type":"debug","z":"22428f45.8ab","name":"Pre get session","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2660,"y":220,"wires":[]},{"id":"8873bf3d.db5de","type":"function","z":"22428f45.8ab","name":"Redirect to user landing page","func":"msg.payload  = {\n    Page :global.get(\"DomainProperties.ClientDefaultPage\")\n}\nreturn msg;","outputs":1,"noerr":0,"x":810,"y":840,"wires":[["534fed46.ceb0f4"]]},{"id":"2254455d.8aee2a","type":"function","z":"22428f45.8ab","name":"Load page ","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar fileLoad, fileNotLoaded;\n\nmsg.page = msg.responseObj.Page + \".json\"\n\nmsg.pagePublisherBranch = env.get(\"pagePublisherBranch\")\n// get  pagePublisherBranch ENV\n\n        if (env.get(\"pagePublisherBranch\") &&\n            env.get(\"pagePublisherBranch\") === \"master\"){\n              \n              if (fs.existsSync(\"/root/.node-red/projects/PNO_portfolio_management/pages/\" + msg.page)) {\n            msg.rawdata = fs.readFileSync(\"/root/.node-red/projects/PNO_portfolio_management/pages/\" + msg.page);\n            msg.pageObject = JSON.parse(msg.rawdata);\n            fileLoad = msg;\n        } else {\n            msg.headers = {};\n            msg.rejectUnauthorized =  false;\n        \n        \n            url = global.get(\"innonation_api\")+ \"/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page ;\n            res = encodeURI(url);\n                \n            msg.url = res\n            fileNotLoaded = msg\n        }\n\n    } else {\n            msg.headers = {};\n            msg.rejectUnauthorized =  false;\n        \n        \n            url = global.get(\"innonation_api\")+ \"/pages?\" +  \"applicationId=\"  + msg.responseObj.applicationId + \"&pageName=\"+  msg.responseObj.Page ;\n            res = encodeURI(url);\n                \n            msg.url = res\n            fileNotLoaded = msg\n    }\n\nreturn [fileLoad, fileNotLoaded];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":890,"y":920,"wires":[["516e0d62.dc0d14","3318562b.47220a"],["983ec1b8.b05dd"]],"outputLabels":["fileLoad","fileNotLoaded"]},{"id":"3318562b.47220a","type":"json","z":"22428f45.8ab","name":"Parse page file","property":"pageObject","action":"","pretty":false,"x":1140,"y":940,"wires":[["18d61a14.1b2d76"]]},{"id":"18d61a14.1b2d76","type":"function","z":"22428f45.8ab","name":"Set ","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.responseObj.presentationLayer = msg.pageObject\nmsg.appObj =msg.pageObject;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1270,"y":940,"wires":[["3dbe8cdf.cfd5b4","137eb072.4e54a"]]},{"id":"137eb072.4e54a","type":"debug","z":"22428f45.8ab","name":"TOKEN post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1450,"y":900,"wires":[]},{"id":"bd6bfd6d.c939b","type":"function","z":"22428f45.8ab","name":"project overview change","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nvar found, notFound;\n\nif (msg.responseObj.Page   === \"project overview\"){\n    \n   obj = { time: new Date(),\n            sourcePage : msg.RevotioData.session.Page\n   }\n   \n   if (msg.RevotioData.PostData ){\n       obj.postData = msg.RevotioData.PostData\n   }\n   \n    fs.ensureDirSync(\"/root/.node-red/projects/PNO_portfolio_management/analysis\")\n  \n    fs.writeJsonSync(\"/root/.node-red/projects/PNO_portfolio_management/analysis/\"+new Date()+ \".json\", JSON.stringify(obj))\n\n    msg.responseObj.Page   = \"default project overview\"\n    found = msg;\n}  else {\n    notFound = msg;\n}\nreturn [found, notFound];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":670,"y":920,"wires":[["2254455d.8aee2a"],["2254455d.8aee2a"]],"outputLabels":["found, ","notFound"]},{"id":"f97150ae.cf23d","type":"function","z":"22428f45.8ab","name":"Parse object && save json file","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.responseObj.presentationLayer = JSON.parse(msg.payload).pages[0];\nmsg.appObj = JSON.parse(msg.payload);\n\nfs.ensureDirSync(\"/root/.node-red/projects/PNO_portfolio_management/pages/\")\n\nfs.writeJsonSync(\"/root/.node-red/projects/PNO_portfolio_management/pages/\"+msg.responseObj.presentationLayer.name.toLowerCase().trim() + \".json\", JSON.stringify(msg.responseObj.presentationLayer))\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":1000,"wires":[["3dbe8cdf.cfd5b4"]],"outputLabels":["Items, "]},{"id":"983ec1b8.b05dd","type":"http request","z":"22428f45.8ab","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":1110,"y":1000,"wires":[["f97150ae.cf23d"]]},{"id":"357858a9.3a7a18","type":"function","z":"22428f45.8ab","name":"Parse object","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\n\n\nmsg.responseObj.presentationLayer = JSON.parse(msg.payload).pages[0];\nmsg.appObj = JSON.parse(msg.payload);\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":1440,"wires":[[]],"outputLabels":["Items, "]},{"id":"808d5c5c.169a6","type":"http request","z":"22428f45.8ab","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":1440,"wires":[["357858a9.3a7a18"]]},{"id":"7e246bb3.a4bdc4","type":"function","z":"22428f45.8ab","name":"Get user & organization type data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n            aggregateObj = {\n                    query : { query : [{\n                                $match: {\n                                  user : new ObjectID(msg.RevotioData.session.user_id),\n                                  \"type\": \"organization\",\n                                  \"permission_type\": \"organization\"\n                                }\n                              },\n                         {\n                             \"$lookup\":{\n                                        from: \"organizations\",\n                                        localField: \"type_id\",\n                                        foreignField: \"_id\",\n                                        as: \"organizationData\"\n                                    }\n                         },\n                         {\n                             \"$unwind\":\n                             {\n                                path : \"$organizationData\",\n                                includeArrayIndex : \"arrayIndex\", // optional\n                                preserveNullAndEmptyArrays : true // optional\n                            }\n                         }\n                         \n                            ],},\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_permissions',\n                    operation:'aggregate',\n                    }\n                    \n            mongodbTools.resolveAsync(aggregateObj, node, function(res){\n                 if (res.length > 0){\n                    msg.RevotioData.session.permission = res[0]\n                } else {\n                    msg.RevotioData.session.permission = {}\n                }\n                    \n                    node.send(msg) \n            })  \n            \n           \n ","outputs":1,"noerr":0,"x":1240,"y":320,"wires":[["a568dd87.1b6dc","967bc07e.c7f2c"]]},{"id":"beee4a6.d97e5b8","type":"debug","z":"22428f45.8ab","name":"Pre redir4ect 2/2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3410,"y":280,"wires":[]},{"id":"35b6d281.c3180e","type":"debug","z":"22428f45.8ab","name":"Pre redir4ect 1/2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2930,"y":280,"wires":[]},{"id":"f146e39e.4c4e5","type":"debug","z":"22428f45.8ab","name":"EXIT POST","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"msg","x":350,"y":1200,"wires":[]},{"id":"f207746d.fc46e8","type":"json","z":"22428f45.8ab","name":"","property":"payload","action":"","pretty":false,"x":230,"y":1180,"wires":[["53c36d8e.ef37d4","f146e39e.4c4e5"]]},{"id":"57f0ceaa.0ac0b","type":"debug","z":"22428f45.8ab","name":"EXIT POST - response","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"msg","x":600,"y":1220,"wires":[]},{"id":"f26cc4af.43ec38","type":"function","z":"22428f45.8ab","name":"Get /Set key","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n//**********************************************\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{    revotioSessionId:msg.PostPayload.content.revotioSessionId,\n                                        deviceId:msg.PostPayload.content.deviceId}, \n                            update : { \"$set\" : {token : msg.payload.token}},\n                            options : {upsert: true, returnOriginal: false}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'findOneAndUpdate', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.findOneAndUpdateResponse = res\n                    node.send(msg) \n            })  \n\n// return msg;\n// Get key\n\n// if ( typeof msg.payload.TokenContent === \"object\" && \n//     msg.payload.TokenContent.deviceId   && \n//     msg.payload.TokenContent.revotioSessionId\n//     ){\n    \n    \n    \n\n//     findOneObj = {\n//                         query : {\n//                                 query :{\n//                                     revotioSessionId:msg.payload.TokenContent.revotioSessionId,\n//                                     deviceId:msg.payload.TokenContent.deviceId\n//                                 } \n//                                 },\n//                         connection:global.get(\"DB_data.connection\"),\n//                         database:global.get(\"DB_data.appDB\"),\n//                         collection:'sessions',\n//                         operation:'find',\n//                         }\n    \n//                 mongodbTools.resolveAsync(findOneObj, node, function(res){\n//                     if (res.length > 0){\n//                         msg.payload.key = res[0]._id\n//                     } \n    \n//                         node.send(msg) \n//                 })  \n\n// } else {\n//     node.send(msg)\n// }\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":1040,"wires":[["7f9dfbf6.4ce354","95ad1aec.c05398"]]},{"id":"57ab671a.bbe478","type":"function","z":"22428f45.8ab","name":"Token API","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar jsonwebtoken = global.get('jsonwebtoken');\n\nvar generate, validate, key, error;\n\nif (typeof msg.payload === 'string'){\n    payload = JSON.parse(msg.payload)\n    msg.payload = payload;\n} \nif (typeof msg.payload === 'string'){\n    payload = JSON.parse(msg.payload)\n    msg.payload = payload;\n} \nif (typeof msg.payload.content === 'string'){\n    var content = JSON.parse(msg.payload.content)\n    msg.payload.content = content;\n} \n\nmsg.PostPayload  = msg.payload;\n\nmsg.token = msg.PostPayload.token\n\nmsg.headers = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Methods': 'PUT,GET,POST,DELETE,OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'content-type': 'application/json',\n};\n\n        if (msg.PostPayload.type === \"generate\"  && msg.PostPayload.content && msg.PostPayload.content.deviceId){\n\n            generate = msg;\n        } else if (msg.PostPayload.type === \"validate\" &&  msg.PostPayload.token){\n            validate = msg;\n            \n        } else if (msg.PostPayload.type === \"key\" &&  msg.PostPayload.token ){\n            key = msg;\n            \n        } else {\n          error = msg\n        }\n\nreturn [generate, validate, key, error];","outputs":4,"noerr":0,"initialize":"","finalize":"","x":660,"y":1060,"wires":[["5cc34c91.c06a64"],["e6839973.216ab8"],["434697e9.1ff3b8"],["cc28556a.cb7078"]],"outputLabels":["generate","validate","key","error"]},{"id":"2ec8c2a4.2c5d3e","type":"function","z":"22428f45.8ab","name":"KEY","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ntokenState = \"invalid\"\nTokenContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.PostPayload.token, global.get(\"SystemVars.secret\"), function(err, decoded) {\n      if (decoded !== undefined){\n          tokenState = \"valid\"\n          TokenContent = decoded\n      }\n    });\n    \n    payload = { type:msg.PostPayload.type, token : msg.PostPayload.token  , tokenState : tokenState }; //, TokenContent:TokenContent ,key: TokenContent.key\n    \n    msg.payload = payload ;\n    return msg;\n    // findOneObj = {\n    //                             query : {\n    //                                     query :{revotioSessionId:msg.PostPayload.content.revotioSessionId, \n    //                                             deviceId : msg.PostPayload.content.deviceId} \n    //                                     },\n    //                             connection:global.get(\"DB_data.connection\"),\n    //                             database:global.get(\"DB_data.appDB\"),\n    //                             collection:'sessions',\n    //                             operation:'find',\n    //                             }\n            \n    //                     mongodbTools.resolveAsync(findOneObj, node, function(res){\n    //                         if (res.length > 0){\n    //                             msg.payload.key = res[0]._id\n    //                         } \n                        //   node.send(msg)  \n                        // })\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1120,"wires":[["7f9dfbf6.4ce354","95ad1aec.c05398"]]},{"id":"cc28556a.cb7078","type":"function","z":"22428f45.8ab","name":"error","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = \"invalid post request - type\";\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1160,"wires":[["7f9dfbf6.4ce354","95ad1aec.c05398"]]},{"id":"e6839973.216ab8","type":"subflow:53926ffd.c5a74","z":"22428f45.8ab","name":"","env":[],"x":760,"y":1080,"wires":[["bd71e02b.86b74"]]},{"id":"bd71e02b.86b74","type":"function","z":"22428f45.8ab","name":"Validate","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n    \n    msg.payload = { type:msg.PostPayload.type, token : msg.tokenResult.token  , tokenState : msg.tokenResult.tokenState }; // TokenContent:TokenContent ,key: msg.tokenResult.key\n    \n   \n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":1080,"wires":[["7f9dfbf6.4ce354","95ad1aec.c05398"]]},{"id":"434697e9.1ff3b8","type":"subflow:53926ffd.c5a74","z":"22428f45.8ab","name":"","env":[],"x":760,"y":1120,"wires":[["2ec8c2a4.2c5d3e"]]},{"id":"358ba198.43c70e","type":"subflow:53926ffd.c5a74","z":"22428f45.8ab","name":"","env":[],"x":420,"y":260,"wires":[["18300eee.bc13f1","419c886f.616e68"]]},{"id":"419c886f.616e68","type":"function","z":"22428f45.8ab","name":"Decrypt","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n        \ndataState = \"invalid\"\ndataContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.payload.data, msg.tokenResult.key, function(err, decoded) {\n      if (decoded !== undefined){\n          dataState = \"valid\"\n          dataContent = decoded\n      }\n    });\n    \n    msg.dataResult = {\n        \n        data : msg.payload.data  ,\n        dataState : dataState,\n        key: msg.tokenResult.key, \n        dataContent:dataContent\n    }\n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":260,"wires":[["57dd5648.3cade8","d25f097e.01e458"]]},{"id":"57dd5648.3cade8","type":"debug","z":"22428f45.8ab","name":"ENTERANCE post A","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":900,"y":160,"wires":[]},{"id":"16987802.9cc1b8","type":"function","z":"22428f45.8ab","name":"Set msg.token","func":"\nmsg.token = msg.payload.token\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":480,"wires":[["cd161118.d929e"]]},{"id":"cd161118.d929e","type":"subflow:53926ffd.c5a74","z":"22428f45.8ab","name":"","env":[],"x":480,"y":480,"wires":[["64e30f7f.75341"]]},{"id":"64e30f7f.75341","type":"function","z":"22428f45.8ab","name":"Decrypt","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n        \ndataState = \"invalid\"\ndataContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.payload.data, msg.tokenResult.key, function(err, decoded) {\n      if (decoded !== undefined){\n          dataState = \"valid\"\n          dataContent = decoded\n      }\n    });\n    \n    msg.dataResult = {\n        \n        data : msg.payload.data  ,\n        dataState : dataState,\n        key: msg.tokenResult.key, \n        dataContent:dataContent\n    }\n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":480,"wires":[["2051aa96.2da936","91f18bc9.521138"]]},{"id":"95c91e78.e2e0d","type":"function","z":"22428f45.8ab","name":"Set msg.token","func":"\nmsg.token = msg.payload.token\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":720,"wires":[["a65378af.4bceb8"]]},{"id":"a65378af.4bceb8","type":"subflow:53926ffd.c5a74","z":"22428f45.8ab","name":"","env":[],"x":500,"y":720,"wires":[["969b994a.6d3158"]]},{"id":"969b994a.6d3158","type":"function","z":"22428f45.8ab","name":"Decrypt","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n        \ndataState = \"invalid\"\ndataContent = {};\n// verify a token symmetric\n    jsonwebtoken.verify(msg.payload.data, msg.tokenResult.key, function(err, decoded) {\n      if (decoded !== undefined){\n          dataState = \"valid\"\n          dataContent = decoded\n      }\n    });\n    \n    msg.dataResult = {\n        \n        data : msg.payload.data  ,\n        dataState : dataState,\n        key: msg.tokenResult.key, \n        dataContent:dataContent\n    }\n    return msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":720,"wires":[["4e8bb101.951b7","ad02ca99.ed0958"]]},{"id":"639c54a7.45bdac","type":"debug","z":"22428f45.8ab","name":"Pre Request With data ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3140,"y":1040,"wires":[]},{"id":"4bb16b7e.2206a4","type":"debug","z":"22428f45.8ab","name":"Pre action REQUEST","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1630,"y":700,"wires":[]},{"id":"3330057.39240fa","type":"function","z":"22428f45.8ab","name":"Validate pageSession call","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar sessionRequest, logout;\n// validate pageSession call\n\nif (    msg.RevotioData.session.hasOwnProperty(\"pageSessionId\") &&\n        ObjectID.isValid(msg.RevotioData.session.pageSessionId)=== true\n){\n    sessionRequest = msg\n} else {\n    logout = msg\n}\n\n\nreturn [sessionRequest, logout];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1010,"y":460,"wires":[["6e52c24e.32c77c"],["58fbe66b.db29c8"]],"outputLabels":["sessionRequest, ","logout"]},{"id":"6e52c24e.32c77c","type":"function","z":"22428f45.8ab","name":"Process pageSession call","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// findOne \nfindOneObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.RevotioData.session.pageSessionId)} \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'page_load_sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.payload = res[0]\n                } else {\n                   msg.payload = {}\n                }\n                \n                if (    msg.payload.hasOwnProperty(\"pageObject\") && \n                        msg.payload.pageObject.hasOwnProperty(\"revotioSessionId\")\n                ){\n                      msg.payload.pageObject.revotioSessionId = msg.RevotioData.session.revotioSessionId\n                \n                }\n              \n// //          remove gadgets list\n\n// if ( msg.payload.pageObject.Page === \"organization overview\"){\n    delete msg.payload.gadgetsList\n// }\n\n\n                    \n                    node.send(msg) \n            }) \n\n\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1310,"y":460,"wires":[["b918a2d4.ad163"]]},{"id":"58fbe66b.db29c8","type":"subflow:ab79407.ded3ec","z":"22428f45.8ab","name":"","env":[],"x":1150,"y":540,"wires":[]},{"id":"9ae0c558.f913a8","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":2310,"y":540,"wires":[]},{"id":"ffa0b47b.784c08","type":"function","z":"22428f45.8ab","name":"Update Session to match location user && gen page_session_id -- enterance --","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nresponseObj = msg.payload.pageObject;\n\nObj =  {timestamp : new Date(),\n        applicationId: new ObjectID(global.get(\"applicationId\")),\n        // session : msg.RevotioData.session\n}\n\nObj.revotioSessionId =  msg.RevotioData.session.revotioSessionId;\nObj.deviceId =  msg.RevotioData.session.deviceId;\n\n\nif (msg.payload.pageObject.user_id){\n    Obj.user_id =  msg.payload.pageObject.user_id;\n}\n\nif (msg.payload.pageObject.RevotioData.userData){\n    Obj.userData =  msg.payload.pageObject.RevotioData.userData;\n}\n\nif (msg.payload.pageObject.Page){\n    Obj.Page =  msg.payload.pageObject.Page;\n}\n\nif (typeof msg.payload.pageObject.RevotioData === 'object'){\n    Obj.FlowData = msg.payload.pageObject.RevotioData\n    Obj.FlowData.Data  = {}\n} else {\n     Obj.FlowData = {Data:{}}\n}\n\n\nObj.token = msg.token\nObj.pageName  = msg.payload.pageName\n\nif (msg.payload.pageObject.presentationLayer && msg.payload.pageObject.presentationLayer.container && msg.payload.pageObject.presentationLayer.container !== null){\n    Obj.container =  msg.payload.pageObject.presentationLayer.container;\n}\n\n\n{\n             \n                                               \nObj.Gadgets =  [];\nObj.Page= msg.payload.pageObject.presentationLayer.name;\nObj.groupedObject =  msg.payload.pageObject.presentationLayer.groupedObject;\nObj.page_id =  new ObjectID(msg.payload.pageObject.presentationLayer._id);\n                            }\n\nupdateObj = {\n                    query : {\n                            query :{deviceId: responseObj.deviceId, revotioSessionId: responseObj.revotioSessionId}, \n                            update : {\"$set\" : Obj},\n                            options : {upsert: true, returnOriginal: false}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'sessions',\n                    operation:'findOneAndUpdate', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                \n                msg.session = res\n                \n                // if (typeof res === 'object' && res.hasOwnProperty(\"value\")){\n                    \n                //     //  msg.payload = res.value\n                     \n                // } else {\n                //     msg.payload = {};\n                // }\n                \n                // update    \n\n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(Obj.FlowData.page_session_id)}, \n                            update : { \"$set\" : {date : new Date(), deviceId: Obj.deviceId, revotioSessionId: Obj.revotioSessionId}},\n                            options : {upsert: true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'page_load_sessions',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            })  \n            \n            \n            })\n                    ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1780,"y":520,"wires":[["27e0db6d.5be984","50435091.c9859"]]},{"id":"56ebf668.007fb8","type":"inject","z":"22428f45.8ab","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1110,"y":1260,"wires":[["c74a80dc.3be26"]]},{"id":"c74a80dc.3be26","type":"function","z":"22428f45.8ab","name":"","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nmsg.RevotioData = {\n    session:{\n        pageSessionId:new ObjectID(\"5f840c84c9cb71c19290efc7\")\n    }\n}\n\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1390,"y":1280,"wires":[["3330057.39240fa"]]},{"id":"27e0db6d.5be984","type":"debug","z":"22428f45.8ab","name":"@@@###@@@##@#","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2180,"y":580,"wires":[]},{"id":"8eb478dc.adf1e8","type":"debug","z":"22428f45.8ab","name":"PRE INIT REQUEST","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1280,"y":660,"wires":[]},{"id":"967bc07e.c7f2c","type":"debug","z":"22428f45.8ab","name":"Pre redirect dececion","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1890,"y":180,"wires":[]},{"id":"50435091.c9859","type":"function","z":"22428f45.8ab","name":"Encrypt data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\npayload = {\n    data : jsonwebtoken.sign(msg.payload, msg.tokenResult.key),\n    token:msg.RevotioData.session.token,\n    pageSessionId:msg.RevotioData.session.pageSessionId,\n    pageName:msg.payload.pageName\n};\nmsg.payload = payload;\n\nreturn msg;\n            \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2150,"y":540,"wires":[["9ae0c558.f913a8"]]},{"id":"426a3309.63179c","type":"debug","z":"22428f45.8ab","name":"POST REDIRECT","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3570,"y":320,"wires":[]},{"id":"9141ef07.3fc94","type":"subflow:ab79407.ded3ec","z":"22428f45.8ab","name":"","env":[],"x":1910,"y":660,"wires":[]},{"id":"b918a2d4.ad163","type":"function","z":"22428f45.8ab","name":"validate","func":"var valid, logout;\n\nif ( typeof msg.payload === 'object' && msg.payload.hasOwnProperty(\"user_id\")){\n    valid = msg\n} else {\n    logout = msg\n}\nreturn [ valid, logout];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1340,"y":540,"wires":[["ffa0b47b.784c08"],["9ee02b6d.d40548","4bb16b7e.2206a4"]],"outputLabels":["valid","logout"]},{"id":"9ee02b6d.d40548","type":"subflow:ab79407.ded3ec","z":"22428f45.8ab","name":"","env":[],"x":1570,"y":560,"wires":[]},{"id":"173ae262.6db51e","type":"function","z":"22428f45.8ab","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":100,"wires":[[]]},{"id":"8d13220a.064cb","type":"debug","z":"22428f45.8ab","name":"Download post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":480,"y":1420,"wires":[]},{"id":"10876916.4d4127","type":"function","z":"22428f45.8ab","name":"Check if file needs to be removed","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (msg.payload.file.startsWith(\"/files/tmp/TMP__exports/\")){\n    fs.removeSync(msg.payload.folder)\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":1440,"wires":[[]]},{"id":"c566be41.4720e","type":"inject","z":"a2b40f09.d18fd8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":940,"wires":[["288d2d5b.9a47c2"]]},{"id":"288d2d5b.9a47c2","type":"function","z":"a2b40f09.d18fd8","name":"get source file","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// findOne \nfindOneObj = {\n                    query : {\n                            query :{application_id:new ObjectID(\"5f22ab9e5c29cbe8cc52540c\"), name:\"organization_overview_time_focus\"}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.payload = res[0]\n                } else {\n                    msg.payload = {}\n                }\n                    \n                    node.send(msg) \n            })  ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":940,"wires":[["6f0a612d.c1a26","55b93eb4.ffef7"]]},{"id":"ad1dbf73.d9348","type":"debug","z":"a2b40f09.d18fd8","name":"B","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":880,"wires":[]},{"id":"6f0a612d.c1a26","type":"function","z":"a2b40f09.d18fd8","name":"get entity modal and ","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.modalContainer = msg.payload.content.container[3]\nmsg.groupedObject = {\n    key: \"47975d37-c5e4-bd28-d0b6-e09d2276bb44\",\n    value : msg.payload.groupedObject[\"47975d37-c5e4-bd28-d0b6-e09d2276bb44\"]\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":940,"wires":[["ad1dbf73.d9348","874fa2f1.8d53e"]]},{"id":"55b93eb4.ffef7","type":"debug","z":"a2b40f09.d18fd8","name":"A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":570,"y":880,"wires":[]},{"id":"874fa2f1.8d53e","type":"function","z":"a2b40f09.d18fd8","name":"Get pages","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// findOne \nfindOneObj = {\n                    query : {\n                            query :{application_id:new ObjectID(\"5f22ab9e5c29cbe8cc52540c\"), name:{\"$ne\":\"organization_overview_time_focus\"}}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                    msg.payload = [];\n                   _.each(res, function(pageObj, index){\n                        pageObj.content.container.push(msg.modalContainer)\n                        pageObj.groupedObject[msg.groupedObject.key] = msg.groupedObject.value\n                        msg.payload.push(pageObj)\n                   })\n                    node.send(msg) \n            })  ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":940,"wires":[["1355d1a3.a43cae","becfb0df.5ca03"]]},{"id":"1355d1a3.a43cae","type":"debug","z":"a2b40f09.d18fd8","name":"C","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":990,"y":880,"wires":[]},{"id":"15323210.b027ae","type":"function","z":"a2b40f09.d18fd8","name":"Update page","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n            \nif (msg.payload.hasOwnProperty(\"content\") && \n    msg.payload.hasOwnProperty(\"_id\")\n    ){\n\n    updateObj = {\n                    query : {\n                            query :{_id:new ObjectID(msg.payload._id)}, \n                            update : {\"$set\":{content: msg.payload.content, groupedObject: msg.payload.groupedObject}}, \n                            options :{upsert:true}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'update', // updateMany , updateOne\n                    }\n            \n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    // msg.payload = res\n                    node.send(msg) \n            })  \n            \n} else {\n    return msg\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1130,"y":900,"wires":[["becfb0df.5ca03","fda4bf1d.b2f6b"]]},{"id":"becfb0df.5ca03","type":"function","z":"a2b40f09.d18fd8","name":"Loop through page records ","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    itt.outArray.push(msg.payload)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":1140,"y":940,"wires":[["15323210.b027ae"],["dcd10b13.a1f788"]]},{"id":"dcd10b13.a1f788","type":"debug","z":"a2b40f09.d18fd8","name":"E","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1370,"y":1040,"wires":[]},{"id":"fda4bf1d.b2f6b","type":"debug","z":"a2b40f09.d18fd8","name":"D","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1390,"y":860,"wires":[]},{"id":"7b54b6d2.c1bdc8","type":"comment","z":"22428f45.8ab","name":"Global gadgets","info":"","x":260,"y":2160,"wires":[]},{"id":"ae5785c7.0c1788","type":"function","z":"22428f45.8ab","name":"Trigger remove actions per entity","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\n// delete all sub entities first\n_.each(msg.payload,function(SubItem, SubIndex){\n    node.send({organization_id:new ObjectID(SubItem._id)})\n} )\n\n// continue with main entity removal\n\nreturn msg;","outputs":1,"noerr":0,"x":1320,"y":2220,"wires":[["e15d5772.0e0df8","995ff8a2.63f6b8","4844d2da.33a67c"]]},{"id":"e53c7860.990738","type":"function","z":"22428f45.8ab","name":"Trigger delete project data","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif (msg.done === false ){\n    node.send(msg)\n}\n","outputs":1,"noerr":0,"x":1960,"y":2180,"wires":[["b5f3fdc7.4343c"]]},{"id":"be600bea.594778","type":"function","z":"22428f45.8ab","name":"check if msg.organization_id is present and prepair child lookup","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n\nvar valid, invalid\nif (msg.payload.hasOwnProperty(\"organization_id\")){\n\n    payload = {\"$or\": [{parent_id : new ObjectID(msg.payload.organization_id)}, {_id : new ObjectID(msg.payload.organization_id)} ] }\n    msg.operation = 'find.toArray'\n    msg.payload = payload\n    valid = msg\n} else {\n    invalid = msg\n}\n\nreturn [valid, invalid]","outputs":2,"noerr":0,"x":750,"y":2240,"wires":[["28fc6052.64dc2"],["fb27820e.4bb97"]],"outputLabels":["valid, ","invalid"]},{"id":"94966f9f.ffccb","type":"comment","z":"22428f45.8ab","name":"Delete all organization Data","info":"","x":380,"y":2200,"wires":[]},{"id":"1f04146c.c5c66c","type":"link in","z":"22428f45.8ab","name":"Delete all organization Data","links":["755fb71d.d2028","bfc74af8.6937b"],"x":515,"y":2200,"wires":[["be600bea.594778","851e478a.8f9ef8"]]},{"id":"efb566c8.5efc78","type":"function","z":"22428f45.8ab","name":"Get all app pages ","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n// find  \nfindObj = {\n                    query : {\n                            query : {\tapplication_id : new ObjectID(msg.payload.application_id)},\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n// return msg;","outputs":1,"noerr":0,"x":1090,"y":2300,"wires":[["48d6d059.1ebe2"]]},{"id":"3d51ab9c.83f104","type":"comment","z":"22428f45.8ab","name":"Delete all application data","info":"","x":410,"y":2320,"wires":[]},{"id":"79dc2356.f732cc","type":"link in","z":"22428f45.8ab","name":"Delete all project data","links":["b5f3fdc7.4343c","b298aff4.badb78","e9fb6492.5b068"],"x":495,"y":2320,"wires":[["f9261894.ca8358","7fef60a1.2197d"]]},{"id":"88dfad99.1b2e6","type":"function","z":"22428f45.8ab","name":"Libs","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif ( Array.isArray(msg.payload)){\n   _.each(msg.payload, function(Item, Index){\n    \n    msg.page_id = Item._id\n    node.send(msg);\n    \n    \n}); \n} else if (msg.payload.hasOwnProperty(\"page_id\")) {\n    msg.page_id = msg.payload.page_id\n    node.send(msg);\n} else{\n      msg.page_id = msg.payload._id\n    node.send(msg);\n}\n\n\n\n// return msg;","outputs":1,"noerr":0,"x":550,"y":2440,"wires":[["1c10dad8.d6dd35"]]},{"id":"879998ed.ad4368","type":"comment","z":"22428f45.8ab","name":"Remove all page data","info":"","x":380,"y":2400,"wires":[]},{"id":"d116d5bc.d0b7b8","type":"link in","z":"22428f45.8ab","name":"Remove all wp data","links":["48d6d059.1ebe2","5bc91a39.2b348c","cf312f50.45a118","148a291d.254577"],"x":475,"y":2400,"wires":[["88dfad99.1b2e6","3ffb599e.3cfae6"]]},{"id":"b5f3fdc7.4343c","type":"link out","z":"22428f45.8ab","name":"","links":["79dc2356.f732cc"],"x":2095,"y":2180,"wires":[]},{"id":"48d6d059.1ebe2","type":"link out","z":"22428f45.8ab","name":"","links":["d116d5bc.d0b7b8"],"x":1215,"y":2300,"wires":[]},{"id":"7b5b5f0d.80bcc","type":"http in","z":"22428f45.8ab","name":"removeOrganization","url":"/removeOrganization","method":"post","upload":false,"swaggerDoc":"","x":410,"y":2240,"wires":[["be600bea.594778","851e478a.8f9ef8"]]},{"id":"225ad824.8c4278","type":"http in","z":"22428f45.8ab","name":"removeApplication","url":"/removeApplication","method":"post","upload":false,"swaggerDoc":"","x":370,"y":2360,"wires":[["f9261894.ca8358","7fef60a1.2197d"]]},{"id":"b4649bdb.15fc58","type":"http in","z":"22428f45.8ab","name":"removePage","url":"/removePage","method":"post","upload":false,"swaggerDoc":"","x":370,"y":2440,"wires":[["88dfad99.1b2e6","3ffb599e.3cfae6"]]},{"id":"486017bd.73dec8","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":870,"y":2440,"wires":[]},{"id":"fb27820e.4bb97","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1050,"y":2260,"wires":[]},{"id":"f9261894.ca8358","type":"function","z":"22428f45.8ab","name":"check if msg.application_id is present and prepair child lookup","func":"var BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nvar valid, invalid\nif (msg.payload.hasOwnProperty(\"application_id\")){\n\n    // payload = {parent_id : new ObjectID(msg.payload.project_id)}\n    // msg.operation = 'find.toArray'\n    // msg.payload = payload\n    valid = msg\n} else {\n    invalid = msg\n}\n\nreturn [valid, invalid]","outputs":2,"noerr":0,"x":750,"y":2360,"wires":[["efb566c8.5efc78","4f0079fd.f87378"],["b8cd1575.e05088"]],"outputLabels":["valid, ","invalid"]},{"id":"b8cd1575.e05088","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1050,"y":2380,"wires":[]},{"id":"e167db41.388518","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1750,"y":2140,"wires":[]},{"id":"e15d5772.0e0df8","type":"function","z":"22428f45.8ab","name":"Remove Organization","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// remove \n            removeObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.organization_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(removeObj, node, function(res){\n                    msg.result = res\n                    node.send(msg) \n            }) ","outputs":1,"noerr":0,"x":1600,"y":2140,"wires":[["e167db41.388518"]]},{"id":"28fc6052.64dc2","type":"function","z":"22428f45.8ab","name":"get organizations","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n    // query = {\"$or\": [{parent_id : new ObjectID(msg.payload.organization_id)}, {_id : new ObjectID(msg.payload.organization_id)} ] }\n    // msg.operation = 'find.toArray'\n                    \n                // find  \n                findObj = {\n                    query : {\n                            query :msg.payload, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'organizations',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })   \n\n   ","outputs":1,"noerr":0,"x":1090,"y":2220,"wires":[["ae5785c7.0c1788"]],"outputLabels":["valid, "]},{"id":"995ff8a2.63f6b8","type":"function","z":"22428f45.8ab","name":"Remove all users && users data","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// find  \nfindObj = {\n                    query : {\n                            query :{organization_id: new ObjectID(msg.organization_id)}, \n                            projection:{_id :1}\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_accounts',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n                \n                _.each(res, function(user, index){\n                    \n                    // removeusers \n                        removeusers = {\n                                query : {\n                                        query :{_id:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'users',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeusers, node, function(res){\n                                \n                        }) \n                        \n                        // removeuser_accounts \n                        removeuser_accounts = {\n                                query : {\n                                        query :{user:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'user_accounts',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeuser_accounts, node, function(res){\n                                \n                        }) \n                        \n                         // removeuser_permissions\n                        removeuser_permissions = {\n                                query : {\n                                        query :{user:user._id}, \n                                        },\n                                connection:global.get(\"DB_data.connection\"),\n                                database:global.get(\"DB_data.appDB\"),\n                                collection:'user_permissions',\n                                operation:'remove',\n                                }\n            \n                        mongodbTools.resolveAsync(removeuser_permissions, node, function(res){\n                                \n                        }) \n                        \n                       \n                      \n                })\n                \n                    // msg.payload = res\n                    node.send(msg) \n            }) \n            \n// return msg;\n","outputs":1,"noerr":0,"x":1630,"y":2180,"wires":[[]]},{"id":"4f0079fd.f87378","type":"function","z":"22428f45.8ab","name":"Remove all application records && files","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n // removequery\n            pages = {\n                    query : {\n                            query :{application_id : new ObjectID(msg.payload.application_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(pages, node, function(res){\n                   \n            })  \n            \n \n          \n // removequery\n            application = {\n                    query : {\n                            query :{_id : new ObjectID(msg.payload.application_id)}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'applications',\n                    operation:'remove',\n                    }\n\n            mongodbTools.resolveAsync(application, node, function(res){\n                   \n            })  \n            \n            \n            \n    // remove all app files\n    fs.removeSync(global.get(\"DomainProperties.filesFolder\")+ \"applications/\" + msg.payload.application_id)\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1150,"y":2340,"wires":[["38e9efde.33218"]]},{"id":"38e9efde.33218","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":1330,"y":2340,"wires":[]},{"id":"1c10dad8.d6dd35","type":"function","z":"22428f45.8ab","name":"Remove all page records && files","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n \n // get page obj\n  findOneObj = {\n                    query : {\n                            query :{_id : new ObjectID(msg.page_id) }\n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOneObj, node, function(res){\n                if (res.length > 0){\n                    msg.page = res[0]\n                } else {\n                    msg.page = {}\n                }\n                    \n                // remove all app files\n                fs.removeSync(global.get(\"DomainProperties.filesFolder\")+ \"applications/\" + msg.page.application_id+\"/pages/\"+msg.page_id)\n\n                 // removequery\n                            pages = {\n                                    query : {\n                                            query :{_id : new ObjectID(msg.page_id)},\n                                            },\n                                    connection:global.get(\"DB_data.connection\"),\n                                    database:global.get(\"DB_data.appDB\"),\n                                    collection:'pages',\n                                    operation:'remove',\n                                    }\n                \n                            mongodbTools.resolveAsync(pages, node, function(res){\n                                   node.send(msg)\n                            })  \n            })  \n            ","outputs":1,"noerr":0,"x":740,"y":2440,"wires":[["486017bd.73dec8"]]},{"id":"4844d2da.33a67c","type":"function","z":"22428f45.8ab","name":"Get all org's applications ","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar query = {organization_id : new ObjectID(msg.organization_id)}\nmsg.done = false\n // find  \nfindObj = {\n                    query : {\n                            query :query, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'applications',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findObj, node, function(res){\n\n                    _.each(res, function(AppItem,AppItemIndex ){\n                        node.send({application_id :AppItem._id })\n                    })\n                   \n                    msg.done = true\n                    node.send(msg) \n            }) \n","outputs":1,"noerr":0,"x":1610,"y":2220,"wires":[["e53c7860.990738","e101b76a.ca28f8"]]},{"id":"e101b76a.ca28f8","type":"function","z":"22428f45.8ab","name":"Send response","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\nif (msg.done === true ){\n    node.send(msg)\n}\n","outputs":1,"noerr":0,"x":1920,"y":2220,"wires":[["1044ed72.f373c3"]]},{"id":"1044ed72.f373c3","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":2230,"y":2220,"wires":[]},{"id":"3ffb599e.3cfae6","type":"debug","z":"22428f45.8ab","name":"Remove page","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":630,"y":2580,"wires":[]},{"id":"7fef60a1.2197d","type":"debug","z":"22428f45.8ab","name":"Remove app","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":2320,"wires":[]},{"id":"851e478a.8f9ef8","type":"debug","z":"22428f45.8ab","name":"Remove org","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":650,"y":2140,"wires":[]},{"id":"4eea1368.e7a81c","type":"inject","z":"22428f45.8ab","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":880,"y":2060,"wires":[["d4196640.0694f8"]]},{"id":"d4196640.0694f8","type":"function","z":"22428f45.8ab","name":"Libs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\nvar unzipper =  global.get('unzipper')","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1140,"y":2020,"wires":[[]]},{"id":"4d6e8aaa.054e84","type":"function","z":"d8703926.e2eca","name":"gadgets menu","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.menu = [  {\n                                        name: \"Home\",\n                                        label: \"Home\",\n                                        button: true,\n                                        Page : \"landing page\",\n                                        buttonType: \"success\",\n                                        redirect:true,\n                                        // iconName: global.get(\"icons.fas.create\"),\n                                        // iconUrl: 'https://revotio.nl/webpages/images/icons/Add.svg',\n                                        // iconState: true,\n                                        inner:[]\n                            }, {\n                                        name: \"Action button\",\n                                        label: \"Action button\",\n                                        button: true,\n                                        Page : \"action button\",\n                                        buttonType: \"success\",\n                                        redirect:true,\n                                        // iconName: global.get(\"icons.fas.create\"),\n                                        // iconUrl: 'https://revotio.nl/webpages/images/icons/Add.svg',\n                                        // iconState: true,\n                                        inner:[]\n                            },\n                            \n                            \n                              {\n                                        name: \"Gadgets\",\n                                        label: \"Gadgets\",\n                                        button: false,\n                                        group  :true,\n                                        buttonType: \"success\",\n                                        redirect:false,\n                                        inner:[  {\n                                                                name: \"modal\",\n                                                                label: \"modal\",\n                                                                button: true,\n                                                                Page : \"modal\",\n                                                                buttonType: \"success\",\n                                                                redirect:true,\n                                                            \n                                                                inner:[]\n                                                   }]\n                            }]           ;\n\n// Create organizations group\n\ngadgetsDir = \"../../../var/www/pagePublisher/src/components/gadgets\"\n\n msg.files = []\nfs.readdir(gadgetsDir, (err, files) => { \n          if (err) \n            console.log(err); \n          else { \n              \n              // get pages\n             files.forEach(file => { \n                      newFile = file.replace('.vue','');\n                      newFile2 = newFile.replace('.js','');\n                      msg.files.push(newFile2)\n                      newFile3 = newFile2.replace('-','');\n                      \n                      if (lodash.includes(msg.files,newFile3 ) === false){\n                          msg.files.push(newFile3)\n                      }\n                    }) \n       \n     \nfindManyObj = {\n                    query : {\n                            query :{name : {\"$in\":msg.files} , application_id : new ObjectID(global.get(\"applicationId\"))}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:\"revotio\",\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findManyObj, node, function(res){\n                \n                node.warn({\n                    res:res,\n                    files: msg.files\n                })\n                 //node.warn({\"files\":files})\n                                lodash.orderBy(res,[\"name\"],['asc']).forEach(page => { \n                                  msg.menu[2].inner.push(\n                                          {\n                                        name: page.name,\n                                        label: page.name,\n                                        button: true,\n                                        Page : page.name,\n                                        buttonType: \"success\",\n                                        redirect:true,\n                                        // iconName: global.get(\"icons.fas.create\"),\n                                        // iconUrl: 'https://revotio.nl/webpages/images/icons/Add.svg',\n                                        // iconState: true,\n                                        inner:[]\n                            });\n                    }) \n                        _.each(msg.menu,function(item,index){\n                            if (msg.RevotioData.session.Page === item.Page ){\n                                item.active = true\n                            } else{\n                                   item.active = false\n                            }\n                        })            \n            \n                     msg.payload = {\n                        gadgetsList:[{\n                        gadgetName: 'menu',\n                        gadgetId: 'menu',\n                         gadgetData: {\n                             parent :{},\n                             child : msg.menu}\n                        }]\n            };\n\n          node.send(msg)\n            }) \n              \n           \n          } \n          \n          \n     \n}) \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1540,"y":700,"wires":[["b8cba8eb.07bea8","95883a5d.f23058"]],"outputLabels":["PNO, "]},{"id":"95883a5d.f23058","type":"debug","z":"d8703926.e2eca","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1820,"y":780,"wires":[]},{"id":"1d5c7c1a.5822e4","type":"comment","z":"9921cbf1.f82328","name":"breadcrumbs","info":"","x":130,"y":280,"wires":[]},{"id":"e52f4da2.66161","type":"comment","z":"9921cbf1.f82328","name":"Organization global gagdet actions","info":"","x":3300,"y":220,"wires":[]},{"id":"3fc109e8.319576","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2450,"y":180,"wires":[]},{"id":"9bf1ce82.a3dda","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","7fa9c732.feefe8"],"x":755,"y":400,"wires":[["9f66f0d8.42673","193edcb4.56c8e3"]]},{"id":"e0e33689.c66468","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var  MenuAction,resetPage, breadcrumb;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n}  else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    breadcrumb = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,resetPage, breadcrumb];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3210,"y":440,"wires":[["18f8719f.279d1e"],["67412f74.5eb71"],["da6e406f.6787a"]],"outputLabels":["MenuAction,,","resetPage","breadcrumb"]},{"id":"a065c9b7.4db248","type":"debug","z":"9921cbf1.f82328","name":"Organiozation Global Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3260,"y":260,"wires":[]},{"id":"193edcb4.56c8e3","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","fb2f529a.1efbc","26c29dda.6daf62","cd9f1d1b.bf34","e51d11b2.4634e","9ace7eb.b1eda8","662d87cc.7d0548","c934eefd.40a3","ac2bb9bc.e80f78","a1f71373.9e355","d6d858a.66ff0a8","8d6d1196.e41d5","6e279118.75e0d"],"x":1135,"y":400,"wires":[]},{"id":"9e48b64e.89b708","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":720,"y":360,"wires":[]},{"id":"9f66f0d8.42673","type":"debug","z":"9921cbf1.f82328","name":"Organiozation Global INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":930,"y":360,"wires":[]},{"id":"3642fad0.1d3c46","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","f6ff6532.fd5c58"],"x":3015,"y":360,"wires":[["a065c9b7.4db248","e0e33689.c66468"]]},{"id":"4945e5f6.e7e4ec","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","102cb83c.632cd8"],"x":715,"y":300,"wires":[["c35a03c7.b5996"]]},{"id":"b84da9b.a394e58","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1290,"y":300,"wires":[]},{"id":"f6e95f68.59996","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":300,"wires":[["98849c46.46fe6"]]},{"id":"40cb437c.0ca4bc","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":720,"y":260,"wires":[]},{"id":"fb2f529a.1efbc","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3"],"x":1435,"y":460,"wires":[["2c6b2776.25bf08"]]},{"id":"f6ba409a.c55f2","type":"http in","z":"9921cbf1.f82328","name":"breadcrumbs","url":"/breadcrumbs","method":"post","upload":false,"swaggerDoc":"","x":190,"y":340,"wires":[["ca781c12.a2526"]]},{"id":"102cb83c.632cd8","type":"link out","z":"9921cbf1.f82328","name":"","links":["4945e5f6.e7e4ec"],"x":455,"y":300,"wires":[]},{"id":"7fa9c732.feefe8","type":"link out","z":"9921cbf1.f82328","name":"","links":["9bf1ce82.a3dda"],"x":455,"y":340,"wires":[]},{"id":"f6ff6532.fd5c58","type":"link out","z":"9921cbf1.f82328","name":"","links":["3642fad0.1d3c46"],"x":455,"y":380,"wires":[]},{"id":"c4b4ce9b.ff9b4","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":530,"y":340,"wires":[]},{"id":"c803c1f4.c8e2d","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":540,"y":300,"wires":[]},{"id":"e8e5abc8.bc5fe8","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":530,"y":380,"wires":[]},{"id":"c35a03c7.b5996","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":820,"y":300,"wires":[["f6e95f68.59996"]]},{"id":"ca781c12.a2526","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":330,"y":340,"wires":[["102cb83c.632cd8"],["7fa9c732.feefe8"],["f6ff6532.fd5c58"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"18f8719f.279d1e","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3380,"y":300,"wires":[["5d76a2df.6c4dac"]]},{"id":"2c6b2776.25bf08","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1600,"y":460,"wires":[["389c2247.4ac34e"]]},{"id":"98849c46.46fe6","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1140,"y":300,"wires":[["b84da9b.a394e58"]]},{"id":"e84386d.f3bdc78","type":"subflow:e25f5e2d.45871","z":"9921cbf1.f82328","name":"","env":[],"x":580,"y":80,"wires":[[]]},{"id":"1f48a4dd.0fb15b","type":"function","z":"9921cbf1.f82328","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":80,"wires":[["e84386d.f3bdc78"]]},{"id":"569a0a55.e796d4","type":"link in","z":"9921cbf1.f82328","name":"","links":["1c858e53.87a6a2","c94013d0.c9ec3","1e8d4c5e.75a394","5d76a2df.6c4dac","d613a077.0cfbc","fc9a4475.d1aa48","ff901097.cca1e","ae36fa1c.c58368","f649a36e.fdce4","cb1986fd.810e68","a4b88935.b27c28","6bb20b81.bccea4","eebc68f0.d8a528","389c2247.4ac34e","bf826a86.3365d8","5fb061a7.ffba6","588bbc88.4586d4","1d02dc85.832453","e12bf1b4.9899b","87e4fdac.7c21","f4a17635.7094d8","fe0810d0.32a41","d5955510.abc8c8","bedc9b4c.e14ab8","d70fbbfb.67c9f8","69243e82.2f872"],"x":295,"y":60,"wires":[["1f48a4dd.0fb15b"]]},{"id":"c94013d0.c9ec3","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":220,"wires":[]},{"id":"e51d11b2.4634e","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3","67412f74.5eb71"],"x":1435,"y":220,"wires":[["58a84c4c.3d95a4"]]},{"id":"5d76a2df.6c4dac","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":3455,"y":300,"wires":[]},{"id":"58a84c4c.3d95a4","type":"function","z":"9921cbf1.f82328","name":"breadcrumbBasic","func":"msg.payload = {\n    gadgetsList:[\n       {\n  \"gadgetId\": \"a562a518-fb7b-19cc-e9da-e76f288b9074\",\n  \"gadgetName\": \"breadcrumbBasic\",\n  \"gadgetType\": \"breadcrumbs\",\n  \"gadgetData\": [\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 1\",\n        \"allowSearch\": true,\n        \"design\": {\n        //   \"color\": \"white\",\n          \"icon\": \"comment_bank\",\n           \"size\":\"small\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Option 1.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"action\": {\n                \"option\": \"Option 1.A\",\n                \"type\":\"global\"\n            },\n      \n          },\n               {\n            \"title\": \"Option 1.B\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 1.B\",\n                \"type\":\"global\"\n            },\n          },\n          {\n            \"title\": \"Option 1.C\",\n            \"design\": {\n              \"color\": \"red\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 1.C\",\n                \"type\":\"global\"\n            },\n          }\n        ],\n       \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 2\",\n        \"allowSearch\": true,\n        \"design\": {\n         \n          \"color\" : \"black\",\n          \"icon\": \"info\",\n          \"size\":\"medium\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Option 2.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"action\": {\n                option: \"Option 2.A\",\n                type:\"global\"\n            },\n      \n          },\n          {\n            \"title\": \"Option 2.B\",\n            \"design\": {\n              \"color\": \"red\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 2.B\",\n                \"type\":\"global\"\n            },\n          }\n        ],\n       \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n     {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 3\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"color\": \"orange\",\n          \"icon\": \"code\",\n           \"size\":\"large\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Option 3.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"action\": {\n                \"option\": \"Option 3.A\",\n                \"type\":\"global\"\n            },\n      \n          },\n               {\n            \"title\": \"Option 3.B\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 3.B\",\n                \"type\":\"global\"\n            },\n          },\n          {\n            \"title\": \"Option 3.C\",\n            \"design\": {\n              \"color\": \"red\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 3.C\",\n                \"type\":\"global\"\n            },\n          }\n        ],\n       \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"separatorIcon\": \"keyboard_arrow_right\",\n    \"title\": \"Used in breadcrumbs mobile can be null\"\n  }\n}\n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"8b1a8e9e-e528-612f-7320-8a3ad6c58281\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                     \"blockHeight\": 300\n                                },\n                              \"gadgetOptions\": {\n                  \n                                 \"copy\":true\n                              }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Breadcrumb Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1630,"y":220,"wires":[["c94013d0.c9ec3"]]},{"id":"fc9a4475.d1aa48","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":300,"wires":[]},{"id":"9ace7eb.b1eda8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3","67412f74.5eb71"],"x":1435,"y":300,"wires":[["47fe2b66.49e694"]]},{"id":"47fe2b66.49e694","type":"function","z":"9921cbf1.f82328","name":"breadcrumbSubButtons","func":"msg.payload = {\n    gadgetsList:[\n       \n       {\n  \"gadgetId\": \"db2a6c5d-953a-c1a8-d94f-bd2e9b88d5af\",\n  \"gadgetName\": \"breadcrumbSubButtons\",\n  \"gadgetType\": \"breadcrumbs\",\n  \"gadgetData\": [\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 1\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"background-color\": \"orange\",\n          \"icon\": \"comment_bank\"\n        },\n        \"action\": {\n          \"addAnyAction\": \"dependingOnWhatYouNeed\",\n          \"canBeString\": \"orObjectorArray\"\n        },\n        \"actionType\": \"button\",\n        \"subButton\": [\n          {\n            \"icon\": \"info\",\n            \"action\": \"primary 1\",\n            \"color\":\"primary\",\n            \"tooltip\":\"primary 1\",\n          },\n          {\n            \"icon\": \"thumb_up_alt\",\n            \"action\": \"success 1\",\n           \"color\":\"success\",\n           \"tooltip\": \"success 1\",\n          },\n            {\n            \"icon\": \"warning\",\n            \"action\": \"warning 1\",\n            \"color\":\"warning\",\n           \"tooltip\":\"warning 1\",\n          },\n             {\n            \"icon\": \"alarm\",\n            \"action\": \"danger 1\",\n            \"color\":\"danger\",\n           \"tooltip\":\"danger 1\",\n          }\n        ],\n      \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 2\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"background-color\": \"white\",\n          \"icon\": \"comment_bank\"\n        },\n        \"action\": {\n          \"addAnyAction\": \"dependingOnWhatYouNeed\",\n          \"canBeString\": \"orObjectorArray\"\n        },\n        \"actionType\": \"button\",\n        \"subButton\": [\n          {\n            \"icon\": \"info\",\n            \"action\": \"primary 2\",\n            \"color\":\"primary\",\n           \"tooltip\":\"primary 2\",\n          },\n          {\n            \"icon\": \"thumb_up_alt\",\n            \"action\": \"success 2\",\n           \"color\":\"success\",\n           \"tooltip\":\"success 2\",\n          },\n            {\n            \"icon\": \"warning\",\n            \"action\": \"warning 2\",\n            \"color\":\"warning\",\n           \"tooltip\":\"warning 2\",\n          },\n             {\n            \"icon\": \"alarm\",\n            \"action\": \"danger 2\",\n            \"color\":\"danger\",\n           \"tooltip\":\"danger 2\",\n          }\n        ],\n      \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"separatorIcon\": \"keyboard_arrow_right\",\n    \"title\": \"Used in breadcrumbs mobile can be null\"\n  }\n}\n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                                \"gadgetId\": \"a8ab05c4-1595-584a-f223-889ed4f47666\",\n  \"gadgetName\": \"subButtonsCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"subbuttons\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Sub buttons\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":300,"wires":[["fc9a4475.d1aa48"]]},{"id":"783e2299.1db02c","type":"debug","z":"e5822137.be45d","name":"Menu res","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4000,"y":360,"wires":[]},{"id":"4314eee4.f4e7f","type":"debug","z":"d8703926.e2eca","name":"pre menu routing","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":430,"y":760,"wires":[]},{"id":"8366c6b2.7951b8","type":"debug","z":"152aab03.7a806d","name":"Menu res","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":660,"y":300,"wires":[]},{"id":"582d3ca5.214004","type":"debug","z":"d8703926.e2eca","name":"Menu redirect","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":780,"y":620,"wires":[]},{"id":"a8aa2565.f73818","type":"debug","z":"152aab03.7a806d","name":"Menu res 2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":180,"wires":[]},{"id":"a8ff24ce.78ef88","type":"debug","z":"5e9b9c1d.bbe4a4","name":"redirect subflow 1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":870,"y":220,"wires":[]},{"id":"671e830e.08d56c","type":"debug","z":"5e9b9c1d.bbe4a4","name":"redirect subflow 1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":440,"wires":[]},{"id":"917c120a.8776e","type":"http response","z":"152aab03.7a806d","name":"","statusCode":"","headers":{},"x":1090,"y":480,"wires":[]},{"id":"f4360e46.6f855","type":"function","z":"152aab03.7a806d","name":"Route response menu","func":"var redirect,logout, other;\n\nif (msg.payload.hasOwnProperty(\"payload\")){\n    payload = msg.payload.payload\n    msg.RevotioData = msg.payload.RevotioData\n    msg.payload = payload\n}\n\n\nif (msg.payload.hasOwnProperty(\"Page\") || msg.payload.hasOwnProperty(\"data\")){\n    redirect = msg;\n} else if (msg.payload.hasOwnProperty(\"RevotioData\")  && msg.payload.RevotioData.hasOwnProperty(\"logout\")  &&msg.payload.RevotioData.logout === true){\n    logout = msg;\n} else {\n    other = msg;\n}\n\nreturn [redirect,logout, other];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":900,"y":480,"wires":[["917c120a.8776e"],["917c120a.8776e"],[]],"outputLabels":["redirect","logout","other"]},{"id":"2abfe6c1.b1ac7a","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nvar gadgetsList =[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}}];\n\n  \ngadgetsList.push(\n       {\n  \"gadgetData\": {\n    \"data\": msg.data,\n    \"options\": {\"number-columns\":1}\n  },\n  \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n  \"gadgetName\": \"actionConfirmationText\",\n  \"gadgetType\": \"dynamic-text-area\"\n}\n      )\n\nmsg.payload = {gadgetsList:gadgetsList};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3910,"y":380,"wires":[["ff901097.cca1e"]]},{"id":"ff901097.cca1e","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":4115,"y":380,"wires":[]},{"id":"46c8e8bf.f80d88","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"msg.data = [ {\n        \"label\": \"Gadget name\",\n        \"value\": msg.RevotioData.PostData.gadgetName\n      },\n      {\n        \"label\": \"Selected\",\n        \"value\": msg.RevotioData.PostData.gadgetData.selected\n      },\n      {\n        \"label\": \"Icon\",\n        \"value\": msg.RevotioData.PostData.gadgetData.icon\n      },\n      {\n        \"label\": \"Title\",\n        \"value\": msg.RevotioData.PostData.gadgetData.title\n      }\n      \n      \n      ]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3640,"y":300,"wires":[["2abfe6c1.b1ac7a"]]},{"id":"214539c7.4207b6","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"msg.data = [ {\n        \"label\": \"Gadget name\",\n        \"value\": msg.RevotioData.PostData.gadgetName\n      },\n      {\n        \"label\": \"Selected\",\n        \"value\": msg.RevotioData.PostData.gadgetData.selected.option\n      },\n      {\n        \"label\": \"Icon\",\n        \"value\": msg.RevotioData.PostData.gadgetData.icon\n      },\n      {\n        \"label\": \"Title\",\n        \"value\": msg.RevotioData.PostData.gadgetData.title\n      }\n      \n      \n      ]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3640,"y":280,"wires":[["2abfe6c1.b1ac7a"]]},{"id":"cb1986fd.810e68","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":340,"wires":[]},{"id":"c934eefd.40a3","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3","67412f74.5eb71"],"x":1435,"y":340,"wires":[["eaf885d1.c0e158"]]},{"id":"eaf885d1.c0e158","type":"function","z":"9921cbf1.f82328","name":"breadcrumbForm","func":"msg.payload = {\n    gadgetsList:[\n       {\n  \"gadgetId\": \"6f760438-dec6-9415-cb5e-2cf52c7d2e73\",\n  \"gadgetName\": \"breadcrumbForm\",\n  \"gadgetType\": \"breadcrumbs\",\n  \"gadgetData\": [\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 1\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"background-color\": \"white\",\n          \"icon\": \"comment_bank\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Form 1.A - empty\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"actionType\": \"form\",\n            \"form\" :{\n              gadget:{\n                  \"gadgetData\": {\n                            \"canceled\": true,\n                            \"submitButtonAction\": true,\n                            \"submitOnInputChange\": true,\n                            \"id\":  \"Form A - empty\",\n                            \"nextButtonText\": \"Next\",\n                            \"showPrevious\": true,\n                         \n                            \"submitButtonText\": \"Submit\",\n                            \"title\":  \"Form A - empty\",\n                            \"steps\": [\n                              {\n                                \"fields\": [\n                                  {\n                                    \"htmlTag\": \"input\",\n                                    \"name\": \"Sample Input\",\n                                    \"options\": {\n                                      \"label\": \"Sample Input\",\n                                      \"placeholder\": \"Sample Inpu\",\n                                      \"required\": false,\n                                      \"type\": \"text\",\n                                      \"value\": \"\",\n                                      \"min\": \"\",\n                                      \"max\": \"\",\n                                      \"preview\": \"\",\n                                      \"disabled\": false,\n                                      \"previewPosition\": \"\"\n                                    }\n                                  },\n                                  {\n                                    \"name\": \"issue_type\",\n                                    \"htmlTag\": \"select\",\n                                    \"optionsGroup\": {\n                                      \"10010\": \"Information request\",\n                                      \"10012\": \"New feature request\",\n                                      \"10013\": \"Report Bug/ issue\"\n                                    },\n                                    \"options\": {\n                                      \"multiple\": false,\n                                      \"value\": \"\",\n                                      \"label\": \"Issue type\",\n                                      \"type\": \"text\",\n                                      \"placeholder\": \"\",\n                                      \"required\": false,\n                                      \"maxlength\": 100,\n                                      \"width\": 100,\n                                      \"info\": \"Choose the type of ticket you would like to create\"\n                                    }\n                                  },\n                                  {\n                                    \"name\": \"summary\",\n                                    \"htmlTag\": \"textarea\",\n                                    \"execActionData\": [\n                                      {\n                                        \"issue_type\": \"10010\"\n                                      },\n                                      {\n                                        \"issue_type\": \"10013\"\n                                      }\n                                    ],\n                                    \"options\": {\n                                      \"value\": \"\",\n                                      \"label\": \"What do you need?\",\n                                      \"type\": \"text\",\n                                      \"placeholder\": \"\",\n                                      \"required\": true,\n                                      \"maxlength\": 50,\n                                      \"width\": 100,\n                                      \"info\": \"Tell us what you're looking for. For example, 'put me on the mailing list'.\"\n                                    },\n                                    \"type\": \"text\"\n                                  }\n                                ]\n                              }\n                            ]\n                            \n                          },\n                        \"gadgetOptions\": {},\n                        //   \"gadgetId\": \"7cb43f66-cc5d-9564-3d51-3b1bf8479812\",\n                        //   \"gadgetName\": \"form\",\n                        //   \"gadgetType\": \"custom-form\"\n                },\n                values:{}\n    \n            }\n                },\n          {\n            \"title\": \"Form 1.B - mapped\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"actionType\": \"form\",\n            \"form\" :{\n              gadget:{\n                  \"gadgetData\": {\n                            \"canceled\": false,\n                            \"submitButtonAction\": true,\n                            \"submitOnInputChange\": true,\n                            \"id\":  \"Form 1.B - mapped\",\n                            \"nextButtonText\": \"Next\",\n                            \"showPrevious\": true,\n                            \"dismissDisabledSubmit\": false,\n                            \"submitButtonText\": \"Submit\",\n                            \"title\":  \"Form 1.B - mapped\",\n                            \"steps\": [\n                              {\n                                \"fields\": [\n                                  {\n                                    \"htmlTag\": \"input\",\n                                    \"name\": \"Sample Input\",\n                                    \"options\": {\n                                      \"label\": \"Sample Input\",\n                                      \"placeholder\": \"Sample Inpu\",\n                                      \"required\": false,\n                                      \"type\": \"text\",\n                                      \"value\": \"\",\n                                      \"min\": \"\",\n                                      \"max\": \"\",\n                                      \"preview\": \"\",\n                                      \"disabled\": false,\n                                      \"previewPosition\": \"\"\n                                    }\n                                  },\n                                  {\n                                    \"name\": \"issue_type\",\n                                    \"htmlTag\": \"select\",\n                                    \"optionsGroup\": {\n                                      \"10010\": \"Information request\",\n                                      \"10012\": \"New feature request\",\n                                      \"10013\": \"Report Bug/ issue\"\n                                    },\n                                    \"options\": {\n                                      \"multiple\": false,\n                                      \"value\": \"\",\n                                      \"label\": \"Issue type\",\n                                      \"type\": \"text\",\n                                      \"placeholder\": \"\",\n                                      \"required\": false,\n                                      \"maxlength\": 100,\n                                      \"width\": 100,\n                                      \"info\": \"Choose the type of ticket you would like to create\"\n                                    }\n                                  },\n                                  {\n                                    \"name\": \"summary\",\n                                    \"htmlTag\": \"textarea\",\n                                    \"execActionData\": [\n                                      {\n                                        \"issue_type\": \"10010\"\n                                      },\n                                      {\n                                        \"issue_type\": \"10013\"\n                                      }\n                                    ],\n                                    \"options\": {\n                                      \"value\": \"\",\n                                      \"label\": \"What do you need?\",\n                                      \"type\": \"text\",\n                                      \"placeholder\": \"\",\n                                      \"required\": true,\n                                      \"maxlength\": 50,\n                                      \"width\": 100,\n                                      \"info\": \"Tell us what you're looking for. For example, 'put me on the mailing list'.\"\n                                    },\n                                    \"type\": \"text\"\n                                  }\n                                ]\n                              }\n                            ]\n                            \n                          },\n                        \"gadgetOptions\": {},\n                        // //   \"gadgetId\": \"7cb43f66-cc5d-9564-3d51-3b1bf8479812\",\n                        //   \"gadgetName\": \"form\",\n                        //   \"gadgetType\": \"custom-form\"\n                },\n                values:{\n                    \n                    summary:\"A value for the summary field\",\n                    issue_type : \"10010\",\n                    [\"Sample Input\"]:\"Sample Input field value\"\n                }\n    \n            }\n          },\n          {\n             \"title\": \"Form 1.C - no form & values\",\n            \"design\": {\n              \"color\": \"red\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n            \"actionType\": \"form\",\n            \"form\" :{\n                gadget:{},\n                values:{}\n            }\n          }\n        ],\n       \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 2\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"background-color\": \"white\",\n          \"icon\": \"comment_bank\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n           {\n            \"title\": \"Form 2.A - empty && form gadgetAction\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"actionType\": \"form\",\n            \"form\" :{\n              gadget:{\n                  \"gadgetData\": {\n                            \"canceled\": false,\n                            \"submitButtonAction\": true,\n                            \"submitOnInputChange\": true,\n                            \"id\":  \"Form A - empty\",\n                            \"nextButtonText\": \"Next\",\n                            \"showPrevious\": true,\n                            \"dismissDisabledSubmit\": false,\n                            \"submitButtonText\": \"Submit\",\n                            \"title\":  \"Form A - empty\",\n                            \"steps\": [\n                              {\n                                \"fields\": [\n                                  {\n                                    \"htmlTag\": \"input\",\n                                    \"name\": \"Sample Input\",\n                                    \"options\": {\n                                      \"label\": \"Sample Input\",\n                                      \"placeholder\": \"Sample Inpu\",\n                                      \"required\": false,\n                                      \"type\": \"text\",\n                                      \"value\": \"\",\n                                      \"min\": \"\",\n                                      \"max\": \"\",\n                                      \"preview\": \"\",\n                                   \n                                      \"previewPosition\": \"\"\n                                    }\n                                  },\n                                  {\n                                    \"name\": \"issue_type\",\n                                    \"htmlTag\": \"select\",\n                                    \"optionsGroup\": {\n                                      \"10010\": \"Information request\",\n                                      \"10012\": \"New feature request\",\n                                      \"10013\": \"Report Bug/ issue\"\n                                    },\n                                    \"options\": {\n                                      \"multiple\": false,\n                                      \"value\": \"\",\n                                      \"label\": \"Issue type\",\n                                      \"type\": \"text\",\n                                      \"placeholder\": \"\",\n                                      \"required\": false,\n                                      \"maxlength\": 100,\n                                      \"width\": 100,\n                              \n                                      \"info\": \"Choose the type of ticket you would like to create\"\n                                    }\n                                  },\n                                  {\n                                    \"name\": \"summary\",\n                                    \"htmlTag\": \"textarea\",\n                                    \"execActionData\": [\n                                      {\n                                        \"issue_type\": \"10010\"\n                                      },\n                                      {\n                                        \"issue_type\": \"10013\"\n                                      }\n                                    ],\n                                    \"options\": {\n                                      \"value\": \"\",\n                                      \"label\": \"What do you need?\",\n                                      \"type\": \"text\",\n                                      \"placeholder\": \"\",\n                                      \"required\": true,\n                                      \"maxlength\": 50,\n                                      \"width\": 100,\n                                      \"info\": \"Tell us what you're looking for. For example, 'put me on the mailing list'.\"\n                                    },\n                                    \"type\": \"text\"\n                                  }\n                                ]\n                              }\n                            ]\n                            \n                          },\n                        \"gadgetOptions\": {},\n                        //   \"gadgetId\": \"7cb43f66-cc5d-9564-3d51-3b1bf8479812\",\n                          \"gadgetName\": \"breadcrumbForm\",\n                          \"gadgetType\": \"custom-form\"\n                },\n                values:{}\n    \n            }\n                },\n          {\n            \"title\": \"Form 2.B - mapped && form gadgetAction\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"actionType\": \"form\",\n            \"form\" :{\n              gadget:{\n                  \"gadgetData\": {\n                            \"canceled\": false,\n                            \"submitButtonAction\": true,\n                            \"submitOnInputChange\": true,\n                            \"id\":  \"Form 2.B - mapped\",\n                            \"nextButtonText\": \"Next\",\n                            \"showPrevious\": true,\n                            \"dismissDisabledSubmit\": false,\n                            \"submitButtonText\": \"Submit\",\n                            \"title\":  \"Form 2.B - mapped\",\n                            \"steps\": [\n                              {\n                                \"fields\": [\n                                  {\n                                    \"htmlTag\": \"input\",\n                                    \"name\": \"Sample Input\",\n                                    \"options\": {\n                                      \"label\": \"Sample Input\",\n                                      \"placeholder\": \"Sample Inpu\",\n                                      \"required\": false,\n                                      \"type\": \"text\",\n                                      \"value\": \"\",\n                                      \"min\": \"\",\n                                      \"max\": \"\",\n                                      \"preview\": \"\",\n                                     \n                                      \"previewPosition\": \"\"\n                                    }\n                                  },\n                                  {\n                                    \"name\": \"issue_type\",\n                                    \"htmlTag\": \"select\",\n                                    \"optionsGroup\": {\n                                      \"10010\": \"Information request\",\n                                      \"10012\": \"New feature request\",\n                                      \"10013\": \"Report Bug/ issue\"\n                                    },\n                                    \"options\": {\n                                      \"multiple\": false,\n                                      \"value\": \"\",\n                                      \"label\": \"Issue type\",\n                                      \"type\": \"text\",\n                                      \"placeholder\": \"\",\n                                      \"required\": false,\n                                      \"maxlength\": 100,\n                                      \"width\": 100,\n                                      \"info\": \"Choose the type of ticket you would like to create\"\n                                    }\n                                  },\n                                  {\n                                    \"name\": \"summary\",\n                                    \"htmlTag\": \"textarea\",\n                                    \"execActionData\": [\n                                      {\n                                        \"issue_type\": \"10010\"\n                                      },\n                                      {\n                                        \"issue_type\": \"10013\"\n                                      }\n                                    ],\n                                    \"options\": {\n                                      \"value\": \"\",\n                                      \"label\": \"What do you need?\",\n                                      \"type\": \"text\",\n                                      \"placeholder\": \"\",\n                                      \"required\": true,\n                                      \"maxlength\": 50,\n                                      \"width\": 100,\n                                      \"info\": \"Tell us what you're looking for. For example, 'put me on the mailing list'.\"\n                                    },\n                                    \"type\": \"text\"\n                                  }\n                                ]\n                              }\n                            ]\n                            \n                          },\n                        \"gadgetOptions\": {},\n                        //   \"gadgetId\": \"7cb43f66-cc5d-9564-3d51-3b1bf8479812\",\n                          \"gadgetName\": \"breadcrumbForm\",\n                          \"gadgetType\": \"custom-form\"\n                },\n                values:{\n                    \n                    summary:\"A value for the summary field\",\n                    issue_type : \"10010\",\n                    [\"Sample Input\"]:\"Sample Input field value\"\n                }\n    \n            }\n          },\n          {\n            \"title\": \"Form 2.C - no form & values\",\n            \"design\": {\n              \"color\": \"red\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n            \"actionType\": \"form\",\n            \"form\" :{\n                gadget:{},\n                values:{}\n            }\n          }\n        ],\n      \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"separatorIcon\": \"keyboard_arrow_right\",\n    \"title\": \"Used in breadcrumbs mobile can be null\"\n  }\n}\n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"44e9d2aa-a753-443b-9a37-f8f3776b8894\",\n  \"gadgetName\": \"formCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"e0dd5600-7fc3-8f87-2d7e-49647f70da5b\",\n                              \"gadgetName\": \"form\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Forms\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1630,"y":340,"wires":[["cb1986fd.810e68"]]},{"id":"9f5902f2.ab21b","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"\n\nmsg.data = [ {\n        \"label\": \"Gadget name\",\n        \"value\": msg.RevotioData.PostData.gadgetName\n      },\n      {\n        \"label\": \"Gadget type\",\n        \"value\": msg.RevotioData.PostData.gadgetType\n      },\n            {\n        \"label\": \"actionType\",\n        \"value\": msg.RevotioData.PostData.gadgetData.actionType\n      },\n      {\n        \"label\": \"FormData\",\n        \"value\": JSON.stringify(msg.RevotioData.PostData.gadgetData.formData)\n      },\n\n          {\n        \"label\": \"formObj\",\n        \"value\": JSON.stringify(msg.RevotioData.PostData.gadgetData.formObj)\n      },\n      ]\n      \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3640,"y":320,"wires":[["2abfe6c1.b1ac7a"]]},{"id":"a4b88935.b27c28","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":380,"wires":[]},{"id":"ac2bb9bc.e80f78","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3","67412f74.5eb71"],"x":1435,"y":380,"wires":[["6de1fecb.77b24"]]},{"id":"6de1fecb.77b24","type":"function","z":"9921cbf1.f82328","name":"breadcrumbTour","func":"msg.payload = {\n    gadgetsList:[\n       {\n  \"gadgetId\": \"14405e4a-dca8-09f2-8219-5a951580c296\",\n  \"gadgetName\": \"breadcrumbTour\",\n  \"gadgetType\": \"breadcrumbs\",\n  \"gadgetData\": [\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 1\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"background-color\": \"white\",\n          \"icon\": \"comment_bank\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Tour 1.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"actionType\": \"button\",\n            action:{\n                 \"title\": \"Tour 1.A\",\n                 option : \"Tour 1.A\",\n            }\n            },\n          {\n          \"title\": \"Tour 1.B\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"actionType\": \"button\",\n             action:{\n                 \"title\": \"Tour 1.B\",\n                 option : \"Tour 1.B\",\n            }\n          },\n         \n        ],\n        \"tour\": {\n          \"content\": \"First tour box ==== placement = bottom\",\n          \"title\": \"First tour box\",\n          \"priority\": 1,\n          \"placement\": \"bottom\"\n        }\n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 2\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"background-color\": \"white\",\n          \"icon\": \"comment_bank\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Tour 2.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"actionType\": \"button\",\n             action:{\n                 \"title\": \"Tour 2.A\",\n                 option : \"Tour 2.A\",\n            }\n            },\n          {\n          \"title\": \"Tour 2.B\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"actionType\": \"button\",\n              action:{\n                 \"title\": \"Tour 2.B\",\n                 \"option\" : \"Tour 2.B\",\n            }\n          },\n         \n        ],\n        \"tour\": {\n          \"content\": \"Second tour box ==== placement = left\",\n          \"title\": \"Second tour box\",\n          \"priority\": 2,\n          \"placement\": \"left\"\n        }\n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n     {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 3\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"background-color\": \"white\",\n          \"icon\": \"comment_bank\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Tour 3.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"actionType\": \"button\",\n             action:{\n                 \"title\": \"Tour 3.A\",\n                 option : \"Tour 3.A\",\n            }\n            },\n          {\n          \"title\": \"Tour 3.B\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"actionType\": \"button\",\n              action:{\n                 \"title\": \"Tour 3.B\",\n                 option : \"Tour 3.B\",\n            }\n          },\n         \n        ],\n        \"tour\": {\n          \"content\": \"Fourth tour box ==== placement = top\",\n          \"title\": \"Fourth tour box\",\n          \"priority\": 4,\n          \"placement\": \"top\"\n        }\n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 4\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"background-color\": \"white\",\n          \"icon\": \"comment_bank\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Tour 4.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"actionType\": \"button\",\n             action:{\n                 \"title\": \"Tour 4.A\",\n                 option : \"Tour 4.A\",\n            }\n            },\n          {\n          \"title\": \"Tour 4.B\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"actionType\": \"button\",\n              action:{\n                 \"title\": \"Tour 4.B\",\n                 option : \"Tour 4.B\",\n            }\n          },\n         \n        ],\n        \"tour\": {\n          \"content\": \"Third tour box ==== placement = right\",\n          \"title\": \"Third tour box\",\n          \"priority\": 3,\n          \"placement\": \"right\"\n        }\n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"separatorIcon\": \"keyboard_arrow_right\",\n    \"title\": \"Used in breadcrumbs mobile can be null\"\n  }\n}\n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"f4017a35-7604-ecfd-557d-13aea3691900\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":380,"wires":[["a4b88935.b27c28"]]},{"id":"74fbc787.b3cfe8","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"msg.data = [ {\n        \"label\": \"Gadget name\",\n        \"value\": msg.RevotioData.PostData.gadgetName\n      },\n      {\n        \"label\": \"Selected\",\n        \"value\": msg.RevotioData.PostData.gadgetData.selected.option\n      },\n      {\n        \"label\": \"Icon\",\n        \"value\": msg.RevotioData.PostData.gadgetData.icon\n      },\n      {\n        \"label\": \"Title\",\n        \"value\": msg.RevotioData.PostData.gadgetData.title\n      }\n      \n      \n      ]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3640,"y":360,"wires":[["2abfe6c1.b1ac7a"]]},{"id":"16db64b2.5ab03b","type":"subflow:53926ffd.c5a74","z":"e25f5e2d.45871","name":"","x":1380,"y":560,"wires":[["70b60a73.38b344"]]},{"id":"5d156f35.b0e81","type":"subflow:4cbbc60.828563c","z":"22428f45.8ab","name":"","env":[],"x":310,"y":120,"wires":[]},{"id":"4f77ff18.3df8f","type":"subflow:5e9b9c1d.bbe4a4","z":"22428f45.8ab","name":"","env":[],"x":2710,"y":460,"wires":[]},{"id":"45278fd1.18e39","type":"subflow:5e9b9c1d.bbe4a4","z":"22428f45.8ab","name":"","x":2380,"y":120,"wires":[]},{"id":"d890936b.19c77","type":"subflow:5e9b9c1d.bbe4a4","z":"22428f45.8ab","name":"","x":1500,"y":400,"wires":[]},{"id":"534fed46.ceb0f4","type":"subflow:5e9b9c1d.bbe4a4","z":"22428f45.8ab","name":"","x":1240,"y":800,"wires":[]},{"id":"ed062582.39fc48","type":"subflow:5e9b9c1d.bbe4a4","z":"22428f45.8ab","name":"","x":3400,"y":320,"wires":[]},{"id":"6bb20b81.bccea4","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":260,"wires":[]},{"id":"a1f71373.9e355","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3","67412f74.5eb71"],"x":1435,"y":260,"wires":[["21f7f7d8.431c58"]]},{"id":"21f7f7d8.431c58","type":"function","z":"9921cbf1.f82328","name":"breadcrumbBasicOptions","func":"msg.payload = {\n    gadgetsList:[\n       {\n  \"gadgetId\": \"2204b9f1-959e-7c87-3e9d-ad121fe37769\",\n  \"gadgetName\": \"basicOptions\",\n  \"gadgetType\": \"breadcrumbs\",\n  \"gadgetData\": [\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb option 'No search' \",\n        \"allowSearch\": false,\n        \"design\": {\n        //   \"color\": \"white\",\n        //   \"icon\": \"comment_bank\",\n        //   \"size\":\"small\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Option 1.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"action\": {\n                \"option\": \"Option 1.A\",\n                \"type\":\"global\"\n            },\n      \n          },\n               {\n            \"title\": \"Option 1.B\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 1.B\",\n                \"type\":\"global\"\n            },\n          },\n          {\n            \"title\": \"Option 1.C\",\n            \"design\": {\n              \"color\": \"red\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 1.C\",\n                \"type\":\"global\"\n            },\n          }\n        ],\n       \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n    {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb option 'style'\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"color\" : \"black\",\n        //   \"icon\": \"info\",\n          \"size\":\"medium\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Option 2.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"action\": {\n                option: \"Option 2.A\",\n                type:\"global\"\n            },\n      \n          },\n          {\n            \"title\": \"Option 2.B\",\n            \"design\": {\n              \"color\": \"red\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 2.B\",\n                \"type\":\"global\"\n            },\n          }\n        ],\n       \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n     {\n      \"buttonData\": {\n        \"title\": \"Breadcrumb item 3\",\n        \"allowSearch\": true,\n        \"design\": {\n          \"color\": \"orange\",\n          \"icon\": \"code\",\n           \"size\":\"large\"\n        },\n        \"actionType\": \"button\",\n       \"options\": [\n          {\n            \"title\": \"Option 3.A\",\n            \"design\": {\n              \"color\": \"green\",\n              \"iconType\": \"icon\",\n              \"icon\": \"info\",\n              \"size\": \"large\"\n            },\n            \"selected\": true,\n            \"action\": {\n                \"option\": \"Option 3.A\",\n                \"type\":\"global\"\n            },\n      \n          },\n               {\n            \"title\": \"Option 3.B\",\n            \"design\": {\n              \"color\": \"orange\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 3.B\",\n                \"type\":\"global\"\n            },\n          },\n          {\n            \"title\": \"Option 3.C\",\n            \"design\": {\n              \"color\": \"red\",\n              \"iconType\": \"icon\",\n              \"icon\": \"check_circle\"\n            },\n             \"action\": {\n                \"option\": \"Option 3.C\",\n                \"type\":\"global\"\n            },\n          }\n        ],\n       \n      },\n      \"buttonOptions\": {\n        \"dataType\": \"multiple\",\n        \"displayType\": \"text\"\n      }\n    },\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"separatorIcon\": \"keyboard_arrow_right\",\n    \"title\": \"Used in breadcrumbs mobile can be null\"\n  }\n}\n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"73dc6735-b87f-9edb-e978-5a45b4b123cb\",\n  \"gadgetName\": \"basicOptions\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                             \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n})\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"BasicOptionsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Breadcrumb Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":260,"wires":[["6bb20b81.bccea4"]]},{"id":"eebc68f0.d8a528","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":420,"wires":[]},{"id":"d6d858a.66ff0a8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3","67412f74.5eb71"],"x":1435,"y":420,"wires":[["f594ce2c.9510a"]]},{"id":"f594ce2c.9510a","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1600,"y":420,"wires":[["eebc68f0.d8a528"]]},{"id":"67412f74.5eb71","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","e51d11b2.4634e","9ace7eb.b1eda8","662d87cc.7d0548","c934eefd.40a3","ac2bb9bc.e80f78","a1f71373.9e355","d6d858a.66ff0a8","8d6d1196.e41d5","6e279118.75e0d"],"x":3435,"y":340,"wires":[]},{"id":"429d9e1d.aa7f8","type":"comment","z":"9921cbf1.f82328","name":"calendar","info":"","x":200,"y":720,"wires":[]},{"id":"daccef55.18be4","type":"comment","z":"9921cbf1.f82328","name":"calendar gagdet actions","info":"","x":3210,"y":660,"wires":[]},{"id":"87d37e3f.7cb35","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2530,"y":620,"wires":[]},{"id":"9c452783.18eb58","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","872892ea.2eac3"],"x":815,"y":800,"wires":[["755ecb09.36daa4","84e8811.9ab3d8"]]},{"id":"ed0dffed.4a497","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3150,"y":800,"wires":[["4fc7e265.aeb7cc"],["8c0d6729.31a918"],["8f01b271.fa68"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"1c0550db.7f5aff","type":"debug","z":"9921cbf1.f82328","name":"calendar Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3140,"y":700,"wires":[]},{"id":"755ecb09.36daa4","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","82d00db3.efde9","26c29dda.6daf62","cd9f1d1b.bf34","512c4306.470f9c","d2469f2a.9e267","662d87cc.7d0548","685e4089.55b23","86bfef5c.25f0a","da08c84b.c322f8","3deae426.0ad89c","12de4471.8933ac","33162ce5.e32d44"],"x":1195,"y":800,"wires":[]},{"id":"7541c238.bf98ec","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":780,"y":760,"wires":[]},{"id":"84e8811.9ab3d8","type":"debug","z":"9921cbf1.f82328","name":"calendar INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":950,"y":760,"wires":[]},{"id":"3969a289.94429e","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","a894361d.170a68"],"x":3015,"y":800,"wires":[["1c0550db.7f5aff","ed0dffed.4a497"]]},{"id":"254bd029.b4788","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","21e338e3.2265f8"],"x":775,"y":700,"wires":[["86b3b181.36d35"]]},{"id":"49c85cac.8a77c4","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1350,"y":700,"wires":[]},{"id":"c55c8753.f91e78","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":700,"wires":[["84aff97b.c01808"]]},{"id":"9e35f025.a4a55","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":780,"y":660,"wires":[]},{"id":"82d00db3.efde9","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["755ecb09.36daa4"],"x":1475,"y":900,"wires":[["76ca6384.96482c"]]},{"id":"d211399e.178378","type":"http in","z":"9921cbf1.f82328","name":"calendar","url":"/calendar","method":"post","upload":false,"swaggerDoc":"","x":180,"y":780,"wires":[["fb0b52dc.d5e81"]]},{"id":"21e338e3.2265f8","type":"link out","z":"9921cbf1.f82328","name":"","links":["254bd029.b4788"],"x":455,"y":740,"wires":[]},{"id":"872892ea.2eac3","type":"link out","z":"9921cbf1.f82328","name":"","links":["9c452783.18eb58"],"x":455,"y":780,"wires":[]},{"id":"a894361d.170a68","type":"link out","z":"9921cbf1.f82328","name":"","links":["3969a289.94429e"],"x":455,"y":820,"wires":[]},{"id":"7a06d0ab.fac08","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":530,"y":780,"wires":[]},{"id":"553d8110.08e05","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":540,"y":740,"wires":[]},{"id":"13d0d07a.c35bd","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":530,"y":820,"wires":[]},{"id":"86b3b181.36d35","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":880,"y":700,"wires":[["c55c8753.f91e78"]]},{"id":"fb0b52dc.d5e81","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":310,"y":780,"wires":[["21e338e3.2265f8"],["872892ea.2eac3"],["a894361d.170a68"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"4fc7e265.aeb7cc","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3320,"y":740,"wires":[["d6bb8bf3.e689e8"]]},{"id":"76ca6384.96482c","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1660,"y":900,"wires":[["745ed7a9.becce8"]]},{"id":"84aff97b.c01808","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1200,"y":700,"wires":[["49c85cac.8a77c4"]]},{"id":"ada94af4.e7ada8","type":"link in","z":"9921cbf1.f82328","name":"","links":["1c858e53.87a6a2","7e497deb.8200f4","1e8d4c5e.75a394","d6bb8bf3.e689e8","d613a077.0cfbc","55138d24.35b394","942e42e6.ea30e","ae36fa1c.c58368","f649a36e.fdce4","79778570.e5825c","2f774e87.4030b2","bdde0f3.e80b0f","2e6e73eb.5e00ac","745ed7a9.becce8","60d84304.bfd8fc","9af1a0bc.c3157","29b426b2.d8fb5a","eb37dced.e1ec9","185823ed.b85f1c","e18ab142.106d1","13f993fc.6d792c","8a377131.93d15","7f5bd638.29da18","e19917ce.3ef4b8","3746c4c3.df73ac","706df857.05e7f8","6b483753.e7d788","dd5a929.a9ac37","16884a4b.4af1f6","629c726c.ece06c","4cfd8f85.c642b","ddcf43e4.c35d7","be0585dc.b51f68","c25545b8.aa7048","76c4ecca.dfc2b4","a0d3cb4f.e5a1d8","b8aa911c.c508d","225e4780.50aac8","f7110a.24b56ef8","74a3505e.17e4f","d7433ee3.b1521","6810e9fb.510c98","3f00881e.57c498","7f002f4a.a63cc","a7afcb02.a54fc8","bb8fce61.6182e","abad270d.f651c8","3a74a888.476928","fc40095b.362128","16217be1.b91384","16e0679e.2abf78","7cba0fb9.d8c44","76d4be18.01317","454d6545.20dafc","51ef73ae.7d6f8c","7451fc36.e00044","16aff964.e989b7","2ae4780f.e39e38","422f5943.2bab28","f1fe052f.3dfbd8","2ee25b21.113a64","4aa125f7.7634ac","3e51f613.71b5fa","a926ca31.0313b8","a4f927df.422a68","73fe9cd2.24fc74","dc38e187.56ce","c6bcddc4.f4da7","872bad6e.d77f2","ccf248d5.500118","af5b7fdb.c695f","f2ef1695.ffe8d8","b0ea35a8.a6de78","f98a63c3.a3929","389ea707.9800f8","ee9360fd.4692f","d6e65da7.7e1b5","a7d36d89.78a96","4f36bac0.5f7864","1935e4a9.a9282b","82aad879.100568","cbf9c749.5fe488","b341ca8f.ae3728","fae498a5.7f2838","d7b388cb.615cc8","9d385f3c.579db","eb385fc8.1d1ae","b040cb8e.dbdd38","2bcfd332.ccb52c","b744cf60.64c5f","b0d6a540.ac6428","702f876a.c61948","fbdb681f.644bf8","216e1e13.36e012","b78f767c.ee1fc8","968bf9e9.b58fe8","50e9021.518eefc","a7b8f4cc.469918","161febbb.3a0984","a7bc50f8.0a834","40dbf385.49754c","1905807b.0aeec","66396e2a.cc827","6ec05d73.136404","d3e7181.2e37ce8","4182d0d9.d7ba4","dfdc116c.fe701","71d40037.83d13","87ea6aaf.a7a458","8e2324ba.729bb8","8f704540.8b94b8","c14b0048.319e9","a8a76230.4116b","b512a90d.452f18","3cdae76c.492428","fa1e8716.e25a68","bacba205.85082","49a1f946.f14878","6868bf50.6334e","40584c1f.175754","ba6ee25c.d4d91","9f329dbb.741dd","c19a2436.e168d8","797c51ca.42ae7","b97e28de.3182f8","33afe6.6400801a","4091b25c.aaa8ac","acc67ec.d769d8","8f1d3c0e.ab7b6","9314c023.8c373","8e3b6496.c528c8","f9583e9f.d0275","7dbe7335.ebe61c","dfba7f48.d8cc","ec293a27.495238","13e58654.34d81a","e0a0a641.16a908","bfea6545.36a328","7830060f.baa858","9c7ceaa6.643b58","c8f2f194.020fb","94bc81fe.3a29e","99c2d878.0cc238","309a4340.ba736c","f1068219.0a771","20d7d2f5.1f15ce","f9a544ca.32ce38","801182cf.8a99e","6a7e08f8.31cd78","ec1c3e2f.9bbc1","3d850f78.91703","dcc2081a.d9e0f8","301de3a3.850acc","af681287.bfb6a","49687849.1dcea8","5d740b7f.232f74","a59a76bb.e199c8","552cf154.0c851","c3252f4a.e24c3","d65dff44.d05d1","8267ed2c.160da","d0b4f80.c50c108","e45221fe.f960e","382632ab.83d03e","22c55fce.371f3","48cf96d8.c49658","79a89d04.1da1f4","c64a164a.bad598","d9d9b00f.8be1c","34097e05.43a7f2","f81ae2be.b5cb3","7de23991.328508","f5377e84.e98e6","e2e947e9.5bbc58","6df504f4.e8778c","cac7628b.ec04a","ca04fcda.a38d1","18406e31.ef9ff2","a8fcfcf5.c7117","a6be8e2c.5dcaa","eb6413ca.61682","9e2ea88f.07d948","32adc24e.375ece","791f7a69.fdf374","a40abee6.59dbd","6838509.e41fcb","bb35f8df.261f58","144c0757.249a79","7c2c84df.49433c"],"x":255,"y":100,"wires":[["1f48a4dd.0fb15b"]]},{"id":"7e497deb.8200f4","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":660,"wires":[]},{"id":"512c4306.470f9c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["755ecb09.36daa4","8c0d6729.31a918"],"x":1475,"y":660,"wires":[["126d072c.e2ab39"]]},{"id":"d6bb8bf3.e689e8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3395,"y":740,"wires":[]},{"id":"126d072c.e2ab39","type":"function","z":"9921cbf1.f82328","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n       {\n  \"gadgetId\": \"49083f98-e36b-4a52-0bf7-6f437b06ff27\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"calendar\",\n  \"gadgetOptions\": {\n    \"startDateRange\":start,\n    \"endDateRange\": end,\n    \"enableWeekEnds\": false,\n    \"weekendOnOffToggle\": false,\n    \"calendarViewToggle\": false,\n    \"startOftheWeek\": \"1\",\n    \"timeLabelFormat\": 12,\n    \"locale\": \"en-gb\",\n    \"selectOverlap\": \"anyEvents\",\n    \"showSideBar\": true,\n    \"sidebarCloseButton\": false,\n    \"calculateHoursADay\": false,\n    \"waitForActionPost\": false,\n    \"popOver\": false,\n    \"reset\": false\n  },\n  \"gadgetData\": {\n    \"events\": [\n      {\n        \"_id\": \"\",\n        \"formData\": {\n          \"end\": end,\n          \"start\": start,\n          \"title\": \"Event 1\",\n        },\n    \"end\": end,\n          \"start\": start,\n        \"title\": \"Event 1\",\n        \"disabled\": true,\n      }\n    ],\n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"83d65ed1-6120-a884-a4e4-0a8c33ad7fec\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":660,"wires":[["7e497deb.8200f4"]]},{"id":"55138d24.35b394","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":740,"wires":[]},{"id":"d2469f2a.9e267","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["755ecb09.36daa4","8c0d6729.31a918"],"x":1475,"y":740,"wires":[["c873f29e.84d22"]]},{"id":"c873f29e.84d22","type":"function","z":"9921cbf1.f82328","name":"range","func":"var start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\nmsg.payload = {\n    gadgetsList:[\n       \n       {\n  \"gadgetId\": \"e3a1d9bf-a199-5885-086a-40947bb88ba4\",\n  \"gadgetName\": \"range\",\n  \"gadgetType\": \"calendar\",\n  \"gadgetOptions\": {\n    \"startDateRange\":start,\n    \"endDateRange\": end,\n    \"enableWeekEnds\": false,\n    \"weekendOnOffToggle\": false,\n    \"calendarViewToggle\": false,\n    \"startOftheWeek\": \"1\",\n    \"businessHours\": {\n      \"start\": \"07:00\",\n      \"end\": \"20:00\",\n      buffer:1\n        },\n    calendarHours:{\n        start:\"05:30\",\n        end:\"23:30\"\n    },\n    \"timeLabelFormat\": 12,\n    \"locale\": \"en-gb\",\n    \"selectOverlap\": \"anyEvents\",\n    \"showSideBar\": true,\n    \"sidebarCloseButton\": false,\n    \"calculateHoursADay\": false,\n    \"waitForActionPost\": false,\n    \"popOver\": true,\n    \"reset\": false\n  },\n  \"gadgetData\": {\n\n    \"events\": [\n      {\n        \"_id\": \"\",\n        \"formData\": {\n          \"end\": end,\n          \"start\": start,\n          \"title\": \"Event 1\",\n        },\n    \"end\": end,\n          \"start\": start,\n        \"title\": \"Event 1\",\n        \"disabled\": true,\n      }\n    ],\n  }\n}\n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push(\n       {\n  \"gadgetId\": \"2a631ecd-7b7f-67bd-98dd-a39347cd3d48\",\n  \"gadgetName\": \"rangeCode\",\n  \"gadgetType\": \"code-block\",\n  \"gadgetData\": {\n    \"content\": msg.payload.gadgetsList[0],\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n}\n      )\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"rangeDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Range\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":740,"wires":[["55138d24.35b394"]]},{"id":"2f62ec6b.7fb6f4","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nvar gadgetsList =[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}}];\n\n  \ngadgetsList.push(\n       {\n  \"gadgetData\": {\n    \"data\": msg.data,\n    \"options\": {\"number-columns\":1}\n  },\n  \"gadgetOptions\":{\n       \"options\": {\n            \"label\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            },\n            \"value\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            }\n       }\n  },\n  \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n  \"gadgetName\": \"actionConfirmationText\",\n  \"gadgetType\": \"dynamic-text-area\"\n}\n      )\n\nmsg.payload = {gadgetsList:gadgetsList};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3850,"y":820,"wires":[["942e42e6.ea30e"]]},{"id":"942e42e6.ea30e","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3995,"y":880,"wires":[]},{"id":"5576dbdd.1edac4","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.data  = []\n\n_.each(msg.RevotioData.PostData.gadgetData, function(value , key){\n    \n    if (typeof value === \"object\"){\n        _.each(value, function(valueValue, valueValueKey){\n            msg.data.push({\n                    \"label\": key +\".\"+valueValueKey,\n                    \"value\": valueValue\n                  })\n    \n        })\n    } else {\n        msg.data.push({\n        \"label\": key,\n        \"value\": value\n      })\n    \n    }\n    \n    \n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3520,"y":860,"wires":[["2f62ec6b.7fb6f4"]]},{"id":"79778570.e5825c","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":780,"wires":[]},{"id":"685e4089.55b23","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["755ecb09.36daa4","8c0d6729.31a918"],"x":1475,"y":780,"wires":[["41eec2b.6a23c3c"]]},{"id":"41eec2b.6a23c3c","type":"function","z":"9921cbf1.f82328","name":"events","func":"var start = new Date();\nvar end = start \nend.setHours(end.getHours() + 4);\n\nvar start2 = new Date();\nstart2.setHours(start2.getHours() + 5);\n\nvar end2 = start2 \nend2.setHours(end2.getHours() + 2);\n\nvar start3 = new Date();\nstart3.setHours(start3.getHours() + 8);\nvar end3 = start3\nend3.setHours(end3.getHours() + 1);\n\nvar start4 = new Date();\nstart4.setHours(start4.getHours() + 10);\nvar end4 = start4\nend4.setHours(end4.getHours() + 2);\n\nvar start5 = new Date();\nstart5.setHours(start5.getHours() + 13);\nvar end5= start5 \nend5.setHours(end5.getHours() + 3);\n\nvar start6 = new Date();\nstart6.setHours(start6.getHours() + 17);\nvar end6 = start6\nend6.setHours(end6.getHours() + 3);\n\nvar start7 = new Date();\nstart7.setHours(start7.getHours() + 22);\nvar end7 = start7\nend7.setHours(end7.getHours() + 5);\n\n\nmsg.payload = {\n    gadgetsList:[\n       \n       {\n  \"gadgetId\": \"a6c76368-9974-fe32-2aa6-7a2ad8d22ad6\",\n  \"gadgetName\": \"events\",\n  \"gadgetType\": \"calendar\",\n  \"gadgetOptions\": {\n    \"startDateRange\":start,\n    \"endDateRange\": end,\n    \"enableWeekEnds\": false,\n    \"weekendOnOffToggle\": false,\n    \"calendarViewToggle\": false,\n    \"startOftheWeek\": \"1\",\n    \"timeLabelFormat\": 12,\n    \"locale\": \"en-gb\",\n    \"selectOverlap\": \"anyEvents\",\n    \"showSideBar\": true,\n    \"sidebarCloseButton\": false,\n    \"calculateHoursADay\": false,\n    \"waitForActionPost\": false,\n    \"popOver\": true,\n    \"reset\": false\n  },\n  \"gadgetData\": {\n\n    \"events\": [\n      {\n        \"_id\": \"\",\n        \n         \"end\": end,\n          \"start\": start,\n        \"title\": \"Event 1, not editable\",\n        \"disabled\": true,\n      },\n      {\n        \"_id\": \"\",\n        \n         \"end\": end2,\n          \"start\": start2,\n        \"title\": \"Event 2, Editable\",\n        \"disabled\": false,\n      },\n     {\n        \"_id\": \"\",\n        \n         \"end\": end3,\n          \"start\": start3,\n        \"title\": \"Event 3, Editable & Description\",\n        description:{[\"Title value\"]:'<h2>Hi I am a Title value 1</h2>',[\"Title value\"]:'<h2>Hi I am a <strong>Title value 2<strong/></h2>'},\n        \"disabled\": false,\n      },\n       {\n        \"_id\": \"\",\n        \n         \"end\": end4,\n          \"start\": start4,\n        \"title\": \"Event 4, Editable & backgroundColor\",\n        // description:{[\"Title value\"]:'<h2>Hi I am a Title value 1</h2>',[\"Title value\"]:'<h2>Hi I am a <strong>Title value 2<strong/></h2>'},\n       \"backgroundColor\" : \"green\",\n        \"disabled\": false,\n      },\n          {\n        \"_id\": \"\",\n        \n         \"end\": end5,\n          \"start\": start5,\n        \"title\": \"Event 5, Editable & borderColor = red\",\n        // description:{[\"Title value\"]:'<h2>Hi I am a Title value 1</h2>',[\"Title value\"]:'<h2>Hi I am a <strong>Title value 2<strong/></h2>'},\n       \"borderColor\" : \"red\",\n        \"disabled\": false,\n      },\n       {\n        \"_id\": \"\",\n        \n         \"end\": end6,\n          \"start\": start6,\n        \"title\": \"Event 6, Editable & textColor = brown\",\n        // description:{[\"Title value\"]:'<h2>Hi I am a Title value 1</h2>',[\"Title value\"]:'<h2>Hi I am a <strong>Title value 2<strong/></h2>'},\n       \"textColor\" : \"red\",\n        \"disabled\": false,\n      },\n             {\n        \"_id\": \"\",\n        \n         \"end\": end7,\n          \"start\": start7,\n        \"title\": \"Event 7, Editable & display = background\",\n        // description:{[\"Title value\"]:'<h2>Hi I am a Title value 1</h2>',[\"Title value\"]:'<h2>Hi I am a <strong>Title value 2<strong/></h2>'},\n       \"display\" : \"background\",\n        \"disabled\": false,\n      }\n    ],\n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"4d9c0b7b-8f46-750c-3e66-29f9b6bb2c0f\",\n  \"gadgetName\": \"eventsCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"e0dd5600-7fc3-8f87-2d7e-49647f70da5b\",\n                              \"gadgetName\": \"eventsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Events\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":780,"wires":[["79778570.e5825c"]]},{"id":"2f774e87.4030b2","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":820,"wires":[]},{"id":"86bfef5c.25f0a","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["755ecb09.36daa4","8c0d6729.31a918"],"x":1475,"y":820,"wires":[["f41bc2bb.b2538"]]},{"id":"f41bc2bb.b2538","type":"function","z":"9921cbf1.f82328","name":"tour","func":"var start = new Date();\nvar end = start \nend.setHours(end.getHours() + 4);\n\nvar start2 = new Date();\nstart2.setHours(start2.getHours() + 5);\n\nvar end2 = start2 \nend2.setHours(end2.getHours() + 2);\n\nvar start3 = new Date();\nstart3.setHours(start3.getHours() + 8);\nvar end3 = start3\nend3.setHours(end3.getHours() + 1);\n\nvar start4 = new Date();\nstart4.setHours(start4.getHours() + 10);\nvar end4 = start4\nend4.setHours(end4.getHours() + 2);\n\nvar start5 = new Date();\nstart5.setHours(start5.getHours() + 13);\nvar end5= start5 \nend5.setHours(end5.getHours() + 3);\n\nvar start6 = new Date();\nstart6.setHours(start6.getHours() + 17);\nvar end6 = start6\nend6.setHours(end6.getHours() + 3);\n\nvar start7 = new Date();\nstart7.setHours(start7.getHours() + 22);\nvar end7 = start7\nend7.setHours(end7.getHours() + 5);\n\n\nmsg.payload = {\n    gadgetsList:[\n       \n       {\n  \"gadgetId\": \"2da712f5-c6ed-7c17-81bf-44d573509068\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"calendar\",\n  \"gadgetOptions\": {\n    \"startDateRange\":start,\n    \"endDateRange\": end,\n    \"enableWeekEnds\": false,\n    \"weekendOnOffToggle\": false,\n    \"calendarViewToggle\": false,\n    \"startOftheWeek\": \"1\",\n    \"timeLabelFormat\": 12,\n    \"locale\": \"en-gb\",\n    \"selectOverlap\": \"anyEvents\",\n    \"showSideBar\": true,\n    \"sidebarCloseButton\": false,\n    \"calculateHoursADay\": false,\n    \"waitForActionPost\": false,\n    \"popOver\": false,\n    \"reset\": false\n  },\n  \"gadgetData\": {\n            \"tours\": {\n                  \"eventsPicker\": {\n                    \"content\": \"Placement right && priority = 6 \",\n                    \"title\": \"Option == > eventsPicker\",\n                    \"priority\": 6,\n                    \"placement\": \"left\"\n                  },\n                  \"allDay\": {\n                    \"content\": \"Placement right && priority = 5 \",\n                   \"title\": \"Option == > allDay\",\n                    \"priority\": 5,\n                    \"placement\": \"top\"\n                  },\n                  \"calendarViewSwitch\": {\n                    \"content\": \"Placement right && priority = 4 \",\n                    \"title\": \"Option == > calendarViewSwitch\",\n                    \"priority\": 4,\n                    \"placement\": \"right\"\n                  },\n                  \"calendarViews\": {\n                      \"content\": \"Placement top && priority = 3 \",\n                   \"title\": \"Option == > calendarViews\",\n                    \"priority\": 3,\n                    \"placement\": \"top\"\n                  },\n                  \"today\": {\n                      \"content\": \"Placement left && priority = 2 \",\n                   \"title\": \"Option == > today\",\n                    \"priority\": 2,\n                    \"placement\": \"left\"\n                  },\n                  \"navigation\": {\n                   \"content\": \"Placement bottom && priority = 1 \",\n                   \"title\": \"Option == > navigation\",\n                    \"priority\": 1,\n                    \"placement\": \"bottom\"\n      }\n    }\n  }}]}\n\n\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"6b80b4a7-472c-14b6-9327-357f23a4edef\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":820,"wires":[["2f774e87.4030b2"]]},{"id":"bdde0f3.e80b0f","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":700,"wires":[]},{"id":"da08c84b.c322f8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["755ecb09.36daa4","8c0d6729.31a918"],"x":1475,"y":700,"wires":[["120e1a2.ea229e6"]]},{"id":"120e1a2.ea229e6","type":"function","z":"9921cbf1.f82328","name":"drag","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\n\nmsg.payload = {\n    gadgetsList:[\n       {\n  \"gadgetId\": \"f9632d8f-c705-7775-b366-851ac8d96779\",\n  \"gadgetName\": \"eventsPicker\",\n  \"gadgetType\": \"calendar\",\n  \"gadgetOptions\": {\n    \"startDateRange\":start,\n    \"endDateRange\": end,\n    \"enableWeekEnds\": false,\n    \"weekendOnOffToggle\": false,\n    \"calendarViewToggle\": false,\n    \"startOftheWeek\": \"1\",\n    \"timeLabelFormat\": 12,\n    \"locale\": \"en-gb\",\n    \"selectOverlap\": \"anyEvents\",\n    \"showSideBar\": true,\n    \"sidebarCloseButton\": false,\n    \"calculateHoursADay\": false,\n    \"waitForActionPost\": false,\n    \"popOver\": false,\n    \"reset\": false\n  },\n  \"gadgetData\": {\n    \"eventsPicker\": [\n      {\n        \"label\": \"Morning Tasks\",\n        \"icon\": \"swipe\",\n        \"events\": [\n          {\n            \"title\": \"Cleaning\",\n            \"duration\": \"02:00\",\n            \"backgroundColor\": \"green\",\n            \"icon\": \"analytics\"\n          }\n        ]\n      }\n    ],\n    \"events\": [\n      {\n        \"_id\": \"\",\n        \"formData\": {\n          \"end\": end,\n          \"start\": start,\n          \"title\": \"Event 1\",\n        },\n    \"end\": end,\n          \"start\": start,\n        \"title\": \"Event 1\",\n        \"disabled\": true,\n      }\n    ],\n  }\n}\n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"bc72a15d-b52f-680f-4630-a69eef419438\",\n  \"gadgetName\": \"dragCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"dragDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Events\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":700,"wires":[["bdde0f3.e80b0f"]]},{"id":"2e6e73eb.5e00ac","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":860,"wires":[]},{"id":"3deae426.0ad89c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["755ecb09.36daa4","8c0d6729.31a918"],"x":1475,"y":860,"wires":[["25b9546d.55db7c"]]},{"id":"25b9546d.55db7c","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1660,"y":860,"wires":[["2e6e73eb.5e00ac"]]},{"id":"8c0d6729.31a918","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","512c4306.470f9c","d2469f2a.9e267","662d87cc.7d0548","685e4089.55b23","86bfef5c.25f0a","da08c84b.c322f8","3deae426.0ad89c"],"x":3375,"y":780,"wires":[]},{"id":"745ed7a9.becce8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":900,"wires":[]},{"id":"8155641f.de6968","type":"comment","z":"9921cbf1.f82328","name":"catalog","info":"","x":210,"y":1160,"wires":[]},{"id":"fb59ac8f.585be","type":"comment","z":"9921cbf1.f82328","name":"catalog gagdet actions","info":"","x":2940,"y":1120,"wires":[]},{"id":"a1f86fb8.473bc","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2550,"y":1060,"wires":[]},{"id":"ef6eb36b.af4ba","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","dc2c6cd4.026f9"],"x":855,"y":1280,"wires":[["ecb2ebb1.a720c8","c5171db1.9e1ca"]]},{"id":"ae0b01c1.8de9d","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3210,"y":1200,"wires":[["abf6ffa5.231a5"],["d7552120.ca7fc"],["7e03b2ab.f3b99c"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"9a7019b6.90a6e8","type":"debug","z":"9921cbf1.f82328","name":"catalog Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3180,"y":1140,"wires":[]},{"id":"ecb2ebb1.a720c8","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","3ae2698b.1521a6","26c29dda.6daf62","cd9f1d1b.bf34","a4068274.1987a","9ca5395.6c309c8","662d87cc.7d0548","48dffeab.b720a","3e306bac.f04474","df2eca39.dced78","f4dfb767.07c788","f866df09.7044d"],"x":1235,"y":1280,"wires":[]},{"id":"f114610f.bc3c4","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":820,"y":1240,"wires":[]},{"id":"c5171db1.9e1ca","type":"debug","z":"9921cbf1.f82328","name":"catalog INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":990,"y":1240,"wires":[]},{"id":"b616d704.754c38","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","e5c5613e.a1fd2"],"x":3015,"y":1200,"wires":[["9a7019b6.90a6e8","ae0b01c1.8de9d"]]},{"id":"bcf0c7a0.257838","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","a6aad1dc.7a4d9"],"x":815,"y":1180,"wires":[["fb8f755a.ec2bd8"]]},{"id":"e9fe39c6.4659c8","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1390,"y":1180,"wires":[]},{"id":"60fb726c.8a519c","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":1180,"wires":[["fd004892.809e38"]]},{"id":"9f31662c.c9a0c8","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":820,"y":1140,"wires":[]},{"id":"3ae2698b.1521a6","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["ecb2ebb1.a720c8"],"x":1555,"y":1320,"wires":[["1fc8226d.22272e"]]},{"id":"322ceb30.cd3fe4","type":"http in","z":"9921cbf1.f82328","name":"catalog","url":"/catalog","method":"post","upload":false,"swaggerDoc":"","x":190,"y":1220,"wires":[["821e3ebb.a7831"]]},{"id":"a6aad1dc.7a4d9","type":"link out","z":"9921cbf1.f82328","name":"","links":["bcf0c7a0.257838"],"x":455,"y":1180,"wires":[]},{"id":"dc2c6cd4.026f9","type":"link out","z":"9921cbf1.f82328","name":"","links":["ef6eb36b.af4ba"],"x":455,"y":1220,"wires":[]},{"id":"e5c5613e.a1fd2","type":"link out","z":"9921cbf1.f82328","name":"","links":["b616d704.754c38"],"x":455,"y":1260,"wires":[]},{"id":"fa65a6d.8ef0358","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":530,"y":1220,"wires":[]},{"id":"72f97731.c17928","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":540,"y":1180,"wires":[]},{"id":"2405f4b3.91c8bc","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":530,"y":1260,"wires":[]},{"id":"fb8f755a.ec2bd8","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":920,"y":1180,"wires":[["60fb726c.8a519c"]]},{"id":"821e3ebb.a7831","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":310,"y":1220,"wires":[["a6aad1dc.7a4d9"],["dc2c6cd4.026f9"],["e5c5613e.a1fd2"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"abf6ffa5.231a5","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3380,"y":1140,"wires":[["9af1a0bc.c3157"]]},{"id":"1fc8226d.22272e","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1740,"y":1320,"wires":[["7f5bd638.29da18"]]},{"id":"fd004892.809e38","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1240,"y":1180,"wires":[["e9fe39c6.4659c8"]]},{"id":"60d84304.bfd8fc","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2415,"y":1120,"wires":[]},{"id":"a4068274.1987a","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["ecb2ebb1.a720c8","d7552120.ca7fc"],"x":1555,"y":1120,"wires":[["ea44e9a9.7d6388"]]},{"id":"9af1a0bc.c3157","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3455,"y":1140,"wires":[]},{"id":"ea44e9a9.7d6388","type":"function","z":"9921cbf1.f82328","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n          {\n                  \"gadgetId\": \"e4a0b1e8-a9f7-d047-385c-06ead3138685\",\n                  \"gadgetName\": \"basic\",\n                  \"gadgetType\": \"catalog\",\n                  \"gadgetData\": {\n                    \"featuredImage\": \"/files/media/soup.jpg\",\n                    \"title\": \"Soup\",\n                    \"author\": \"Jane Doe\",\n                    \"isFavorite\": false,\n                    \"rating\": 3.4,\n                    \"footerInfo\": [\n                      {\n                        \"icon\": \"schedule\",\n                        \"label\": \"20 min\",\n                        \"color\": \"#d1d2d1\"\n                      },\n                      {\n                        \"icon\": \"/files/media/icons/pepper.svg\",\n                        \"label\": \"3/5\",\n                        \"color\": \"#d1d2d1\"\n                      }\n                    ],\n                    \"callactionType\": \"globalClick\",\n                    \"tooltipContent\": \"<bold> Lorem ipsum dolor sit amet</bold> , consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui.\",\n                    \"tooltipButtonLabel\": \"\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"canEditTooltip\": false\n                  }\n                }\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":1120,"wires":[["60d84304.bfd8fc"]]},{"id":"29b426b2.d8fb5a","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2415,"y":1200,"wires":[]},{"id":"9ca5395.6c309c8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["ecb2ebb1.a720c8","d7552120.ca7fc"],"x":1555,"y":1200,"wires":[["af57031e.a375"]]},{"id":"af57031e.a375","type":"function","z":"9921cbf1.f82328","name":"disabled","func":"msg.payload = {\n    gadgetsList:[\n     \n          {\n                \"gadgetId\": \"ac8e520b-212b-1a23-ed72-ecc1fbbaf66f\",\n                 \"gadgetName\": \"disabled\",\n                      \"gadgetType\": \"catalog\",\n                  \"gadgetData\": {\n                    \"featuredImage\": \"/files/media/pancakes.jpg\",\n                    \"title\": \"Pancakes\",\n                    \"author\": \"Mastro Pancakes\",\n                    \"isFavorite\": false,\n                    \"rating\": 2.8,\n                    \"footerInfo\": [\n                      {\n                        \"icon\": \"schedule\",\n                        \"label\": \"30 min\",\n                        \"color\": \"#d1d2d1\"\n                      },\n                      {\n                        \"icon\": \"/files/media/icons/pepper.svg\",\n                        \"label\": \"1/5\",\n                        \"color\": \"#d1d2d1\"\n                      }\n                    ],\n                    \"callactionType\": \"globalClick\",\n                    \"tooltipContent\": \"Lorem ipsum  <bold> Pancakes  </bold> sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui.\",\n                    \"tooltipButtonLabel\": \"Pancakes label\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": true,\n                    \"canEditTooltip\": false\n                  }\n                }\n      \n      ]\n}\n\n\nmsg.payload.gadgetsList.push({\n                          \"gadgetId\": \"b7f1c2cf-8f9a-7c91-63a6-3ab731bc51bb\",\n  \"gadgetName\": \"disabledCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"disabledDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Disabled\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1740,"y":1200,"wires":[["29b426b2.d8fb5a"]]},{"id":"32860329.037b7c","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nvar gadgetsList =[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}}];\n\n  \ngadgetsList.push(\n       {\n  \"gadgetData\": {\n    \"data\": msg.data,\n    \"options\": {\"number-columns\":1}\n  },\n  \"gadgetOptions\":{\n       \"options\": {\n            \"label\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            },\n            \"value\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            }\n       }\n  },\n  \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n  \"gadgetName\": \"actionConfirmationText\",\n  \"gadgetType\": \"dynamic-text-area\"\n}\n      )\n\nmsg.payload = {gadgetsList:gadgetsList};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3670,"y":1220,"wires":[["eb37dced.e1ec9"]]},{"id":"eb37dced.e1ec9","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3815,"y":1260,"wires":[]},{"id":"507d3ba.67b95c4","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.data  = []\n\n_.each(msg.RevotioData.PostData.gadgetData, function(value , key){\n    \n    if (typeof value === \"object\"){\n        _.each(value, function(valueValue, valueValueKey){\n            msg.data.push({\n                    \"label\": key +\".\"+valueValueKey,\n                    \"value\": valueValue\n                  })\n    \n        })\n    } else {\n        msg.data.push({\n        \"label\": key,\n        \"value\": value\n      })\n    \n    }\n    \n    \n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3500,"y":1220,"wires":[["32860329.037b7c"]]},{"id":"e18ab142.106d1","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2415,"y":1240,"wires":[]},{"id":"3e306bac.f04474","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["ecb2ebb1.a720c8","d7552120.ca7fc"],"x":1555,"y":1240,"wires":[["d009361f.96fd08"]]},{"id":"d009361f.96fd08","type":"function","z":"9921cbf1.f82328","name":"tour","func":"msg.payload = {\n    gadgetsList:[\n     \n          {\n                  \"gadgetId\": \"862c9cde-3bfb-6ea2-28ff-b72aa556636c\",\n                  \"gadgetName\": \"tour\",\n                  \"gadgetType\": \"catalog\",\n                  \"gadgetData\": {\n                    \"featuredImage\": \"/files/media/ice cream.jpg\",\n                    \"title\": \"Ice cream\",\n                    \"author\": \"Mastro ice cream\",\n                    \"isFavorite\": false,\n                    \"rating\": 2.8,\n                    \"footerInfo\": [\n                      {\n                        \"icon\": \"schedule\",\n                        \"label\": \"30 min\",\n                        \"color\": \"#d1d2d1\"\n                      },\n                      {\n                        \"icon\": \"/files/media/icons/pepper.svg\",\n                        \"label\": \"1/5\",\n                        \"color\": \"#d1d2d1\"\n                      }\n                    ],\n                    \"callactionType\": \"globalClick\",\n                    \"tooltipContent\": \"Lorem ipsum  <bold> ice cream  </bold> sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui.\",\n                    \"tooltipButtonLabel\": \"Pancakes label\",\n                  tour:{\n                      content:\"Tour content, left placement\",\n                      title :\"Tour title, left placement\",\n                      priority:1,\n                      placement :\"left\"\n                  }\n                      \n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"canEditTooltip\": false\n                  }\n                }\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":1240,"wires":[["e18ab142.106d1"]]},{"id":"13f993fc.6d792c","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2415,"y":1160,"wires":[]},{"id":"df2eca39.dced78","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["ecb2ebb1.a720c8","d7552120.ca7fc"],"x":1555,"y":1160,"wires":[["cd96b602.b57c78"]]},{"id":"cd96b602.b57c78","type":"function","z":"9921cbf1.f82328","name":"tooltip","func":"\n\nmsg.payload = {\n    gadgetsList:[\n     \n          {\n                  \"gadgetId\": \"5dcbadee-aa09-f1c1-6135-312dfefdca6b\",\n                  \"gadgetName\": \"tooltip\",\n                  \"gadgetType\": \"catalog\",\n                  \"gadgetData\": {\n                    \"featuredImage\": \"/files/media/sandwich.jpg\",\n                    \"title\": \"Sandwich\",\n                    \"author\": \"Chef Sandwich\",\n                    \"isFavorite\": false,\n                    \"rating\": 2.8,\n                    \"footerInfo\": [\n                      {\n                        \"icon\": \"schedule\",\n                        \"label\": \"20 min\",\n                        \"color\": \"#d1d2d1\"\n                      },\n                      {\n                        \"icon\": \"/files/media/icons/pepper.svg\",\n                        \"label\": \"1/5\",\n                        \"color\": \"#d1d2d1\"\n                      }\n                    ],\n                    \"callactionType\": \"tooltip\",\n                    \"tooltipContent\": \"Lorem ipsum  <bold> sandwich  </bold> sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus. Phasellus viverra nulla ut metus varius laoreet. Quisque rutrum. Aenean imperdiet. Etiam ultricies nisi vel augue. Curabitur ullamcorper ultricies nisi. Nam eget dui.\",\n                    \"tooltipButtonLabel\": \"sandwich label\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"canEditTooltip\": true\n                  }\n                }\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"13fe34f3-3a34-bb1f-e598-b5981dc0cf84\",\n  \"gadgetName\": \"tooltipCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"tooltipDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"tooltip\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":1160,"wires":[["13f993fc.6d792c"]]},{"id":"8a377131.93d15","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2415,"y":1280,"wires":[]},{"id":"f4dfb767.07c788","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["ecb2ebb1.a720c8","d7552120.ca7fc"],"x":1555,"y":1280,"wires":[["b3da5f9a.b172a"]]},{"id":"b3da5f9a.b172a","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1740,"y":1280,"wires":[["8a377131.93d15"]]},{"id":"d7552120.ca7fc","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","a4068274.1987a","9ca5395.6c309c8","662d87cc.7d0548","48dffeab.b720a","3e306bac.f04474","df2eca39.dced78","f4dfb767.07c788"],"x":3435,"y":1180,"wires":[]},{"id":"7f5bd638.29da18","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2415,"y":1320,"wires":[]},{"id":"776cdf5c.689b4","type":"comment","z":"9921cbf1.f82328","name":"chip","info":"","x":150,"y":1540,"wires":[]},{"id":"94a5d40e.08fe08","type":"comment","z":"9921cbf1.f82328","name":"chip gagdet actions","info":"","x":3210,"y":1500,"wires":[]},{"id":"e4f8300e.7d9d","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2490,"y":1440,"wires":[]},{"id":"4a7dc474.f5b2fc","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","92d030a2.3a705"],"x":795,"y":1660,"wires":[["475cd8f4.85e058","dfd02bd2.e7f9a8"]]},{"id":"4d8d83c6.c2b44c","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":1640,"wires":[["8cdb299b.d6a578"],["78558b37.8df614"],["eafa15c7.311638"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"7337daea.1c0584","type":"debug","z":"9921cbf1.f82328","name":"chip Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3150,"y":1540,"wires":[]},{"id":"475cd8f4.85e058","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","2347443c.e8e27c","26c29dda.6daf62","cd9f1d1b.bf34","b754a57d.248d58","5978c4de.8eda9c","662d87cc.7d0548","8fdc3ee2.10182","d8796ce5.52cdd","555e4376.ac3b0c","b41c9647.e2d728","a7ab5532.4c0938"],"x":1175,"y":1660,"wires":[]},{"id":"71ef0c8b.963a54","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":760,"y":1620,"wires":[]},{"id":"dfd02bd2.e7f9a8","type":"debug","z":"9921cbf1.f82328","name":"chip INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":920,"y":1620,"wires":[]},{"id":"36ef5932.696326","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","68198337.253a2c"],"x":2975,"y":1640,"wires":[["7337daea.1c0584","4d8d83c6.c2b44c"]]},{"id":"bebabcaf.4cbaf","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","618f63c3.825bac"],"x":755,"y":1560,"wires":[["86339cad.767a8"]]},{"id":"3adcc365.d7e92c","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1290,"y":1560,"wires":[]},{"id":"afa98057.efd1c","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":1560,"wires":[["e8a04714.bbf4b8"]]},{"id":"92e8ce0f.a8a68","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":760,"y":1520,"wires":[]},{"id":"2347443c.e8e27c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["475cd8f4.85e058"],"x":1475,"y":1740,"wires":[["ee29154b.687088"]]},{"id":"a3b99224.88c8","type":"http in","z":"9921cbf1.f82328","name":"chip","url":"/chip","method":"post","upload":false,"swaggerDoc":"","x":130,"y":1600,"wires":[["c75955e5.904418"]]},{"id":"618f63c3.825bac","type":"link out","z":"9921cbf1.f82328","name":"","links":["bebabcaf.4cbaf"],"x":395,"y":1560,"wires":[]},{"id":"92d030a2.3a705","type":"link out","z":"9921cbf1.f82328","name":"","links":["4a7dc474.f5b2fc"],"x":395,"y":1600,"wires":[]},{"id":"68198337.253a2c","type":"link out","z":"9921cbf1.f82328","name":"","links":["36ef5932.696326"],"x":395,"y":1640,"wires":[]},{"id":"4404cd7e.560254","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":470,"y":1600,"wires":[]},{"id":"638cbe9f.c040d","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":480,"y":1560,"wires":[]},{"id":"b3c11d28.df39","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":470,"y":1640,"wires":[]},{"id":"86339cad.767a8","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":860,"y":1560,"wires":[["afa98057.efd1c"]]},{"id":"c75955e5.904418","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":250,"y":1600,"wires":[["618f63c3.825bac"],["92d030a2.3a705"],["68198337.253a2c"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"8cdb299b.d6a578","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3340,"y":1580,"wires":[["3746c4c3.df73ac"]]},{"id":"ee29154b.687088","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1660,"y":1740,"wires":[["ddcf43e4.c35d7"]]},{"id":"e8a04714.bbf4b8","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1180,"y":1560,"wires":[["3adcc365.d7e92c"]]},{"id":"e19917ce.3ef4b8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":1500,"wires":[]},{"id":"b754a57d.248d58","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["475cd8f4.85e058","78558b37.8df614"],"x":1475,"y":1500,"wires":[["6c103bd8.982484"]]},{"id":"3746c4c3.df73ac","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3415,"y":1580,"wires":[]},{"id":"6c103bd8.982484","type":"function","z":"9921cbf1.f82328","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n   \n       {\n  \"gadgetId\": \"8ebc580c-2724-3aea-3f9b-ff2ccc3909a9\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"chip\",\n  \"gadgetData\": [\n    {\n      \"title\": \"Chip 1\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": true,\n      \"color\": \"warning\",\n      \"allowEdit\": false,\n      \"allowDelete\": true,\n      \"src\": \"\"\n    },\n    {\n      \"title\": \"Chip 2\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": true,\n      \"color\": \"warning\",\n      \"allowEdit\": false,\n      \"allowDelete\": false,\n      \"src\": \"\"\n    },\n    {\n      \"title\": \"Chip 3\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": true,\n      \"color\": \"warning\",\n      \"allowEdit\": true,\n      \"allowDelete\": false,\n      \"src\": \"\"\n    }\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"addType\": \"list\",\n    \"allowAdd\": true,\n    \"chipsList\": [\n      {\n        \"title\": \"Suggest 1\",\n        \"avatar\": \"\",\n        \"icon\": \"bookmark\",\n        \"iconPack\": \"\",\n        \"transparent\": true,\n        \"color\": \"warning\",\n        \"allowEdit\": true,\n        \"allowDelete\": true,\n        \"src\": \"\"\n      },\n      {\n        \"title\": \"Suggest 2\",\n        \"avatar\": \"\",\n        \"icon\": \"bookmark\",\n        \"iconPack\": \"\",\n        \"transparent\": true,\n        \"color\": \"warning\",\n        \"allowEdit\": false,\n        \"allowDelete\": true,\n        \"src\": \"\"\n      },\n      {\n        \"title\": \"Suggest 3\",\n        \"avatar\": \"\",\n        \"icon\": \"bookmark\",\n        \"iconPack\": \"\",\n        \"transparent\": true,\n        \"color\": \"warning\",\n        \"allowEdit\": true,\n        \"allowDelete\": false,\n        \"src\": \"\"\n      },\n      {\n        \"title\": \"Suggest 4\",\n        \"avatar\": \"\",\n        \"icon\": \"bookmark\",\n        \"iconPack\": \"\",\n        \"transparent\": true,\n        \"color\": \"warning\",\n        \"allowEdit\": false,\n        \"allowDelete\": false,\n        \"src\": \"\"\n      }\n    ]\n  }\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                         \"gadgetId\": \"bed74c3a-051e-e427-61ea-0bb455d0b862\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":1500,"wires":[["e19917ce.3ef4b8"]]},{"id":"706df857.05e7f8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":1580,"wires":[]},{"id":"5978c4de.8eda9c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["475cd8f4.85e058","78558b37.8df614"],"x":1475,"y":1580,"wires":[["62c6e2db.35c36c"]]},{"id":"62c6e2db.35c36c","type":"function","z":"9921cbf1.f82328","name":"crud","func":"\nmsg.payload = {\n    gadgetsList:[\n   \n       {\n  \"gadgetId\": \"c47ca97a-3191-1f14-b3b4-488cd6271ea8\",\n  \"gadgetName\": \"crud\",\n  \"gadgetType\": \"chip\",\n  \"gadgetData\": [\n    {\n      \"title\": \"Chip 1, edit\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": false,\n      \"color\": \"warning\",\n      \"allowEdit\": true,\n      \"allowDelete\": false,\n      \"src\": \"\"\n    },\n    {\n      \"title\": \"Chip 2, delete\",\n      \"avatar\": \"\",\n      \"icon\": \"code\",\n      \"iconPack\": \"\",\n      \"transparent\": false,\n      \"color\": \"danger\",\n      \"allowEdit\": false,\n      \"allowDelete\": true,\n      \"src\": \"\"\n    },\n\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"addType\": \"list\",\n    \"allowAdd\": true,\n    \n    \"chipsList\" : [ {\n      \"title\": \"Chip 3, NEW edit\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": false,\n      \"color\": \"primary\",\n      \"allowEdit\": true,\n      \"allowDelete\": false,\n      \"src\": \"\"\n    },\n    {\n      \"title\": \"Chip 4,NEW  delete\",\n      \"avatar\": \"\",\n      \"icon\": \"code\",\n      \"iconPack\": \"\",\n      \"transparent\": false,\n      \"color\": \"success\",\n      \"allowEdit\": false,\n      \"allowDelete\": true,\n      \"src\": \"\"\n    },\n]\n  }\n}\n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                       \"gadgetId\": \"cbbb68b5-1415-df0c-da0d-460bd388843b\",\n  \"gadgetName\": \" crudCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"crudDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"CRUD\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":1580,"wires":[["706df857.05e7f8"]]},{"id":"a0273b37.91daa8","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nvar gadgetsList =[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}}];\n\n  \ngadgetsList.push(\n       {\n  \"gadgetData\": {\n    \"data\": msg.data,\n    \"options\": {\"number-columns\":1}\n  },\n  \"gadgetOptions\":{\n       \"options\": {\n            \"label\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            },\n            \"value\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            }\n       }\n  },\n  \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n  \"gadgetName\": \"actionConfirmationText\",\n  \"gadgetType\": \"dynamic-text-area\"\n}\n      )\n\nmsg.payload = {gadgetsList:gadgetsList};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3690,"y":1660,"wires":[["6b483753.e7d788"]]},{"id":"6b483753.e7d788","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3835,"y":1740,"wires":[]},{"id":"f2c61273.60316","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.data  = []\n\n_.each(msg.RevotioData.PostData.gadgetData, function(value , key){\n    \n    if (typeof value === \"object\"){\n        _.each(value, function(valueValue, valueValueKey){\n            msg.data.push({\n                    \"label\": key +\".\"+valueValueKey,\n                    \"value\": valueValue\n                  })\n    \n        })\n    } else {\n        msg.data.push({\n        \"label\": key,\n        \"value\": value\n      })\n    \n    }\n    \n    \n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3480,"y":1660,"wires":[["a0273b37.91daa8"]]},{"id":"dd5a929.a9ac37","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":1620,"wires":[]},{"id":"8fdc3ee2.10182","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["475cd8f4.85e058","78558b37.8df614"],"x":1475,"y":1620,"wires":[[]]},{"id":"16884a4b.4af1f6","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":1660,"wires":[]},{"id":"d8796ce5.52cdd","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["475cd8f4.85e058","78558b37.8df614"],"x":1475,"y":1660,"wires":[["8cc28a84.dad438"]]},{"id":"8cc28a84.dad438","type":"function","z":"9921cbf1.f82328","name":"tour","func":"msg.payload = {\n    gadgetsList:[\n   \n\n       {\n  \"gadgetId\": \"3b9c3645-2864-7cf9-b320-c34147d303b9\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"chip\",\n  \"gadgetData\": [\n    {\n      \"title\": \"Chip 1\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": true,\n      \"color\": \"warning\",\n      \"allowEdit\": false,\n      \"allowDelete\": true,\n      \"src\": \"\"\n    },\n    {\n      \"title\": \"Chip 2\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": true,\n      \"color\": \"warning\",\n      \"allowEdit\": false,\n      \"allowDelete\": false,\n      \"src\": \"\",\n       tour:{\n                      content:\"Tour on a chip itself, left placement\",\n                      title :\"Tour on a chip itself, left placement\",\n                      priority:3,\n                      placement :\"left\"\n                  },\n    },\n    {\n      \"title\": \"Chip 3\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": true,\n      \"color\": \"warning\",\n      \"allowEdit\": true,\n      \"allowDelete\": false,\n      \"src\": \"\"\n    }\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"addType\": \"list\",\n    \"allowAdd\": true,\n     tour:{\n                      content:\"Tour chips, right placement\",\n                      title :\"Tour chips, right placement\",\n                      priority:1,\n                      placement :\"left\"\n                  },\n    \"chipsList\": [\n      {\n        \"title\": \"Suggest 1\",\n        \"avatar\": \"\",\n        \"icon\": \"bookmark\",\n        \"iconPack\": \"\",\n        \"transparent\": true,\n        \"color\": \"warning\",\n        \"allowEdit\": true,\n        \"allowDelete\": true,\n        \"src\": \"\"\n      },\n      {\n        \"title\": \"Suggest 2\",\n        \"avatar\": \"\",\n        \"icon\": \"bookmark\",\n        \"iconPack\": \"\",\n        \"transparent\": true,\n        \"color\": \"warning\",\n        \"allowEdit\": false,\n        \"allowDelete\": true,\n        \"src\": \"\"\n      },\n      {\n        \"title\": \"Suggest 3\",\n        \"avatar\": \"\",\n        \"icon\": \"bookmark\",\n        \"iconPack\": \"\",\n        \"transparent\": true,\n        \"color\": \"warning\",\n        \"allowEdit\": true,\n        \"allowDelete\": false,\n        \"src\": \"\"\n      },\n      {\n        \"title\": \"Suggest 4\",\n        \"avatar\": \"\",\n        \"icon\": \"bookmark\",\n        \"iconPack\": \"\",\n        \"transparent\": true,\n        \"color\": \"warning\",\n        \"allowEdit\": false,\n        \"allowDelete\": false,\n        \"src\": \"\"\n      }\n    ]\n  }\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"c82f5aca-f439-4efc-a6cc-fd357e26de59\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                                                  tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":1660,"wires":[["16884a4b.4af1f6"]]},{"id":"629c726c.ece06c","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":1540,"wires":[]},{"id":"555e4376.ac3b0c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["475cd8f4.85e058","78558b37.8df614"],"x":1475,"y":1540,"wires":[["db2a2bd9.f4d838"]]},{"id":"db2a2bd9.f4d838","type":"function","z":"9921cbf1.f82328","name":"design","func":"\nmsg.payload = {\n    gadgetsList:[\n   \n       {\n  \"gadgetId\": \"b321f2f0-af3b-598a-4034-f6b8d02cae7e\",\n  \"gadgetName\": \"design\",\n  \"gadgetType\": \"chip\",\n  \"gadgetData\": [\n    {\n      \"title\": \"Chip 1, transparent & materials icon & color = primary\",\n      \"avatar\": \"\",\n      \"icon\": \"bookmark\",\n      \"iconPack\": \"\",\n      \"transparent\": true,\n      \"color\": \"primary\",\n      \"allowEdit\": false,\n      \"allowDelete\": false,\n      \"src\": \"\"\n    },\n    {\n      \"title\": \"Chip 2, solid & materials icon & color = success\",\n      \"avatar\": \"\",\n      \"icon\": \"code\",\n      \"iconPack\": \"\",\n      \"transparent\": false,\n      \"color\": \"success\",\n      \"allowEdit\": false,\n      \"allowDelete\": false,\n      \"src\": \"\"\n    },\n    {\n      \"title\": \"Chip 3 transparent, image icon & color = warning\",\n      \"avatar\": \"\",\n    //   \"icon\": \"design\",\n    //   \"iconPack\": \"\",\n      \"transparent\": true,\n      \"color\": \"warning\",\n      \"allowEdit\": false,\n      \"allowDelete\": false,\n      \"src\": \"/files/logo/factory/logo.jpg\"\n    },\n      {\n      \"title\": \"Chip 4 solid & jpg icon & color = danger\",\n      \"avatar\": \"\",\n    //   \"icon\": \"design\",\n    //   \"iconPack\": \"\",\n      \"transparent\": false,\n      \"color\": \"danger\",\n      \"allowEdit\": false,\n      \"allowDelete\": false,\n      \"src\": \"/files/logo/factory/logo.jpg\"\n    }\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"addType\": \"list\",\n    \"allowAdd\": false,\n\n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"3d2bdb65-5899-f4eb-e34b-8b0dfb700481\",\n  \"gadgetName\": \"designCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"designDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Design\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":1540,"wires":[["629c726c.ece06c"]]},{"id":"4cfd8f85.c642b","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":1700,"wires":[]},{"id":"b41c9647.e2d728","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["475cd8f4.85e058","78558b37.8df614"],"x":1475,"y":1700,"wires":[["57ca495e.fe8f38"]]},{"id":"57ca495e.fe8f38","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1660,"y":1700,"wires":[["4cfd8f85.c642b"]]},{"id":"78558b37.8df614","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","b754a57d.248d58","5978c4de.8eda9c","662d87cc.7d0548","8fdc3ee2.10182","d8796ce5.52cdd","555e4376.ac3b0c","b41c9647.e2d728"],"x":3415,"y":1620,"wires":[]},{"id":"ddcf43e4.c35d7","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":1740,"wires":[]},{"id":"389c2247.4ac34e","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":460,"wires":[]},{"id":"cf537f9f.2c296","type":"comment","z":"9921cbf1.f82328","name":"data-card","info":"","x":160,"y":3380,"wires":[]},{"id":"f73d19ed.a29148","type":"comment","z":"9921cbf1.f82328","name":"data-card gagdet actions","info":"","x":3230,"y":3340,"wires":[]},{"id":"87d5e61.1dcad18","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2490,"y":3280,"wires":[]},{"id":"6ecc1b23.a979f4","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","24cd7a58.457436"],"x":795,"y":3500,"wires":[["e55b29ea.f07798","714dd3d1.2a482c"]]},{"id":"58d3f27d.6c34fc","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":3480,"wires":[["574b8f54.626ba"],["ec40ce65.830ec"],["4fd864df.47cc8c"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"48e23afe.b2af34","type":"debug","z":"9921cbf1.f82328","name":"data-card Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3160,"y":3380,"wires":[]},{"id":"e55b29ea.f07798","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","44190308.4c3d2c","26c29dda.6daf62","cd9f1d1b.bf34","a066adb7.f58c8","5ccefbf8.0480f4","662d87cc.7d0548","254d1c18.1ab894","f0cac11.30dd44","726d7ff4.73977","9430ef91.a37d7","cbfacd04.0a84e"],"x":1175,"y":3500,"wires":[]},{"id":"7c5b7da4.481524","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":760,"y":3460,"wires":[]},{"id":"714dd3d1.2a482c","type":"debug","z":"9921cbf1.f82328","name":"data-card INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":930,"y":3460,"wires":[]},{"id":"62e818e0.9a7858","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","ce07f5bf.fa7d58"],"x":2975,"y":3480,"wires":[["48e23afe.b2af34","58d3f27d.6c34fc"]]},{"id":"c5ec0bac.cda6c8","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","352ec5bc.bce17a"],"x":755,"y":3400,"wires":[["ff070b83.892e68"]]},{"id":"d26048ea.f5b008","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1290,"y":3400,"wires":[]},{"id":"fe03add3.21c71","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":3400,"wires":[["c5a9ec0f.29f93"]]},{"id":"39d2e62c.28574a","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":760,"y":3360,"wires":[]},{"id":"44190308.4c3d2c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["e55b29ea.f07798"],"x":1475,"y":3460,"wires":[["9595d387.07198"]]},{"id":"3a569881.13cf58","type":"http in","z":"9921cbf1.f82328","name":"Datacard","url":"/Datacard","method":"post","upload":false,"swaggerDoc":"","x":120,"y":3440,"wires":[["1902003.905f"]]},{"id":"352ec5bc.bce17a","type":"link out","z":"9921cbf1.f82328","name":"","links":["c5ec0bac.cda6c8"],"x":395,"y":3400,"wires":[]},{"id":"24cd7a58.457436","type":"link out","z":"9921cbf1.f82328","name":"","links":["6ecc1b23.a979f4"],"x":395,"y":3440,"wires":[]},{"id":"ce07f5bf.fa7d58","type":"link out","z":"9921cbf1.f82328","name":"","links":["62e818e0.9a7858"],"x":395,"y":3480,"wires":[]},{"id":"1ed1c9e9.1794d6","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":470,"y":3440,"wires":[]},{"id":"c11cd223.d3ef6","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":480,"y":3400,"wires":[]},{"id":"ffdfdc40.2570d","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":470,"y":3480,"wires":[]},{"id":"ff070b83.892e68","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":860,"y":3400,"wires":[["fe03add3.21c71"]]},{"id":"1902003.905f","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":250,"y":3440,"wires":[["352ec5bc.bce17a"],["24cd7a58.457436"],["ce07f5bf.fa7d58"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"574b8f54.626ba","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3340,"y":3420,"wires":[["c25545b8.aa7048"]]},{"id":"9595d387.07198","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1660,"y":3460,"wires":[["d7433ee3.b1521"]]},{"id":"c5a9ec0f.29f93","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1180,"y":3400,"wires":[["d26048ea.f5b008"]]},{"id":"be0585dc.b51f68","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":3340,"wires":[]},{"id":"a066adb7.f58c8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["e55b29ea.f07798","ec40ce65.830ec"],"x":1475,"y":3340,"wires":[["d1bae367.40b9a"]]},{"id":"c25545b8.aa7048","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3415,"y":3420,"wires":[]},{"id":"d1bae367.40b9a","type":"function","z":"9921cbf1.f82328","name":"basic","func":"\nmsg.payload = {\n    gadgetsList:[\n       {\n                  \"gadgetId\": \"c85c8da9-bda5-239f-4999-9c789e9e48d5\",\n                  \"gadgetName\": \"basic\",\n                  \"gadgetType\": \"data-card\",\n                  \"gadgetData\": {\n                    \"cardTitle\": \"Title\",\n                    \"cardType\": \"success\",\n                    \"cardContentValue\": \"cardContentValue\",\n                    \"cardBottonValue\": \"cardBottonValue\",\n                    \"cardIcon\": \"code\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false\n                  }\n                }\n      \n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"d44fa87b-6bf0-68d1-8f23-f0617979473b\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":3340,"wires":[["be0585dc.b51f68"]]},{"id":"725780b8.49e2c","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nvar gadgetsList =[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}}];\n\n  \ngadgetsList.push(\n       {\n  \"gadgetData\": {\n    \"data\": msg.data,\n    \"options\": {\"number-columns\":1}\n  },\n  \"gadgetOptions\":{\n       \"options\": {\n            \"label\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            },\n            \"value\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            }\n       }\n  },\n  \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n  \"gadgetName\": \"actionConfirmationText\",\n  \"gadgetType\": \"dynamic-text-area\"\n}\n      )\n\nmsg.payload = {gadgetsList:gadgetsList};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3690,"y":3500,"wires":[["a0d3cb4f.e5a1d8"]]},{"id":"a0d3cb4f.e5a1d8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3835,"y":3540,"wires":[]},{"id":"96479889.f12c98","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.data  = []\n\n_.each(msg.RevotioData.PostData.gadgetData, function(value , key){\n    \n    if (typeof value === \"object\"){\n        _.each(value, function(valueValue, valueValueKey){\n            msg.data.push({\n                    \"label\": key +\".\"+valueValueKey,\n                    \"value\": valueValue\n                  })\n    \n        })\n    } else {\n        msg.data.push({\n        \"label\": key,\n        \"value\": value\n      })\n    \n    }\n    \n    \n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3480,"y":3500,"wires":[["725780b8.49e2c"]]},{"id":"225e4780.50aac8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":3380,"wires":[]},{"id":"f0cac11.30dd44","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["e55b29ea.f07798","ec40ce65.830ec"],"x":1475,"y":3380,"wires":[["8b69294c.ec3fe8"]]},{"id":"8b69294c.ec3fe8","type":"function","z":"9921cbf1.f82328","name":"tour","func":"\n\nmsg.payload = {\n    gadgetsList:[\n       {\n                  \"gadgetId\": \"fafe3cbd-9234-f0ab-cd8d-894a5c699207\",\n                  \"gadgetName\": \"tour\",\n                  \"gadgetType\": \"data-card\",\n                  \"gadgetData\": {\n                       tour:{\n                      content:\"Tour data-card, left placement\",\n                      title :\"Tour data-card, left placement\",\n                      priority:1,\n                      placement :\"left\"\n                  },\n                    \"cardTitle\": \"Tour title \",\n                    \"cardType\": \"warning\",\n                    \"cardContentValue\": \"cardContentValue\",\n                    \"cardBottonValue\": \"cardBottonValue\",\n                    \"cardIcon\": \"tour\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false\n                  }\n                }\n      \n      \n      \n      ]\n}\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"8c953448-e3c7-3cdd-5252-547acde30ef8\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                                                  tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":3380,"wires":[["225e4780.50aac8"]]},{"id":"74a3505e.17e4f","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":3420,"wires":[]},{"id":"9430ef91.a37d7","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["e55b29ea.f07798","ec40ce65.830ec"],"x":1475,"y":3420,"wires":[["4ac7e955.5d85f8"]]},{"id":"4ac7e955.5d85f8","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1660,"y":3420,"wires":[["74a3505e.17e4f"]]},{"id":"ec40ce65.830ec","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","a066adb7.f58c8","5ccefbf8.0480f4","662d87cc.7d0548","254d1c18.1ab894","f0cac11.30dd44","726d7ff4.73977","9430ef91.a37d7"],"x":3415,"y":3460,"wires":[]},{"id":"d7433ee3.b1521","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":3460,"wires":[]},{"id":"53b22a5e.feefc4","type":"comment","z":"9921cbf1.f82328","name":"divider","info":"","x":170,"y":4360,"wires":[]},{"id":"7e63a916.fd5508","type":"comment","z":"9921cbf1.f82328","name":"divider gagdet actions","info":"","x":2900,"y":4320,"wires":[]},{"id":"dcad03e3.1c7fb","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2510,"y":4260,"wires":[]},{"id":"d40378ed.c70318","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","c0229117.e7f26"],"x":815,"y":4480,"wires":[["4a0e13.afe011ec","d83bbae3.3a6708"]]},{"id":"11179e34.62ab12","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":4400,"wires":[["90fc2b04.5f3118"],["828b4955.b29758"],["6b6feae7.c3aff4"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"180581bb.0a064e","type":"debug","z":"9921cbf1.f82328","name":"divider Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3140,"y":4340,"wires":[]},{"id":"4a0e13.afe011ec","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","8f94175e.2b7158","26c29dda.6daf62","cd9f1d1b.bf34","6badb9b2.9b85b8","37ab8877.e131a8","662d87cc.7d0548","48dffeab.b720a","19fbfda8.482412","e50ae9ee.b53698","2d921ad6.29dc56","d5bf56b2.445d18","4709a216.246d4c","68a81141.8dfb8"],"x":1195,"y":4480,"wires":[]},{"id":"a9f8b163.c46d2","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":780,"y":4440,"wires":[]},{"id":"d83bbae3.3a6708","type":"debug","z":"9921cbf1.f82328","name":"divider INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":940,"y":4440,"wires":[]},{"id":"4f83b27d.317e9c","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","6c749af5.fea1d4"],"x":2975,"y":4400,"wires":[["180581bb.0a064e","11179e34.62ab12"]]},{"id":"37537142.9f10ae","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","d6e38b88.ee5da8"],"x":775,"y":4380,"wires":[["a427d608.1e5328"]]},{"id":"42467475.eacfdc","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1350,"y":4380,"wires":[]},{"id":"a5b0a3a1.a5877","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":4380,"wires":[["88dad1d3.07e7f"]]},{"id":"84f926c6.9a0c58","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":780,"y":4340,"wires":[]},{"id":"8f94175e.2b7158","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec"],"x":1515,"y":4480,"wires":[["f16eab41.52afd8"]]},{"id":"9d15352d.52ed08","type":"http in","z":"9921cbf1.f82328","name":"divider","url":"/divider","method":"post","upload":false,"swaggerDoc":"","x":150,"y":4420,"wires":[["6ed4ad3b.84ce94"]]},{"id":"d6e38b88.ee5da8","type":"link out","z":"9921cbf1.f82328","name":"","links":["37537142.9f10ae"],"x":415,"y":4380,"wires":[]},{"id":"c0229117.e7f26","type":"link out","z":"9921cbf1.f82328","name":"","links":["d40378ed.c70318"],"x":415,"y":4420,"wires":[]},{"id":"6c749af5.fea1d4","type":"link out","z":"9921cbf1.f82328","name":"","links":["4f83b27d.317e9c"],"x":415,"y":4460,"wires":[]},{"id":"17963b78.693705","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":490,"y":4420,"wires":[]},{"id":"f04c6b17.6da258","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":500,"y":4380,"wires":[]},{"id":"578ad361.4a56cc","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":490,"y":4460,"wires":[]},{"id":"a427d608.1e5328","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":880,"y":4380,"wires":[["a5b0a3a1.a5877"]]},{"id":"6ed4ad3b.84ce94","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":270,"y":4440,"wires":[["d6e38b88.ee5da8"],["c0229117.e7f26"],["6c749af5.fea1d4"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"90fc2b04.5f3118","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3340,"y":4340,"wires":[["fc40095b.362128"]]},{"id":"f16eab41.52afd8","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1700,"y":4480,"wires":[["51ef73ae.7d6f8c"]]},{"id":"88dad1d3.07e7f","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1200,"y":4380,"wires":[["42467475.eacfdc"]]},{"id":"3a74a888.476928","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4280,"wires":[]},{"id":"6badb9b2.9b85b8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec","828b4955.b29758"],"x":1515,"y":4280,"wires":[["1a069b1c.bcb9d5"]]},{"id":"fc40095b.362128","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3415,"y":4340,"wires":[]},{"id":"1a069b1c.bcb9d5","type":"function","z":"9921cbf1.f82328","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n               \n      {\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"title\": \"Basic\",\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ]}\n\n\nmsg.payload.gadgetsList.push({\n                        \"gadgetId\": \"6dd95755-5d3a-d74c-05d0-106a9918e783\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4280,"wires":[["3a74a888.476928"]]},{"id":"16217be1.b91384","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4360,"wires":[]},{"id":"37ab8877.e131a8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec","828b4955.b29758"],"x":1515,"y":4360,"wires":[["ef19f19d.370b9"]]},{"id":"ef19f19d.370b9","type":"function","z":"9921cbf1.f82328","name":"position","func":"msg.payload = {\n    gadgetsList:[\n     \n         {\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"positionDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"dashed\",\n                                \"position\": \"right-center\",\n                              \n                                \"background\": \"transparent\",\n                                \"title\": \"Position\",\n                        \n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } \n      \n      ]\n}\n\n\nmsg.payload.gadgetsList.push({\n                          \"gadgetId\": \"89bc297a-1170-3f99-d305-1897df5e7c3a\",\n  \"gadgetName\": \"positionCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":4360,"wires":[["16217be1.b91384"]]},{"id":"375935e0.9ee76a","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nvar gadgetsList =[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}}];\n\n  \ngadgetsList.push(\n       {\n  \"gadgetData\": {\n    \"data\": msg.data,\n    \"options\": {\"number-columns\":1}\n  },\n  \"gadgetOptions\":{\n       \"options\": {\n            \"label\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            },\n            \"value\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            }\n       }\n  },\n  \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n  \"gadgetName\": \"actionConfirmationText\",\n  \"gadgetType\": \"dynamic-text-area\"\n}\n      )\n\nmsg.payload = {gadgetsList:gadgetsList};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3630,"y":4420,"wires":[["16e0679e.2abf78"]]},{"id":"16e0679e.2abf78","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3775,"y":4520,"wires":[]},{"id":"b6f0872e.dc9ad8","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.data  = []\n\n_.each(msg.RevotioData.PostData.gadgetData, function(value , key){\n    \n    if (typeof value === \"object\"){\n        _.each(value, function(valueValue, valueValueKey){\n            msg.data.push({\n                    \"label\": key +\".\"+valueValueKey,\n                    \"value\": valueValue\n                  })\n    \n        })\n    } else {\n        msg.data.push({\n        \"label\": key,\n        \"value\": value\n      })\n    \n    }\n    \n    \n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3460,"y":4420,"wires":[["375935e0.9ee76a"]]},{"id":"7cba0fb9.d8c44","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4400,"wires":[]},{"id":"19fbfda8.482412","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec","828b4955.b29758"],"x":1515,"y":4400,"wires":[["64937e04.40e9f"]]},{"id":"64937e04.40e9f","type":"function","z":"9921cbf1.f82328","name":"tour","func":"msg.payload = {\n    gadgetsList:[\n     \n          {\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                tour:{\n                                      content:\"Tour state, right placement\",\n                                      title :\"Tour state, right placement\",\n                                      priority:1,\n                                      placement :\"right\"\n                                  },\n                                \"title\": \"Tour\",\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"b85c6a0c-0c9b-422c-a6ee-7824407af5d4\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4400,"wires":[["7cba0fb9.d8c44"]]},{"id":"76d4be18.01317","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4320,"wires":[]},{"id":"e50ae9ee.b53698","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec","828b4955.b29758"],"x":1515,"y":4320,"wires":[["274eb24.537524e"]]},{"id":"274eb24.537524e","type":"function","z":"9921cbf1.f82328","name":"tooltip","func":"\nmsg.payload = {\n    gadgetsList:[\n               \n      {\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"borderStyleDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"dotted\",\n                                \"title\": \"borderStyle\",\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ]}\n\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"a39c0899-307a-a617-7fc0-a7d8626c085b\",\n  \"gadgetName\": \"borderStyleCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4320,"wires":[["76d4be18.01317"]]},{"id":"454d6545.20dafc","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4440,"wires":[]},{"id":"2d921ad6.29dc56","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec","828b4955.b29758"],"x":1515,"y":4440,"wires":[["583d6db.b3b6794"]]},{"id":"583d6db.b3b6794","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n      \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":4440,"wires":[["454d6545.20dafc"]]},{"id":"828b4955.b29758","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","6badb9b2.9b85b8","37ab8877.e131a8","662d87cc.7d0548","48dffeab.b720a","19fbfda8.482412","e50ae9ee.b53698","2d921ad6.29dc56","d5bf56b2.445d18","4709a216.246d4c","68a81141.8dfb8"],"x":3395,"y":4380,"wires":[]},{"id":"51ef73ae.7d6f8c","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4480,"wires":[]},{"id":"7451fc36.e00044","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4520,"wires":[]},{"id":"d5bf56b2.445d18","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec","828b4955.b29758"],"x":1515,"y":4520,"wires":[["ac0d261c.1bab88"]]},{"id":"ac0d261c.1bab88","type":"function","z":"9921cbf1.f82328","name":"design","func":"\nmsg.payload = {\n    gadgetsList:[\n               \n      {\n                              \"gadgetId\": \"4a0e983c-71d9-2af7-8301-a3712804edb5\",\n                              \"gadgetName\": \"design\",\n                              \"gadgetType\": \"divider\",\n                             \"gadgetData\": {\n                                  \"borderStyle\": \"solid\",\n                                  \"position\": \"center\",\n                                  \"icon\": \"\",\n                                  \"color\": \"success\",\n                                  \"background\": \"warning\",\n                                  \"title\": \"Design\",\n                                  \"textTag\": \"h5\"\n                                },\n                                \"gadgetOptions\": {\n                                  \"disabled\": false,\n                                  \"style\": {}\n                                }\n                              \n                            } ]}\n\n\nmsg.payload.gadgetsList.push({\n                       \"gadgetId\": \"93fa8936-8c11-13e4-d3b0-7d9880f87bbe\",\n  \"gadgetName\": \"designCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4520,"wires":[["7451fc36.e00044"]]},{"id":"c147f88c.9e6288","type":"comment","z":"9921cbf1.f82328","name":"dynamic-btn","info":"","x":190,"y":4720,"wires":[]},{"id":"21b769ff.bb0086","type":"comment","z":"9921cbf1.f82328","name":"dynamic-btn gagdet actions","info":"","x":2920,"y":4680,"wires":[]},{"id":"f3df4226.6b67","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2510,"y":4620,"wires":[]},{"id":"fc20665c.9428a8","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","881da9b8.e5ab38"],"x":815,"y":4840,"wires":[["20d13e87.861f02","2efaeac9.d0a736"]]},{"id":"29c6064d.4885da","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":4760,"wires":[["64507fa2.18767"],["c212c8e1.b2cdc8"],["677bccb7.00efc4"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"4a44713f.fab33","type":"debug","z":"9921cbf1.f82328","name":"dynamic-btn Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3150,"y":4700,"wires":[]},{"id":"20d13e87.861f02","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","e9e748d6.190dc8","26c29dda.6daf62","cd9f1d1b.bf34","3bccd68b.99d99a","ad167e4d.dca8","662d87cc.7d0548","48dffeab.b720a","177474ee.3cabeb","b50edab2.80c5e8","c1caa6fb.76a9b8","70edf3e.7bfb10c","9f45006.bf8a8"],"x":1195,"y":4840,"wires":[]},{"id":"6a542002.1861d","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":780,"y":4800,"wires":[]},{"id":"2efaeac9.d0a736","type":"debug","z":"9921cbf1.f82328","name":"dynamic-btn INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":960,"y":4800,"wires":[]},{"id":"e29b5b4c.88cc58","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","b9ff1b52.0fef58"],"x":2975,"y":4760,"wires":[["4a44713f.fab33","29c6064d.4885da"]]},{"id":"fcb81fe0.5782c","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","99064d7b.ff74a"],"x":775,"y":4740,"wires":[["246960a2.19802"]]},{"id":"a2e93547.555c18","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1350,"y":4740,"wires":[]},{"id":"e6f1b571.5a6fe8","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":4740,"wires":[["6809c382.972e6c"]]},{"id":"6417c640.bab0b8","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":780,"y":4700,"wires":[]},{"id":"e9e748d6.190dc8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["20d13e87.861f02"],"x":1515,"y":4860,"wires":[["cca67471.160898"]]},{"id":"cd2d2a81.ee9878","type":"http in","z":"9921cbf1.f82328","name":"dynamicBtn","url":"/dynamicBtn","method":"post","upload":false,"swaggerDoc":"","x":110,"y":4780,"wires":[["90872629.4f8458"]]},{"id":"99064d7b.ff74a","type":"link out","z":"9921cbf1.f82328","name":"","links":["fcb81fe0.5782c"],"x":415,"y":4740,"wires":[]},{"id":"881da9b8.e5ab38","type":"link out","z":"9921cbf1.f82328","name":"","links":["fc20665c.9428a8"],"x":415,"y":4780,"wires":[]},{"id":"b9ff1b52.0fef58","type":"link out","z":"9921cbf1.f82328","name":"","links":["e29b5b4c.88cc58"],"x":415,"y":4820,"wires":[]},{"id":"e85417b3.8526e8","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":490,"y":4780,"wires":[]},{"id":"d469af0b.b0ac5","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":500,"y":4740,"wires":[]},{"id":"a09e0139.a6b15","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":490,"y":4820,"wires":[]},{"id":"246960a2.19802","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":880,"y":4740,"wires":[["e6f1b571.5a6fe8"]]},{"id":"90872629.4f8458","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":270,"y":4780,"wires":[["99064d7b.ff74a"],["881da9b8.e5ab38"],["b9ff1b52.0fef58"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"64507fa2.18767","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3340,"y":4700,"wires":[["2ae4780f.e39e38"]]},{"id":"cca67471.160898","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1700,"y":4860,"wires":[["a926ca31.0313b8"]]},{"id":"6809c382.972e6c","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1200,"y":4740,"wires":[["a2e93547.555c18"]]},{"id":"16aff964.e989b7","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4660,"wires":[]},{"id":"3bccd68b.99d99a","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["20d13e87.861f02","c212c8e1.b2cdc8"],"x":1515,"y":4660,"wires":[["c9fdbdb1.e0399"]]},{"id":"2ae4780f.e39e38","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3415,"y":4700,"wires":[]},{"id":"c9fdbdb1.e0399","type":"function","z":"9921cbf1.f82328","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n       \n       {\n  \"gadgetId\": \"59957aa2-4058-5b4a-3f9c-8a4c147672d7\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Basic\",\n  \"action\": {\n      btnAction:\"basic\",\n        }\n  }\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                     \"gadgetId\": \"77faffb3-cbf4-c990-317f-b51ad1472457\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4660,"wires":[["16aff964.e989b7"]]},{"id":"422f5943.2bab28","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4740,"wires":[]},{"id":"ad167e4d.dca8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["20d13e87.861f02","c212c8e1.b2cdc8"],"x":1515,"y":4740,"wires":[["542d4376.d3fa4c"]]},{"id":"542d4376.d3fa4c","type":"function","z":"9921cbf1.f82328","name":"form","func":"msg.payload = {\n    gadgetsList:[\n     \n         \n       {\n  \"gadgetId\": \"bdd4a401-474c-01e1-5065-77559a0d8b1a\",\n  \"gadgetName\": \"form\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Form\",\n    \"actionType\": \"form\",\n    \"form\": {\n      \"gadget\": {\n        \"gadgetData\": {\n          \"canceled\": false,\n          \"id\": \"mockdataFOrm10\",\n          \"nextButtonText\": \"Submit\",\n          \"showPrevious\": \"\",\n          \"submitButtonText\": \"Submit\",\n          \"title\": \"\",\n          \"organization_id\": \"\",\n          \"steps\": [\n            {\n              \"fields\": [\n                {\n                  \"htmlTag\": \"input\",\n                  \"name\": \"input2\",\n                  \"options\": {\n                    \"label\": \"Sample Input\",\n                    \"placeholder\": \"Sample Inpu\",\n                    \"required\": true,\n                    \"type\": \"text\",\n                    \"value\": \"\",\n                    \"min\": \"\",\n                    \"max\": \"\",\n                    \"preview\": \"\",\n                    \"disabled\": false,\n                    \"previewPosition\": \"\",\n                    \"info\": \"Hello info\"\n                  }\n                }\n              ]\n            }\n          ]\n        },\n       \n      },\n      \"values\": {\n        \"input2\": \"Mapped input value\"\n      }\n    },\n\n  }\n}\n      \n      \n      ]\n}\n\n\nmsg.payload.gadgetsList.push({\n                \"gadgetId\": \"347930a1-6190-a614-0769-92a54926ea5f\",\n  \"gadgetName\": \"formCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"formDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Form\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4740,"wires":[["422f5943.2bab28"]]},{"id":"32448997.cd4bb6","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nvar gadgetsList =[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}}];\n\n  \ngadgetsList.push(\n       {\n  \"gadgetData\": {\n    \"data\": msg.data,\n    \"options\": {\"number-columns\":1}\n  },\n  \"gadgetOptions\":{\n       \"options\": {\n            \"label\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            },\n            \"value\": {\n              \"textWeight\": \"hairline\",\n              \"italic\": false,\n              \"size\": \"xs\"\n            }\n       }\n  },\n  \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n  \"gadgetName\": \"actionConfirmationText\",\n  \"gadgetType\": \"dynamic-text-area\"\n}\n      )\n\nmsg.payload = {gadgetsList:gadgetsList};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3630,"y":4780,"wires":[[]]},{"id":"f1fe052f.3dfbd8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3655,"y":4820,"wires":[]},{"id":"4f3c0f19.be887","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.data  = []\n\n_.each(msg.RevotioData.PostData.gadgetData, function(value , key){\n    \n    if (typeof value === \"object\"){\n        _.each(value, function(valueValue, valueValueKey){\n            msg.data.push({\n                    \"label\": key +\".\"+valueValueKey,\n                    \"value\": valueValue\n                  })\n    \n        })\n    } else {\n        msg.data.push({\n        \"label\": key,\n        \"value\": value\n      })\n    \n    }\n    \n    \n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3460,"y":4780,"wires":[["32448997.cd4bb6"]]},{"id":"2ee25b21.113a64","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4780,"wires":[]},{"id":"177474ee.3cabeb","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["20d13e87.861f02","c212c8e1.b2cdc8"],"x":1515,"y":4780,"wires":[["a6b5633e.9feb1"]]},{"id":"a6b5633e.9feb1","type":"function","z":"9921cbf1.f82328","name":"tour","func":"msg.payload = {\n    gadgetsList:[\n     \n{\n  \"gadgetId\": \"5fb2860b-6cef-fab5-9df4-395d70e54d03\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"switch\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Tour\",\n    \"actionType\": \"publisherAction\",\n    \"action\": \"tour\",\n    \"design\": {\n      \"icon\": \"support\",\n      \"iconType\": \"icon\",\n      \"size\": \"large\"\n    },\n    \"switch\": {\n      \"onLabel\":\"Switch On\",\n      \"offLabel\":\" Switch Off\",\n      \"state\":false\n    },\n    \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    }\n  }\n}\n\n\n\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n               \"gadgetId\": \"1f66d577-3b06-f311-4bf9-04df5e4eec5d\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                                                      content:\"Tour state, right placement\",\n                                                      title :\"Tour state, right placement\",\n                                                      priority:2,\n                                                      placement :\"right\"\n                                                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4780,"wires":[["2ee25b21.113a64"]]},{"id":"4aa125f7.7634ac","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4700,"wires":[]},{"id":"b50edab2.80c5e8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["20d13e87.861f02","c212c8e1.b2cdc8"],"x":1515,"y":4700,"wires":[["820734fb.cf6148"]]},{"id":"820734fb.cf6148","type":"function","z":"9921cbf1.f82328","name":"List & list_2","func":"\n\nmsg.payload = {\n    gadgetsList:[\n     \n\n       {\n  \"gadgetId\": \"60887001-a89c-bd93-6262-38b50759c590\",\n  \"gadgetName\": \"list\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"multiple\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"List\",\n    \"options\": [\n      {\n        \"title\": \"Option 1\",\n        \"action\": {btnAction:\"list - Option 1\"},\n       \n        \"design\": {\n          \"icon\": \"code\"\n        }\n      },\n       {\n        \"title\": \"Option 2\",\n        \"action\": {btnAction:\"list - Option 2\"},\n       \n        \"design\": {\n          \"icon\": \"dashboard\"\n        }\n      },\n    ],\n\n  }\n} ,    \n{\n    \"gadgetId\": \"d1d82231-a2ff-8a45-9b12-d9d0942c2d5b\",\n    \"gadgetName\": \"list_2\",\n    \"gadgetType\": \"dynamic-btn\",\n    \"gadgetOptions\": {\n      \"dataType\": \"multiple\",\n      \"displayType\": \"button\"\n    },\n    \"gadgetData\": {\n      \"title\": \"List 2\",\n      \"options\": [\n        {\n          \"title\": \"Option 2.1 == publisherAction && switch\",\n          \"action\": {\n            \"btnAction\": \"list - publisherAction 2.1\"\n          },\n          \"design\": {\n            \"icon\": \"create\",\n            \"action\": \"theme\",\n            \"actionType\": \"publisherAction\"\n          },\n          \"switch\": {\n            \"state\":false\n          }\n        },\n        {\n          \"title\": \"Option 2.2  switch\",\n          \"action\": {\n            \"btnAction\": \"list -  2.2 Switch\"\n          },\n          \"design\": {\n            \"icon\": \"create\",\n            \"action\": {\n              \"btnAction\": \"list - Option 2.2 switch\"\n            }\n          },\"switch\": {\n            \"state\":false\n          }\n        },\n        {\n          \"title\": \"Option 2.3  colour\",\n          \"action\": {\n            \"btnAction\": \"list -  2.3 colour\"\n          },\n          \"design\": {\n            \"icon\": \"create\",\n            \"action\": {\n              \"btnAction\": \"list - Option 2.3 colour\"\n            },\n            \"color\": \"warning\"\n          }\n        }\n      ]\n    }\n  }\n  \n\n\n// {\n//   \"gadgetId\": \"d1d82231-a2ff-8a45-9b12-d9d0942c2d5b\",\n//   \"gadgetName\": \"list_2\",\n//   \"gadgetType\": \"dynamic-btn\",\n//   \"gadgetOptions\": {\n//     \"dataType\": \"multiple\",\n//     \"displayType\": \"button\"\n//   },\n//   \"gadgetData\": {\n//     \"title\": \"List 2\",\n//     \"options\": [\n//       {\n//         \"title\": \"Option 2.1 == publisherAction && switch\",\n//         \"action\": {btnAction:\"list - publisherAction 2.1\"},\n       \n//         \"design\": {\n//           \"icon\": \"create\",\n//           \"action\": \"theme\",\n//           \"actionType\": \"publisherAction\",\n//           \"switch\": true\n//         }\n//       },\n//             {\n//         \"title\": \"Option 2.2  switch\",\n//         \"action\": {btnAction:\"list -  2.2 Switch\"},\n       \n//         \"design\": {\n//           \"icon\": \"create\",\n//           \"action\": {btnAction:\"list - Option 2.2 switch\"},\n//          \"switch\": true\n//         }\n//       },\n      \n//                   {\n//         \"title\": \"Option 2.3  colour\",\n//         \"action\": {btnAction:\"list -  2.3 colour\"},\n//         \"design\": {\n//           \"icon\": \"create\",\n//           \"action\": {btnAction:\"list - Option 2.3 colour\"},\n//             color: \"warning\",\n  \n//         }\n//       },\n//     ],\n\n//   }\n// }\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"3c3458df-1906-d539-d870-fffa3e1b01fe\",\n  \"gadgetName\": \"listCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"listDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"List\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":4700,"wires":[["4aa125f7.7634ac"]]},{"id":"3e51f613.71b5fa","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4820,"wires":[]},{"id":"c1caa6fb.76a9b8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["20d13e87.861f02","c212c8e1.b2cdc8"],"x":1515,"y":4820,"wires":[["7362471a.7f6dc8"]]},{"id":"7362471a.7f6dc8","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":4820,"wires":[["3e51f613.71b5fa"]]},{"id":"c212c8e1.b2cdc8","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","3bccd68b.99d99a","ad167e4d.dca8","662d87cc.7d0548","48dffeab.b720a","177474ee.3cabeb","b50edab2.80c5e8","c1caa6fb.76a9b8","70edf3e.7bfb10c","9f45006.bf8a8"],"x":3395,"y":4740,"wires":[]},{"id":"a926ca31.0313b8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4860,"wires":[]},{"id":"a4f927df.422a68","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4900,"wires":[]},{"id":"70edf3e.7bfb10c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["20d13e87.861f02","c212c8e1.b2cdc8"],"x":1515,"y":4900,"wires":[["6bb46191.1bdcb"]]},{"id":"6bb46191.1bdcb","type":"function","z":"9921cbf1.f82328","name":"design","func":"\nmsg.payload = {\n    gadgetsList:[\n     \n       \n\n       {\n  \"gadgetId\": \"6c79b112-2060-850e-7b5d-f66e2a7c42e2\",\n  \"gadgetName\": \"design_1\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Filled Button\",\n    \"actionType\": \"button\",\n    \"action\": {},\n    \"design\": {\n      \"icon\": \"support\",\n      \"iconType\": \"done\",\n      \"size\": \"large\",\n      \"type\":\"filled\"\n    },\n    \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    }\n\n  }\n  },\n {\n  \"gadgetId\": \"e9ee6c46-e05f-b608-0201-44176771530a\",\n  \"gadgetName\": \"design_2\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Design 2 - image\",\n    \"design\": {\n        \"color\": \"danger\",\n        \"iconType\": \"image\",\n        \"size\":\"medium\",\n        \"icon\": \"/files/logo/factory/logo.jpg\"\n    },\n    \"action\": {\n      \"data\":  \"Design 2 - image\",\n      \"type\": \"userClick\"\n    },\n    \"actionType\": \"button\",\n\n  }\n},\n {\n  \"gadgetId\": \"03c024c6-1f2b-e193-bd53-5b433a241f30\",\n  \"gadgetName\": \"design_3\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Design 3 - color code #E2E515\",\n    \"design\": {\n        \"color\": \"#E2E515\",\n\n        \"size\":\"large\",\n     \n    },\n    \"action\": {\n      \"data\": \"Design 3 - color code #E2E515\",\n      \"type\": \"userClick\"\n    },\n    \"actionType\": \"button\",\n\n  }\n},\n {\n  \"gadgetId\": \"3c553ff9-66d4-4df6-df7e-970bf80a4283\",\n  \"gadgetName\": \"design_4\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Design 4 - tooltip\",\n    \"design\": {\n        tooltip:'<p>A <strong>tooltip</strong> <span style=\"text-decoration: underline;\">text</span> with rich text <em>formatting</em></p>',\n    },\n    \"action\": {\n      \"data\": \"Design 4 - tooltip\",\n      \"type\": \"userClick\"\n    },\n    \"actionType\": \"button\",\n\n  }\n},\n {\n \"gadgetId\": \"c7654b85-8c2c-9357-5ffb-442908cd25b6\",\n  \"gadgetName\": \"design_5\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n \"gadgetData\": {\n    \"title\": \"Border Button\",\n    \"actionType\": \"button\",\n    \"action\": {},\n    \"design\": {\n      \"icon\": \"support\",\n      \"iconType\": \"done\",\n      \"size\": \"large\",\n      \"type\":\"border\"\n    },\n    \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    }\n  }\n},\n {\n  \"gadgetId\": \"99e0cfc2-04ff-bebc-4c81-aba3c794271f\",\n  \"gadgetName\": \"design_6\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Relief Button\",\n    \"actionType\": \"button\",\n    \"action\": {},\n    \"design\": {\n      \"icon\": \"support\",\n      \"iconType\": \"done\",\n      \"size\": \"large\",\n      \"type\":\"relief\",\n      \"color\":\"success\"\n    },\n    \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    }\n  }\n},\n\n {\n  \"gadgetId\": \"217d5b7e-14a8-a0a4-2ae2-ae3e65b84ab7\",\n  \"gadgetName\": \"design_7\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Flat Button\",\n    \"actionType\": \"button\",\n    \"action\": {},\n    \"design\": {\n      \"icon\": \"support\",\n      \"iconType\": \"done\",\n      \"size\": \"large\",\n      \"type\":\"flat\"\n    },\n    \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    }\n  }\n},\n {\n  \"gadgetId\": \"635032a5-54d3-e7c0-5761-32c165cffccc\",\n  \"gadgetName\": \"design_8\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Line Button\",\n    \"actionType\": \"button\",\n    \"action\": {},\n    \"design\": {\n      \"icon\": \"support\",\n      \"iconType\": \"done\",\n      \"size\": \"large\",\n      \"type\":\"line\"\n    },\n    \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    }\n  }\n},\n {\n  \"gadgetId\": \"e7b86c96-8558-5776-7784-0e2ac3351463\",\n  \"gadgetName\": \"design_9\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n \"gadgetData\": {\n    \"title\": \"Gradient Button\",\n    \"actionType\": \"button\",\n    \"action\": {},\n    \"design\": {\n      \"icon\": \"support\",\n      \"iconType\": \"done\",\n      \"size\": \"large\",\n      \"type\":\"gradient\"\n    },\n    \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    }\n  }\n}\n      \n      \n      \n      ]\n}\n\nvar gadgetsList = JSON.stringify(msg.payload.gadgetsList)\n\nmsg.payload.gadgetsList.push({\n                \"gadgetId\": \"cd1c2a34-5fc2-3019-576e-998be8bc33c0\",\n  \"gadgetName\": \"designCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": gadgetsList,\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4900,"wires":[["a4f927df.422a68"]]},{"id":"bf826a86.3365d8","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":500,"wires":[]},{"id":"8d6d1196.e41d5","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3","67412f74.5eb71"],"x":1435,"y":500,"wires":[["6ccd20bc.d7b8d"]]},{"id":"6ccd20bc.d7b8d","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"708ad058-fbae-ef60-9bfb-8c211ad668f5\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Breadcrumb</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1590,"y":500,"wires":[["bf826a86.3365d8"]]},{"id":"5f9205a7.af5dac","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"eeab0124-3b3f-f3ee-ea67-fa7f10754782\",\n  \"gadgetName\": \"title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Calendar</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":940,"wires":[["73fe9cd2.24fc74"]]},{"id":"a2b5f718.0f55d8","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Catalog</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":1360,"wires":[["dc38e187.56ce"]]},{"id":"e8b0022b.466c4","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"28bf1742-c56a-f72e-c5f8-52506dfa5ada\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Chips</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":1780,"wires":[["c6bcddc4.f4da7"]]},{"id":"6995a9a.327bd58","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"cffc91b7-af1f-425e-41fe-76429a5f20e9\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Data-cards</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1650,"y":3500,"wires":[["872bad6e.d77f2"]]},{"id":"2e14a981.4cf796","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"dda9696d-d084-40a2-fd85-19e1fd63eda0\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Dividers</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4560,"wires":[["ccf248d5.500118"]]},{"id":"90b6bcc.fcb0e4","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"8d3068be-6b07-faa1-772f-fb22ed7933e2\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Dynamic buttons</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4940,"wires":[["af5b7fdb.c695f"]]},{"id":"73fe9cd2.24fc74","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":940,"wires":[]},{"id":"12de4471.8933ac","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["755ecb09.36daa4"],"x":1475,"y":940,"wires":[["5f9205a7.af5dac"]]},{"id":"dc38e187.56ce","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2415,"y":1360,"wires":[]},{"id":"f866df09.7044d","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["ecb2ebb1.a720c8"],"x":1555,"y":1360,"wires":[["a2b5f718.0f55d8"]]},{"id":"a7ab5532.4c0938","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["475cd8f4.85e058"],"x":1475,"y":1780,"wires":[["e8b0022b.466c4"]]},{"id":"c6bcddc4.f4da7","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":1780,"wires":[]},{"id":"cbfacd04.0a84e","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["e55b29ea.f07798"],"x":1475,"y":3500,"wires":[["6995a9a.327bd58"]]},{"id":"872bad6e.d77f2","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2335,"y":3500,"wires":[]},{"id":"4709a216.246d4c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec","828b4955.b29758"],"x":1515,"y":4560,"wires":[["2e14a981.4cf796"]]},{"id":"ccf248d5.500118","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4560,"wires":[]},{"id":"9f45006.bf8a8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["20d13e87.861f02","c212c8e1.b2cdc8"],"x":1515,"y":4940,"wires":[["90b6bcc.fcb0e4"]]},{"id":"af5b7fdb.c695f","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4940,"wires":[]},{"id":"da6e406f.6787a","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"e0811593-2879-9c1d-d423-64392a45c7ac\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3890,"y":440,"wires":[["ff901097.cca1e"]]},{"id":"8f01b271.fa68","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"59ebbf20-aad5-0b16-e83c-a036d8ae3134\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3590,"y":920,"wires":[["942e42e6.ea30e"]]},{"id":"7e03b2ab.f3b99c","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3530,"y":1300,"wires":[["eb37dced.e1ec9"]]},{"id":"eafa15c7.311638","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                 \"gadgetId\": \"66cb6f3b-f555-23fe-6f9f-bff854af3f9c\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3590,"y":1740,"wires":[["6b483753.e7d788"]]},{"id":"4fd864df.47cc8c","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                 \"gadgetId\": \"09d4e994-3172-88ef-d26d-3bd575cb6b2d\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3550,"y":3540,"wires":[["a0d3cb4f.e5a1d8"]]},{"id":"6b6feae7.c3aff4","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"48af18a8-6358-c113-a4fe-cd1ea98ae6dc\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3530,"y":4520,"wires":[["16e0679e.2abf78"]]},{"id":"677bccb7.00efc4","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"255a2218-d971-3d84-f40b-e168f3fd95bd\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3510,"y":4820,"wires":[["f1fe052f.3dfbd8"]]},{"id":"8e6cce03.57dc1","type":"comment","z":"9921cbf1.f82328","name":"customForm","info":"","x":210,"y":2420,"wires":[]},{"id":"98f7d423.9d0ea8","type":"comment","z":"9921cbf1.f82328","name":"customForm gagdet actions","info":"","x":2900,"y":2380,"wires":[]},{"id":"25f1de67.afac72","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2490,"y":2320,"wires":[]},{"id":"fd72d080.eb95c","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","788ba36d.c3ecec"],"x":795,"y":2540,"wires":[["f5d34cc5.53496","9ff551ba.4654d"]]},{"id":"373e95e0.44afea","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3150,"y":2460,"wires":[["895bd578.b9d248"],["b96e10bc.2f9a6"],["a8288356.3b5a2"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"a0491cd4.6a302","type":"debug","z":"9921cbf1.f82328","name":"customForm Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3130,"y":2400,"wires":[]},{"id":"f5d34cc5.53496","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","a7b45cd1.34892","26c29dda.6daf62","cd9f1d1b.bf34","a7bcff1e.bd5d1","d71e95a5.cfcb48","662d87cc.7d0548","48dffeab.b720a","ca118072.0332a","bf2bd697.125388","48d12207.710a1c","a561b78b.8b5e08","88da0511.ea3f28"],"x":1175,"y":2540,"wires":[]},{"id":"b6d519c6.e7f128","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":760,"y":2500,"wires":[]},{"id":"9ff551ba.4654d","type":"debug","z":"9921cbf1.f82328","name":"customForm INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":940,"y":2500,"wires":[]},{"id":"5a0902e6.f8b34c","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","2bddfb3.1971b04"],"x":2955,"y":2460,"wires":[["a0491cd4.6a302","373e95e0.44afea"]]},{"id":"48e0471a.f00d08","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","a33806d3.a04af8"],"x":755,"y":2440,"wires":[["6ae6429c.5c180c"]]},{"id":"31468a48.2e4726","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1330,"y":2440,"wires":[]},{"id":"6d6af02a.2a986","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":2440,"wires":[["9fcaa91c.825db8"]]},{"id":"a2b0d5fd.965258","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":760,"y":2400,"wires":[]},{"id":"a7b45cd1.34892","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["f5d34cc5.53496"],"x":1495,"y":2560,"wires":[["9880609c.f7099"]]},{"id":"6d2dfed0.e5bca","type":"http in","z":"9921cbf1.f82328","name":"customform","url":"/customform","method":"post","upload":false,"swaggerDoc":"","x":150,"y":2480,"wires":[["5f9c1a5a.1946b4"]]},{"id":"a33806d3.a04af8","type":"link out","z":"9921cbf1.f82328","name":"","links":["48e0471a.f00d08"],"x":435,"y":2440,"wires":[]},{"id":"788ba36d.c3ecec","type":"link out","z":"9921cbf1.f82328","name":"","links":["fd72d080.eb95c"],"x":435,"y":2480,"wires":[]},{"id":"2bddfb3.1971b04","type":"link out","z":"9921cbf1.f82328","name":"","links":["5a0902e6.f8b34c"],"x":435,"y":2520,"wires":[]},{"id":"357ce09f.5fc5d","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":510,"y":2480,"wires":[]},{"id":"3ec33e12.c57262","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":520,"y":2440,"wires":[]},{"id":"19c61025.d9d0e","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":510,"y":2520,"wires":[]},{"id":"6ae6429c.5c180c","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":860,"y":2440,"wires":[["6d6af02a.2a986"]]},{"id":"5f9c1a5a.1946b4","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":290,"y":2480,"wires":[["a33806d3.a04af8"],["788ba36d.c3ecec"],["2bddfb3.1971b04"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"895bd578.b9d248","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3320,"y":2400,"wires":[["b0d6a540.ac6428"]]},{"id":"9880609c.f7099","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1680,"y":2560,"wires":[["50e9021.518eefc"]]},{"id":"9fcaa91c.825db8","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1180,"y":2440,"wires":[["31468a48.2e4726"]]},{"id":"a7bcff1e.bd5d1","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["f5d34cc5.53496","b96e10bc.2f9a6"],"x":1495,"y":2380,"wires":[["75e264c5.9a879c"]]},{"id":"b0d6a540.ac6428","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3395,"y":2400,"wires":[]},{"id":"75e264c5.9a879c","type":"function","z":"9921cbf1.f82328","name":"All && source","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n          \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"\",\n    \"steps\": [\n      { \"title\":\"text inputs\",\n        \"fields\": [\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"text_basic\",\n            \"options\": {\n              \"label\": \"Sample Input\",\n              \"placeholder\": \"Sample Input - text basic\",\n              \"required\": false,\n              \"type\": \"text\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"text_required\",\n            \"options\": {\n              \"label\": \"Text - required\",\n              \"placeholder\": \"Sample Input - text\",\n              \"required\": true,\n              \"type\": \"text\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"text_disabled\",\n            \"options\": {\n              \"label\": \"Text - disabled\",\n              \"placeholder\": \"Sample Input - disabled \",\n              \"required\": false,\n              \"type\": \"text\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": true,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"text_mapped_value\",\n            \"options\": {\n              \"label\": \"Text - Mapped value\",\n              \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"text\",\n              \"value\": \"Mapped value\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n        //   {\n        //     \"htmlTag\": \"input\",\n        //     \"name\": \"text_notEqualTo\",\n        //     \"options\": {\n        //       \"label\": \"Text - notEqualTo 'text value'\",\n        //       \"placeholder\":  \"Text - notEqualTo 'text value'\",\n        //       \"required\": false,\n        //       \"type\": \"text\",\n        //       \"value\": \"text value test\",\n        //       \"notEqualTo\": \"text value\",\n              \n        //       \"preview\": \"\",\n        //       \"disabled\": false,\n        //       \"previewPosition\": \"\"\n        //     }\n        //   },\n      ]},\n      { \"title\":\"number inputs\",\n        \"fields\": [\n          //  number\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"number_basic\",\n            \"options\": {\n              \"label\": \"Sample Input\",\n              \"placeholder\": \"Sample Input - number basic\",\n              \"required\": false,\n              \"type\": \"number\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"number_required\",\n            \"options\": {\n              \"label\": \"Number - required\",\n              \"placeholder\": \"Sample Input - number\",\n              \"required\": true,\n              \"type\": \"number\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"number_disabled\",\n            \"options\": {\n              \"label\": \"Number - disabled\",\n            //   \"placeholder\": \"Sample Input - disabled \",\n              \"required\": false,\n              \"type\": \"number\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": true,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"number_mapped_value\",\n            \"options\": {\n              \"label\": \"Number - Mapped value\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"number\",\n              \"value\": 123456789,\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"number_min_value_100\",\n            \"options\": {\n              \"label\": \"Number - min value\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"number\",\n              \"value\": 123456789,\n              \"min\": 100,\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"number_max_value_1000\",\n            \"options\": {\n              \"label\": \"Number - min value\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"number\",\n              \"value\": 123,\n            //   \"min\": ,\n              \"max\": 1000,\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"number_min_100_max_1000\",\n            \"options\": {\n              \"label\": \"Number - min - max value\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"number\",\n              \"value\": 123,\n              \"min\": 100,\n              \"max\": 1000,\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n        //   {\n        //     \"htmlTag\": \"input\",\n        //     \"name\": \"number_notEqualTo\",\n        //     \"options\": {\n        //       \"label\": \"Number - notEqualTo 123\",\n        //     //   \"placeholder\": \"Sample Input - Mapped value \",\n        //       \"required\": false,\n        //       \"type\": \"number\",\n        //       \"value\": 123,\n        //       \"notEqualTo\": 123,\n              \n        //       \"preview\": \"\",\n        //       \"disabled\": false,\n        //       \"previewPosition\": \"\"\n        //     }\n        //   },\n       ]\n      },\n       { \"title\":\"date inputs\",\n        \"fields\": [\n          //  number\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"date_basic\",\n            \"options\": {\n              \"label\": \"Sample Input\",\n              \"placeholder\": \"Sample Input - date basic\",\n              \"required\": false,\n              \"type\": \"date\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"date_required\",\n            \"options\": {\n              \"label\": \"date - required\",\n              \"placeholder\": \"date - required\",\n              \"required\": true,\n              \"type\": \"date\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"date_disabled\",\n            \"options\": {\n              \"label\": \"date - disabled\",\n            //   \"placeholder\": \"Sample Input - disabled \",\n              \"required\": false,\n              \"type\": \"date\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": true,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"date_mapped_value\",\n            \"options\": {\n              \"label\": \"Number - Mapped value(\" + \"01-01-\"+moment().year()+\")\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"date\",\n              \"value\": \"01-01-\"+moment().year(),\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"date_min_value_100\",\n            \"options\": {\n              \"label\": \"Date - min value\" + \"(01-01-\"+moment().year()+\")\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"date\",\n            //   \"value\": ,\n              \"min\": \"01-01-\"+moment().year(),\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"date_max_value_\" + \"31-12-\"+moment().year(),\n            \"options\": {\n              \"label\": \"Date - max value\" + \"(31-12-\"+moment().year()+\")\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"date\",\n            //   \"value\": 123,\n            //   \"min\": ,\n              \"max\": + \"31-12-\"+moment().year(),\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"date_min__max_\",\n            \"options\": {\n              \"label\": \"Date - min - max value\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"date\",\n            //   \"value\": 123,\n               \"min\": \"01-01-\"+moment().year(),\n               \"max\": + \"31-12-\"+moment().year(),\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"date_notEqualTo\",\n            \"options\": {\n              \"label\": \"date - notEqualTo \" + new Date(),\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"date\",\n            //   \"value\": 123,\n              \"notEqualTo\": new Date(),\n              \n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n       ]\n      },\n             { \"title\":\"email inputs\",\n        \"fields\": [\n          //  number\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"email_basic\",\n            \"options\": {\n              \"label\": \"email basic\",\n              \"placeholder\": \"Sample Input - email basic\",\n              \"required\": false,\n              \"type\": \"email\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"email_required\",\n            \"options\": {\n              \"label\": \"email - required\",\n              \"placeholder\": \"email - required\",\n              \"required\": true,\n              \"type\": \"email\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"email_disabled\",\n            \"options\": {\n              \"label\": \"email - disabled\",\n            //   \"placeholder\": \"Sample Input - disabled \",\n              \"required\": false,\n              \"type\": \"email\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": true,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"email_mapped_value\",\n            \"options\": {\n              \"label\": \"Email - Mapped value(info@factory.nl)\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"email\",\n              \"value\": \"info@factory.nl\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"email_notEqualTo\",\n            \"options\": {\n              \"label\": \"email - notEqualTo \" +\"info@factory.nl\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"email\",\n            //   \"value\": 123,\n              \"notEqualTo\": \"info@factory.nl\",\n              \n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n       ]\n      },\n     { \"title\":\"password inputs\",\n        \"fields\": [\n          //  number\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"password_basic\",\n            \"options\": {\n              \"label\": \"password basic\",\n              \"placeholder\": \"Sample Input - password basic\",\n              \"required\": false,\n              \"type\": \"password\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"password_required\",\n            \"options\": {\n              \"label\": \"password - required\",\n              \"placeholder\": \"password - required\",\n              \"required\": true,\n              \"type\": \"password\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"password_disabled\",\n            \"options\": {\n              \"label\": \"password - disabled\",\n            //   \"placeholder\": \"Sample Input - disabled \",\n              \"required\": false,\n              \"type\": \"password\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": true,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"password_mapped_value\",\n            \"options\": {\n              \"label\": \"password - Mapped value(test123)\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"password\",\n              \"value\": \"test123\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"password_notEqualTo\",\n            \"options\": {\n              \"label\": \"Password - notEqualTo \" +\"test123\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"password\",\n            //   \"value\": 123,\n              \"notEqualTo\": \"test123l\",\n              \n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n       ]\n      },\n       { \"title\":\"datetime inputs\",\n        \"fields\": [\n          //  number\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"datetime_basic\",\n            \"options\": {\n              \"label\": \"datetime basic\",\n              \"placeholder\": \"Sample Input - datetime basic\",\n              \"required\": false,\n              \"type\": \"datetime\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"datetime_required\",\n            \"options\": {\n              \"label\": \"datetime - required\",\n              \"placeholder\": \"datetime - required\",\n              \"required\": true,\n              \"type\": \"datetime\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"datetime_disabled\",\n            \"options\": {\n              \"label\": \"datetime - disabled\",\n            //   \"placeholder\": \"Sample Input - disabled \",\n              \"required\": false,\n              \"type\": \"datetime\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": true,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"datetime_mapped_value\",\n            \"options\": {\n              \"label\": \"datetime - Mapped value(\"+new Date()+\")\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"datetime\",\n              \"value\": new Date(),\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"datetime_notEqualTo\",\n            \"options\": {\n              \"label\": \"datetime - notEqualTo \" +new Date(),\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"datetime\",\n            //   \"value\": 123,\n              \"notEqualTo\":new Date(),\n              \n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n       ]\n      },\n             { \"title\":\"color inputs\",\n        \"fields\": [\n          //  number\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"color_basic\",\n            \"options\": {\n              \"label\": \"color basic\",\n              \"placeholder\": \"Sample Input - color basic\",\n              \"required\": false,\n              \"type\": \"color\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"color_required\",\n            \"options\": {\n              \"label\": \"color - required\",\n              \"placeholder\": \"color - required\",\n              \"required\": true,\n              \"type\": \"color\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"color_disabled\",\n            \"options\": {\n              \"label\": \"color - disabled\",\n            //   \"placeholder\": \"Sample Input - disabled \",\n              \"required\": false,\n              \"type\": \"color\",\n              \"value\": \"\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": true,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"color_mapped_value\",\n            \"options\": {\n              \"label\": \"color - Mapped value(#E74C3C)\",\n            //   \"placeholder\": \"Sample Input - Mapped value \",\n              \"required\": false,\n              \"type\": \"color\",\n              \"value\": \"#E74C3C\",\n              \"min\": \"\",\n              \"max\": \"\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n          {\n            \"htmlTag\": \"input\",\n            \"name\": \"color_notEqualTo\",\n            \"options\": {\n              \"label\": \"color - notEqualTo \" +\"#E74C3C\",\n              \"required\": false,\n              \"type\": \"color\",\n              \"notEqualTo\": \"#E74C3C\",\n              \"preview\": \"\",\n              \"disabled\": false,\n              \"previewPosition\": \"\"\n            }\n          },\n       ]\n      },\n      { \"title\":\"select inputs\",\n        \"fields\": [\n          {\n            \"name\": \"select_type_single\",\n            \"htmlTag\": \"select\",\n            \"optionsGroup\": {\n              \"option_1\": \"Option 1\",\n              \"option_2\": \"Option 2\",\n              \"option_3\":  \"Option 3\",\n            },\n            \"options\": {\n              \"multiple\": false,\n              \"value\": \"\",\n              \"label\": \"Select type - single\",\n              \"type\": \"text\",\n              \"placeholder\": \"\",\n              \"required\": false,\n              \"maxlength\": 100,\n              \"width\": 100,\n              \"info\": \"Select type - single tooltip\",\n            }\n          },\n           {\n            \"name\": \"select_type_multiple\",\n            \"htmlTag\": \"select\",\n            \"optionsGroup\": {\n              \"option_1\": \"Option 1\",\n              \"option_2\": \"Option 2\",\n              \"option_3\":  \"Option 3\",\n            },\n            \"options\": {\n              \"multiple\": true,\n              \"value\": \"\",\n              \"label\": \"Select type - multiple\",\n              \"type\": \"text\",\n              \"placeholder\": \"\",\n              \"required\": false,\n              \"maxlength\": 100,\n              \"width\": 100,\n              \"info\": \"Select type - multiple tooltip\",\n            }\n          },\n           {\n            \"name\": \"select_type_conditional\",\n            \"htmlTag\": \"select\",\n            \"optionsGroup\": {\n              \"visible\": \"Visible\",\n               \"invisible\": \"invisible\",\n            },\n            \"options\": {\n              \"multiple\": true,\n              \"value\": \"\",\n              \"label\": \"Select type - conditional\",\n              \"type\": \"text\",\n              \"placeholder\": \"\",\n              \"required\": false,\n            \n              \"width\": 100,\n              \"info\": \"Select type - conditional tooltip\",\n            }\n          },\n          {\n            \"name\": \"select_type_conditional_visible\",\n            \"htmlTag\": \"select\",\n            \"execActionData\": [\n              {\n                \"select_type_conditional\": \"visible\"\n              },\n            \n            ],\n            \"options\": {\n              \"value\": \"\",\n              \"label\": \"Select type conditional visible\",\n              \"type\": \"text\",\n              \"placeholder\": \"\",\n            //   \"required\": true,\n            //   \"maxlength\": 50,\n              \"width\": 100,\n              \"info\": \"Tell us what you're looking for. For example, 'put me on the mailing list'.\"\n            },\n            \"type\": \"text\"\n          }\n        ]\n      },\n      { \"title\":\"select inputs Group\",\n        \"fields\": [\n          {\n            \"name\": \"select_type_single\",\n            \"htmlTag\": \"opt-group\",\n            \"optionsGroup\": {\n                \"group1\" : {\n                              \"group1.option_1\":   \"group1.Option 1\",\n                              \"group1.option_2\":   \"group1.Option 2\",\n                              \"group1.option_3\":   \"group1.Option 3\",\n                },\n                 \"group2\" : {\n                              \"group2.option_1\":   \"group2.Option 1\",\n                              \"group2.option_2\":   \"group2.Option 2\",\n                              \"group2.option_3\":   \"group2.Option 3\",\n                }\n            },\n            \"options\": {\n              \"multiple\": false,\n              \"value\": \"\",\n              \"label\": \"Select type - single\",\n              \"type\": \"select\",\n              \"placeholder\": \"\",\n              \"required\": false,\n              \"maxlength\": 100,\n              \"width\": 100,\n              \"info\": \"Select type - single tooltip\",\n            }\n          },\n           {\n            \"name\": \"select_type_multiple\",\n            \"htmlTag\": \"select\",\n            \"optionsGroup\": {\n              \"option_1\": \"Option 1\",\n              \"option_2\": \"Option 2\",\n              \"option_3\":  \"Option 3\",\n            },\n            \"options\": {\n              \"multiple\": true,\n              \"value\": \"\",\n              \"label\": \"Select type - multiple\",\n              \"type\": \"text\",\n              \"placeholder\": \"\",\n              \"required\": false,\n              \"maxlength\": 100,\n              \"width\": 100,\n              \"info\": \"Select type - multiple tooltip\",\n            }\n          },\n           {\n            \"name\": \"select_type_conditional\",\n            \"htmlTag\": \"select\",\n            \"optionsGroup\": {\n              \"visible\": \"Visible\",\n               \"invisible\": \"invisible\",\n            },\n            \"options\": {\n              \"multiple\": true,\n              \"value\": \"\",\n              \"label\": \"Select type - conditional\",\n              \"type\": \"text\",\n              \"placeholder\": \"\",\n              \"required\": false,\n            \n              \"width\": 100,\n              \"info\": \"Select type - conditional tooltip\",\n            }\n          },\n          {\n            \"name\": \"select_type_conditional_visible\",\n            \"htmlTag\": \"select\",\n            \"execActionData\": [\n              {\n                \"select_type_conditional\": \"visible\"\n              },\n            \n            ],\n            \"options\": {\n              \"value\": \"\",\n              \"label\": \"Select type conditional visible\",\n              \"type\": \"text\",\n              \"placeholder\": \"\",\n            //   \"required\": true,\n            //   \"maxlength\": 50,\n              \"width\": 100,\n              \"info\": \"Tell us what you're looking for. For example, 'put me on the mailing list'.\"\n            },\n            \"type\": \"text\"\n          }\n        ]\n      },\n            { \"title\":\"subform inputs\",\n        \"fields\": [\n         {\n                      \"htmlTag\": \"subform\",\n                      \"name\": \"input1\",\n                      \"options\": {\n                          \"label\": \"Subform without required field\",\n                          \"disabled\": false\n                      },\n                      \"fields\": [[\n                        {\n                            \"htmlTag\": \"input\",\n                            \"name\": \"field1\",\n                            \"options\": {\n                                \"label\": \"Required False\",\n                                \"placeholder\": \"Sample Inpu\",\n                                \"required\": false,\n                                \"type\": \"text\",\n                                \"value\": \"\",\n                                \"disabled\": false\n                            }\n                        }]\n                    ]\n                  },\n           {\n              \"htmlTag\": \"subform\",\n              \"name\": \"input1\",\n              \"options\": {\n                  \"label\": \"Subform with required field\",\n                  \"disabled\": false\n              },\n              \"fields\": [[\n                {\n                    \"htmlTag\": \"input\",\n                    \"name\": \"field1\",\n                    \"options\": {\n                        \"label\": \"Required field\",\n                        \"placeholder\": \"Sample Inpu\",\n                        \"required\": true,\n                        \"type\": \"text\",\n                        \"value\": \"\",\n                        \"disabled\": false\n                    }\n                }]\n            ]\n          }\n        ]\n      },\n                { \"title\":\"upload/download inputs\",\n        \"fields\": [\n        \n        {\n                    \"htmlTag\": \"button\",\n                    \"name\": \"buttonUpload\",\n                    \"options\": {\n                        \"label\": \"Sample Upload with value, allowed to download\",\n                        \"required\": true,\n                        \"type\": \"upload\",\n                        \"value\":\"/files/TEMP/upload-download/avatar.jpeg\",\n                        \"downloadUploadedFile\":true,\n                        \"disabled\": false,\n                        \"folder\":\"/files/TEMP/upload-download/\"\n                    }\n                },\n\n                {\n                  \"htmlTag\": \"button\",\n                  \"name\": \"buttonUpload1\",\n                  \"options\": {\n                      \"label\": \"Sample Upload with value, not allowed to download\",\n                      \"required\": true,\n                      \"type\": \"upload\",\n                      \"value\":\"/files/TEMP/upload-download/notPermittedDownloadFIle.png\",\n                      \"downloadUploadedFile\":false,\n                      \"disabled\": false,\n                      \"folder\":\"/files/TEMP/upload-download/\"\n                  }\n              },\n                {\n                  \"htmlTag\": \"button\",\n                  \"name\": \"buttonDownload\",\n                  \"options\": {\n                      \"label\": \"Sample Download\",\n                      \"type\": \"download\",\n                      \"value\":\"/files/TEMP/upload-download/btnDownload.png\",\n                      \"disabled\": false\n                  }\n              }, \n            \n          {\n                      \"htmlTag\": \"button\",\n                      \"name\": \"buttonUpload\",\n                      \"options\": {\n                          \"label\": \"Sample Upload\",\n                          \"required\": true,\n                          \"type\": \"upload\",\n                          \"value\":\"\",\n                          \"disabled\": false,\n                          \"folder\":\"/files/TEMP/upload-download\",\n                      }\n                  },\n\n                  {\n                    \"htmlTag\": \"button\",\n                    \"name\": \"buttonDownload\",\n                    \"options\": {\n                        \"label\": \"Sample Download\",\n                        \"required\": true,\n                        \"type\": \"download\",\n                       \"value\":\"/files/TEMP/upload-download/downloadFile.png\",\n                        \"disabled\": false\n                    }\n                }\n        \n        \n        \n        \n        ]\n      },\n      \n                { \"title\":\"wysiwg inputs\",\n        \"fields\": [\n   {\n                      \"htmlTag\": \"wysiwyg\",\n                      \"name\": \"wysiwyginput\",\n                      \"options\": {\n                          \"label\": \"Sample Wysiwyg Required\",\n                          \"required\": true,\n                          \"disabled\":false\n                      }\n                  },\n                  {\n                    \"htmlTag\": \"wysiwyg\",\n                    \"name\": \"wysiwyginput\",\n                    \"options\": {\n                        \"label\": \"Sample Wysiwyg, Not Required\",\n                        \"required\": false,\n                        \"disabled\":false\n                    }\n                },\n                {\n                  \"htmlTag\": \"wysiwyg\",\n                  \"name\": \"wysiwyginput\",\n                  \"options\": {\n                      \"label\": \"Sample Wysiwyg, Disabled\",\n                      \"required\": false,\n                      \"disabled\":true\n                  }\n              }\n        ]\n      },\n                      { \"title\":\"date/time inputs\",\n        \"fields\": [\n {\n              \"htmlTag\": \"input\",\n              \"name\": \"datetime_basic\",\n              \"options\": {\n                \"label\": \"datetime basic\",\n                \"placeholder\": \"Sample Input - datetime basic\",\n                \"required\": false,\n                \"type\": \"datetime\",\n                \"value\": \"\",\n                \"min\": \"\",\n                \"max\": \"\",\n                \"preview\": \"\",\n                \"disabled\": false,\n                \"previewPosition\": \"\"\n              }\n            },\n            {\n              \"htmlTag\": \"input\",\n              \"name\": \"datetime_required\",\n              \"options\": {\n                \"label\": \"datetime - required\",\n                \"placeholder\": \"datetime - required\",\n                \"required\": true,\n                \"type\": \"datetime\",\n                \"value\": \"\",\n                \"min\": \"\",\n                \"max\": \"\",\n                \"preview\": \"\",\n                \"disabled\": false,\n                \"previewPosition\": \"\"\n              }\n            },\n            {\n              \"htmlTag\": \"input\",\n              \"name\": \"datetime_disabled\",\n              \"options\": {\n                \"label\": \"datetime - disabled\",\n                \"required\": false,\n                \"type\": \"datetime\",\n                \"value\": \"\",\n                \"min\": \"\",\n                \"max\": \"\",\n                \"preview\": \"\",\n                \"disabled\": true,\n                \"previewPosition\": \"\"\n              }\n            },\n            {\n              \"htmlTag\": \"input\",\n              \"name\": \"datetime_mapped_value\",\n              \"options\": {\n                \"label\": \"datetime - Mapped value(Tue May 25 2021 07:30:33 GMT+0000 (Coordinated Universal Time))\",\n                \"required\": false,\n                \"type\": \"datetime\",\n                \"value\": \"2021-05-25T07:30:33.483Z\",\n                \"min\": \"\",\n                \"max\": \"\",\n                \"preview\": \"\",\n                \"disabled\": false,\n                \"previewPosition\": \"\"\n              }\n            },\n            {\n              \"htmlTag\": \"input\",\n              \"name\": \"datetime_notEqualTo\",\n              \"options\": {\n                \"label\": \"datetime - notEqualTo Tue May 25 2021 07:30:33 GMT+0000 (Coordinated Universal Time)\",\n                \"required\": false,\n                \"type\": \"datetime\",\n                \"notEqualTo\": \"2021-05-25T07:30:33.483Z\",\n                \"preview\": \"\",\n                \"disabled\": false,\n                \"previewPosition\": \"\"\n              }\n            },\n\n            {\n                \"htmlTag\": \"input\",\n                \"name\": \"datemanagementOnly\",\n                \"options\": {\n                  \"label\": \"datetime - but edits date only\",\n                  \"required\": false,\n                  \"type\": \"datetime\",\n                  \"date_management\":true,\n                  \"time_management\":false,\n                  \"value\": \"2021-05-25T07:30:33.483Z\",\n                  \"disabled\": false\n                }\n              },\n\n            {\n                \"htmlTag\": \"input\",\n                \"name\": \"timemanagementonly\",\n                \"options\": {\n                  \"label\": \"datetime - but edits time only\",\n                  \"required\": false,\n                  \"type\": \"datetime\",\n                  \"date_management\":false,\n                  \"time_management\":true,\n                  \"value\": \"2021-05-25T07:30:33.483Z\",\n                  \"disabled\": false\n                }\n              }\n        ]\n      }\n     \n    ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"9457997c-5e6f-9507-307f-bdf45cb8fc65\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"custom-form\"\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1590,"y":2360,"wires":[["2e01affa.c1f32"]]},{"id":"fbdb681f.644bf8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3635,"y":2480,"wires":[]},{"id":"216e1e13.36e012","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2295,"y":2460,"wires":[]},{"id":"43cc6552.23510c","type":"function","z":"9921cbf1.f82328","name":"tour","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n      tour:{\n                      content:\"Main level, right placement\",\n                      title :\"Main level, right placement\",\n                      priority:1,\n                      placement :\"right\"\n                  },\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"tour\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"c8306369-d36f-dddd-486c-5aa62bae0f61\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {title : \"Tour\",\n            fields:[]\n   }\n    \n    if (index === 0){\n        \n        // _.each(step)\n        _.each(step.fields, function(stepField,stepFieldIndex ){\n            \n            newField = {  tour:{\n                                      content:\"Field level, name :\"+ stepField.name,\n                                      title :\"Field level, htmlTag :\"+ stepField.htmlTag,\n                                      priority:stepFieldIndex+2,\n                                    //   placement :\"right\"\n                                  },}\n            \n            _.each(stepField, function(value, key){\n               newField[key]= value \n            })\n            \n            Newstep.fields.push(newField)\n            \n        })\n        data.gadgetData.steps.push(Newstep)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": data,\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2210,"y":2460,"wires":[["216e1e13.36e012"]]},{"id":"968bf9e9.b58fe8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":2520,"wires":[]},{"id":"48d12207.710a1c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["f5d34cc5.53496","b96e10bc.2f9a6"],"x":1495,"y":2520,"wires":[["ac4bc4e4.769498"]]},{"id":"ac4bc4e4.769498","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":2520,"wires":[["968bf9e9.b58fe8"]]},{"id":"b96e10bc.2f9a6","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","a7bcff1e.bd5d1","d71e95a5.cfcb48","662d87cc.7d0548","48dffeab.b720a","ca118072.0332a","bf2bd697.125388","48d12207.710a1c"],"x":3375,"y":2440,"wires":[]},{"id":"50e9021.518eefc","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":2560,"wires":[]},{"id":"c7412cf6.7ca38","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Custom-form</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":2600,"wires":[["a7b8f4cc.469918"]]},{"id":"a7b8f4cc.469918","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":2600,"wires":[]},{"id":"a561b78b.8b5e08","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["f5d34cc5.53496"],"x":1495,"y":2600,"wires":[["c7412cf6.7ca38"]]},{"id":"a8288356.3b5a2","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3490,"y":2480,"wires":[["fbdb681f.644bf8"]]},{"id":"59943c65.abaa84","type":"comment","z":"9921cbf1.f82328","name":"codeBlock","info":"","x":120,"y":1980,"wires":[]},{"id":"da5d77e6.f9d5b8","type":"comment","z":"9921cbf1.f82328","name":"codeBlock gagdet actions","info":"","x":2850,"y":1940,"wires":[]},{"id":"90b2f627.6745e8","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2450,"y":1880,"wires":[]},{"id":"ec35bb4d.c809f8","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","5c699052.fdd4f"],"x":755,"y":2100,"wires":[["dbb13f21.eca84","45d83a98.fd7004"]]},{"id":"ebed632e.e8331","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3110,"y":2020,"wires":[["95027fe4.f0dbc"],["d02057f2.f9a518"],["389542eb.28722e"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"a0b8554f.206598","type":"debug","z":"9921cbf1.f82328","name":"codeBlock Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3070,"y":1940,"wires":[]},{"id":"dbb13f21.eca84","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","e1a34970.fcfba8","26c29dda.6daf62","cd9f1d1b.bf34","ca7aca84.1fbdb8","da84c57f.211838","662d87cc.7d0548","48dffeab.b720a","fa1bb7ec.149038","ff0b5b78.a45e58","25d48636.5e6a6a","9279f6cb.962428"],"x":1135,"y":2100,"wires":[]},{"id":"d248a552.b19c68","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":720,"y":2060,"wires":[]},{"id":"45d83a98.fd7004","type":"debug","z":"9921cbf1.f82328","name":"codeBlock INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":900,"y":2060,"wires":[]},{"id":"1a23811c.4c868f","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","abcf5755.c631a8"],"x":2915,"y":2020,"wires":[["a0b8554f.206598","ebed632e.e8331"]]},{"id":"eb6e4b69.404fd8","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","5d1fc72a.721078"],"x":715,"y":2000,"wires":[["a52a4acd.7ee428"]]},{"id":"f5fd8a09.6a7438","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1290,"y":2000,"wires":[]},{"id":"d5295d97.9ffda","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":2000,"wires":[["9d9078bc.cd78b8"]]},{"id":"8ce57758.d67bb8","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":720,"y":1960,"wires":[]},{"id":"e1a34970.fcfba8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["dbb13f21.eca84"],"x":1455,"y":2100,"wires":[["56a7e204.4817ec"]]},{"id":"285b728b.1298fe","type":"http in","z":"9921cbf1.f82328","name":"codeBlock","url":"/codeBlock","method":"post","upload":false,"swaggerDoc":"","x":100,"y":2120,"wires":[["c26ae99f.592038"]]},{"id":"5d1fc72a.721078","type":"link out","z":"9921cbf1.f82328","name":"","links":["eb6e4b69.404fd8"],"x":355,"y":2000,"wires":[]},{"id":"5c699052.fdd4f","type":"link out","z":"9921cbf1.f82328","name":"","links":["ec35bb4d.c809f8"],"x":355,"y":2040,"wires":[]},{"id":"abcf5755.c631a8","type":"link out","z":"9921cbf1.f82328","name":"","links":["1a23811c.4c868f"],"x":355,"y":2080,"wires":[]},{"id":"ce3d7673.695798","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":430,"y":2040,"wires":[]},{"id":"6b754c1d.a34a94","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":440,"y":2000,"wires":[]},{"id":"a8cd601b.61443","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":430,"y":2080,"wires":[]},{"id":"a52a4acd.7ee428","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":820,"y":2000,"wires":[["d5295d97.9ffda"]]},{"id":"c26ae99f.592038","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":210,"y":2040,"wires":[["5d1fc72a.721078"],["5c699052.fdd4f"],["abcf5755.c631a8"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"95027fe4.f0dbc","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3280,"y":1960,"wires":[["a7bc50f8.0a834"]]},{"id":"56a7e204.4817ec","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1640,"y":2100,"wires":[["4182d0d9.d7ba4"]]},{"id":"9d9078bc.cd78b8","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1140,"y":2000,"wires":[["f5fd8a09.6a7438"]]},{"id":"161febbb.3a0984","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2315,"y":1940,"wires":[]},{"id":"ca7aca84.1fbdb8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["dbb13f21.eca84","d02057f2.f9a518"],"x":1455,"y":1940,"wires":[["2522ca92.a3a986"]]},{"id":"a7bc50f8.0a834","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3355,"y":1960,"wires":[]},{"id":"2522ca92.a3a986","type":"function","z":"9921cbf1.f82328","name":"basic","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ntestStructure = {\n    text:\"text\",\n    number:123456789,\n    date:new Date(),\n    object : {\n            text:\"text\",\n            number:123456789,\n            date:new Date(),\n    },\n    array:[\"text\",123456789,new Date()]\n}\n\n\nmsg.payload = {\n    gadgetsList:[\n                {\n                  \"gadgetId\": \"aa576a1c-6eff-0c25-0386-cb8edd2b8d60\",\n                  \"gadgetName\": \"basic - JSON\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": testStructure,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"d44fa87b-6bf0-68d1-8f23-f0617979473b\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": \"auto\"\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic - JSON\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1630,"y":1940,"wires":[["161febbb.3a0984"]]},{"id":"1905807b.0aeec","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3715,"y":2080,"wires":[]},{"id":"66396e2a.cc827","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2315,"y":2020,"wires":[]},{"id":"fa1bb7ec.149038","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["dbb13f21.eca84","d02057f2.f9a518"],"x":1455,"y":2020,"wires":[["2d9a9364.426e7c"]]},{"id":"2d9a9364.426e7c","type":"function","z":"9921cbf1.f82328","name":"tour","func":"testStructure = {\n    text:\"text\",\n    number:123456789,\n    date:new Date(),\n    object : {\n            text:\"text\",\n            number:123456789,\n            date:new Date(),\n    },\n    array:[\"text\",123456789,new Date()]\n}\n\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n\n       {\n  \"gadgetId\": \"640ff7c2-510a-a196-0128-006874bf8c49\",\n  \"gadgetName\": \"Tour\",\n  \"gadgetType\": \"code-block\",\n  \"gadgetData\": {\n    \"content\": testStructure,\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"8c953448-e3c7-3cdd-5252-547acde30ef8\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1630,"y":2020,"wires":[["66396e2a.cc827"]]},{"id":"6ec05d73.136404","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2315,"y":1980,"wires":[]},{"id":"ff0b5b78.a45e58","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["dbb13f21.eca84","d02057f2.f9a518"],"x":1455,"y":1980,"wires":[["3228f748.954a28"]]},{"id":"3228f748.954a28","type":"function","z":"9921cbf1.f82328","name":"basic - JSON string","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ntestStructure = {\n    text:\"text\",\n    number:123456789,\n    date:new Date(),\n    object : {\n            text:\"text\",\n            number:123456789,\n            date:new Date(),\n    },\n    array:[\"text\",123456789,new Date()]\n}\n\n\nmsg.payload = {\n    gadgetsList:[\n                {\n                  \"gadgetId\": \"3c0c227e-1d75-1510-8e21-0d5e98bb3217\",\n                  \"gadgetName\": \"basic - JSON string\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": JSON.stringify(testStructure), \n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"e7ddbe6f-f155-638c-2cf7-8874330fa1dd\",\n                              \"gadgetName\": \"basicJsonStringCode\",\n                              \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": \"auto\"\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"c34b1d13-c6ef-86c6-6f85-30d4c04c44d2\",\n                              \"gadgetName\": \"Basic JSON string divider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"basic - JSON string\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1980,"wires":[["6ec05d73.136404"]]},{"id":"d3e7181.2e37ce8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2315,"y":2060,"wires":[]},{"id":"25d48636.5e6a6a","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["dbb13f21.eca84","d02057f2.f9a518"],"x":1455,"y":2060,"wires":[["fd2e0f10.32176"]]},{"id":"fd2e0f10.32176","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1640,"y":2060,"wires":[["d3e7181.2e37ce8"]]},{"id":"d02057f2.f9a518","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","ca7aca84.1fbdb8","da84c57f.211838","662d87cc.7d0548","48dffeab.b720a","fa1bb7ec.149038","ff0b5b78.a45e58","25d48636.5e6a6a"],"x":3335,"y":2000,"wires":[]},{"id":"4182d0d9.d7ba4","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2315,"y":2100,"wires":[]},{"id":"2831d373.fe075c","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"cffc91b7-af1f-425e-41fe-76429a5f20e9\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Code-block</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1630,"y":2140,"wires":[["dfdc116c.fe701"]]},{"id":"dfdc116c.fe701","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2315,"y":2140,"wires":[]},{"id":"9279f6cb.962428","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["dbb13f21.eca84"],"x":1455,"y":2140,"wires":[["2831d373.fe075c"]]},{"id":"389542eb.28722e","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"89c4a850-cdc0-0226-d7f0-9c513219c8f8\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3430,"y":2120,"wires":[["1905807b.0aeec"]]},{"id":"2e01affa.c1f32","type":"function","z":"9921cbf1.f82328","name":"Text","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"Text\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"0348e4fa-e76a-20f6-cc3d-265080c5c157\",\n  \"gadgetName\": \"text inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n      \n\n\n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   \n    \n    if (step.title === \"text inputs\"){\n        \n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"13fe34f3-3a34-bb1f-e598-b5981dc0cf84\",\n                              \"gadgetName\": \"textCode\",\n                              \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": data,\n                                    \"language\": \"json\",\n                                   \"blockHeight\": 500\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"textDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"tooltip\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2360,"wires":[["fb6b26ba.bae068"]]},{"id":"fb6b26ba.bae068","type":"function","z":"9921cbf1.f82328","name":"Number","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"number inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"67cc4f20-aa6f-4172-bbfc-74ec679a7cec\",\n  \"gadgetName\": \"number\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n                          \"gadgetId\": \"b7f1c2cf-8f9a-7c91-63a6-3ab731bc51bb\",\n  \"gadgetName\": \"numberCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"numberDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Number\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":2360,"wires":[["bac13f03.0e218"]]},{"id":"bac13f03.0e218","type":"function","z":"9921cbf1.f82328","name":"email inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"email inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"3459b59c-e870-fef8-d0e2-0219c75ebbff\",\n  \"gadgetName\": \"email inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n     \"gadgetId\": \"db327d96-9185-c203-aefa-11c8c4fd45f7\",\n  \"gadgetName\": \"email inputsCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5a648d5c-0f36-fee3-02c7-5caf7c96c4f1\",\n                              \"gadgetName\": \"email inputsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Email\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1910,"y":2360,"wires":[["7a2bbf9b.c2a01"]]},{"id":"7a2bbf9b.c2a01","type":"function","z":"9921cbf1.f82328","name":"password inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"password inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"09212e15-e764-c9ab-a629-7c90c841ed12\",\n  \"gadgetName\": \"password inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"2e2a9b42-4391-cfc6-3cfc-daa2543f3a56\",\n  \"gadgetName\": \"passwordCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"e223aae3-b4dc-1ada-2da0-6cf6c2f4c4b7\",\n                              \"gadgetName\": \"passwordDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Password\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2040,"y":2360,"wires":[["2bbc2f7d.1761f"]]},{"id":"2bbc2f7d.1761f","type":"function","z":"9921cbf1.f82328","name":"datetime inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"datetime inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"e52b36e4-cb4b-32d3-689d-1c8d04217f4f\",\n  \"gadgetName\": \"datetime inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"937aafca-ab07-fe71-e092-79b14a5afa03\",\n  \"gadgetName\": \"datetimeCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n             \"gadgetId\": \"c0390ff8-de8c-b775-fe23-edc152d932e4\",\n  \"gadgetName\": \"datetimeDivider\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Date time\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1600,"y":2400,"wires":[["b4010cda.143c"]]},{"id":"b4010cda.143c","type":"function","z":"9921cbf1.f82328","name":"color inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"color inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"a2cd5702-4dbd-ad6c-72de-e13bcfb975e1\",\n  \"gadgetName\": \"color inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"78e4324f-16ce-859c-5f17-1a625d3c3e29\",\n  \"gadgetName\": \"colorCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"0d6af730-f436-4652-3579-6798d7b8602d\",\n  \"gadgetName\": \"colorDivider\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Color\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":2400,"wires":[["f2864989.70d508"]]},{"id":"f2864989.70d508","type":"function","z":"9921cbf1.f82328","name":"select inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"select inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"b615a893-919f-25b3-7694-aca2b90034c8\",\n  \"gadgetName\": \"Select inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"1884e940-cc5f-e4e1-5b0b-e71f88c2c83f\",\n  \"gadgetName\": \"selectCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"c094ab33-699a-0e6c-38c8-ad23977aab8c\",\n  \"gadgetName\": \"selectDivider\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Select\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1850,"y":2400,"wires":[["fb01439b.28171"]]},{"id":"fb01439b.28171","type":"function","z":"9921cbf1.f82328","name":"select inputs Group","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"select inputs Group\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"fac1c33a-b720-6867-c26d-0d1fa8888bbb\",\n  \"gadgetName\": \"select inputs Group\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"1884e940-cc5f-e4e1-5b0b-e71f88c2c83f\",\n  \"gadgetName\": \"selectCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"f82cfc21-5044-2877-76df-bfbd7ab3a2b8\",\n  \"gadgetName\": \"selectGroupDivider\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"select inputs Group\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2010,"y":2400,"wires":[["2bdfe5b4.97192a"]]},{"id":"97500e41.5ac14","type":"subflow:e25f5e2d.45871","z":"9de255bd.0d0938","name":"","env":[],"x":420,"y":60,"wires":[[]]},{"id":"a3db9df3.02e7d","type":"function","z":"9de255bd.0d0938","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":60,"wires":[["97500e41.5ac14"]]},{"id":"6319a4af.c1413c","type":"link in","z":"9de255bd.0d0938","name":"","links":["6baab3f7.fc435c","c18b7c0.baecd88","d8e51acf.e8cf18","967cf285.6bee8","521c3639.b9d5f8","a3928ad0.40c618","da200657.836488","bfa6365d.b7abd8","757605d3.6f50ec","1c36c499.5edeeb","b9343fa1.30605","2e4f8b17.6bf574","c3e3e6a9.6c4f68","b180cdf2.dd319","c83b8c8e.d05e7","989bb7c5.8f5918","971ed970.9f9a48","3c5c019.7d8ccfe","4598dfa3.41806","b78823e3.f2b6a","f414bfb.945be4","c06136a.92480c8","1af6fe34.485702","6a3db0fa.307","72a3dc05.5eb184","7d663b8a.1af7f4","59e6fd2f.725424","e9cd7eb.8b48f8"],"x":135,"y":60,"wires":[["a3db9df3.02e7d"]]},{"id":"b0b5498e.4206e8","type":"comment","z":"9de255bd.0d0938","name":"infiniteAccordion","info":"","x":220,"y":1640,"wires":[]},{"id":"a6bfa33e.8afbc","type":"comment","z":"9de255bd.0d0938","name":"infiniteAccordion gagdet actions","info":"","x":3110,"y":1580,"wires":[]},{"id":"dff3b194.12ac6","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2530,"y":1540,"wires":[]},{"id":"26dc1abf.f98ce6","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","4f2bec99.8f08f4"],"x":835,"y":1760,"wires":[["b1f965be.9872d8","94506c56.56d57"]]},{"id":"9dab1cc9.6bebd","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var  MenuAction,resetPage, breadcrumb;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n}  else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    breadcrumb = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,resetPage, breadcrumb];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3150,"y":1680,"wires":[["ddce0e1a.495de"],["d1bcd5fb.a3eed8"],["cf4f5024.376a8"]],"outputLabels":["MenuAction,,","resetPage","breadcrumb"]},{"id":"230ebd31.d0bef2","type":"debug","z":"9de255bd.0d0938","name":"infiniteAccordion Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3110,"y":1620,"wires":[]},{"id":"94506c56.56d57","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","50620da8.3a2c24","26c29dda.6daf62","cd9f1d1b.bf34","6311606e.82658","8c17c413.5ec118","662d87cc.7d0548","b1cbeef4.f75aa","b65cf5ce.853898","d0aa1a7.333c2e8","dda42e61.4764c","2a69c16c.32922e"],"x":1215,"y":1760,"wires":[]},{"id":"fa8c089b.aa78d8","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":800,"y":1720,"wires":[]},{"id":"b1f965be.9872d8","type":"debug","z":"9de255bd.0d0938","name":"infiniteAccordion INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1000,"y":1720,"wires":[]},{"id":"5977c9e.bed0d38","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","44d3108f.c513"],"x":3015,"y":1680,"wires":[["230ebd31.d0bef2","9dab1cc9.6bebd"]]},{"id":"4922ebfb.502ee4","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","4c7c0ea7.016e7"],"x":795,"y":1660,"wires":[["c3150c57.c7c87"]]},{"id":"fd893b62.7b8b58","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1370,"y":1660,"wires":[]},{"id":"623273ad.d1c03c","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":1660,"wires":[["db328b75.b37c28"]]},{"id":"e19578fc.7b6a68","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":800,"y":1620,"wires":[]},{"id":"50620da8.3a2c24","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["94506c56.56d57"],"x":1515,"y":1780,"wires":[["bc3be2e4.beac4"]]},{"id":"4f38f9fe.506f98","type":"http in","z":"9de255bd.0d0938","name":"infiniteAccordion","url":"/infiniteAccordion","method":"post","upload":false,"swaggerDoc":"","x":280,"y":1700,"wires":[["13c8ffdc.5771e"]]},{"id":"4c7c0ea7.016e7","type":"link out","z":"9de255bd.0d0938","name":"","links":["4922ebfb.502ee4"],"x":535,"y":1660,"wires":[]},{"id":"4f2bec99.8f08f4","type":"link out","z":"9de255bd.0d0938","name":"","links":["26dc1abf.f98ce6"],"x":535,"y":1700,"wires":[]},{"id":"44d3108f.c513","type":"link out","z":"9de255bd.0d0938","name":"","links":["5977c9e.bed0d38"],"x":535,"y":1740,"wires":[]},{"id":"105e4c38.3d0d44","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":610,"y":1700,"wires":[]},{"id":"d5b80702.952be8","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":620,"y":1660,"wires":[]},{"id":"3d6811f1.df07ee","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":610,"y":1740,"wires":[]},{"id":"c3150c57.c7c87","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":900,"y":1660,"wires":[["623273ad.d1c03c"]]},{"id":"13c8ffdc.5771e","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":410,"y":1700,"wires":[["4c7c0ea7.016e7"],["4f2bec99.8f08f4"],["44d3108f.c513"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"ddce0e1a.495de","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3340,"y":1640,"wires":[["94d4796d.a6ddc8"]]},{"id":"bc3be2e4.beac4","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1680,"y":1780,"wires":[["de49c3fc.d032c"]]},{"id":"db328b75.b37c28","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1220,"y":1660,"wires":[["fd893b62.7b8b58"]]},{"id":"14bb20e8.503a5f","type":"link in","z":"9de255bd.0d0938","name":"","links":["1c858e53.87a6a2","4158d11e.60e1c","1e8d4c5e.75a394","94d4796d.a6ddc8","d613a077.0cfbc","8e50a026.3339d","291cc53c.0f176a","ae36fa1c.c58368","f649a36e.fdce4","100725d3.419e3a","6f954b19.1fdff4","50567732.178ec8","10546fc1.67b5e","de49c3fc.d032c","418e309d.b4b47","f3b02c31.979a9","f0f5f4b7.8793a8","1b8e4032.7ba41","37bfdbba.507524","291d120b.30220e","dd5f5b88.1ddb78","8078fce8.f525e","67e1da18.337b84","d0d5e044.de8fc","ed54fa7b.adc398","aa16f9ce.e9a138","3d5960f4.f9283","f94d06dc.0c5b88","69f3b75c.6572c8","d9e65892.d75c48","73b2d387.db160c","bb4aa3b8.ac43f","87a3887a.147208","218bec3b.a42764","9c5fce75.53928","39a48509.a84e8a","9feaaa74.837d48","87da3c43.a0a63","647baaf9.0cb624","b3053356.55caf","3b73abd8.df4014","e57576da.21df48","6ea0a161.dd861","61e2add5.0c9c84","bc4d3166.6227a","9b42c25d.ba917","28ffc1c6.6289ce","69d15fb5.6e3a9","d06fab22.b1bc08","8495d27a.d25e3","86eac7a4.9a3e78","43221283.76ea6c","e86cd5b8.ebcd58","eda86bab.1e2368","ff903bf4.a97e38","f69e23c9.56574","5a08c4a6.b3a77c","66f58795.5f77b8","17d1d657.41442a","21f1bf25.4bf65","e145fe40.e8b24","1602437f.7f27ed","97504182.22b25","b52ca9ed.19ea28","ba5017b9.617138","ce92a16f.3ea36","e4186082.10228","26e9bd9f.3288b2","a118d6bb.4836c8","6761b271.f1f41c","d508359.84fdcc8","f9dc6412.919678","2fa82b1f.6aa944","2fe4f236.92c9de","682499c1.ce89f8","70359650.37b998","da8be9ba.df2298","96594c79.d9c15","c9c4a913.6b0648","48a1122f.31105c","3efec37f.f772fc","7484ce06.41c41","9ad1fba1.bcd5f8","d90a206e.e5bb6","3e88bb1.7e06c44","9fc97a30.8b5848","b0109a58.b23b38","cc703bc7.872898","4266d67c.ca2ce8","6c279dc4.f64724","8887314e.04546","ddb4ddf9.0baa2","a4c49818.1c0c28","72783216.9e1e9c","8189707d.406e4","28740e4d.346de2","12aeee0a.c94592","6ed72e85.2eb8a","57e60c57.e7ffe4","80675d73.2c5ef","287f7200.d416fe","edf40e53.d9006","28b40741.4093d8","bde01cf1.830e7","12b90b10.c7fb65","5fc299e1.d7f0c8","affb75c5.518788","de86a65d.9fdde8","5e9a4860.70ac48","e01bb0c0.2e22","94e2d649.66f048","dddda585.ca8dc8","60d269f.5ed6c98","acde72ee.7059c","b7696e3b.bd74a","8437873f.7cf4a8","cf641bf8.a672c8","4361d011.2170c","2e458b45.51c7e4","bfa0a56b.25cf28"],"x":135,"y":100,"wires":[["a3db9df3.02e7d"]]},{"id":"4158d11e.60e1c","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":1580,"wires":[]},{"id":"6311606e.82658","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["94506c56.56d57","d1bcd5fb.a3eed8"],"x":1515,"y":1580,"wires":[["b324ad8.b19875"]]},{"id":"94d4796d.a6ddc8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3415,"y":1640,"wires":[]},{"id":"b324ad8.b19875","type":"function","z":"9de255bd.0d0938","name":"basic","func":"msg.payload = {\n    gadgetsList:[\n  \n       {\n  \"gadgetId\": \"4bd759f6-4401-7211-ec41-47c7f160b53e\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"infinite-accordion\",\n  \"gadgetData\": [\n    {\n      \"inner\": [\n        {\n          \"title\": \"Main A - inner 1\",\n          \"inner\": [\n            {\n              \"title\":  \"Main A - inner 1 - inner 1\",\n              \n              \"inner\": [],\n         \n             \"variables\": {\n                    \"discription label 1\": \"discription value 1\",\n                    \"discription label 2\": \"<p> discription value 2 </p>\"\n                  },\n            }\n          ],\n          \"keys\": [],\n         \n        },\n        {\n               \"title\": \"Main A - inner 2\",\n         \n          \"inner\": [\n             {\n              \"title\":  \"Main A - inner 2 - inner 1\",\n              \n              \"inner\": [],\n         \n             \"variables\": {\n                    \"discription label 1\": \"discription value 1\",\n                    \"discription label 2\": \"<p> discription value 2 </p>\"\n                  },\n            }\n          ],\n          \"keys\": [],\n        }\n      ],\n      \"keys\": [\n        {\n          \"title\": \"Main A - key 1\",\n          \"values\": {\n             \"label\": \"value\"\n          }\n        },\n         {\n          \"title\": \"Main A - key 2\",\n          \"values\": {\n            \"label\": \"value\"\n          }\n        }\n      ],\n      \"title\": \"Main A\",\n      \"variables\": {\n        \"discription label 1\": \"discription value 1\",\n        \"discription label 2\": \"<p> discription value 2 </p>\"\n      },\n      \"avatar\": {\n        \"path\": \"/files/logo/factory/logo.jpg\",\n        \"size\": \"large\"\n      }\n    },\n       {\n      \"inner\": [\n        {\n          \"title\": \"Main B - inner 1\",\n          \"inner\": [\n            {\n              \"title\":  \"Main B - inner 1 - inner 1\",\n              \n              \"inner\": [],\n         \n             \"variables\": {\n                    \"discription label 1\": \"discription value 1\",\n                    \"discription label 2\": \"<p> discription value 2 </p>\"\n                  },\n            }\n          ],\n          \"keys\": [],\n         \n        },\n        {\n               \"title\": \"Main B - inner 2\",\n         \n          \"inner\": [\n             {\n              \"title\":  \"Main B - inner 2 - inner 1\",\n              \n              \"inner\": [],\n         \n             \"variables\": {\n                    \"discription label 1\": \"discription value 1\",\n                    \"discription label 2\": \"<p> discription value 2 </p>\"\n                  },\n            }\n          ],\n          \"keys\": [],\n        }\n      ],\n      \"keys\": [\n        {\n          \"title\": \"Main B - key 1\",\n          \"values\": {\n             \"label\": \"value\"\n          }\n        },\n         {\n          \"title\": \"Main B - key 2\",\n          \"values\": {\n            \"label\": \"value\"\n          }\n        }\n      ],\n         \"selected\": true,\n      \"title\": \"Main B ===> Selected\",\n      \"variables\": {\n        \"discription label 1\": \"discription value 1\",\n        \"discription label 2\": \"<p> discription value 2 </p>\"\n      },\n      \"avatar\": {\n        \"path\": \"/files/logo/factory/logo.jpg\",\n        \"size\": \"large\"\n      }\n    }\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"8b1a8e9e-e528-612f-7320-8a3ad6c58281\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                     \"blockHeight\": 300\n                                },\n                              \"gadgetOptions\": {\n                  \n                                 \"copy\":true\n                              }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Breadcrumb Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1580,"wires":[["4158d11e.60e1c"]]},{"id":"8e50a026.3339d","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":1660,"wires":[]},{"id":"8c17c413.5ec118","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["94506c56.56d57","d1bcd5fb.a3eed8"],"x":1515,"y":1660,"wires":[["8d3cf91f.69fb58"]]},{"id":"8d3cf91f.69fb58","type":"function","z":"9de255bd.0d0938","name":"filter__search","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n       \n\n       {\n  \"gadgetId\": \"214be92e-bd3d-3fb7-4839-33a8777de09a\",\n  \"gadgetName\": \"filter__search\",\n  \"gadgetType\": \"infinite-accordion\",\n  \"gadgetData\": [\n        {\n           \"title\": \"title  = 'A', number = '1', date = '01-01-\"+(moment().year() - 1)+\"'\",\n           \"variables\": {\n                    \"title\": \"A\",\n                    \"number\": \"<p> 1 </p>\",\n                    \"date\":\"01-01-\"+Number(moment().year() - 1)+\"'\",\n                  },\n          \"inner\": [\n            {\n              \"title\": \"title  = 'A.1', number = '1.1', date = '31-12-\"+Number(moment().year() - 1)+\"'\",\n              \"inner\": [],\n              \"variables\": {\n                    \"title\": \"A.1t\",\n                    \"number\": \"<p> 1.1 </p>\",\n                    \"date\":\"31-12-\"+Number(moment().year() - 1)+\"'\",\n                  },\n              \"filters\": [\n                {\n                  \"label\": \"title\",\n                  \"value\": \"A.1\"\n                },\n             {\n                  \"label\": \"number\",\n                  \"value\": 1.1\n                },\n                {\n                  \"label\": \"date\",\n                  \"value\": \"31-12-\"+Number(moment().year() - 1)\n                },\n              ]\n            }\n          ],\n          \"keys\": [],\n          \"filters\": [\n           \n               {\n                  \"label\": \"title\",\n                  \"value\": \"A\"\n                },\n             {\n                  \"label\": \"number\",\n                  \"value\": 1\n                },\n                {\n                  \"label\": \"date\",\n                  \"value\": \"01-01-\"+(moment().year() - 1)\n                },\n          ]\n        },\n        {\n           \"title\": \"title  = 'B', number = '2', date = '01-01-\"+moment().year()+\"'\",\n          \"variables\": {\n                    \"title\": \"B\",\n                    \"number\": \"<p> 2 </p>\",\n                    \"date\":\"01-01-\"+moment().year(),\n                  },\n          \"inner\": [\n            {\n                 \"variables\": {\n                    \"title\": \"B.1\",\n                    \"number\": \"<p> 2.5 </p>\",\n                    \"date\":\"31-12-\"+moment().year(),\n                  },\n              \"title\": \"title  = 'B.1', number = '2.5', date = '31-12-\"+moment().year()+\"'\",\n            \n              \"filters\": [\n                \n               {\n                  \"label\": \"title\",\n                  \"value\": \"B.1\"\n                },\n             {\n                  \"label\": \"number\",\n                  \"value\": 2.5\n                },\n                {\n                  \"label\": \"date\",\n                  \"value\": \"31-12-\"+moment().year()\n                },\n              ]\n            }\n          ],\n          \"keys\": [],\n          \"filters\": [\n            \n               {\n                  \"label\": \"title\",\n                  \"value\": \"B\"\n                },\n             {\n                  \"label\": \"number\",\n                  \"value\": 2\n                },\n                {\n                  \"label\": \"date\",\n                  \"value\": \"01-01-\"+moment().year()\n                },\n          ]\n        }\n      ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"filters\": [\n      {\n        \"label\": \"title\",\n        \"type\": \"string\",\n        \"title\": \"title\"\n      },\n      {\n        \"label\": \"date\",\n        \"type\": \"date\",\n        \"title\": \"date\"\n      },\n      {\n        \"label\": \"number\",\n        \"type\": \"number\",\n        \"title\": \"number\"\n      }\n    ]\n  }\n}\n      \n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                                \"gadgetId\": \"a8ab05c4-1595-584a-f223-889ed4f47666\",\n  \"gadgetName\": \"filter__searchCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"filter__searchDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Filter & search\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":1660,"wires":[["8e50a026.3339d"]]},{"id":"291cc53c.0f176a","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3555,"y":1720,"wires":[]},{"id":"6f954b19.1fdff4","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":1700,"wires":[]},{"id":"b65cf5ce.853898","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["94506c56.56d57","d1bcd5fb.a3eed8"],"x":1515,"y":1700,"wires":[["46997b3f.5ab8c4"]]},{"id":"46997b3f.5ab8c4","type":"function","z":"9de255bd.0d0938","name":"tour","func":"msg.payload = {\n    gadgetsList:[\n   \n       {\n  \"gadgetId\": \"2352e8a6-1870-6e56-9c58-194e293d0d5a\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"infinite-accordion\",\n  \"gadgetData\": [\n    {\n      \"buttons\": [\n        {\n          \"buttonData\": {\n            \"title\": \"Tour btn example\",\n            \"tour\": {\n                      \"content\": \"Main level  - 'normal btn'\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 2,\n                      \"placement\": \"bottom\"\n                    },\n            \"allowSearch\": false,\n            \"searchPlaceholder\": \"Search\",\n            \"design\": {\n              \"file\": \"\",\n              \"icon\": \"code\",\n              \"width\": \"\",\n              \"embossed\": false,\n              \"linebox\": false,\n              \"gradient\": false,\n              \"color\": \"\",\n              \"size\": \"small\"\n            },\n            \"disabled\": false,\n            \"options\": [\n              {\n                \"title\": \"\",\n                \"design\": [\n                  {\n                    \"file\": \"\",\n                    \"icon\": \"\",\n                    \"width\": \"\",\n                    \"embossed\": false,\n                    \"linebox\": false,\n                    \"gradient\": false,\n                    \"color\": \"\",\n                    \"size\": \"small\"\n                  }\n                ],\n                \"disabled\": false,\n                \"options\": [\n                  {}\n                ],\n                \"selected\": false,\n                \"action\": {\n                  \"key\": \"organization\",\n                  \"value\": \"PNO Consulutants\",\n                  \"Page\": \"organization overview\",\n                  \"organization_id\": \"5b3360ce41c82d3f438035cb\"\n                }\n              }\n            ],\n            \"type\": \"success\",\n            \"action\": {\n              \"actionType\": \"button\",\n              \"state\": \"\",\n              \"ButtonData\": {\n                \"name\": \"\",\n                \"organization_id\": \"\",\n                \"type\": \"\",\n                \"project_id\": \"\",\n                \"action\": \"create\"\n              }\n            }\n          },\n          \"buttonOptions\": {\n            \"dataType\": \"single\",\n            \"displayType\": \"text\"\n          }\n        }\n      ],\n      \"actionButtons\": [\n        {          \"tour\": {\n                      \"content\": \"Main level  - 'upload btn'\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 3,\n                      \"placement\": \"bottom\"\n                    },\n          \"actionType\": \"upload\",\n          \"icon\": \"cloud_upload\",\n          \"path\": \"/some/path/to/upload/the/file\",\n          \"tooltip\": \"Upload\",\n          \"color\": \"success\"\n        },\n        {\n                      \"tour\": {\n                      \"content\": \"Main level  - 'download btn'\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 2,\n                      \"placement\": \"bottom\"\n                    },\n          \"actionType\": \"download\",\n          \"icon\": \"vertical_align_bottom\",\n          \"path\": \"/files/users/5bc85af71eabf93884014c55/Dafydd Williams.jpeg\",\n          \"tooltip\": \"Download\",\n          \"color\": \"success\"\n        }\n      ],\n      \"inner\": [\n        {\n          \"title\": \"Child level\",\n      \"buttons\": [\n        {\n          \"buttonData\": {\n            \"title\": \"Tour btn example\",\n            \"tour\": {\n                      \"content\": \"Child level  - 'normal btn'\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 4,\n                      \"placement\": \"bottom\"\n                    },\n            \"allowSearch\": false,\n            \"searchPlaceholder\": \"Search\",\n            \"design\": {\n              \"file\": \"\",\n              \"icon\": \"code\",\n              \"width\": \"\",\n              \"embossed\": false,\n              \"linebox\": false,\n              \"gradient\": false,\n              \"color\": \"\",\n              \"size\": \"small\"\n            },\n            \"disabled\": false,\n            \"options\": [\n              {\n                \"title\": \"\",\n                \"design\": [\n                  {\n                    \"file\": \"\",\n                    \"icon\": \"\",\n                    \"width\": \"\",\n                    \"embossed\": false,\n                    \"linebox\": false,\n                    \"gradient\": false,\n                    \"color\": \"\",\n                    \"size\": \"small\"\n                  }\n                ],\n                \"disabled\": false,\n                \"options\": [\n                  {}\n                ],\n                \"selected\": false,\n                \"action\": {\n                  \"key\": \"organization\",\n                  \"value\": \"PNO Consulutants\",\n                  \"Page\": \"organization overview\",\n                  \"organization_id\": \"5b3360ce41c82d3f438035cb\"\n                }\n              }\n            ],\n            \"type\": \"success\",\n            \"action\": {\n              \"actionType\": \"button\",\n              \"state\": \"\",\n              \"ButtonData\": {\n                \"name\": \"\",\n                \"organization_id\": \"\",\n                \"type\": \"\",\n                \"project_id\": \"\",\n                \"action\": \"create\"\n              }\n            }\n          },\n          \"buttonOptions\": {\n            \"dataType\": \"single\",\n            \"displayType\": \"text\"\n          }\n        }\n      ],\n      \"actionButtons\": [\n        {          \"tour\": {\n                      \"content\": \"Child level  - 'upload btn'\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 5,\n                      \"placement\": \"bottom\"\n                    },\n          \"actionType\": \"upload\",\n          \"icon\": \"cloud_upload\",\n          \"path\": \"/some/path/to/upload/the/file\",\n          \"tooltip\": \"Upload\",\n          \"color\": \"success\"\n        },\n        {\n                      \"tour\": {\n                      \"content\": \"Child level  - 'download btn'\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 6,\n                      \"placement\": \"bottom\"\n                    },\n          \"actionType\": \"download\",\n          \"icon\": \"vertical_align_bottom\",\n          \"path\": \"/files/users/5bc85af71eabf93884014c55/Dafydd Williams.jpeg\",\n          \"tooltip\": \"Download\",\n          \"color\": \"success\"\n        }\n      ],\n                    \"tour\": {\n                      \"content\": \"Child level\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 3,\n                      \"placement\": \"bottom\"\n                    },\n      \n        },\n     \n      ],\n      \"keys\": [\n        {\n            \"tour\": {\n                      \"content\": \"Main key level\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 7,\n                      \"placement\": \"bottom\"\n                    },\n          \"title\": \"SubTitle\",\n          \"values\": {\n            \"Emploee cost\": \"€ 35 230\"\n          }\n        }\n      ],\n      \"filters\": [\n        {\n          \"label\": \"orgType\",\n          \"value\": \"ltest1\"\n        }\n      ],\n      \"state\": \"success\",\n      \"title\": \"\",\n      \"variables\": {\n        \"stringSample\": \"This is a sample text\",\n        \"stringSample1\": \"<p> I am tag </p>\"\n      },\n      \"avatar\": {\n        \"path\": \"/files/users/5bc85af71eabf93884014c55/Dafydd Williams.jpeg\",\n        \"size\": \"large\"\n      },\n    \"tour\": {\n      \"content\": \"Main level\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    },\n    }\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"filters\": [\n      {            \"tour\": {\n                      \"content\": \"Filter level\",\n                      \"title\": \"Tour Title\",\n                      \"priority\": 8,\n                      \"placement\": \"bottom\"\n                    },\n        \"label\": \"orgType\",\n        \"type\": \"string\",\n        \"title\": \"Organization\"\n      },\n      {\n        \"label\": \"orgDate\",\n        \"type\": \"date\",\n        \"title\": \"Orgdate\"\n      },\n      {\n        \"label\": \"orgNumber\",\n        \"type\": \"number\",\n        \"title\": \"OrgNumber\"\n      }\n    ]\n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"f4017a35-7604-ecfd-557d-13aea3691900\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1700,"wires":[["6f954b19.1fdff4"]]},{"id":"50567732.178ec8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":1620,"wires":[]},{"id":"d0aa1a7.333c2e8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["94506c56.56d57","d1bcd5fb.a3eed8"],"x":1515,"y":1620,"wires":[["fd62b340.7f344"]]},{"id":"fd62b340.7f344","type":"function","z":"9de255bd.0d0938","name":"buttons","func":"msg.payload = {\n    gadgetsList:[\n     \n       {\n  \"gadgetId\": \"078453a6-9474-751d-e4ec-eeeebd5cf19b\",\n  \"gadgetName\": \"buttons\",\n  \"gadgetType\": \"infinite-accordion\",\n  \"gadgetData\": [\n    {\n      \"buttons\": [\n        {\n          \"buttonData\": {\n            \"title\": \"Alarm button\",\n            \"allowSearch\": false,\n            \"searchPlaceholder\": \"Search\",\n            \"design\": {\n              \"file\": \"\",\n              \"icon\": \"alarm\",\n              \"width\": \"\",\n              \"embossed\": false,\n              \"linebox\": false,\n              \"gradient\": false,\n              \"color\": \"\",\n              \"size\": \"small\"\n            },\n            \"disabled\": false,\n            \"options\": [\n              {\n                \"title\": \"\",\n                \"design\": [\n                  {\n                    \"file\": \"\",\n                    \"icon\": \"\",\n                    \"width\": \"\",\n                    \"embossed\": false,\n                    \"linebox\": false,\n                    \"gradient\": false,\n                    \"color\": \"\",\n                    \"size\": \"small\"\n                  }\n                ],\n                \"disabled\": false,\n                \"options\": [\n                  {}\n                ],\n                \"selected\": false,\n                \"action\": {\n                  \"key\": \"organization\",\n                  \"value\": \"PNO Consulutants\",\n                  \"Page\": \"organization overview\",\n                  \"organization_id\": \"5b3360ce41c82d3f438035cb\"\n                }\n              }\n            ],\n            \"type\": \"success\",\n            \"action\": {\n              Type: \"Alarm button\",\n            }\n          },\n          \"buttonOptions\": {\n            \"dataType\": \"single\",\n            \"displayType\": \"text\"\n          }\n        }\n      ],\n      \"actionButtons\": [\n        {\n          \"actionType\": \"upload\",\n          \"icon\": \"cloud_upload\",\n          \"path\": \"/some/path/to/upload/the/file\",\n          \"tooltip\": \"Upload\",\n          \"color\": \"success\"\n        },\n        {\n          \"actionType\": \"download\",\n          \"icon\": \"vertical_align_bottom\",\n          \"path\":  \"/files/logo/factory/logo.jpg\",\n          \"tooltip\": \"Download\",\n          \"color\": \"success\"\n        }\n      ],\n      \"inner\": [\n        {\n                  \"buttons\": [\n        {\n          \"buttonData\": {\n            \"title\": \"Code button\",\n            \"allowSearch\": false,\n            \"searchPlaceholder\": \"Search\",\n            \"tooltip\": \"Code button tooltip\",\n            \"design\": {\n              \"file\": \"\",\n              \"icon\": \"code\",\n              \"width\": \"\",\n              \"embossed\": true,\n              \"linebox\": true,\n              \"gradient\": true,\n              \"color\": \"\",\n              \"size\": \"small\"\n            },\n            \"disabled\": false,\n            \"options\": [\n              {\n                \"title\": \"\",\n                \"design\": [\n                  {\n                    \"file\": \"\",\n                    \"icon\": \"\",\n                    \"width\": \"\",\n                    \"embossed\": false,\n                    \"linebox\": false,\n                    \"gradient\": false,\n                    \"color\": \"\",\n                    \"size\": \"small\"\n                  }\n                ],\n                \"disabled\": false,\n                \"options\": [\n                  {}\n                ],\n                \"selected\": false,\n  \n              }\n            ],\n            \"type\": \"warning\",\n            \"action\": {\n              Type: \"Code button\",\n            }\n          },\n          \"buttonOptions\": {\n            \"dataType\": \"single\",\n            \"displayType\": \"text\"\n          }\n        }\n      ],\n      \"actionButtons\": [\n        {\n          \"actionType\": \"upload\",\n          \"icon\": \"cloud_upload\",\n          \"path\": \"/files/tmpUplopad\",\n          \"tooltip\": \"Upload\",\n          \"color\": \"danger\"\n        },\n        {\n          \"actionType\": \"download\",\n          \"icon\": \"vertical_align_bottom\",\n          \"path\":  \"/files/logo/factory/logo.jpg\",\n          \"tooltip\": \"Download\",\n          \"color\": \"primary\"\n        }\n      ],\n          \"title\": \"child row\",\n          \n            \"keys\": [\n                {\n                  \"title\": \"child row - key\",\n                  \"values\": {\n                    \"label\": \"value\"\n                  }\n                }\n              ],\n         \n        },\n    \n      ],\n      \"keys\": [\n        {\n          \"title\": \"SubTitle\",\n          \"values\": {\n            \"label\": \"value\"\n          }\n        }\n      ],\n \n      \"state\": \"success\",\n      \"title\": \"Main row\",\n      \"variables\": {\n        \"stringSample\": \"This is a sample text\",\n        \"stringSample1\": \"<p> I am tag </p>\"\n      },\n      \"avatar\": {\n        \"path\": \"/files/logo/factory/logo.jpg\",\n        \"size\": \"large\"\n      }\n    }\n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n  \n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"73dc6735-b87f-9edb-e978-5a45b4b123cb\",\n  \"gadgetName\": \"basicOptions\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                             \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n})\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"BasicOptionsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Breadcrumb Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":1620,"wires":[["50567732.178ec8"]]},{"id":"10546fc1.67b5e","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":1740,"wires":[]},{"id":"dda42e61.4764c","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["94506c56.56d57","d1bcd5fb.a3eed8"],"x":1515,"y":1740,"wires":[["f1a23878.b29be8"]]},{"id":"f1a23878.b29be8","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":1740,"wires":[["10546fc1.67b5e"]]},{"id":"d1bcd5fb.a3eed8","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","6311606e.82658","8c17c413.5ec118","662d87cc.7d0548","b1cbeef4.f75aa","b65cf5ce.853898","d0aa1a7.333c2e8","dda42e61.4764c","2a69c16c.32922e"],"x":3295,"y":1680,"wires":[]},{"id":"de49c3fc.d032c","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":1780,"wires":[]},{"id":"418e309d.b4b47","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":1820,"wires":[]},{"id":"2a69c16c.32922e","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["94506c56.56d57","d1bcd5fb.a3eed8"],"x":1515,"y":1820,"wires":[["f725a339.8da8c"]]},{"id":"f725a339.8da8c","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"708ad058-fbae-ef60-9bfb-8c211ad668f5\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Infinate accrdion</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1820,"wires":[["418e309d.b4b47"]]},{"id":"cf4f5024.376a8","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"e0811593-2879-9c1d-d423-64392a45c7ac\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3410,"y":1720,"wires":[["291cc53c.0f176a"]]},{"id":"7b7d5df9.c61d04","type":"comment","z":"9de255bd.0d0938","name":"Mediaviewer","info":"","x":210,"y":2060,"wires":[]},{"id":"75ffdaa2.e14bf4","type":"comment","z":"9de255bd.0d0938","name":"Mediaviewer gagdet actions","info":"","x":2940,"y":2020,"wires":[]},{"id":"2c249246.1fffee","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2530,"y":1960,"wires":[]},{"id":"9df64188.bc54d","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","2a5b96f9.bb26ba"],"x":835,"y":2180,"wires":[["a62bcd94.b7411","b06534b9.4d4d88"]]},{"id":"a8c07432.7d3de8","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3190,"y":2100,"wires":[["c23904f2.b4d5a8"],["8bda7b3f.76b4d8"],["a00bf93d.d7eb28"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"c4c539e4.216898","type":"debug","z":"9de255bd.0d0938","name":"Mediaviewer Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3170,"y":2040,"wires":[]},{"id":"a62bcd94.b7411","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","82fefdb6.bb756","26c29dda.6daf62","cd9f1d1b.bf34","ef2579a.0435a88","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","ca28793c.e140c8","7030c515.504b2c","90a2f8ec.11a538","7092e76b.637588"],"x":1215,"y":2180,"wires":[]},{"id":"4a305652.72f698","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":800,"y":2140,"wires":[]},{"id":"b06534b9.4d4d88","type":"debug","z":"9de255bd.0d0938","name":"Mediaviewer INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":980,"y":2140,"wires":[]},{"id":"b1b08898.197e68","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","534382db.59c98c"],"x":2995,"y":2100,"wires":[["c4c539e4.216898","a8c07432.7d3de8"]]},{"id":"c1cf1980.737bb8","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","144e8daa.9b73c2"],"x":795,"y":2080,"wires":[["58fe2391.86c2ac"]]},{"id":"67a3fe30.510a6","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1370,"y":2080,"wires":[]},{"id":"2c4bd915.228f46","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":2080,"wires":[["4285f001.42881"]]},{"id":"75aa327d.0eb73c","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":800,"y":2040,"wires":[]},{"id":"82fefdb6.bb756","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["a62bcd94.b7411"],"x":1535,"y":2160,"wires":[["80fe52b5.64984"]]},{"id":"4267f16b.24226","type":"http in","z":"9de255bd.0d0938","name":"Mediaviewer","url":"/Mediaviewer","method":"post","upload":false,"swaggerDoc":"","x":190,"y":2120,"wires":[["18b5f07e.d16fc"]]},{"id":"144e8daa.9b73c2","type":"link out","z":"9de255bd.0d0938","name":"","links":["c1cf1980.737bb8"],"x":435,"y":2080,"wires":[]},{"id":"2a5b96f9.bb26ba","type":"link out","z":"9de255bd.0d0938","name":"","links":["9df64188.bc54d"],"x":435,"y":2120,"wires":[]},{"id":"534382db.59c98c","type":"link out","z":"9de255bd.0d0938","name":"","links":["b1b08898.197e68"],"x":435,"y":2160,"wires":[]},{"id":"88c131e4.29718","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":510,"y":2120,"wires":[]},{"id":"9fcd1a5.f2221e8","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":520,"y":2080,"wires":[]},{"id":"996d5a31.088878","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":510,"y":2160,"wires":[]},{"id":"58fe2391.86c2ac","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":900,"y":2080,"wires":[["2c4bd915.228f46"]]},{"id":"18b5f07e.d16fc","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":290,"y":2120,"wires":[["144e8daa.9b73c2"],["2a5b96f9.bb26ba"],["534382db.59c98c"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"c23904f2.b4d5a8","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3420,"y":2060,"wires":[["d9e65892.d75c48"]]},{"id":"80fe52b5.64984","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1720,"y":2160,"wires":[["f94d06dc.0c5b88"]]},{"id":"4285f001.42881","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1220,"y":2080,"wires":[["67a3fe30.510a6"]]},{"id":"ef2579a.0435a88","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["a62bcd94.b7411","8bda7b3f.76b4d8"],"x":1535,"y":2020,"wires":[["5a8fb02e.95d36"]]},{"id":"5a8fb02e.95d36","type":"function","z":"9de255bd.0d0938","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n        \n       {\n  \"gadgetId\": \"e83b9d57-735d-de4f-d537-9a9c449561c5\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"media-viewer\",\n  \"gadgetData\": {\n    \"media\": [\n      {\n        \"src\": \"https://www.youtube.com/embed/bTqVqk7FSmY?iv_load_policy=3&modestbranding=1&playsinline=1&showinfo=0&rel=0&enablejsapi=1\",\n        \"mediaType\": \"html\",\n        \"type\": \"embed\",\n        \"info\": \"info1\",\n        \"allowDelete\": false\n      },\n      {\n        \"src\": \"https://player.vimeo.com/video/76979871?loop=false&byline=false&portrait=false&title=false&speed=true&transparent=0&gesture=media\",\n        \"mediaType\": \"html\",\n        \"type\": \"embed\",\n        \"info\": \"info2\"\n      },\n      {\n        \"src\": \"https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885__340.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n        \"info\": \"info3\"\n      },\n      {\n        \"src\": \"/files/logo/factory/logo.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n        \"mimeType\": \"image/jpg\",\n        \"info\": \"/files/logo/factory/logo.jpg\"\n      },\n      {\n        \"src\": \"/files/media/pancakes.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n           \"mimeType\": \"image/jpg\",\n        \"info\": \"/files/media/pancakes.jpg\"\n      },\n     {\n        \"src\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp3\",\n        \"mediaType\": \"audio\",\n        \"type\": \"file\",\n        \"mimeType\": \"audio/mp3\",\n        \"info\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp3\"\n      },\n      {\n        \"src\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp4\",\n        \"mediaType\": \"video\",\n        \"type\": \"file\",\n        \"mimeType\": \"video/mp4\",\n        \"info\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp4\"\n      }\n    ],\n    \"preview\": [\n      {\n        \"filePath\": \"https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885__340.jpg\",\n        \"srcToShow\": \"https://player.vimeo.com/video/76979871?loop=false&byline=false&portrait=false&title=false&speed=true&transparent=0&gesture=media\"\n      }\n    ],\n    \"mediaMainFolders\": \"/files/SystemFiles/icons/\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"allowDelete\": true,\n    \"allowAdd\": true,\n    \"allowFullscreen\": true,\n    \"navigation\": true\n  }\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2020,"wires":[["ed54fa7b.adc398"]]},{"id":"ca28793c.e140c8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["a62bcd94.b7411","8bda7b3f.76b4d8"],"x":1535,"y":2080,"wires":[["2f5bd780.c95038"]]},{"id":"2f5bd780.c95038","type":"function","z":"9de255bd.0d0938","name":"tour","func":"\nmsg.payload = {\n    gadgetsList:[\n     \n        \n       {\n  \"gadgetId\": \"c011fb44-659b-e797-aff4-ae146c76094c\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"media-viewer\",\n  \"gadgetData\": {\n    \"media\": [\n      {\n          tour:{\n                      content:\"Tour on media level, top placement\",\n                      title :\"Tour on media level, top placement\",\n                      priority:2,\n                      placement :\"top\"\n                  },\n        \"src\": \"https://www.youtube.com/embed/bTqVqk7FSmY?iv_load_policy=3&modestbranding=1&playsinline=1&showinfo=0&rel=0&enablejsapi=1\",\n        \"mediaType\": \"html\",\n        \"type\": \"embed\",\n        \"info\": \"info1\",\n        \"allowDelete\": false\n      },\n      {\n        \"src\": \"https://player.vimeo.com/video/76979871?loop=false&byline=false&portrait=false&title=false&speed=true&transparent=0&gesture=media\",\n        \"mediaType\": \"html\",\n        \"type\": \"embed\",\n        \"info\": \"info2\"\n      },\n      {\n        \"src\": \"https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885__340.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n        \"info\": \"info3\"\n      },\n      {\n        \"src\": \"/files/logo/factory/logo.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n        \"mimeType\": \"image/jpg\",\n        \"info\": \"/files/logo/factory/logo.jpg\"\n      },\n      {\n        \"src\": \"/files/media/pancakes.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n           \"mimeType\": \"image/jpg\",\n        \"info\": \"/files/media/pancakes.jpg\"\n      },\n     {\n        \"src\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp3\",\n        \"mediaType\": \"audio\",\n        \"type\": \"file\",\n        \"mimeType\": \"audio/mp3\",\n        \"info\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp3\"\n      },\n      {\n          \n        \"src\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp4\",\n        \"mediaType\": \"video\",\n        \"type\": \"file\",\n        \"mimeType\": \"video/mp4\",\n        \"info\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp4\"\n      }\n    ],\n    \"preview\": [\n      {\n        \"filePath\": \"https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885__340.jpg\",\n        \"srcToShow\": \"https://player.vimeo.com/video/76979871?loop=false&byline=false&portrait=false&title=false&speed=true&transparent=0&gesture=media\"\n      }\n    ],\n    \"mediaMainFolders\": \"/files/SystemFiles/icons/\"\n  },\n  \"gadgetOptions\": {\n      tour:{\n                      content:\"Tour content, left placement\",\n                      title :\"Tour title, left placement\",\n                      priority:1,\n                      placement :\"left\"\n                  },\n    \"disabled\": false,\n    \"allowDelete\": true,\n    \"allowAdd\": true,\n    \"allowFullscreen\": true,\n    \"navigation\": true\n  }\n}\n      \n      \n      ]\n}\n\n\n\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2080,"wires":[["aa16f9ce.e9a138"]]},{"id":"90a2f8ec.11a538","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["a62bcd94.b7411","8bda7b3f.76b4d8"],"x":1535,"y":2120,"wires":[["84f9ce76.7c82a"]]},{"id":"84f9ce76.7c82a","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1720,"y":2120,"wires":[["3d5960f4.f9283"]]},{"id":"8bda7b3f.76b4d8","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","ef2579a.0435a88","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","ca28793c.e140c8","7030c515.504b2c","90a2f8ec.11a538"],"x":3375,"y":2100,"wires":[]},{"id":"4e22fa82.b46df4","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Media-viewer</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2200,"wires":[["69f3b75c.6572c8"]]},{"id":"7092e76b.637588","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["a62bcd94.b7411"],"x":1535,"y":2200,"wires":[["4e22fa82.b46df4"]]},{"id":"a00bf93d.d7eb28","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3490,"y":2140,"wires":[["73b2d387.db160c"]]},{"id":"ed54fa7b.adc398","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":2020,"wires":[]},{"id":"aa16f9ce.e9a138","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":2100,"wires":[]},{"id":"3d5960f4.f9283","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":2140,"wires":[]},{"id":"f94d06dc.0c5b88","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":2180,"wires":[]},{"id":"69f3b75c.6572c8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":2220,"wires":[]},{"id":"d9e65892.d75c48","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3495,"y":2060,"wires":[]},{"id":"73b2d387.db160c","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3635,"y":2140,"wires":[]},{"id":"33d1fde1.7b2012","type":"comment","z":"9de255bd.0d0938","name":"progressbar","info":"","x":210,"y":2880,"wires":[]},{"id":"647b3553.adbd2c","type":"comment","z":"9de255bd.0d0938","name":"progressbar gagdet actions","info":"","x":2940,"y":2840,"wires":[]},{"id":"d8ebbf1e.a9cd","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2530,"y":2780,"wires":[]},{"id":"54daf74.b5a8d08","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","1c59496b.17c6a7"],"x":835,"y":3000,"wires":[["5ce7d23c.b9350c","2a737c72.37e784"]]},{"id":"f2d43a6.074cec8","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3190,"y":2920,"wires":[["a4736d38.7f7e5"],["a6b308c9.09f518"],["277c94.0f42d36c"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"4dc1be8f.f4ed1","type":"debug","z":"9de255bd.0d0938","name":"progressbar Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3170,"y":2860,"wires":[]},{"id":"5ce7d23c.b9350c","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","652ddc8b.126e34","26c29dda.6daf62","cd9f1d1b.bf34","6d20fff9.89ee4","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","13a1c95e.c777e7","7030c515.504b2c","1d863088.f315ef","675e2bde.bfe4f4"],"x":1215,"y":3000,"wires":[]},{"id":"4e258abe.b9b784","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":800,"y":2960,"wires":[]},{"id":"2a737c72.37e784","type":"debug","z":"9de255bd.0d0938","name":"progressbar INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":980,"y":2960,"wires":[]},{"id":"832dd3cf.73007","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","7e4b6ecd.2918f"],"x":2995,"y":2920,"wires":[["4dc1be8f.f4ed1","f2d43a6.074cec8"]]},{"id":"592c77e1.8bed28","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","4419999.d913668"],"x":795,"y":2900,"wires":[["42a9dca4.85eed4"]]},{"id":"d792521b.4fa3f","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1370,"y":2900,"wires":[]},{"id":"3cd79b65.971c44","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":2900,"wires":[["c855fe6a.87f0a"]]},{"id":"1cc199ef.eb88d6","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":800,"y":2860,"wires":[]},{"id":"652ddc8b.126e34","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["5ce7d23c.b9350c"],"x":1535,"y":2980,"wires":[["590eceac.240a6"]]},{"id":"ad028baa.30e1b8","type":"http in","z":"9de255bd.0d0938","name":"progressbar","url":"/progressbar","method":"post","upload":false,"swaggerDoc":"","x":190,"y":2940,"wires":[["a8c3297a.516898"]]},{"id":"4419999.d913668","type":"link out","z":"9de255bd.0d0938","name":"","links":["592c77e1.8bed28"],"x":435,"y":2900,"wires":[]},{"id":"1c59496b.17c6a7","type":"link out","z":"9de255bd.0d0938","name":"","links":["54daf74.b5a8d08"],"x":435,"y":2940,"wires":[]},{"id":"7e4b6ecd.2918f","type":"link out","z":"9de255bd.0d0938","name":"","links":["832dd3cf.73007"],"x":435,"y":2980,"wires":[]},{"id":"30daeaa6.611d36","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":510,"y":2940,"wires":[]},{"id":"d840fb2d.ca6f08","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":520,"y":2900,"wires":[]},{"id":"cb0d6247.6302","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":510,"y":2980,"wires":[]},{"id":"42a9dca4.85eed4","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":900,"y":2900,"wires":[["3cd79b65.971c44"]]},{"id":"a8c3297a.516898","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":290,"y":2940,"wires":[["4419999.d913668"],["1c59496b.17c6a7"],["7e4b6ecd.2918f"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"a4736d38.7f7e5","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3420,"y":2880,"wires":[["9feaaa74.837d48"]]},{"id":"590eceac.240a6","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1720,"y":2980,"wires":[["9c5fce75.53928"]]},{"id":"c855fe6a.87f0a","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1220,"y":2900,"wires":[["d792521b.4fa3f"]]},{"id":"6d20fff9.89ee4","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["5ce7d23c.b9350c","a6b308c9.09f518"],"x":1535,"y":2840,"wires":[["d06ce4ea.6302c8"]]},{"id":"d06ce4ea.6302c8","type":"function","z":"9de255bd.0d0938","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n  \n       {\n                  \"gadgetId\": \"2900ae05-5b74-a852-6e6c-1a0f22bfd55b\",\n                  \"gadgetName\": \"basic\",\n                  \"gadgetType\": \"progressbar\",\n                  \"gadgetData\": [\n                    {\n                      \"tooltip\": \"Progress 50%\",\n                      \"color\": \"primary\",\n                      \"lineStart\": \"0\",\n                      \"lineWidth\": \"50\"\n                    },\n                    {\n                      \"tooltip\": \"Progress 10%\",\n                      \"color\": \"danger\",\n                      \"lineStart\": \"50\",\n                      \"lineWidth\": \"10%\"\n                    }\n                  ],\n                  \"gadgetOptions\": {\n                    \"height\": 6,\n                    \"progressType\": \"success\"\n                  }\n                }\n      \n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2840,"wires":[["bb4aa3b8.ac43f"]]},{"id":"13a1c95e.c777e7","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["5ce7d23c.b9350c","a6b308c9.09f518"],"x":1535,"y":2900,"wires":[["4a2f9b14.7b7ee4"]]},{"id":"4a2f9b14.7b7ee4","type":"function","z":"9de255bd.0d0938","name":"tour","func":"\nmsg.payload = {\n    gadgetsList:[\n     \n  \n       {\n  \"gadgetId\": \"3293febd-f38b-42c5-8464-9c8a377be081\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"progressbar\",\n  \"gadgetData\": [\n    {\n      \"tooltip\": \"Progress 80%\",\n      \"color\": \"primary\",\n      \"lineStart\": \"0\",\n      \"lineWidth\": \"80\"\n    },\n        {\n        tour:{\n          content:\"Tour on progressbar @bar, right placement\",\n          title :\"Tour on progressbar @bar, right placement\",\n          priority:2,\n          placement :\"right\"\n      },\n      \"tooltip\": \"Progress 50% Start 20\",\n      \"color\": \"primary\",\n      \"lineStart\": \"20%\",\n      \"lineWidth\": \"50%\"\n    },\n    {\n      \"tooltip\": \"Progress 30%\",\n      \"color\": \"danger\",\n      \"lineStart\": \"100\",\n      \"lineWidth\": \"13%\"\n    }\n  ],\n  \"gadgetOptions\": {\n  tour:{\n          content:\"Tour on progressbar, top placement\",\n          title :\"Tour on progressbar, top placement\",\n          priority:1,\n          placement :\"top\"\n      },\n    \"height\": 6,\n    \"progressType\": \"success\"\n  }\n},\n            \n       {\n  \"gadgetId\": \"c011fb44-659b-e797-aff4-ae146c76094c\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"media-viewer\",\n  \"gadgetData\": {\n    \"media\": [\n      {\n          tour:{\n                      content:\"Tour on media level, top placement\",\n                      title :\"Tour on media level, top placement\",\n                      priority:2,\n                      placement :\"top\"\n                  },\n        \"src\": \"https://www.youtube.com/embed/bTqVqk7FSmY?iv_load_policy=3&modestbranding=1&playsinline=1&showinfo=0&rel=0&enablejsapi=1\",\n        \"mediaType\": \"html\",\n        \"type\": \"embed\",\n        \"info\": \"info1\",\n        \"allowDelete\": false\n      },\n      {\n        \"src\": \"https://player.vimeo.com/video/76979871?loop=false&byline=false&portrait=false&title=false&speed=true&transparent=0&gesture=media\",\n        \"mediaType\": \"html\",\n        \"type\": \"embed\",\n        \"info\": \"info2\"\n      },\n      {\n        \"src\": \"https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885__340.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n        \"info\": \"info3\"\n      },\n      {\n        \"src\": \"/files/logo/factory/logo.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n        \"mimeType\": \"image/jpg\",\n        \"info\": \"/files/logo/factory/logo.jpg\"\n      },\n      {\n        \"src\": \"/files/media/pancakes.jpg\",\n        \"mediaType\": \"image\",\n        \"type\": \"file\",\n           \"mimeType\": \"image/jpg\",\n        \"info\": \"/files/media/pancakes.jpg\"\n      },\n     {\n        \"src\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp3\",\n        \"mediaType\": \"audio\",\n        \"type\": \"file\",\n        \"mimeType\": \"audio/mp3\",\n        \"info\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp3\"\n      },\n      {\n          \n        \"src\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp4\",\n        \"mediaType\": \"video\",\n        \"type\": \"file\",\n        \"mimeType\": \"video/mp4\",\n        \"info\": \"/files/media/John Mayer - Free Fallin' (Live at the Nokia Theatre).mp4\"\n      }\n    ],\n    \"preview\": [\n      {\n        \"filePath\": \"https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885__340.jpg\",\n        \"srcToShow\": \"https://player.vimeo.com/video/76979871?loop=false&byline=false&portrait=false&title=false&speed=true&transparent=0&gesture=media\"\n      }\n    ],\n    \"mediaMainFolders\": \"/files/SystemFiles/icons/\"\n  },\n  \"gadgetOptions\": {\n      tour:{\n                      content:\"Tour content, left placement\",\n                      title :\"Tour title, left placement\",\n                      priority:1,\n                      placement :\"left\"\n                  },\n    \"disabled\": false,\n    \"allowDelete\": true,\n    \"allowAdd\": true,\n    \"allowFullscreen\": true,\n    \"navigation\": true\n  }\n}\n      \n      \n      ]\n}\n\n\n\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2900,"wires":[["87a3887a.147208"]]},{"id":"1d863088.f315ef","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["5ce7d23c.b9350c","a6b308c9.09f518"],"x":1535,"y":2940,"wires":[["df6d0d11.a9ada"]]},{"id":"df6d0d11.a9ada","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1720,"y":2940,"wires":[["218bec3b.a42764"]]},{"id":"a6b308c9.09f518","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","6d20fff9.89ee4","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","13a1c95e.c777e7","7030c515.504b2c","1d863088.f315ef"],"x":3375,"y":2920,"wires":[]},{"id":"2efec6af.13009a","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Progress bar</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3020,"wires":[["39a48509.a84e8a"]]},{"id":"675e2bde.bfe4f4","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["5ce7d23c.b9350c"],"x":1535,"y":3020,"wires":[["2efec6af.13009a"]]},{"id":"277c94.0f42d36c","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3490,"y":2960,"wires":[["87da3c43.a0a63"]]},{"id":"bb4aa3b8.ac43f","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":2840,"wires":[]},{"id":"87a3887a.147208","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":2920,"wires":[]},{"id":"218bec3b.a42764","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":2960,"wires":[]},{"id":"9c5fce75.53928","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3000,"wires":[]},{"id":"39a48509.a84e8a","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3040,"wires":[]},{"id":"9feaaa74.837d48","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3495,"y":2880,"wires":[]},{"id":"87da3c43.a0a63","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3635,"y":2960,"wires":[]},{"id":"eea0dc2a.52067","type":"comment","z":"9de255bd.0d0938","name":"slider","info":"","x":190,"y":3260,"wires":[]},{"id":"b8929624.4728c8","type":"comment","z":"9de255bd.0d0938","name":"slider gagdet actions","info":"","x":2920,"y":3220,"wires":[]},{"id":"7290b249.d3162c","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2530,"y":3160,"wires":[]},{"id":"d1140436.5b7678","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","a9d5d351.8598c"],"x":835,"y":3380,"wires":[["4bd9d36b.9ffe4c","2e45cfc4.1473d"]]},{"id":"14ca936f.881f2d","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3190,"y":3300,"wires":[["cd7c2ff2.3b46"],["11b7ec3.ed3c914"],["5178a26e.826fec"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"1a0d4c93.4d0063","type":"debug","z":"9de255bd.0d0938","name":"slider Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3150,"y":3240,"wires":[]},{"id":"4bd9d36b.9ffe4c","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","2acc0329.27128c","26c29dda.6daf62","cd9f1d1b.bf34","1202bac7.21dbc5","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","7254c661.30f8e8","7030c515.504b2c","6c0553ef.3335ac","e490d0cd.3023a"],"x":1215,"y":3380,"wires":[]},{"id":"843d27ac.4ee428","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":800,"y":3340,"wires":[]},{"id":"2e45cfc4.1473d","type":"debug","z":"9de255bd.0d0938","name":"slider INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":960,"y":3340,"wires":[]},{"id":"2f4c5f0b.3a784","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","c1c7e1c5.47eab"],"x":2995,"y":3300,"wires":[["1a0d4c93.4d0063","14ca936f.881f2d"]]},{"id":"56bbb4b0.0d8e1c","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","8a96fa57.91d738"],"x":795,"y":3280,"wires":[["5825993e.d58f78"]]},{"id":"a18cb5b1.553938","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1370,"y":3280,"wires":[]},{"id":"7af5811c.0b01e","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":3280,"wires":[["f54eeb78.d97df8"]]},{"id":"c411323f.0cc53","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":800,"y":3240,"wires":[]},{"id":"2acc0329.27128c","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4bd9d36b.9ffe4c"],"x":1535,"y":3360,"wires":[["8455864b.641448"]]},{"id":"8bd49eca.87dcd","type":"http in","z":"9de255bd.0d0938","name":"slider","url":"/slider","method":"post","upload":false,"swaggerDoc":"","x":170,"y":3320,"wires":[["6c5dcdf3.2d13c4"]]},{"id":"8a96fa57.91d738","type":"link out","z":"9de255bd.0d0938","name":"","links":["56bbb4b0.0d8e1c"],"x":435,"y":3280,"wires":[]},{"id":"a9d5d351.8598c","type":"link out","z":"9de255bd.0d0938","name":"","links":["d1140436.5b7678"],"x":435,"y":3320,"wires":[]},{"id":"c1c7e1c5.47eab","type":"link out","z":"9de255bd.0d0938","name":"","links":["2f4c5f0b.3a784"],"x":435,"y":3360,"wires":[]},{"id":"8bd4bfc8.019e1","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":510,"y":3320,"wires":[]},{"id":"a078681.1ff3c98","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":520,"y":3280,"wires":[]},{"id":"cd34a69a.0289b8","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":510,"y":3360,"wires":[]},{"id":"5825993e.d58f78","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":900,"y":3280,"wires":[["7af5811c.0b01e"]]},{"id":"6c5dcdf3.2d13c4","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":290,"y":3320,"wires":[["8a96fa57.91d738"],["a9d5d351.8598c"],["c1c7e1c5.47eab"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"cd7c2ff2.3b46","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3420,"y":3260,"wires":[["86eac7a4.9a3e78"]]},{"id":"8455864b.641448","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1720,"y":3360,"wires":[["d06fab22.b1bc08"]]},{"id":"f54eeb78.d97df8","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1220,"y":3280,"wires":[["a18cb5b1.553938"]]},{"id":"1202bac7.21dbc5","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4bd9d36b.9ffe4c","11b7ec3.ed3c914"],"x":1535,"y":3220,"wires":[["5007fb6f.47aae4"]]},{"id":"5007fb6f.47aae4","type":"function","z":"9de255bd.0d0938","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n  \n     \n       {\n  \"gadgetId\": \"639448f0-c0ff-9841-a476-f60e2205928d\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"slider\",\n  \"gadgetData\": {\n    \"slides\": [\n      {\n        \"icon\": \"bookmark\",\n        \"title\": \"Title 1\",\n        \"description\": \"Description 1\",\n        \"iconPack\": \"\",\n        \"color\": \"warning\",\n        \"step\": 10,\n        \"ticks\": true,\n        \"textFixed\": \"\",\n        \"min\": 20,\n        \"max\": 90,\n        \"value\": [\n          30,\n          60\n        ]\n      },\n      {\n        \"icon\": \"Code\",\n        \"title\": \"Title 2\",\n        \"description\": \"Description  2\",\n        \"iconPack\": \"\",\n        \"color\": \"success\",\n        \"step\": 10,\n        \"ticks\": true,\n        \"textFixed\": \"\",\n        \"min\": 20,\n        \"max\": 90,\n        \"value\": [\n          50,\n          60\n        ]\n      }\n    ]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false\n  }\n}\n      \n      \n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3220,"wires":[["9b42c25d.ba917"]]},{"id":"7254c661.30f8e8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4bd9d36b.9ffe4c","11b7ec3.ed3c914"],"x":1535,"y":3280,"wires":[["e91e4596.b1b508"]]},{"id":"e91e4596.b1b508","type":"function","z":"9de255bd.0d0938","name":"tour","func":"\nmsg.payload = {\n    gadgetsList:[\n   \n \n  \n       {\n  \"gadgetId\": \"550ec7d9-b2a0-8f73-d39a-d268630c4e04\",\n  \"gadgetName\": \"Tour\",\n  \"gadgetType\": \"slider\",\n  \"gadgetData\": {\n       tour:{\n          content:\"Tour on slider, right placement\",\n          title :\"Tour on slider, right placement\",\n          priority:1,\n          placement :\"right\"\n      },\n    \"slides\": [\n      {\n         tour:{\n          content:\"Tour on slider @slide, top placement\",\n          title :\"Tour on slider @slide, top placement\",\n          priority:2,\n          placement :\"top\"\n      },\n        \"icon\": \"bookmark\",\n        \"title\": \"Title 1\",\n        \"description\": \"Description 1\",\n        \"iconPack\": \"\",\n        \"color\": \"warning\",\n        \"step\": 30,\n        \"ticks\": true,\n        \"textFixed\": \"\",\n        \"min\": 40,\n        \"max\": 800,\n        \"value\": [\n          30,\n          60\n        ]\n      },\n      {\n        \"icon\": \"code\",\n        \"title\": \"Title 2\",\n        \"description\": \"Description  2\",\n        \"iconPack\": \"\",\n        \"color\": \"success\",\n        \"step\": 7.3333,\n        \"ticks\": false,\n        \"textFixed\": \"\",\n        \"min\": 15,\n        \"max\": 100,\n        \"value\": [\n          50,\n          60\n        ]\n      }\n    ]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false\n  }\n}\n      \n\n      ]\n}\n\n\n\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3280,"wires":[["28ffc1c6.6289ce"]]},{"id":"6c0553ef.3335ac","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4bd9d36b.9ffe4c","11b7ec3.ed3c914"],"x":1535,"y":3320,"wires":[["c693113.d862bf"]]},{"id":"c693113.d862bf","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1720,"y":3320,"wires":[["69d15fb5.6e3a9"]]},{"id":"11b7ec3.ed3c914","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","1202bac7.21dbc5","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","7254c661.30f8e8","7030c515.504b2c","6c0553ef.3335ac"],"x":3375,"y":3300,"wires":[]},{"id":"8301b51d.64f728","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Slider</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3400,"wires":[["8495d27a.d25e3"]]},{"id":"e490d0cd.3023a","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4bd9d36b.9ffe4c"],"x":1535,"y":3400,"wires":[["8301b51d.64f728"]]},{"id":"5178a26e.826fec","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3490,"y":3340,"wires":[["43221283.76ea6c"]]},{"id":"9b42c25d.ba917","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3220,"wires":[]},{"id":"28ffc1c6.6289ce","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3300,"wires":[]},{"id":"69d15fb5.6e3a9","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3340,"wires":[]},{"id":"d06fab22.b1bc08","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3380,"wires":[]},{"id":"8495d27a.d25e3","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3420,"wires":[]},{"id":"86eac7a4.9a3e78","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3495,"y":3260,"wires":[]},{"id":"43221283.76ea6c","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3635,"y":3340,"wires":[]},{"id":"eee70400.9601d8","type":"comment","z":"9de255bd.0d0938","name":"switch","info":"","x":190,"y":3600,"wires":[]},{"id":"e47e805b.9d865","type":"comment","z":"9de255bd.0d0938","name":"slider gagdet actions","info":"","x":2920,"y":3560,"wires":[]},{"id":"4c1b6c8d.b9bfd4","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2530,"y":3500,"wires":[]},{"id":"17ab8780.84d389","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","3f576b3a.617894"],"x":835,"y":3720,"wires":[["404772f1.acb68c","6bcdd93.d054b28"]]},{"id":"cc45ef30.1e0c1","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3190,"y":3640,"wires":[["e979fc51.e79ad"],["98c765e5.2171d8"],["d04147d0.9fa568"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"fe1d04a0.a2a8f8","type":"debug","z":"9de255bd.0d0938","name":"switch Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3150,"y":3580,"wires":[]},{"id":"404772f1.acb68c","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","1365005d.04c78","26c29dda.6daf62","cd9f1d1b.bf34","b29eb360.1d1cc","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","b17909ae.562e68","7030c515.504b2c","c85bc429.cf8bb8","e4479541.7f96a8"],"x":1215,"y":3720,"wires":[]},{"id":"8f904064.0541d","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":800,"y":3680,"wires":[]},{"id":"6bcdd93.d054b28","type":"debug","z":"9de255bd.0d0938","name":"switch INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":960,"y":3680,"wires":[]},{"id":"d0d77ab4.267028","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","af21bc93.83a17"],"x":2995,"y":3640,"wires":[["fe1d04a0.a2a8f8","cc45ef30.1e0c1"]]},{"id":"fd150057.0083e","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","d9efc561.eadc48"],"x":795,"y":3620,"wires":[["a020f701.6e9bd8"]]},{"id":"8b9dad4d.33e53","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1370,"y":3620,"wires":[]},{"id":"8119b1ef.a1357","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":3620,"wires":[["47da53e8.b9b16c"]]},{"id":"bc70b96e.2cd098","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":800,"y":3580,"wires":[]},{"id":"1365005d.04c78","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["404772f1.acb68c"],"x":1535,"y":3700,"wires":[["5aa333a5.7c314c"]]},{"id":"7a6897ab.808988","type":"http in","z":"9de255bd.0d0938","name":"switch","url":"/switch","method":"post","upload":false,"swaggerDoc":"","x":170,"y":3660,"wires":[["61b1e1ec.059b4"]]},{"id":"d9efc561.eadc48","type":"link out","z":"9de255bd.0d0938","name":"","links":["fd150057.0083e"],"x":435,"y":3620,"wires":[]},{"id":"3f576b3a.617894","type":"link out","z":"9de255bd.0d0938","name":"","links":["17ab8780.84d389"],"x":435,"y":3660,"wires":[]},{"id":"af21bc93.83a17","type":"link out","z":"9de255bd.0d0938","name":"","links":["d0d77ab4.267028"],"x":435,"y":3700,"wires":[]},{"id":"93fcf33.896141","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":510,"y":3660,"wires":[]},{"id":"14854366.22424d","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":520,"y":3620,"wires":[]},{"id":"3422fa53.fcceb6","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":510,"y":3700,"wires":[]},{"id":"a020f701.6e9bd8","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":900,"y":3620,"wires":[["8119b1ef.a1357"]]},{"id":"61b1e1ec.059b4","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":290,"y":3660,"wires":[["d9efc561.eadc48"],["3f576b3a.617894"],["af21bc93.83a17"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"e979fc51.e79ad","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3420,"y":3600,"wires":[["66f58795.5f77b8"]]},{"id":"5aa333a5.7c314c","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1720,"y":3700,"wires":[["f69e23c9.56574"]]},{"id":"47da53e8.b9b16c","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1220,"y":3620,"wires":[["8b9dad4d.33e53"]]},{"id":"b29eb360.1d1cc","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["404772f1.acb68c","98c765e5.2171d8"],"x":1535,"y":3560,"wires":[["d4e45a43.6c9c98"]]},{"id":"d4e45a43.6c9c98","type":"function","z":"9de255bd.0d0938","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n  \n    \n      \n      \n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3560,"wires":[["e86cd5b8.ebcd58"]]},{"id":"b17909ae.562e68","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["404772f1.acb68c","98c765e5.2171d8"],"x":1535,"y":3620,"wires":[["6de95011.7a78e"]]},{"id":"6de95011.7a78e","type":"function","z":"9de255bd.0d0938","name":"tour","func":"\nmsg.payload = {\n    gadgetsList:[\n   \n \n  \n       {\n  \"gadgetId\": \"550ec7d9-b2a0-8f73-d39a-d268630c4e04\",\n  \"gadgetName\": \"Tour\",\n  \"gadgetType\": \"slider\",\n  \"gadgetData\": {\n       tour:{\n          content:\"Tour on slider, right placement\",\n          title :\"Tour on slider, right placement\",\n          priority:1,\n          placement :\"right\"\n      },\n    \"slides\": [\n      {\n         tour:{\n          content:\"Tour on slider @slide, top placement\",\n          title :\"Tour on slider @slide, top placement\",\n          priority:2,\n          placement :\"top\"\n      },\n        \"icon\": \"bookmark\",\n        \"title\": \"Title 1\",\n        \"description\": \"Description 1\",\n        \"iconPack\": \"\",\n        \"color\": \"warning\",\n        \"step\": 30,\n        \"ticks\": true,\n        \"textFixed\": \"\",\n        \"min\": 40,\n        \"max\": 800,\n        \"value\": [\n          30,\n          60\n        ]\n      },\n      {\n        \"icon\": \"code\",\n        \"title\": \"Title 2\",\n        \"description\": \"Description  2\",\n        \"iconPack\": \"\",\n        \"color\": \"success\",\n        \"step\": 7.3333,\n        \"ticks\": false,\n        \"textFixed\": \"\",\n        \"min\": 15,\n        \"max\": 100,\n        \"value\": [\n          50,\n          60\n        ]\n      }\n    ]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false\n  }\n}\n      \n\n      ]\n}\n\n\n\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3620,"wires":[["eda86bab.1e2368"]]},{"id":"c85bc429.cf8bb8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["404772f1.acb68c","98c765e5.2171d8"],"x":1535,"y":3660,"wires":[["a2c1880f.43dc28"]]},{"id":"a2c1880f.43dc28","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1720,"y":3660,"wires":[["ff903bf4.a97e38"]]},{"id":"98c765e5.2171d8","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","b29eb360.1d1cc","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","b17909ae.562e68","7030c515.504b2c","c85bc429.cf8bb8"],"x":3375,"y":3640,"wires":[]},{"id":"dc313dcc.9368c","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Switch</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3740,"wires":[["5a08c4a6.b3a77c"]]},{"id":"e4479541.7f96a8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["404772f1.acb68c"],"x":1535,"y":3740,"wires":[["dc313dcc.9368c"]]},{"id":"d04147d0.9fa568","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3490,"y":3680,"wires":[["17d1d657.41442a"]]},{"id":"e86cd5b8.ebcd58","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3560,"wires":[]},{"id":"eda86bab.1e2368","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3640,"wires":[]},{"id":"ff903bf4.a97e38","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3680,"wires":[]},{"id":"f69e23c9.56574","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3720,"wires":[]},{"id":"5a08c4a6.b3a77c","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2375,"y":3760,"wires":[]},{"id":"66f58795.5f77b8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3495,"y":3600,"wires":[]},{"id":"17d1d657.41442a","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3635,"y":3680,"wires":[]},{"id":"7d575201.81b87c","type":"comment","z":"9de255bd.0d0938","name":"iframeContainer","info":"","x":220,"y":1320,"wires":[]},{"id":"6e99a759.3781f8","type":"comment","z":"9de255bd.0d0938","name":"iframeContainer gagdet actions","info":"","x":2950,"y":1280,"wires":[]},{"id":"ba062b53.d7a9b8","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2530,"y":1220,"wires":[]},{"id":"f7a63b8.bb914c8","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","dc799fc9.e9c83"],"x":835,"y":1440,"wires":[["4d958d68.40b614","cd0013e5.a34f8"]]},{"id":"862b5a67.286518","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3190,"y":1360,"wires":[["d395b452.3efcc8"],["5bf8dec2.cb74a"],["5858e1af.25ac7"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"78798de2.d967e4","type":"debug","z":"9de255bd.0d0938","name":"iframeContainer Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3120,"y":1300,"wires":[]},{"id":"4d958d68.40b614","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","5e35d2a8.785bdc","26c29dda.6daf62","cd9f1d1b.bf34","a2a9365a.7da5c8","9072dcf.7d0dd2","662d87cc.7d0548","48dffeab.b720a","445579da.d716e8","770e069.33327f8","3bdba2e8.aaa2ee","76c2e066.900d1"],"x":1215,"y":1440,"wires":[]},{"id":"722da690.114c28","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":800,"y":1400,"wires":[]},{"id":"cd0013e5.a34f8","type":"debug","z":"9de255bd.0d0938","name":"iframeContainer INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":990,"y":1400,"wires":[]},{"id":"9f7f0041.06561","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","62a2fc9c.27ed34"],"x":2995,"y":1360,"wires":[["78798de2.d967e4","862b5a67.286518"]]},{"id":"1b59b893.31aa97","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","f31e3ccd.6b57f"],"x":795,"y":1340,"wires":[["923f7478.422bc8"]]},{"id":"d6c494a5.ee1828","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1370,"y":1340,"wires":[]},{"id":"54920732.ca09e8","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":1340,"wires":[["474ba7a5.bdd248"]]},{"id":"594c9bb6.db4594","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":800,"y":1300,"wires":[]},{"id":"5e35d2a8.785bdc","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4d958d68.40b614"],"x":1535,"y":1400,"wires":[["465cd7fb.8f3788"]]},{"id":"cb849f9a.3025a","type":"http in","z":"9de255bd.0d0938","name":"iframeContainer","url":"/iframeContainer","method":"post","upload":false,"swaggerDoc":"","x":200,"y":1380,"wires":[["68a3f434.5368dc"]]},{"id":"f31e3ccd.6b57f","type":"link out","z":"9de255bd.0d0938","name":"","links":["1b59b893.31aa97"],"x":435,"y":1340,"wires":[]},{"id":"dc799fc9.e9c83","type":"link out","z":"9de255bd.0d0938","name":"","links":["f7a63b8.bb914c8"],"x":435,"y":1380,"wires":[]},{"id":"62a2fc9c.27ed34","type":"link out","z":"9de255bd.0d0938","name":"","links":["9f7f0041.06561"],"x":435,"y":1420,"wires":[]},{"id":"f007829d.c975f","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":510,"y":1380,"wires":[]},{"id":"4a97abb1.1aa204","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":520,"y":1340,"wires":[]},{"id":"e342beb3.c252c","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":510,"y":1420,"wires":[]},{"id":"923f7478.422bc8","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":900,"y":1340,"wires":[["54920732.ca09e8"]]},{"id":"68a3f434.5368dc","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":290,"y":1380,"wires":[["f31e3ccd.6b57f"],["dc799fc9.e9c83"],["62a2fc9c.27ed34"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"d395b452.3efcc8","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3360,"y":1300,"wires":[["b180cdf2.dd319"]]},{"id":"465cd7fb.8f3788","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1720,"y":1400,"wires":[["2e4f8b17.6bf574"]]},{"id":"474ba7a5.bdd248","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1220,"y":1340,"wires":[["d6c494a5.ee1828"]]},{"id":"a2a9365a.7da5c8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4d958d68.40b614","5bf8dec2.cb74a"],"x":1535,"y":1280,"wires":[["36ad4a02.3b1fc6"]]},{"id":"36ad4a02.3b1fc6","type":"function","z":"9de255bd.0d0938","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n\n       {\n              \"gadgetId\": \"c3846780-4a2e-23ef-30b4-f17297da5bda\",\n              \"gadgetName\": \"basic\",\n              \"gadgetType\": \"iframecontainer\",\n              \"gadgetData\": {\n                \"url\": \"https://innonation.nl\"\n              },\n              \"gadgetOptions\": {\n                \"disabled\": false,\n                \"style\": {\n                  \"height\": \"1000px\"\n                }\n              }\n            }\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":1280,"wires":[["757605d3.6f50ec"]]},{"id":"445579da.d716e8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4d958d68.40b614","5bf8dec2.cb74a"],"x":1535,"y":1320,"wires":[["b92e3b9c.0947d8"]]},{"id":"b92e3b9c.0947d8","type":"function","z":"9de255bd.0d0938","name":"tour","func":"\nmsg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"57f68964-88a6-609f-ac8e-80e7cfcb9dd7\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"iframecontainer\",\n  \"gadgetData\": {\n          \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    },\n    \"url\": \"https://www.youtube.com/embed/rqFE7JjptnU\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"style\": {\n      \"height\": \"400px\"\n    }\n  }\n}\n      \n      \n      \n      ]\n}\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":1320,"wires":[["1c36c499.5edeeb"]]},{"id":"3bdba2e8.aaa2ee","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4d958d68.40b614","5bf8dec2.cb74a"],"x":1535,"y":1360,"wires":[["130d798.d9f3387"]]},{"id":"130d798.d9f3387","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1720,"y":1360,"wires":[["b9343fa1.30605"]]},{"id":"5bf8dec2.cb74a","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","a2a9365a.7da5c8","9072dcf.7d0dd2","662d87cc.7d0548","48dffeab.b720a","445579da.d716e8","770e069.33327f8","3bdba2e8.aaa2ee"],"x":3415,"y":1340,"wires":[]},{"id":"bc64e18e.db3b6","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Catalog</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":1440,"wires":[["c3e3e6a9.6c4f68"]]},{"id":"76c2e066.900d1","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4d958d68.40b614"],"x":1535,"y":1440,"wires":[["bc64e18e.db3b6"]]},{"id":"5858e1af.25ac7","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3530,"y":1380,"wires":[["c83b8c8e.d05e7"]]},{"id":"757605d3.6f50ec","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2475,"y":1280,"wires":[]},{"id":"1c36c499.5edeeb","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2475,"y":1320,"wires":[]},{"id":"b9343fa1.30605","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2475,"y":1360,"wires":[]},{"id":"2e4f8b17.6bf574","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2475,"y":1400,"wires":[]},{"id":"c3e3e6a9.6c4f68","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2475,"y":1440,"wires":[]},{"id":"b180cdf2.dd319","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":3435,"y":1300,"wires":[]},{"id":"c83b8c8e.d05e7","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":3875,"y":1380,"wires":[]},{"id":"8945f4f2.6a2d78","type":"comment","z":"9921cbf1.f82328","name":"dataTable","info":"","x":220,"y":3800,"wires":[]},{"id":"bf69e9e7.49f548","type":"comment","z":"9921cbf1.f82328","name":"dataTable gagdet actions","info":"","x":3110,"y":3740,"wires":[]},{"id":"4970a6ff.6fd0f8","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2550,"y":3700,"wires":[]},{"id":"d0222e4c.a6126","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","456fac7a.693134"],"x":855,"y":3920,"wires":[["fe20d0a0.9d855","2f6a47c6.4ca4b8"]]},{"id":"d3b77095.f7b2","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var  MenuAction,resetPage, breadcrumb;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n}  else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    breadcrumb = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,resetPage, breadcrumb];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":3840,"wires":[["49471a6.1943ce4"],["77e2ab43.a07704"],["9f9967d5.7ebf58"]],"outputLabels":["MenuAction,,","resetPage","breadcrumb"]},{"id":"1e63563c.cdaeda","type":"debug","z":"9921cbf1.f82328","name":"dataTable Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3100,"y":3780,"wires":[]},{"id":"2f6a47c6.4ca4b8","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","97d713a1.82954","26c29dda.6daf62","cd9f1d1b.bf34","fed5e1fb.bd585","a9a092c5.66c4d","662d87cc.7d0548","b1cbeef4.f75aa","22a1ffea.8915a","f8623f80.4cc11","f66a0ddd.2ff05","85c4105f.6eb17","f959eb5a.b6ed38","680ba1e5.5442e","5c153a6a.8147f4","2f4d456.e9d4bba"],"x":1235,"y":3920,"wires":[]},{"id":"81071360.9b2d1","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":820,"y":3880,"wires":[]},{"id":"fe20d0a0.9d855","type":"debug","z":"9921cbf1.f82328","name":"dataTable INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":990,"y":3880,"wires":[]},{"id":"5c107447.12ffdc","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","8314881d.af5e48"],"x":3035,"y":3840,"wires":[["1e63563c.cdaeda","d3b77095.f7b2"]]},{"id":"bf0a5a3a.b65548","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","c8e25bdd.169df8"],"x":815,"y":3820,"wires":[["ce04ed1d.736ff"]]},{"id":"8d9084dd.882578","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1390,"y":3820,"wires":[]},{"id":"ff17419b.1bf4e","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":3820,"wires":[["a21321f2.4e944"]]},{"id":"b84d4795.dd2a08","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":820,"y":3780,"wires":[]},{"id":"97d713a1.82954","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8"],"x":1535,"y":4160,"wires":[["5e7f2e86.8c16b"]]},{"id":"b15a9b3d.d05728","type":"http in","z":"9921cbf1.f82328","name":"dataTable","url":"/dataTable","method":"post","upload":false,"swaggerDoc":"","x":280,"y":3860,"wires":[["181e1b91.0bcb34"]]},{"id":"c8e25bdd.169df8","type":"link out","z":"9921cbf1.f82328","name":"","links":["bf0a5a3a.b65548"],"x":555,"y":3820,"wires":[]},{"id":"456fac7a.693134","type":"link out","z":"9921cbf1.f82328","name":"","links":["d0222e4c.a6126"],"x":555,"y":3860,"wires":[]},{"id":"8314881d.af5e48","type":"link out","z":"9921cbf1.f82328","name":"","links":["5c107447.12ffdc"],"x":555,"y":3900,"wires":[]},{"id":"48a7e11e.70a4e","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":630,"y":3860,"wires":[]},{"id":"5eaf1d2a.d974a4","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":640,"y":3820,"wires":[]},{"id":"1e0b6a10.e92ef6","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":630,"y":3900,"wires":[]},{"id":"ce04ed1d.736ff","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":920,"y":3820,"wires":[["ff17419b.1bf4e"]]},{"id":"181e1b91.0bcb34","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":430,"y":3860,"wires":[["c8e25bdd.169df8"],["456fac7a.693134"],["8314881d.af5e48"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"49471a6.1943ce4","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3360,"y":3800,"wires":[["5d740b7f.232f74"]]},{"id":"5e7f2e86.8c16b","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1700,"y":4160,"wires":[["301de3a3.850acc"]]},{"id":"a21321f2.4e944","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1240,"y":3820,"wires":[["8d9084dd.882578"]]},{"id":"fed5e1fb.bd585","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":3740,"wires":[["c67846bf.d23b98"]]},{"id":"c67846bf.d23b98","type":"function","z":"9921cbf1.f82328","name":"basic","func":"msg.payload = {\n    gadgetsList:[\n  \n\n   {\n  \"gadgetId\": \"ecd8bd55-f1b4-3af9-06c0-1237755c6d04\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"data-table\",\n  \"gadgetOptions\": {\n    \"allowSearch\": false,\n    \"maxItems\": 10,\n    \"striped\": false,\n    \"export\": false,\n    \"multipleSelection\": false,\n    \"submitFilter\": false,\n    \"calculateColumns\": false,\n    \"calculateLabel\": \"Total\"\n  },\n  \"gadgetData\": {\n    \"tableColumnData\": {\n      \"columnHead\": [\n        {\n          \"title\": \"Name\",\n          \"allowSort\": true,\n          \"headKey\": \"name\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showCalculateLabel\": true\n        },\n        {\n          \"title\": \"Amount\",\n          \"allowSort\": true,\n          \"headKey\": \"amount\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": false,\n          \"filterType\": \"number\",\n          \"formatOptions\": {\n            \"decimal\": 2,\n            \"numberSymbol\": \"$\",\n            \"numberSymbolPosition\": \"before\",\n            \"decimalSymbol\": \".\",\n            \"digitGroupSymbol\": \",\",\n            \"calculationType\": \"sum\"\n          }\n        }\n      ],\n      \"columnOptions\": {\n        \"columnStyle\": {},\n        \"cellStyle\": {},\n        \"allowSort\": true\n      }\n    },\n    \"tableTitle\": \"I am test table\",\n    \"tableRowData\": [\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"John Doe\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"30\",\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n              \"min\": \"10\",\n              \"max\": \"30\"\n            }\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"John Doe\",\n          \"amount\": \"600\"\n        },\n        \"rowOptions\": {\n          \"globalClick\": true,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Jane Doe - disabled\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"50\",\n            \"editable\": true\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Jane Doe\",\n          \"amount\": \"50\"\n        },\n        \"rowOptions\": {\n          \"globalClick\": false,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Samuel Kim\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"70\",\n            \"editable\": false\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Samuel Kim\",\n          \"amount\": \"70\"\n        },\n        \"rowOptions\": {\n          \"globalClick\": true,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      }\n    ],\n    \"tableOptions\": {\n      \"mainOption\": \"global\"\n    }\n  }\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"8b1a8e9e-e528-612f-7320-8a3ad6c58281\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                     \"blockHeight\": 300\n                                },\n                              \"gadgetOptions\": {\n                  \n                                 \"copy\":true\n                              }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":3740,"wires":[["801182cf.8a99e"]]},{"id":"a9a092c5.66c4d","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":3820,"wires":[["593937fc.39af28"]]},{"id":"593937fc.39af28","type":"function","z":"9921cbf1.f82328","name":"filter__search","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n \n       {\n                  \"gadgetId\": \"dbec8692-0b20-26fe-2841-85f1d1f37fe5\",\n                  \"gadgetName\": \"filter__search\",\n                  \"gadgetType\": \"data-table\",\n                  \"gadgetOptions\": {\n                    \"allowSearch\": true,\n                    \"maxItems\": 10,\n                    \"striped\": false,\n                    \"export\": true,\n                    \"multipleSelection\": false,\n                    \"submitFilter\": false,\n          \n                  },\n                  \"gadgetData\": {\n                    \"tableColumnData\": {\n                      \"columnHead\": [\n                        {\n                          \"title\": \"Name\",\n                          \"allowSort\": true,\n                          \"headKey\": \"name\",\n                          \"hidden\": false,\n                          \"editable\": false,\n                            \"showFilter\": true,\n                              \"filterType\": \"string\",\n                        \n                        },\n                        {\n                          \"title\": \"Amount\",\n                          \"allowSort\": true,\n                          \"headKey\": \"amount\",\n                          \"hidden\": false,\n                          \"editable\": false,\n                          \"showFilter\": true,\n                          \"filterType\": \"number\",\n                          \"formatOptions\": {\n                            \"decimal\": 2,\n                            \"numberSymbol\": \"$\",\n                            \"numberSymbolPosition\": \"before\",\n                            \"decimalSymbol\": \".\",\n                            \"digitGroupSymbol\": \",\",\n                            \"calculationType\": \"sum\"\n                          }\n                        },\n                        {\n                          \"title\": \"Date\",\n                          \"allowSort\": true,\n                          \"headKey\": \"date\",\n                          \"hidden\": false,\n                          \"editable\": false,\n                          \"showFilter\": true,\n                          \"filterType\": \"date\",\n                        }\n                      ],\n                      \"columnOptions\": {\n                        \"columnStyle\": {},\n                        \"cellStyle\": {},\n                        \"allowSort\": true\n                      }\n                    },\n                    \"tableTitle\": \"I am test table\",\n                    \"tableRowData\": [\n                      {\n                        \"rowData\": [\n                          {\n                            \"headKey\": \"name\",\n                            \"type\": \"string\",\n                            \"data\": \"John Doe\",\n                            \"editable\": false\n                          },\n                          {\n                            \"headKey\": \"amount\",\n                            \"type\": \"number\",\n                            \"data\": \"600\",\n                            \"editable\": false,\n                           \n                          },\n                             {\n                            \"headKey\": \"date\",\n                            \"type\": \"date\",\n                            \"data\": \"01-01-\"+moment().year(),\n                            \"editable\": false,\n                           \n                          }\n                        ],\n                        \"rowSourceData\": {\n                          \"name\": \"John Doe\",\n                          \"amount\": \"600\",\n                          date:  \"01-01-\"+moment().year(),\n                        },\n                        \"rowOptions\": {\n                          \"globalClick\": true,\n                          \"style\": {\n                            \"width\": \"20%\"\n                          }\n                        }\n                      },\n                      {\n                        \"rowData\": [\n                          {\n                            \"headKey\": \"name\",\n                            \"type\": \"string\",\n                            \"data\": \"Jane Doe\",\n                            \"editable\": false\n                          },\n                          {\n                            \"headKey\": \"amount\",\n                            \"type\": \"number\",\n                            \"data\": \"50\",\n                            \"editable\": false\n                          },\n                            {\n                            \"headKey\": \"date\",\n                            \"type\": \"date\",\n                            \"data\": \"01-07-\"+moment().year(),\n                            \"editable\": false,\n                           \n                          }\n                        ],\n                        \"rowSourceData\": {\n                          \"name\": \"Jane Doe\",\n                          \"amount\": \"50\",\n                          date :\"01-07-\"+moment().year(),\n                        },\n                        \"rowOptions\": {\n                          \"globalClick\": true,\n                          \"style\": {\n                            \"width\": \"20%\"\n                          }\n                        }\n                      },\n                      {\n                        \"rowData\": [\n                          {\n                            \"headKey\": \"name\",\n                            \"type\": \"string\",\n                            \"data\": \"Samuel Kim\",\n                            \"editable\": false\n                          },\n                          {\n                            \"headKey\": \"amount\",\n                            \"type\": \"number\",\n                            \"data\": \"70\",\n                            \"editable\": false\n                          },\n                         {\n                            \"headKey\": \"date\",\n                            \"type\": \"date\",\n                            \"data\": \"31-12-\"+moment().year(),\n                            \"editable\": false,\n                           \n                          }\n                        ],\n                        \"rowSourceData\": {\n                          \"name\": \"Samuel Kim\",\n                          \"amount\": \"70\",\n                          date: \"31-12-\"+moment().year(),\n                        },\n                        \"rowOptions\": {\n                          \"globalClick\": true,\n                          \"style\": {\n                            \"width\": \"20%\"\n                          }\n                        }\n                      }\n                    ],\n                   \n                    \"tableOptions\": {\n                      \"mainOption\": \"global\"\n                    }\n                  }\n                }\n      \n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                                \"gadgetId\": \"a8ab05c4-1595-584a-f223-889ed4f47666\",\n  \"gadgetName\": \"filter__searchCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"filter__searchDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Filter & search\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":3820,"wires":[["ec1c3e2f.9bbc1"]]},{"id":"22a1ffea.8915a","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":4080,"wires":[["17a44036.43805"]]},{"id":"17a44036.43805","type":"function","z":"9921cbf1.f82328","name":"tour","func":"msg.payload = {\n    gadgetsList:[\n   \n    {\n  \"gadgetId\": \"d38d5bcd-0b29-3ee1-5d97-a70ac009c72d\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"data-table\",\n  \"gadgetOptions\": {\n    \"allowSearch\": false,\n    \"maxItems\": 10,\n    \"striped\": false,\n    \"export\": false,\n    \"multipleSelection\": false,\n    \"submitFilter\": false,\n    \"calculateColumns\": false,\n    \"calculateLabel\": \"Total\"\n  },\n  \"gadgetData\": {\n    \"tableColumnData\": {\n      \"columnHead\": [\n        {\n            tour:{\n                      content:\"Tour table column, bottom placement\",\n                      title :\"Tour table column, bottom placement\",\n                      priority:2,\n                      placement :\"bottom\"\n                  },\n          \"title\": \"Name\",\n          \"allowSort\": true,\n          \"headKey\": \"name\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showCalculateLabel\": true\n        },\n        {\n          \"title\": \"Amount\",\n          \"allowSort\": true,\n          \"headKey\": \"amount\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": false,\n          \"filterType\": \"number\",\n          \"formatOptions\": {\n            \"decimal\": 2,\n            \"numberSymbol\": \"$\",\n            \"numberSymbolPosition\": \"before\",\n            \"decimalSymbol\": \".\",\n            \"digitGroupSymbol\": \",\",\n            \"calculationType\": \"sum\"\n          }\n        }\n      ],\n      \"columnOptions\": {\n        \"columnStyle\": {},\n        \"cellStyle\": {},\n        \"allowSort\": true\n      }\n    },\n    \"tableTitle\": \"Tour\",\n    \"tableRowData\": [\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"John Doe\",\n            \"editable\": false\n          },\n          {\n                tour:{\n                      content:\"Tour table row >> CELL, top placement\",\n                      title :\"Tour table row  >> CELL, top placement\",\n                      priority:4,\n                      placement :\"top\"\n                  },\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"30\",\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n              \"min\": \"10\",\n              \"max\": \"30\"\n            }\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"John Doe\",\n          \"amount\": \"600\"\n        },\n        \"rowOptions\": {\n            tour:{\n                      content:\"Tour table row, right placement\",\n                      title :\"Tour table tow, right placement\",\n                      priority:3,\n                      placement :\"right\"\n                  },\n          \"globalClick\": true,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Jane Doe - disabled\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"50\",\n            \"editable\": true\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Jane Doe\",\n          \"amount\": \"50\"\n        },\n        \"rowOptions\": {\n          \"globalClick\": false,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Samuel Kim\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"70\",\n            \"editable\": false\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Samuel Kim\",\n          \"amount\": \"70\"\n        },\n        \"rowOptions\": {\n          \"globalClick\": true,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      }\n    ],\n        \"tableButton\": [\n        {\n        \"buttonData\": {\n          \"title\": \"Global action\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"select\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"Global action\",\n          \"type\": \"danger\",\n          \"actionType\": \"button\",\n          \"multipleSelection\": false,\n          \"clickType\": \"global\",\n          tour:{\n                      content:\"Tour table MAIN >> Button, left placement\",\n                      title :\"Tour table MAIN >> Button, left placement\",\n                      priority:5,\n                      placement :\"left\"\n                  },\n          \n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      },\n    ],\n    \"tableOptions\": {\n      \"mainOption\": \"global\"\n    },\n     tour:{\n                      content:\"Tour table MAIN, left placement\",\n                      title :\"Tour table MAIN, left placement\",\n                      priority:1,\n                      placement :\"left\"\n                  },\n    \n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"f4017a35-7604-ecfd-557d-13aea3691900\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4080,"wires":[["3d850f78.91703"]]},{"id":"f8623f80.4cc11","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":3780,"wires":[["70ddb54f.45484c"]]},{"id":"70ddb54f.45484c","type":"function","z":"9921cbf1.f82328","name":"buttons","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"9323fbb8-9fd3-3c71-f4bd-41f0e77dd118\",\n  \"gadgetName\": \"Buttons\",\n  \"gadgetType\": \"data-table\",\n  \"gadgetOptions\": {\n    \"allowSearch\": true,\n    \"maxItems\": 10,\n    \"striped\": false,\n    \"export\": true,\n    \"multipleSelection\": true,\n    \"submitFilter\": false,\n    \"calculateColumns\": true,\n    \"calculateLabel\": \"Total\"\n  },\n  \"gadgetData\": {\n    \"tableColumnData\": {\n      \"columnHead\": [\n        {\n          \"title\": \"Name\",\n          \"allowSort\": true,\n          \"headKey\": \"name\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showCalculateLabel\": true\n        },\n        {\n          \"title\": \"Amount\",\n          \"allowSort\": true,\n          \"headKey\": \"amount\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": true,\n          \"filterType\": \"number\",\n          \"formatOptions\": {\n            \"decimal\": 2,\n            \"numberSymbol\": \"$\",\n            \"numberSymbolPosition\": \"before\",\n            \"decimalSymbol\": \".\",\n            \"digitGroupSymbol\": \",\",\n            \"calculationType\": \"sum\"\n          }\n        }\n      ],\n      \"columnOptions\": {\n        \"columnStyle\": {},\n        \"cellStyle\": {},\n        \"allowSort\": true\n      }\n    },\n    \"tableTitle\": \"Buttons\",\n    \"tableRowData\": [\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"John Doe\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"30\",\n            \"editable\": true,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n              \"min\": \"10\",\n              \"max\": \"30\"\n            }\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"John Doe\",\n          \"amount\": \"600\"\n        },\n        \"rowOptions\": {\n          \"globalClick\": false,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Jane Doe\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"50\",\n            \"editable\": true\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Jane Doe\",\n          \"amount\": \"50\"\n        },\n        \"rowOptions\": {\n          \"globalClick\": false,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Samuel Kim\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"70\",\n            \"editable\": true\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Samuel Kim\",\n          \"amount\": \"70\"\n        },\n        \"rowOptions\": {\n          \"globalClick\": false,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      }\n    ],\n    \"tableButton\": [\n              {\n        \"buttonData\": {\n          \"title\": \"Select single\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"select\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"Select single\",\n          \"type\": \"primary\",\n          \"actionType\": \"button\",\n          \"multipleSelection\": false,\n          \"clickType\": \"row\",\n          \n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      },\n                    {\n        \"buttonData\": {\n          \"title\": \"Select multiple\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"select\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"Select multiple\",\n          \"type\": \"primary\",\n          \"actionType\": \"button\",\n          \"multipleSelection\": true,\n          \"clickType\": \"row\",\n          \n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      },\n      {\n        \"buttonData\": {\n          \"title\": \"Select - form\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"edit\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"Select - form\",\n          \"type\": \"warning\",\n          \"actionType\": \"form\",\n          \"form\": {\n            \"gadget\": {\n              \"gadgetData\": {\n                \"canceled\": false,\n                \"id\": \"mockdataFOrm10\",\n                \"nextButtonText\": \"Submit\",\n                \"showPrevious\": \"\",\n                \"submitButtonText\": \"Submit\",\n                \"title\": \"\",\n                \"organization_id\": \"\",\n                \"steps\": [\n                  {\n                    \"fields\": [\n                      {\n                        \"htmlTag\": \"input\",\n                        \"name\": \"sample\",\n                        \"options\": {\n                          \"label\": \"Input\",\n                          \"placeholder\": \"Sample\",\n                          \"required\": true,\n                          \"type\": \"text\",\n                          \"value\": \"\",\n                          \"min\": \"\",\n                          \"max\": \"\",\n                          \"preview\": \"\",\n                          \"disabled\": false,\n                          \"previewPosition\": \"\",\n                          \"info\": \"Hello info\"\n                        }\n                      }\n                    ]\n                  }\n                ]\n              },\n             \n            },\n            \"values\": {\n              \"sample\": \"mapped formField value\"\n            }\n          },\n          \"multipleSelection\": false,\n          \"clickType\": \"row\",\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      },\n                          {\n        \"buttonData\": {\n          \"title\": \"Global action\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"select\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"Global action\",\n          \"type\": \"danger\",\n          \"actionType\": \"button\",\n          \"multipleSelection\": false,\n          \"clickType\": \"global\",\n          \n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      },\n    ],\n    \"tableOptions\": {\n      \"mainOption\": \"CRUD\"\n    }\n  }\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"73dc6735-b87f-9edb-e978-5a45b4b123cb\",\n  \"gadgetName\": \"basicOptions\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                             \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n})\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"BasicOptionsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Buttons\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":3780,"wires":[["6a7e08f8.31cd78"]]},{"id":"f66a0ddd.2ff05","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":4120,"wires":[["2004e17d.74700e"]]},{"id":"2004e17d.74700e","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":4120,"wires":[["dcc2081a.d9e0f8"]]},{"id":"77e2ab43.a07704","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","fed5e1fb.bd585","a9a092c5.66c4d","662d87cc.7d0548","b1cbeef4.f75aa","22a1ffea.8915a","f8623f80.4cc11","f66a0ddd.2ff05","85c4105f.6eb17","f959eb5a.b6ed38","680ba1e5.5442e","5c153a6a.8147f4","2f4d456.e9d4bba"],"x":3315,"y":3840,"wires":[]},{"id":"85c4105f.6eb17","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":4200,"wires":[["f0d2615f.4a9c1"]]},{"id":"f0d2615f.4a9c1","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"708ad058-fbae-ef60-9bfb-8c211ad668f5\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Data table</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4200,"wires":[["af681287.bfb6a"]]},{"id":"9f9967d5.7ebf58","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"e0811593-2879-9c1d-d423-64392a45c7ac\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3430,"y":3880,"wires":[["49687849.1dcea8"]]},{"id":"801182cf.8a99e","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":3740,"wires":[]},{"id":"6a7e08f8.31cd78","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":3780,"wires":[]},{"id":"ec1c3e2f.9bbc1","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":3820,"wires":[]},{"id":"3d850f78.91703","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":4080,"wires":[]},{"id":"dcc2081a.d9e0f8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":4120,"wires":[]},{"id":"301de3a3.850acc","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":4160,"wires":[]},{"id":"af681287.bfb6a","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":4200,"wires":[]},{"id":"49687849.1dcea8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3575,"y":3880,"wires":[]},{"id":"5d740b7f.232f74","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":3435,"y":3800,"wires":[]},{"id":"f959eb5a.b6ed38","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":3860,"wires":[["1007bea.6ba1a41"]]},{"id":"1007bea.6ba1a41","type":"function","z":"9921cbf1.f82328","name":"design","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n \n\n       {\n  \"gadgetId\": \"a5d2c70d-24e6-8d9f-41db-378158f1ca7b\",\n  \"gadgetName\": \"design\",\n  \"gadgetType\": \"data-table\",\n  \"gadgetOptions\": {\n    \"allowSearch\": true,\n    \"maxItems\": 10,\n    \"striped\": true,\n    \"export\": true,\n    \"multipleSelection\": false,\n    \"submitFilter\": false,\n    \"calculateColumns\": true,\n    \"calculateLabel\": \"Total\"\n  },\n  \"gadgetData\": {\n    \"tableColumnData\": {\n      \"columnHead\": [\n        {\n          \"title\": \"Name\",\n          \"allowSort\": true,\n          \"headKey\": \"name\",\n          \"hidden\": false,\n          \"editable\": false,\n          info:\"Plane text tooltip content\",\n        showCalculateLabel : true\n        },\n        {\n          \"title\": \"Amount\",\n          \"allowSort\": true,\n          \"headKey\": \"amount\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": true,\n          \"filterType\": \"number\",\n          info:'<p>HTML <em>text</em> <strong>tooltip</strong> <span style=\"text-decoration: underline;\">content</span></p>',\n          \"formatOptions\": {\n            \"decimal\": 2,\n            \"numberSymbol\": \"$\",\n            \"numberSymbolPosition\": \"before\",\n            \"decimalSymbol\": \".\",\n            \"digitGroupSymbol\": \",\",\n            \"calculationType\": \"sum\"\n          }\n        },\n        {\n          \"title\": \"Date\",\n          \"allowSort\": true,\n          \"headKey\": \"date\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": true,\n          \"filterType\": \"date\",\n           info:'<p>The main navigation is offered via the breadcrumb gadget.</p><p>It provides you:</p><ol><li>Insights in your current view/focus</li><li>the ability to navigate to other entities within the application</li><li>the possibility to trigger actions on the current active entity, action like:</li></ol><table style=\"height: 171px; margin-left: 30px; width: 530px;\"><tbody><tr style=\"height: 3px;\"><td style=\"width: 31px; height: 3px;\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAFqADAAQAAAABAAAAFgAAAAA/6RFgAAABxklEQVQ4EWNki331n4EGgIkGZoKNHDUYHrJDLyhY4G7HwxDjYWIwkGVmkOBnYrj76h/DhSd/GL7+wp9K8RosJ8jE0BTMxRBizcHAyswIt/rDl38Ms3Z/Z2jZ/I3h5x+4MAoDZxjrSDIz7K8TYIi042S4/fQvQ9r0TwzyOW8Z6pd/Yfj7j4GhLJCbYWsxPwMfB8JCZJOxGszCzMCwPJ+fQUYYyACCzDmfGUyUWBgO1QswvAG6dvK2b2BxW202hgnR3GA2OoHV4GgzdgY1KYiht579ZXj1+T9DmjsXg7woM0NZADfD/CM/4eZE2HIyyApgGoMpAtSy5dIvBlA4goCSODPDn3//GS4+gATmznM/Gdy1WcFyIOLkzV8Mjz9A1MIFgQyskff263+G3HmfGeZm8TGwsTAydIZzM4T0f2RgYWJkEONlZJiewgs24/n7vww5878gmwdnM+Ir3byBLuuJ52VQkgC6+i8Dw72Xf+FBdPT6L4a02V8Y7rwBSmABeA0GqWcCBlawIRuDgTwrgygfI8OjN/8YDt34zXDozm8sxiGECBqMUEoaC2vkkWYEdtU0MxgY57QBLIzobqaSTSycLPhLKXL9AwAVSn1Ntm+TtAAAAABJRU5ErkJggg==\" alt=\"view\" /></td><td style=\"width: 425px; height: 3px;\"><strong>&nbsp;view,&nbsp;information about the active entity</strong></td></tr><tr style=\"height: 18px;\"><td style=\"width: 31px; height: 18px;\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAF6ADAAQAAAABAAAAFgAAAAC4T9ojAAAA6UlEQVQ4EWPUOJ7/n4FGgIlG5oKNHTUca+gOjmBhYWRiEGblwepCXIJEu1yRXYRho14ZLnOwihNtOFbdBARpajgLPss9BfUZqpWCwUqYGZkZ+Ji5GI4YN8G1+F/qYnj7+wucj85gxJf9eZjZGSRZ+cF65DhEGVpUohjirkyEm3H/5xuGP///wfnoDLwu//L3J8Ptv6/gev7+/8tw+weCD5fAwaBpmBNt+PPfHxla763F4UbswkQbDgqi7e8vYjcFhyjRhuPQj1eYpoazMOK1mzJJFiYG2hnPwsaIN6lT5HQWHkZ2igzApxkAihItES/ovTIAAAAASUVORK5CYII=\" alt=\"Create\" /></td><td style=\"width: 425px; height: 18px;\"><strong>&nbsp;create</strong>, a new entity&nbsp;</td></tr><tr style=\"padding-left: 30px; height: 18px;\"><td style=\"width: 31px; height: 18px;\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAF6ADAAQAAAABAAAAFwAAAACFL/OTAAABAElEQVRIDWP8P9/5PwONABONzAUbO2o41tAdpMHCxofVtciC5LncIImBIXwVA4OsLbJZGGzSDRfVYWD49YWBgZmFgcGhmoEBjw+AKkgABskMDAaRDAyn5zAwnJoFNJgHaNEnnAYQ73KYwSCjTFMYGF5fY2C4MA+nwSAJ4gxHNhik68JyoOFXQCy8gLDh2Ay+MBevoTBJ/IZTYDDIAtyGKzhBIg/mDFBQEOlimBbchnMIwNRAwphEg0GacSfFFxcZGE5MY2D48YGB4cE+hEUksHAb/uEuAwMIUwBwBwsFhsK0Al3OCGNTnWb5z0g7x7P8Z8Id7JR6heU/CzelZuDUDwBR1jNVjS1hCwAAAABJRU5ErkJggg==\" alt=\"edit\" /></td><td style=\"width: 425px; height: 18px;\"><strong>&nbsp;edit</strong>, information of the active entity</td></tr><tr style=\"padding-left: 30px; height: 18px;\"><td style=\"width: 31px; height: 18px;\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAFaADAAQAAAABAAAAFQAAAAAr0zA0AAAA4UlEQVQ4EeVSMRKCMBDcYFBrWx1a/AF+QWt9mRaOL0EfQKMlTxBnsAFHBpQhiQri6JhgQ6Omutvb2yR7R/bjiUDNR6tZL5f7c1H60VNCQHvdK41ApCmY739sUYrqpon2aIhGpwO93y+EuMB5s4bIMkTzBUQSSy9QivIoAtt6YLsdUtd9bc4YwLJX7ClTijLPQ2tggRrGE70I4+Uqt+KtcAf+fKV+5Pv8cJAOWIShFC9B5UrdCMfpDE3LAtFIyQePE6SO88hlQaUoDwKcbFvWV4l9z6AotPofSwWttLXSO1XxAg7oQr8helFzAAAAAElFTkSuQmCC\" alt=\"view\" /></td><td style=\"width: 425px; height: 18px;\"><strong>&nbsp;remove</strong>, the active entity</td></tr></tbody></table><p>&nbsp;</p>',\n                       \n        }\n      ],\n      \"columnOptions\": {\n        \"columnStyle\": {},\n        \"cellStyle\": {},\n        \"allowSort\": true\n      }\n    },\n    \"tableTitle\": \"I am test table >> Design\",\n    \"tableRowData\": [\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"John Doe\",\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": false,\n            \n            }\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"30\",\n            \"editable\": false,\n            \"options\": {\n              \"bold\": false,\n              \"italic\": true,\n            \n            }\n          },\n           {\n            \"headKey\": \"date\",\n            \"type\": \"date\",\n            \"data\": \"01-01-\"+moment().year(),\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n             \n            }\n          }\n        ],\n       \n        \"rowOptions\": {\n          \"globalClick\": true,\n          state:\"success\",\n          \"style\": {\n            \"width\": \"50%\",\n             \"text-align\": \"left\",\n             \"color\":\"black\"\n        \n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Jane Doe\",\n            \"editable\": false,\n             \"options\": {\n              \"bold\": true,\n              \"italic\": false,\n            \n            }\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"50\",\n            \"editable\": true,\n             \"options\": {\n              \"bold\": false,\n              \"italic\": true,\n            \n            }\n          },\n           {\n            \"headKey\": \"date\",\n            \"type\": \"date\",\n            \"data\": \"01-07-\"+moment().year(),\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n             \n            }\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Jane Doe\",\n          \"amount\": \"50\",\n          \"date\": \"01-07-\"+moment().year(),\n        },\n        \"rowOptions\": {\n          \"globalClick\": true,\n            state:\"warning\",\n          \"style\": {\n            \"text-align\": \"right\",\n             \"color\":\"gray\",\n            \"width\": \"70%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Samuel Kim\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"70\",\n            \"editable\": false\n          },\n           {\n            \"headKey\": \"date\",\n            \"type\": \"date\",\n            \"data\": \"31-12-\"+moment().year(),\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n             \n            }\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Samuel Kim\",\n          \"amount\": \"70\",\n           \"date\": \"31-12-\"+moment().year(),\n        },\n        \"rowOptions\": {\n          \"globalClick\": true,\n          \"style\": {\n            \"width\": \"10%\",\n            \"text-align\": \"right\",\n             \"color\":\"green\"\n          }\n        }\n      }\n    ],\n\n    \"tableOptions\": {\n      \"mainOption\": \"global\"\n    }\n  }\n}\n      \n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"9a087433-9e18-6c38-7ff0-c8f7ced57e5e\",\n                              \"gadgetName\": \"designCode\",\n                              \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"c344f9a5-77ba-45c5-f39a-e28e5ce9ddb1\",\n                              \"gadgetName\": \"designDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Design\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":3860,"wires":[["a59a76bb.e199c8"]]},{"id":"a59a76bb.e199c8","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":3860,"wires":[]},{"id":"680ba1e5.5442e","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":3900,"wires":[["9497f7df.0e11e8"]]},{"id":"9497f7df.0e11e8","type":"function","z":"9921cbf1.f82328","name":"Advanced","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n \n\n\n       {\n  \"gadgetId\": \"eb805b9f-071c-c03b-729b-433c92a1efce\",\n  \"gadgetName\": \"advanced\",\n  \"gadgetType\": \"data-table\",\n  \"gadgetOptions\": {\n    \"allowSearch\": true,\n    \"maxItems\": 10,\n    \"striped\": true,\n    \"export\": true,\n    \"multipleSelection\": false,\n    \"submitFilter\": false,\n    \"calculateColumns\": true,\n    \"calculateLabel\": \"Total\"\n  },\n  \"gadgetData\": {\n    \"tableColumnData\": {\n      \"columnHead\": [\n        {\n          \"title\": \"Name\",\n          \"allowSort\": true,\n          \"headKey\": \"name\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showCalculateLabel\": true\n        },\n        {\n          \"title\": \"Amount\",\n          \"allowSort\": true,\n          \"headKey\": \"amount\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": true,\n          \"filterType\": \"number\",\n          \"formatOptions\": {\n            \"decimal\": 2,\n            \"numberSymbol\": \"$\",\n            \"numberSymbolPosition\": \"before\",\n            \"decimalSymbol\": \".\",\n            \"digitGroupSymbol\": \",\",\n            \"calculationType\": \"sum\"\n          }\n        },\n         {\n          \"title\": \"Date\",\n          \"allowSort\": true,\n          \"headKey\": \"date\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": true,\n          \"filterType\": \"date\",\n           info:'<p>The main navigation is offered via the breadcrumb gadget.</p><p>It provides you:</p><ol><li>Insights in your current view/focus</li><li>the ability to navigate to other entities within the application</li><li>the possibility to trigger actions on the current active entity, action like:</li></ol><table style=\"height: 171px; margin-left: 30px; width: 530px;\"><tbody><tr style=\"height: 3px;\"><td style=\"width: 31px; height: 3px;\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAFqADAAQAAAABAAAAFgAAAAA/6RFgAAABxklEQVQ4EWNki331n4EGgIkGZoKNHDUYHrJDLyhY4G7HwxDjYWIwkGVmkOBnYrj76h/DhSd/GL7+wp9K8RosJ8jE0BTMxRBizcHAyswIt/rDl38Ms3Z/Z2jZ/I3h5x+4MAoDZxjrSDIz7K8TYIi042S4/fQvQ9r0TwzyOW8Z6pd/Yfj7j4GhLJCbYWsxPwMfB8JCZJOxGszCzMCwPJ+fQUYYyACCzDmfGUyUWBgO1QswvAG6dvK2b2BxW202hgnR3GA2OoHV4GgzdgY1KYiht579ZXj1+T9DmjsXg7woM0NZADfD/CM/4eZE2HIyyApgGoMpAtSy5dIvBlA4goCSODPDn3//GS4+gATmznM/Gdy1WcFyIOLkzV8Mjz9A1MIFgQyskff263+G3HmfGeZm8TGwsTAydIZzM4T0f2RgYWJkEONlZJiewgs24/n7vww5878gmwdnM+Ir3byBLuuJ52VQkgC6+i8Dw72Xf+FBdPT6L4a02V8Y7rwBSmABeA0GqWcCBlawIRuDgTwrgygfI8OjN/8YDt34zXDozm8sxiGECBqMUEoaC2vkkWYEdtU0MxgY57QBLIzobqaSTSycLPhLKXL9AwAVSn1Ntm+TtAAAAABJRU5ErkJggg==\" alt=\"view\" /></td><td style=\"width: 425px; height: 3px;\"><strong>&nbsp;view,&nbsp;information about the active entity</strong></td></tr><tr style=\"height: 18px;\"><td style=\"width: 31px; height: 18px;\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAF6ADAAQAAAABAAAAFgAAAAC4T9ojAAAA6UlEQVQ4EWPUOJ7/n4FGgIlG5oKNHTUca+gOjmBhYWRiEGblwepCXIJEu1yRXYRho14ZLnOwihNtOFbdBARpajgLPss9BfUZqpWCwUqYGZkZ+Ji5GI4YN8G1+F/qYnj7+wucj85gxJf9eZjZGSRZ+cF65DhEGVpUohjirkyEm3H/5xuGP///wfnoDLwu//L3J8Ptv6/gev7+/8tw+weCD5fAwaBpmBNt+PPfHxla763F4UbswkQbDgqi7e8vYjcFhyjRhuPQj1eYpoazMOK1mzJJFiYG2hnPwsaIN6lT5HQWHkZ2igzApxkAihItES/ovTIAAAAASUVORK5CYII=\" alt=\"Create\" /></td><td style=\"width: 425px; height: 18px;\"><strong>&nbsp;create</strong>, a new entity&nbsp;</td></tr><tr style=\"padding-left: 30px; height: 18px;\"><td style=\"width: 31px; height: 18px;\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAF6ADAAQAAAABAAAAFwAAAACFL/OTAAABAElEQVRIDWP8P9/5PwONABONzAUbO2o41tAdpMHCxofVtciC5LncIImBIXwVA4OsLbJZGGzSDRfVYWD49YWBgZmFgcGhmoEBjw+AKkgABskMDAaRDAyn5zAwnJoFNJgHaNEnnAYQ73KYwSCjTFMYGF5fY2C4MA+nwSAJ4gxHNhik68JyoOFXQCy8gLDh2Ay+MBevoTBJ/IZTYDDIAtyGKzhBIg/mDFBQEOlimBbchnMIwNRAwphEg0GacSfFFxcZGE5MY2D48YGB4cE+hEUksHAb/uEuAwMIUwBwBwsFhsK0Al3OCGNTnWb5z0g7x7P8Z8Id7JR6heU/CzelZuDUDwBR1jNVjS1hCwAAAABJRU5ErkJggg==\" alt=\"edit\" /></td><td style=\"width: 425px; height: 18px;\"><strong>&nbsp;edit</strong>, information of the active entity</td></tr><tr style=\"padding-left: 30px; height: 18px;\"><td style=\"width: 31px; height: 18px;\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAFaADAAQAAAABAAAAFQAAAAAr0zA0AAAA4UlEQVQ4EeVSMRKCMBDcYFBrWx1a/AF+QWt9mRaOL0EfQKMlTxBnsAFHBpQhiQri6JhgQ6Omutvb2yR7R/bjiUDNR6tZL5f7c1H60VNCQHvdK41ApCmY739sUYrqpon2aIhGpwO93y+EuMB5s4bIMkTzBUQSSy9QivIoAtt6YLsdUtd9bc4YwLJX7ClTijLPQ2tggRrGE70I4+Uqt+KtcAf+fKV+5Pv8cJAOWIShFC9B5UrdCMfpDE3LAtFIyQePE6SO88hlQaUoDwKcbFvWV4l9z6AotPofSwWttLXSO1XxAg7oQr8helFzAAAAAElFTkSuQmCC\" alt=\"view\" /></td><td style=\"width: 425px; height: 18px;\"><strong>&nbsp;remove</strong>, the active entity</td></tr></tbody></table><p>&nbsp;</p>',\n                       \n        },\n         {\n          \"title\": \"Array\",\n          \"allowSort\": true,\n          \"headKey\": \"array\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": true,\n          \"filterType\": \"array\",\n           info:'Array column'      \n        },\n                {\n          \"title\": \"Button\",\n          \"allowSort\": true,\n          \"headKey\": \"button\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showFilter\": true,\n          \"filterType\": \"button\",\n           info:'Button column'      \n        }\n      ],\n      \"columnOptions\": {\n        \"columnStyle\": {},\n        \"cellStyle\": {},\n        \"allowSort\": true\n      }\n    },\n    \"tableTitle\": \"I am test table\",\n    \"tableRowData\": [\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"John Doe Amount(min:10 | max:30) && date(min:\"+\"01-01-\"+ Number(moment().year() - 1)+\" | max:\"+\"01-01-\"+ Number(moment().year()+1 )+\")\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"30\",\n            \"editable\": true,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n              \"min\": \"10\",\n              \"max\": \"30\"\n            }\n          },\n           {\n            \"headKey\": \"date\",\n            \"type\": \"date\",\n            \"data\": \"01-01-\"+moment().year(),\n            \"editable\": true,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n              \"min\":  \"01-01-\"+ Number(moment().year() - 1),\n              \"max\": \"01-01-\"+ Number(moment().year()+1 ),\n             \n            }\n          },\n           {\n            \"headKey\": \"array\",\n            \"type\": \"array\",\n            \"data\": [1,2,3,4,5,6,7,8,9],\n            \"editable\": true,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true\n            }\n          },\n                    {\n            \"headKey\": \"button\",\n            \"type\": \"button\",\n            \"data\": \"button\",\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true\n            }\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"John Doe Amount(min:10 | max:30) && date(min:\"+\"01-01-\"+ Number(moment().year() - 1)+\" | max:\"+\"01-01-\"+ Number(moment().year()+1 )+\")\",\n          \"amount\": \"30\",\n          date:\"01-01-\"+moment().year(),\n        },\n        \"rowOptions\": {\n          \"globalClick\": false,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Jane Doe (min:1 | max:100) && date(min:\"+\"01-07-\"+ Number(moment().year() - 1)+\" | max:\"+\"01-07-\"+ Number(moment().year()+1 )+\")\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"50\",\n            \"options\": {\n              \"bold\": false,\n              \"italic\": true,\n              \"min\": \"1\",\n              \"max\": \"100\"\n            },\n            \"editable\": true\n          },\n           {\n            \"headKey\": \"date\",\n            \"type\": \"date\",\n            \"data\": \"01-07-\"+moment().year(),\n            \"editable\": true,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n              \"min\":  \"01-07-\"+ Number(moment().year() - 1),\n              \"max\": \"01-07-\"+ Number(moment().year()+1 ),\n             \n            }\n          },\n           {\n            \"headKey\": \"array\",\n            \"type\": \"array\",\n            \"data\": ['<p><strong><span style=\"color: #ff6600;\">1</span></strong> t<strong>e</strong><span style=\"text-decoration: underline;\">x</span><em>t</em></p>','<p><strong><span style=\"color: #ff6600;\">2</span></strong> t<strong>e</strong><span style=\"text-decoration: underline;\">x</span><em>t</em></p>','<p><strong><span style=\"color: #ff6600;\">3</span></strong> t<strong>e</strong><span style=\"text-decoration: underline;\">x</span><em>t</em></p>','<p><strong><span style=\"color: #ff6600;\">4</span></strong> t<strong>e</strong><span style=\"text-decoration: underline;\">x</span><em>t</em></p>'],\n            \"editable\": true,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true\n            }\n          },\n          {\n            \"headKey\": \"button\",\n            \"type\": \"button\",\n            \"data\": \"button\",\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true\n            }\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\": \"Jane Doe (min:1 | max:100) && date(min:\"+\"01-07-\"+ Number(moment().year() - 1)+\" | max:\"+\"01-07-\"+ Number(moment().year()+1 )+\")\",\n          \"amount\": \"50\",\n          date:\"01-07-\"+moment().year(),\n        },\n        \"rowOptions\": {\n          \"globalClick\": false,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      },\n      {\n        \"rowData\": [\n          {\n            \"headKey\": \"name\",\n            \"type\": \"string\",\n            \"data\": \"Samuel Kim (min:100 | max:10000) && date(min:\"+\"31-12-\"+ Number(moment().year() - 1)+\" | max:\"+\"31-12-\"+ Number(moment().year()+1 )+\")\",\n            \"editable\": false\n          },\n          {\n            \"headKey\": \"amount\",\n            \"type\": \"number\",\n            \"data\": \"70\",\"options\": {\n              \"bold\": true,\n              \"italic\": false,\n              \"min\": \"100\",\n              \"max\": \"10000\"\n            },\n            \"editable\": true\n          },\n            {\n            \"headKey\": \"date\",\n            \"type\": \"date\",\n            \"data\": \"31-12-\"+moment().year(),\n            \"editable\": true,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true,\n              \"min\":  \"31-12-\"+ Number(moment().year() - 1),\n              \"max\": \"31-12-\"+ Number(moment().year()+1 ),\n             \n            }\n          },\n           {\n            \"headKey\": \"array\",\n            \"type\": \"array\",\n            \"data\": [\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\"],\n            \"editable\": true,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true\n            }\n          },\n                    {\n            \"headKey\": \"button\",\n            \"type\": \"button\",\n            \"data\": \"button\",\n            \"editable\": false,\n            \"options\": {\n              \"bold\": true,\n              \"italic\": true\n            }\n          }\n        ],\n        \"rowSourceData\": {\n          \"name\":  \"Samuel Kim (min:100 | max:10000) && date(min:\"+\"31-12-\"+ Number(moment().year() - 1)+\" | max:\"+\"31-12-\"+ Number(moment().year()+1 )+\")\",\n          \"amount\": \"70\",\n          \"date\": \"31-12-\"+moment().year(),\n        },\n        \"rowOptions\": {\n          \"globalClick\": false,\n          \"style\": {\n            \"width\": \"20%\"\n          }\n        }\n      }\n    ],\n    \"tableButton\": [\n      {\n        \"buttonData\": {\n          \"title\": \"Edit\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"fa\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"edit\",\n          \"type\": \"warning\",\n          \"actionType\": \"form\",\n          \"form\": {\n            \"gadget\": {\n              \"gadgetData\": {\n                \"canceled\": false,\n                \"id\": \"mockdataFOrm10\",\n                \"nextButtonText\": \"Submit\",\n                \"showPrevious\": \"\",\n                \"submitButtonText\": \"Submit\",\n                \"title\": \"\",\n                \"organization_id\": \"\",\n                \"steps\": [\n                  {\n                    \"fields\": [\n                      {\n                        \"htmlTag\": \"input\",\n                        \"name\": \"amount\",\n                        \"options\": {\n                          \"label\": \"Sample Input\",\n                          \"placeholder\": \"Sample Inpu\",\n                          \"required\": true,\n                          \"type\": \"text\",\n                          \"value\": \"\",\n                          \"min\": \"\",\n                          \"max\": \"\",\n                          \"preview\": \"\",\n                          \"disabled\": false,\n                          \"previewPosition\": \"\",\n                          \"info\": \"Hello info\"\n                        }\n                      }\n                    ]\n                  }\n                ]\n              },\n           \n            },\n            \"values\": {\n              \"amount\": \"input value\"\n            }\n          },\n          \"multipleSelection\": false,\n          \"clickType\": \"selected\",\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      }\n    ],\n    \"tableOptions\": {\n      \"mainOption\": \"CRUD\"\n    }\n  }\n}\n      \n      \n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"f70ebd01-4ed8-2b7c-7e29-918fcb2a43f7\",\n                              \"gadgetName\": \"advancedCode\",\n                              \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"1c60f788-c457-512a-a88a-c2e1c5c0e352\",\n                              \"gadgetName\": \"advancedDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Advanced\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":3900,"wires":[["552cf154.0c851"]]},{"id":"552cf154.0c851","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":3900,"wires":[]},{"id":"34955c7d.892cc4","type":"comment","z":"d8703926.e2eca","name":"actionButton","info":"","x":190,"y":2480,"wires":[]},{"id":"e6281b3e.b49b78","type":"comment","z":"d8703926.e2eca","name":"actionButton gagdet actions","info":"","x":2900,"y":2440,"wires":[]},{"id":"ba94e4d0.9900f8","type":"comment","z":"d8703926.e2eca","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2510,"y":2380,"wires":[]},{"id":"801881b9.c887c","type":"link in","z":"d8703926.e2eca","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","d065db2d.d748c8"],"x":815,"y":2600,"wires":[["ff46d30.12df93","2fe211f8.74685e"]]},{"id":"abb8f122.bd596","type":"function","z":"d8703926.e2eca","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":2520,"wires":[["428ca9f5.4dd788"],["e3a4dd43.1f6c"],["d607a019.6a2e8"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"33ddba31.c7e0e6","type":"debug","z":"d8703926.e2eca","name":"actionButton Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3150,"y":2460,"wires":[]},{"id":"ff46d30.12df93","type":"link out","z":"d8703926.e2eca","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","8e17cf6d.114fb","26c29dda.6daf62","cd9f1d1b.bf34","c934f329.b80a1","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","46804763.7055f8","7030c515.504b2c","1cfe33a7.9a9b6c","7ce6b472.896cfc","cf419bc2.c861c8"],"x":1195,"y":2600,"wires":[]},{"id":"dbc433d0.00315","type":"comment","z":"d8703926.e2eca","name":"INIT FLOW","info":"","x":780,"y":2560,"wires":[]},{"id":"2fe211f8.74685e","type":"debug","z":"d8703926.e2eca","name":"actionButton INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":960,"y":2560,"wires":[]},{"id":"113a4dcb.26f182","type":"link in","z":"d8703926.e2eca","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","c44dc296.1514d"],"x":2975,"y":2520,"wires":[["33ddba31.c7e0e6","abb8f122.bd596"]]},{"id":"9f7bef43.a7dc3","type":"link in","z":"d8703926.e2eca","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","5ec4ef91.e491e"],"x":775,"y":2500,"wires":[["3798760d.1712aa"]]},{"id":"8926420f.4628c","type":"http response","z":"d8703926.e2eca","name":"","statusCode":"","headers":{},"x":1350,"y":2500,"wires":[]},{"id":"ff78f5d2.4b2e28","type":"function","z":"d8703926.e2eca","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":2500,"wires":[["b0187a3f.415f88"]]},{"id":"c7209563.3512b8","type":"comment","z":"d8703926.e2eca","name":"DESIGN","info":"","x":780,"y":2460,"wires":[]},{"id":"8e17cf6d.114fb","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["ff46d30.12df93"],"x":1515,"y":2580,"wires":[["edec3840.8aa198"]]},{"id":"1872c0a3.73095f","type":"http in","z":"d8703926.e2eca","name":"actionButton","url":"/actionButton","method":"post","upload":false,"swaggerDoc":"","x":170,"y":2540,"wires":[["8f5cb1a6.6cbab"]]},{"id":"5ec4ef91.e491e","type":"link out","z":"d8703926.e2eca","name":"","links":["9f7bef43.a7dc3"],"x":415,"y":2500,"wires":[]},{"id":"d065db2d.d748c8","type":"link out","z":"d8703926.e2eca","name":"","links":["801881b9.c887c"],"x":415,"y":2540,"wires":[]},{"id":"c44dc296.1514d","type":"link out","z":"d8703926.e2eca","name":"","links":["113a4dcb.26f182"],"x":415,"y":2580,"wires":[]},{"id":"50eb2a8a.3586f4","type":"comment","z":"d8703926.e2eca","name":"INIT","info":"","x":490,"y":2540,"wires":[]},{"id":"5b85d99e.eb71a8","type":"comment","z":"d8703926.e2eca","name":"DESIGN","info":"","x":500,"y":2500,"wires":[]},{"id":"6a3ae2c3.3dedfc","type":"comment","z":"d8703926.e2eca","name":"ROUTE","info":"","x":490,"y":2580,"wires":[]},{"id":"3798760d.1712aa","type":"subflow:39834eee.0dd5a2","z":"d8703926.e2eca","name":"","env":[],"x":880,"y":2500,"wires":[["ff78f5d2.4b2e28"]]},{"id":"8f5cb1a6.6cbab","type":"subflow:a55f7aee.572be","z":"d8703926.e2eca","name":"","env":[],"x":270,"y":2540,"wires":[["5ec4ef91.e491e"],["d065db2d.d748c8"],["c44dc296.1514d"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"428ca9f5.4dd788","type":"subflow:152aab03.7a806d","z":"d8703926.e2eca","name":"","env":[],"x":3400,"y":2480,"wires":[["bcf796c9.8de8f8"]]},{"id":"edec3840.8aa198","type":"subflow:152aab03.7a806d","z":"d8703926.e2eca","name":"","env":[],"x":1700,"y":2580,"wires":[["dce08cc.269497"]]},{"id":"b0187a3f.415f88","type":"subflow:2ef93158.ae5276","z":"d8703926.e2eca","name":"","env":[],"x":1200,"y":2500,"wires":[["8926420f.4628c"]]},{"id":"c934f329.b80a1","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["ff46d30.12df93","e3a4dd43.1f6c"],"x":1515,"y":2440,"wires":[["3eefa490.4732cc"]]},{"id":"3eefa490.4732cc","type":"function","z":"d8703926.e2eca","name":"basic","func":"\nvar start = new Date();\nvar end = start \n\nend.setHours(end.getHours() + 4);\n\n\nmsg.payload = {\n    gadgetsList:[\n     \n  \n     \n       {\n  \"gadgetId\": \"639448f0-c0ff-9841-a476-f60e2205928d\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"slider\",\n  \"gadgetData\": {\n    \"slides\": [\n      {\n        \"icon\": \"bookmark\",\n        \"title\": \"Title 1\",\n        \"description\": \"Description 1\",\n        \"iconPack\": \"\",\n        \"color\": \"warning\",\n        \"step\": 10,\n        \"ticks\": true,\n        \"textFixed\": \"\",\n        \"min\": 20,\n        \"max\": 90,\n        \"value\": [\n          30,\n          60\n        ]\n      },\n      {\n        \"icon\": \"Code\",\n        \"title\": \"Title 2\",\n        \"description\": \"Description  2\",\n        \"iconPack\": \"\",\n        \"color\": \"success\",\n        \"step\": 10,\n        \"ticks\": true,\n        \"textFixed\": \"\",\n        \"min\": 20,\n        \"max\": 90,\n        \"value\": [\n          50,\n          60\n        ]\n      }\n    ]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false\n  }\n}\n      \n      \n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":2440,"wires":[["17cb9f85.7d739"]]},{"id":"46804763.7055f8","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["ff46d30.12df93","e3a4dd43.1f6c"],"x":1515,"y":2500,"wires":[["8925dfe3.0ada7"]]},{"id":"8925dfe3.0ada7","type":"function","z":"d8703926.e2eca","name":"tour","func":"\nmsg.payload = {\n    gadgetsList:[\n   \n \n  \n       {\n  \"gadgetId\": \"550ec7d9-b2a0-8f73-d39a-d268630c4e04\",\n  \"gadgetName\": \"Tour\",\n  \"gadgetType\": \"slider\",\n  \"gadgetData\": {\n       tour:{\n          content:\"Tour on slider, right placement\",\n          title :\"Tour on slider, right placement\",\n          priority:1,\n          placement :\"right\"\n      },\n    \"slides\": [\n      {\n         tour:{\n          content:\"Tour on slider @slide, top placement\",\n          title :\"Tour on slider @slide, top placement\",\n          priority:2,\n          placement :\"top\"\n      },\n        \"icon\": \"bookmark\",\n        \"title\": \"Title 1\",\n        \"description\": \"Description 1\",\n        \"iconPack\": \"\",\n        \"color\": \"warning\",\n        \"step\": 30,\n        \"ticks\": true,\n        \"textFixed\": \"\",\n        \"min\": 40,\n        \"max\": 800,\n        \"value\": [\n          30,\n          60\n        ]\n      },\n      {\n        \"icon\": \"code\",\n        \"title\": \"Title 2\",\n        \"description\": \"Description  2\",\n        \"iconPack\": \"\",\n        \"color\": \"success\",\n        \"step\": 7.3333,\n        \"ticks\": false,\n        \"textFixed\": \"\",\n        \"min\": 15,\n        \"max\": 100,\n        \"value\": [\n          50,\n          60\n        ]\n      }\n    ]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false\n  }\n}\n      \n\n      ]\n}\n\n\n\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                             tour:{\n                      content:\"Tour state, right placement\",\n                      title :\"Tour state, right placement\",\n                      priority:2,\n                      placement :\"right\"\n                  },\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":2500,"wires":[["ae27717a.40c71"]]},{"id":"1cfe33a7.9a9b6c","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["ff46d30.12df93","e3a4dd43.1f6c"],"x":1515,"y":2540,"wires":[["5edb4796.a2e728"]]},{"id":"5edb4796.a2e728","type":"function","z":"d8703926.e2eca","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n      \"color\": \"#FFFF\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":2540,"wires":[["c6737cff.792a3"]]},{"id":"e3a4dd43.1f6c","type":"link out","z":"d8703926.e2eca","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","c934f329.b80a1","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","46804763.7055f8","7030c515.504b2c","1cfe33a7.9a9b6c","cf419bc2.c861c8"],"x":3355,"y":2520,"wires":[]},{"id":"a6416236.d70b6","type":"function","z":"d8703926.e2eca","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Action button</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":2620,"wires":[["491fd505.fc69fc"]]},{"id":"7ce6b472.896cfc","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["ff46d30.12df93"],"x":1515,"y":2620,"wires":[["a6416236.d70b6"]]},{"id":"d607a019.6a2e8","type":"function","z":"d8703926.e2eca","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3470,"y":2560,"wires":[["d93ac4.0a65554"]]},{"id":"f294a7d3.9aeeb8","type":"comment","z":"d8703926.e2eca","name":"landing page","info":"","x":130,"y":2880,"wires":[]},{"id":"d8d6c902.075768","type":"comment","z":"d8703926.e2eca","name":"landing page  gagdet actions","info":"","x":2880,"y":2900,"wires":[]},{"id":"a0458514.6fb818","type":"comment","z":"d8703926.e2eca","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2510,"y":2780,"wires":[]},{"id":"7e83740c.a1857c","type":"link in","z":"d8703926.e2eca","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","29662c48.55a664"],"x":815,"y":3000,"wires":[["937c22c5.981cc","7342b726.06ed08"]]},{"id":"60e1937c.ed389c","type":"function","z":"d8703926.e2eca","name":"Route userAction","func":"var   MenuAction,  resetPage, Gadgets,gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else  if (PostData.gadgetName=== \"Gadgets\"){\n    Gadgets = msg;\n}else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, Gadgets,gadgetAction];","outputs":4,"noerr":0,"initialize":"","finalize":"","x":3150,"y":2980,"wires":[["c71fdc1c.ae0e2"],["71a101e0.618d"],["644be8a2.a40288"],["84342289.0b531"]],"outputLabels":[" MenuAction","resetPage","Gadgets","gadgetAction"]},{"id":"9108051f.44d278","type":"debug","z":"d8703926.e2eca","name":"landing page Gadget post","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3130,"y":2920,"wires":[]},{"id":"937c22c5.981cc","type":"link out","z":"d8703926.e2eca","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","532faf68.e71ca","26c29dda.6daf62","cd9f1d1b.bf34","aa0c71fa.2c828","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","25f2abaa.36b9e4","7030c515.504b2c","5dad84da.c9426c","5f9c3364.46538c"],"x":1195,"y":3000,"wires":[]},{"id":"7283f2e2.7d244c","type":"comment","z":"d8703926.e2eca","name":"INIT FLOW","info":"","x":780,"y":2960,"wires":[]},{"id":"7342b726.06ed08","type":"debug","z":"d8703926.e2eca","name":"landing page INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":960,"y":2960,"wires":[]},{"id":"101a5e24.a61bd2","type":"link in","z":"d8703926.e2eca","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","89bbc22a.50053"],"x":2955,"y":2980,"wires":[["9108051f.44d278","60e1937c.ed389c"]]},{"id":"7e24743b.7b34ac","type":"link in","z":"d8703926.e2eca","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","b43140b4.38bc9"],"x":715,"y":2900,"wires":[["870ad491.c43ed8","41cffe6a.dc2f8"]]},{"id":"2b3db7e.68f9748","type":"http response","z":"d8703926.e2eca","name":"","statusCode":"","headers":{},"x":1350,"y":2900,"wires":[]},{"id":"f7e08113.b0e5a","type":"function","z":"d8703926.e2eca","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":2900,"wires":[["a2d5b724.4edb18"]]},{"id":"10d27bcb.f1e3e4","type":"comment","z":"d8703926.e2eca","name":"DESIGN","info":"","x":780,"y":2860,"wires":[]},{"id":"532faf68.e71ca","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["937c22c5.981cc"],"x":1515,"y":2980,"wires":[["f432aafa.115fd8"]]},{"id":"bee8effa.6b4c7","type":"http in","z":"d8703926.e2eca","name":"landingPage","url":"/landingPage","method":"post","upload":false,"swaggerDoc":"","x":130,"y":2940,"wires":[["4e2ffb08.ff6564"]]},{"id":"b43140b4.38bc9","type":"link out","z":"d8703926.e2eca","name":"","links":["7e24743b.7b34ac"],"x":415,"y":2900,"wires":[]},{"id":"29662c48.55a664","type":"link out","z":"d8703926.e2eca","name":"","links":["7e83740c.a1857c"],"x":415,"y":2940,"wires":[]},{"id":"89bbc22a.50053","type":"link out","z":"d8703926.e2eca","name":"","links":["101a5e24.a61bd2"],"x":415,"y":2980,"wires":[]},{"id":"c85f28d1.3cceb8","type":"comment","z":"d8703926.e2eca","name":"INIT","info":"","x":490,"y":2940,"wires":[]},{"id":"82ac9787.0e0ed8","type":"comment","z":"d8703926.e2eca","name":"DESIGN","info":"","x":500,"y":2900,"wires":[]},{"id":"4d038010.93308","type":"comment","z":"d8703926.e2eca","name":"ROUTE","info":"","x":490,"y":2980,"wires":[]},{"id":"870ad491.c43ed8","type":"subflow:39834eee.0dd5a2","z":"d8703926.e2eca","name":"","env":[],"x":880,"y":2900,"wires":[["f7e08113.b0e5a"]]},{"id":"4e2ffb08.ff6564","type":"subflow:a55f7aee.572be","z":"d8703926.e2eca","name":"","env":[],"x":270,"y":2940,"wires":[["b43140b4.38bc9"],["29662c48.55a664"],["89bbc22a.50053"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"c71fdc1c.ae0e2","type":"subflow:152aab03.7a806d","z":"d8703926.e2eca","name":"","env":[],"x":3380,"y":2920,"wires":[["dd5d1f3e.91b73"]]},{"id":"f432aafa.115fd8","type":"subflow:152aab03.7a806d","z":"d8703926.e2eca","name":"","env":[],"x":1700,"y":2980,"wires":[["ed25e04e.d3e8d"]]},{"id":"a2d5b724.4edb18","type":"subflow:2ef93158.ae5276","z":"d8703926.e2eca","name":"","env":[],"x":1200,"y":2900,"wires":[["2b3db7e.68f9748"]]},{"id":"aa0c71fa.2c828","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["937c22c5.981cc","71a101e0.618d"],"x":1515,"y":2840,"wires":[["5b50f4a7.b71b7c"]]},{"id":"5b50f4a7.b71b7c","type":"function","z":"d8703926.e2eca","name":"Get gagdeta","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\nmsg.rows = [{\n                                            \"rowData\": [\n                                              {\n                                                \"headKey\": \"name\",\n                                                \"type\": \"string\",\n                                                \"data\": \"action button\",\n                                                \"editable\": false\n                                              },\n                                              \n                                            ],\n                                            \"rowSourceData\": {\n                                              \"name\": \"action button\",\n                                            \n                                            },\n                                            \"rowOptions\": {\n                                              \"globalClick\": true,\n                                              \"style\": {\n                                                \"width\": \"20%\"\n                                              }\n                                            }\n                                          }]\n\n// Create organizations group\n\ngadgetsDir = \"../../../var/www/pagePublisher/src/components/gadgets\"\n\n msg.files = []\nfs.readdir(gadgetsDir, (err, files) => { \n          if (err) \n            console.log(err); \n          else { \n              \n              // get pages\n             files.forEach(file => { \n                      newFile = file.replace('.vue','');\n                      newFile2 = newFile.replace('.js','');\n                      msg.files.push(newFile2)\n                      newFile3 = newFile2.replace('-','');\n                      \n                      if (lodash.includes(msg.files,newFile3 ) === false){\n                          msg.files.push(newFile3)\n                      }\n                    }) \n       \n     \nfindManyObj = {\n                    query : {\n                            query :{name : {\"$in\":msg.files} , application_id : new ObjectID(global.get(\"applicationId\"))}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:\"revotio\",\n                    collection:'pages',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findManyObj, node, function(res){\n                \n                node.warn({\n                    res:res,\n                    files: msg.files\n                })\n                 //node.warn({\"files\":files})\n                                lodash.orderBy(res,[\"name\"],[\"asc\"]).forEach(page => { \n                                  msg.rows.push({\n                                            \"rowData\": [\n                                              {\n                                                \"headKey\": \"name\",\n                                                \"type\": \"string\",\n                                                \"data\": page.name,\n                                                \"editable\": false\n                                              },\n                                              \n                                            ],\n                                            \"rowSourceData\": {\n                                              \"name\": page.name,\n                                            \n                                            },\n                                            \"rowOptions\": {\n                                              \"globalClick\": true,\n                                              \"style\": {\n                                                \"width\": \"20%\"\n                                              }\n                                            }\n                                          });\n                    }) \n            \n                 \n\n                node.send(msg)\n            }) \n              \n           \n          } \n          \n          \n     \n}) \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":2840,"wires":[["61765995.5ae358"]]},{"id":"25f2abaa.36b9e4","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["937c22c5.981cc","71a101e0.618d"],"x":1515,"y":2900,"wires":[["18cfd7d4.04a678"]]},{"id":"154c40d8.c6f4bf","type":"function","z":"d8703926.e2eca","name":"users","func":"\nmsg.payload = {\n    gadgetsList:[\n   \n\n       {\n  \"gadgetId\": \"31c5dd87-09ef-7a4b-6b4c-caa6f053ef25\",\n  \"gadgetName\": \"users\",\n  \"gadgetType\": \"data-table\",\n  \"gadgetOptions\": {\n    \"allowSearch\": true,\n    \"maxItems\": 10,\n    \"striped\": false,\n    \"export\": true,\n    \"multipleSelection\": false,\n  },\n  \"gadgetData\": {\n    \"tableColumnData\": {\n      \"columnHead\": [\n        {\n          \"title\": \"Name\",\n          \"allowSort\": true,\n          \"headKey\": \"name\",\n          \"hidden\": false,\n          \"editable\": false,\n\n        },\n               {\n          \"title\": \"Username\",\n          \"allowSort\": true,\n          \"headKey\": \"username\",\n          \"hidden\": false,\n          \"editable\": false,\n       \n        },\n    \n      ],\n      \"columnOptions\": {\n        \"columnStyle\": {},\n        \"cellStyle\": {},\n        \"allowSort\": true\n      }\n    },\n    \"tableTitle\": \"Users\",\n    \"tableRowData\": msg.rows,\n    \"tableButton\": [\n        {\n        \"buttonData\": {\n          \"title\": \"Create\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"add\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"create\",\n          \"type\": \"success\",\n          \"multipleSelection\": false,\n          \"clickType\": \"global\"\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      },\n      {\n        \"buttonData\": {\n          \"title\": \"Edit\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"edit\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"edit\",\n          \"type\": \"warning\",\n          \"multipleSelection\": false,\n          \"clickType\": \"selected\"\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      },\n          {\n        \"buttonData\": {\n          \"title\": \"Delete\",\n          \"allowSearch\": false,\n          \"searchPlaceholder\": \"Search\",\n          \"design\": [\n            {\n              \"file\": \"\",\n              \"icon\": \"delete\",\n              \"field\": true\n            }\n          ],\n          \"disabled\": false,\n          \"action\": \"delete\",\n          \"type\": \"danger\",\n          \"multipleSelection\": false,\n          \"clickType\": \"selected\"\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"button\",\n          \"selectionType\": \"\"\n        }\n      }\n    ],\n    \"tableOptions\": {\n      \"mainOption\": \"CRUD\"\n    }\n  }\n}\n      \n      \n\n      ]\n}\n\n\n\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"02f52897-df6b-56df-7247-c35f47abebd5\",\n  \"gadgetName\": \"usersCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                  \n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"usersTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":2900,"wires":[["7056c137.30e85"]]},{"id":"71a101e0.618d","type":"link out","z":"d8703926.e2eca","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","aa0c71fa.2c828","b79520dd.36ee1","662d87cc.7d0548","48dffeab.b720a","25f2abaa.36b9e4","7030c515.504b2c","5dad84da.c9426c"],"x":3335,"y":2960,"wires":[]},{"id":"9fefb25b.b77fa","type":"function","z":"d8703926.e2eca","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n \"gadgetId\": \"5dc41ac5-97c2-a893-1694-6bb997ce022d\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 78px;\"><span style=\"text-decoration: underline;\"><strong>Welcome to the factory!</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":3020,"wires":[["4755e621.8087d8"]]},{"id":"5f9c3364.46538c","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["937c22c5.981cc"],"x":1515,"y":3020,"wires":[["9fefb25b.b77fa"]]},{"id":"84342289.0b531","type":"function","z":"d8703926.e2eca","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n  \"gadgetId\": \"5276e44e-9c92-08fb-a81d-f4cdd7280dc7\",\n  \"gadgetName\": \"actionPost\",\n  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3450,"y":3040,"wires":[["5e8e4c17.eb0474"]]},{"id":"61765995.5ae358","type":"function","z":"d8703926.e2eca","name":"basic gadgets","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\nmsg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"f11d49c4-493f-713c-e8f6-eaa17a4d87b7\",\n  \"gadgetName\": \"Gadgets\",\n  \"gadgetType\": \"data-table\",\n  \"gadgetOptions\": {\n    \"allowSearch\": true,\n    \"maxItems\": 10,\n    \"striped\": true,\n    \"export\": true,\n    \"multipleSelection\": false,\n  },\n  \"gadgetData\": {\n    \"tableColumnData\": {\n      \"columnHead\": [\n        {\n          \"title\": \"Name\",\n          \"allowSort\": true,\n          \"headKey\": \"name\",\n          \"hidden\": false,\n          \"editable\": false,\n          \"showCalculateLabel\": true\n        },\n      ],\n      \"columnOptions\": {\n        \"columnStyle\": {},\n        \"cellStyle\": {},\n        \"allowSort\": true\n      }\n    },\n    \"tableTitle\": \"Gadgets\",\n    \"tableRowData\": msg.rows,\n    \"tableOptions\": {\n      \"mainOption\": \"global\"\n    }\n  }\n}\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"474549e9-8d4c-d09e-d8f1-de25bd707fd1\",\n  \"gadgetName\": \"basic\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Gadgets\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1960,"y":2840,"wires":[["5d41711e.3f589"]]},{"id":"41cffe6a.dc2f8","type":"debug","z":"d8703926.e2eca","name":"landing page Design post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":930,"y":2860,"wires":[]},{"id":"17cb9f85.7d739","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2440,"wires":[]},{"id":"ae27717a.40c71","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2480,"wires":[]},{"id":"c6737cff.792a3","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2520,"wires":[]},{"id":"dce08cc.269497","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2580,"wires":[]},{"id":"491fd505.fc69fc","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2620,"wires":[]},{"id":"5d41711e.3f589","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2840,"wires":[]},{"id":"7056c137.30e85","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2900,"wires":[]},{"id":"ed25e04e.d3e8d","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2980,"wires":[]},{"id":"4755e621.8087d8","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":3020,"wires":[]},{"id":"5e8e4c17.eb0474","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":3735,"y":3040,"wires":[]},{"id":"dd5d1f3e.91b73","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":3635,"y":2920,"wires":[]},{"id":"d93ac4.0a65554","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":3695,"y":2560,"wires":[]},{"id":"bcf796c9.8de8f8","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":3695,"y":2480,"wires":[]},{"id":"fa82b35b.5e7b3","type":"subflow:5e9b9c1d.bbe4a4","z":"d8703926.e2eca","name":"","x":3500,"y":3000,"wires":[]},{"id":"644be8a2.a40288","type":"function","z":"d8703926.e2eca","name":"","func":"msg.payload = {\n    Page : msg.RevotioData.PostData.gadgetData.data.name\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3380,"y":3000,"wires":[["fa82b35b.5e7b3"]]},{"id":"18cfd7d4.04a678","type":"function","z":"d8703926.e2eca","name":"Get users","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\nmsg.rows = []\n     // findMany\n\nfindManyObj = {\n                    query : {\n                            query :{}, \n                            },\n                    connection:global.get(\"DB_data.connection\"),\n                    database:global.get(\"DB_data.appDB\"),\n                    collection:'user_accounts',\n                    operation:'find',\n                    }\n\n\n\n            mongodbTools.resolveAsync(findManyObj, node, function(res){\n                \n                node.warn({\n                    res:res,\n                    files: msg.files\n                })\n                 //node.warn({\"files\":files})\n                                lodash.orderBy(res,[\"first_name\", \"last_name\"],[\"asc\",\"asc\"]).forEach(user => { \n                                    \n                                    if (user.username === \"dafydd@revotio.com\"){\n                                        selectable = false \n                                    } else {\n                                        selectable = true\n                                    }\n                                  msg.rows.push({\n                                            \"rowData\": [\n                                              {\n                                                \"headKey\": \"name\",\n                                                \"type\": \"string\",\n                                                \"data\": user.first_name + \" \" + user.last_name ,\n                                                \"editable\": false\n                                              },\n                                               {\n                                                \"headKey\": \"username\",\n                                                \"type\": \"string\",\n                                                \"data\": user.username ,\n                                                \"editable\": false\n                                              },\n                                              \n                                            ],\n                                            \"rowSourceData\": {\n                                              \"user\": user.user,\n                                            \n                                            },\n                                            \"rowOptions\": {\n                                                selectable:selectable,\n                                              \"globalClick\": true,\n                                              \"style\": {\n                                                \"width\": \"20%\"\n                                              }\n                                            }\n                                          });\n                    }) \n            \n                 \n\n                node.send(msg)\n            }) \n \n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":2900,"wires":[["154c40d8.c6f4bf"]]},{"id":"dec81b6d.b57158","type":"comment","z":"d8703926.e2eca","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2430,"y":1340,"wires":[]},{"id":"1135b739.8fd459","type":"function","z":"d8703926.e2eca","name":"Create user Form","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n\n\n\nmsg.form = {\n      id: 'create-user-form',\n      canceled: true, // false\n      submitButtonText: 'Create',\n      prevButtonText: 'Previous',\n      entity : \"user\", // empoloyee, project, teammember, involvement, time-recording\n      Type: \"Create\",\n      nextButtonText: 'Next',\n      _id: new ObjectID(),\n      showPrevious: false, //false\n      FormType : \"User\",\n      title: 'Create user',\n      steps: [\n        {\n          title: 'General information',\n          subtitle: '',\n          fields: [\n              {\n              name: 'first_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'First name',\n                placeholder: 'John',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                required: true // false by default\n              }\n            },\n              {\n              name: 'middle_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Middle name',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: false, // false by default\n                maxlength: 50\n              }\n            },\n            {\n              name: 'last_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Last name',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: 'Do',\n                required: true, // false by default\n                maxlength: 50,\n               \n              }\n            },\n            {\n              name: 'email',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Email address',\n                type: 'email', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: true, // false by default\n                maxlength: 50\n              }\n            },\n                                  {\n              name: 'phone_number',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Phone number',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: false, // false by default\n                // min: 12,\n                // max: 12\n              }\n            },\n        ]},\n      ]\n    };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":1560,"wires":[["177a5e64.0e9a72"]]},{"id":"7c226619.1ec158","type":"http in","z":"d8703926.e2eca","name":"Form","url":"/Form","method":"post","upload":false,"swaggerDoc":"","x":210,"y":1680,"wires":[["ad2ba649.37ba08","6e10582f.441768"]]},{"id":"ad2ba649.37ba08","type":"function","z":"d8703926.e2eca","name":"Prepair flow","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n// msg.formTime = {\n//     start : new Date()\n// }\npayload = msg.payload\n_.each(payload, function(item, key){\n    msg[key] = item\n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":1680,"wires":[["d2a9d7a8.f2fad8"]]},{"id":"d2a9d7a8.f2fad8","type":"function","z":"d8703926.e2eca","name":"Route based on msg.RevotioData.Form.FormActionType","func":"var View , Create, Edit, Post;\n\nif (msg.RevotioData.FlowData.Form.FormActionType === \"View\"){\n    msg.RevotioData.FlowData.Form.Type = msg.RevotioData.FlowData.Form.FormActionType\n    msg.RevotioData.FlowData.Form.ModalAction = 'show';\n    View = msg;\n}\nelse if (msg.RevotioData.FlowData.Form.FormActionType === \"Create\"){\n    msg.RevotioData.FlowData.Form.Type = msg.RevotioData.FlowData.Form.FormActionType\n    msg.RevotioData.FlowData.Form.ModalAction = 'show';\n    Create = msg;\n} else if (msg.RevotioData.FlowData.Form.FormActionType === \"Edit\"){\n    msg.RevotioData.FlowData.Form.Type = msg.RevotioData.FlowData.Form.FormActionType\n    msg.RevotioData.FlowData.Form.ModalAction = 'show';\n    Edit = msg;\n} else if (msg.RevotioData.FlowData.Form.FormActionType === \"Post\"){\n    msg.RevotioData.FlowData.Form.ModalAction = 'hide';\n    Post = msg;\n} \nreturn [View , Create, Edit, Post];","outputs":4,"noerr":0,"x":610,"y":1680,"wires":[["57700237.bfe73c"],["d71e46d9.ca0798"],["4568e295.eafe4c"],["b6a6b9bb.0557b8"]],"outputLabels":["View","Create","Edit","Post"]},{"id":"6e10582f.441768","type":"debug","z":"d8703926.e2eca","name":"Pre form","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":360,"y":1620,"wires":[]},{"id":"8f562a45.346078","type":"function","z":"3c16f370.3edeac","name":"Change form to view only","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nif (msg.form){\n    \n    msg.form.id =  msg.form.id.replace(\"edit\",\"view\")\n    msg.form.title =  msg.form.title.replace(\"Edit\",\"View\")\n    msg.form.submitButtonAction = false\n    \n    msg.form.submitButtonText = \"View\"\n    _.each(msg.form.steps, function(stepItem,stepItemIndex){\n        \n        _.each(stepItem.fields, function(fieldsItem,fieldsItemIndex){\n            \n            if (fieldsItem.htmlTag === \"subform\"){\n                \n                _.each(fieldsItem.fields, function(subformMainArray,subformMainArrayIndex ){\n                    _.each(subformMainArray, function(subformMainArrayField,subformMainArrayFieldIndex ){\n                         subformMainArrayField.options.disabled = true \n                    })\n                })\n            } else {\n              fieldsItem.options.disabled = true \n            }\n            \n        })\n        \n    })\n    \n    \n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":190,"y":80,"wires":[[]]},{"id":"eb1e377c.ebf6d8","type":"debug","z":"d8703926.e2eca","name":"User edit","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2420,"y":1440,"wires":[]},{"id":"cbbac0fa.8faad","type":"subflow:3c16f370.3edeac","z":"d8703926.e2eca","name":"","env":[],"x":2470,"y":1500,"wires":[[]]},{"id":"d71e46d9.ca0798","type":"function","z":"d8703926.e2eca","name":"Route based on form FormType","func":"var user\n\nif ( msg.RevotioData.FlowData.Form.FormType === \"User\"){\n    user = msg;\n}\n\n\n\n\n\nreturn [user]\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":1560,"wires":[["1135b739.8fd459"]],"outputLabels":["user","employee","project","Member","involvement","Organization","WorkPackage","Participant","work_package_transaction","team","reporting_period","payment","fundingScheme","transactionCategory","Roles","entityPermissions","userEntityPermissions","comment","loginRecords"]},{"id":"f5075bf5.04d578","type":"function","z":"d8703926.e2eca","name":"Create userAccount","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\npayload = {};\n_.each(msg.RevotioData.FlowData.Data.UserData, function(Value, Key){\n    if (Key !== \"_id\"){\n       payload[Key] = Value;\n    }\n})\n\npayload.user = new ObjectID(msg.RevotioData.FlowData.Data.UserData._id);\npayload.user_id = new ObjectID(msg.RevotioData.FlowData.Data.UserData._id);\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :payload, \n                            update : { \"$set\" : payload},\n                            options : {upsert: true}\n                            },\n                    connection:msg.RevotioData.domainData.DB_data.connection,\n                    database:msg.RevotioData.domainData.DB_data.appDB,\n                    collection:'user_accounts',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2920,"y":1780,"wires":[["22c354e5.1162cc","5261656d.242b3c","df5913f2.8df63"]]},{"id":"4cbf0715.ae61e8","type":"function","z":"d8703926.e2eca","name":"Edit userAccount","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\npayload = msg.RevotioData.PostData.gadgetData.formData ;\nif ( msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty(\"avatar\")){\n    payload.avatar=  msg.RevotioData.PostData.gadgetData.formData.avatar.path  \n}\npayload.user = new ObjectID(msg.RevotioData.PostData.gadgetData.formObj.Appuser_id);\ndelete  payload._id\n\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :  { user: new ObjectID(msg.RevotioData.PostData.gadgetData.formObj.Appuser_id)},\n                            update :  {\"$set\": payload},\n                            options : {upsert: true}\n                            },\n                    connection:msg.RevotioData.domainData.DB_data.connection,\n                    database:msg.RevotioData.domainData.DB_data.appDB,\n                    collection:'user_accounts',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n\n\n","outputs":1,"noerr":0,"x":2930,"y":1820,"wires":[["7dd62f71.5a0b6"]]},{"id":"31e81511.6e425a","type":"function","z":"d8703926.e2eca","name":"Create / update user form(s)","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\nuserId = new ObjectID()\n\nmsg.RevotioData.FlowData.Data.UserData = {\n    _id: new ObjectID(userId),\n    \"username\": msg.RevotioData.PostData.gadgetData.formData.email,\n    \"created\": new Date(),\n    \"updated\": new Date(),\n    \"active\": false,\n    \"avatar\": \"users/\"+userId+\"/\"+\"user Icon.png\",\n    \"first_name\" : msg.RevotioData.PostData.gadgetData.formData.first_name,\n    \"middle_name\" : msg.RevotioData.PostData.gadgetData.formData.middle_name,\n    \"last_name\" : msg.RevotioData.PostData.gadgetData.formData.last_name,\n    \"email\" : msg.RevotioData.PostData.gadgetData.formData.email,\n    salt: crypto.randomBytes(16).toString('hex'),\n    activationToken : crypto.randomBytes(20).toString('hex'),\n};\n\n\nmsg.RevotioData.FlowData.Data.UserData.activationURL = msg.RevotioData.domainData.DomainProperties.RootDomain+ \"/activation=\" + msg.RevotioData.FlowData.Data.UserData.activationToken\n\n// update    \n\n    updateObj = {\n                    query : {\n                            query :{_id: new ObjectID(msg.RevotioData.FlowData.Data.UserData._id)}, \n                            update :{\"$set\": msg.RevotioData.FlowData.Data.UserData},\n                            options : {upsert: true}\n                            },\n                    connection:msg.RevotioData.domainData.DB_data.connection,\n                    database:msg.RevotioData.domainData.DB_data.appDB,\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n            \n      ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2640,"y":1780,"wires":[["f5075bf5.04d578"]]},{"id":"a8c7c3ab.79165","type":"function","z":"d8703926.e2eca","name":"Route based on operation","func":"var Create, Edit;\n\nif (msg.RevotioData.FlowData.Form.Type  ===  \"Create\"){\n    Create = msg;\n}else if (msg.RevotioData.FlowData.Form.Type ===  \"Edit\"){\n    Edit = msg;\n}\n\n\nreturn [Create, Edit];","outputs":"2","noerr":0,"initialize":"","finalize":"","x":1810,"y":1820,"wires":[["3c8b09c2.48f006","2d63d841.66ee48"],["748e19db.ce7998"]],"outputLabels":["Create","Edit"]},{"id":"748e19db.ce7998","type":"function","z":"d8703926.e2eca","name":"Update user form(s)","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\npayload = {}\n_.each(msg.RevotioData.PostData.gadgetData.formData, function(Item , Key){\n    // if (Key !== \"_id\"){\n        payload[Key] = Item;\n    // }\n})\n\nif(msg.RevotioData.PostData.gadgetData.formData.email){\n    payload.username = msg.RevotioData.PostData.gadgetData.formData.email\n}\n\n\npayload.updated=  new Date()\npayload.first_name= msg.RevotioData.PostData.gadgetData.formData.first_name\npayload.middle_name=  msg.RevotioData.PostData.gadgetData.formData.middle_name\npayload.last_name=  msg.RevotioData.PostData.gadgetData.formData.last_name\n\n\nif ( msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty(\"avatar\")){\n  payload.avatar=  msg.RevotioData.PostData.gadgetData.formData.avatar.path  \n}\n\nmsg.RevotioData.FlowData.Data.appUserData = payload\n\n// update    \n    updateObj = {\n                    query : {\n                            query :{_id: new ObjectID(msg.RevotioData.PostData.gadgetData.formObj.Appuser_id)},\n                            update :  {\"$set\": payload},\n                            options : {upsert: true}\n                            },\n                    connection:msg.RevotioData.domainData.DB_data.connection,\n                    database:msg.RevotioData.domainData.DB_data.appDB,\n                    collection:'users',\n                    operation:'update', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            })  \n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2620,"y":1820,"wires":[["4cbf0715.ae61e8"]]},{"id":"3c8b09c2.48f006","type":"function","z":"d8703926.e2eca","name":"check if username already exists","func":"var request = global.get('request');\nvar Moment = global.get('moment');var MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nfindManyObj = {\n                    query : {\n                        query:{\n                            query :{username : msg.RevotioData.PostData.gadgetData.formData.email },\n                            limit : 1\n                            }},\n                    connection:msg.RevotioData.domainData.DB_data.connection,\n                    database:msg.RevotioData.domainData.DB_data.appDB,\n                    collection:'users',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findManyObj, node, function(res){\n                    msg.payload = res\n                    node.send(msg) \n            }) \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2100,"y":1800,"wires":[["1ae4aea6.a850b1","9b20bb31.76f478"]]},{"id":"1ae4aea6.a850b1","type":"function","z":"d8703926.e2eca","name":"Validate","func":"var lodash = global.get('lodash');\n\nvar Invalid, Valid;\n\nif (msg.payload.length > 0){\n    msg.RevotioData.FlowData.Form.ModalAction = \"show\";\n    \n    EmailAddressIndex = lodash.findIndex(msg.RevotioData.PostData.gadgetData.formObj.steps[0].fields, {name : \"email\"});\n    \n    msg.RevotioData.PostData.gadgetData.formObj.steps[0].fields[EmailAddressIndex].error = {msg: \"Email address already exists\"};\n    msg.form = msg.RevotioData.PostData.gadgetData.formObj;\n     Invalid = msg;\n} else {\n    Valid = msg;\n}\nreturn [Invalid, Valid];","outputs":"2","noerr":0,"x":2400,"y":1760,"wires":[["6cc242bc.4a8ebc","2eca6833.ba1d88"],["31e81511.6e425a","2eca6833.ba1d88"]],"outputLabels":["Invalid","Valid"]},{"id":"df5913f2.8df63","type":"function","z":"d8703926.e2eca","name":"Create redirect msg","func":"\nmsg.payload = {\n    Page : \"users global\",\n    RevotioData: {\n        organization_id : msg.RevotioData.FlowData.organization_id\n    },\n    timestamp : new Date(),\n}\nif (String(msg.RevotioData.domainData.MasterOrganizationData._id) === String(msg.RevotioData.FlowData.organization_id)){\n    msg.payload.RevotioData.level = \"admin\"\n} else {\n    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":3150,"y":1780,"wires":[["d23967ae.3f49a8"]]},{"id":"7dd62f71.5a0b6","type":"function","z":"d8703926.e2eca","name":"Create redirect msg","func":"msg.payload = {\n    Page : \"users global\",\n    RevotioData: {\n        organization_id : msg.RevotioData.PostData.gadgetData.formObj.organization_id,\n        // user_id: msg.RevotioData.FlowData.Data._id\n    },\n    timestamp : new Date(),\n}\n\nif (String(msg.RevotioData.domainData.MasterOrganizationData._id) === String(msg.RevotioData.FlowData.organization_id)){\n    msg.payload.RevotioData.level = \"admin\"\n} else {\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":3150,"y":1820,"wires":[["d23967ae.3f49a8"]]},{"id":"22c354e5.1162cc","type":"function","z":"d8703926.e2eca","name":"create user folder","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (msg.RevotioData.FlowData.Form.Type === \"Create\"){\n    \n    // ensure user dir\n    fs.ensureDirSync(msg.RevotioData.domainData.DomainProperties.filesFolder+ \"users/\"+ msg.RevotioData.FlowData.Data.UserData._id)\n    \n     // copy default user logo\n    fs.copySync(msg.RevotioData.domainData.DomainProperties.filesFolder+\"SystemFiles/icons/user.png\" , msg.RevotioData.domainData.DomainProperties.filesFolder+ \"users/\"+ msg.RevotioData.FlowData.Data.UserData._id+\"/\"+\"user.png\" )\n \n    \n \n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3150,"y":1700,"wires":[[]]},{"id":"6cc242bc.4a8ebc","type":"link out","z":"d8703926.e2eca","name":"","links":["15b87ed7.8cbbd9"],"x":2495,"y":1740,"wires":[]},{"id":"8898138d.a9ad8","type":"function","z":"d8703926.e2eca","name":"Set all data to proper notation","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting'); \nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\n\n\n// set all data to proper notation\nfunction capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n// email && username\n\nif (msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty('first_name') && typeof msg.RevotioData.PostData.gadgetData.formData.first_name === 'string'){\n        first_name = \"\"\n        _.each(msg.RevotioData.PostData.gadgetData.formData.first_name.split(\" \"), function(value, index){\n            value.toLowerCase()\n            first_name = first_name + capitalizeFirstLetter(value.toLowerCase()) + \" \";\n        })\n        msg.RevotioData.PostData.gadgetData.formData.first_name = first_name\n}\n\nif (msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty('middle_name') && typeof msg.RevotioData.PostData.gadgetData.formData.middle_name === 'string'){\n        // msg.RevotioData.PostData.gadgetData.formData.middle_name\n        middle_name = \"\"\n        _.each(msg.RevotioData.PostData.gadgetData.formData.middle_name.split(\" \"), function(value, index){\n\n            middle_name = middle_name + capitalizeFirstLetter(capitalizeFirstLetter(value.toLowerCase())) + \" \";\n        })\n        msg.RevotioData.PostData.gadgetData.formData.middle_name = middle_name\n}\n\nif (msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty('last_name') && typeof msg.RevotioData.PostData.gadgetData.formData.last_name === 'string'){\n        // msg.RevotioData.PostData.gadgetData.formData.last_name\n        last_name = \"\"\n        _.each(msg.RevotioData.PostData.gadgetData.formData.last_name.split(\" \"), function(value, index){\n\n            last_name = last_name + capitalizeFirstLetter(capitalizeFirstLetter(value.toLowerCase())) + \" \";\n        })\n        msg.RevotioData.PostData.gadgetData.formData.last_name = last_name\n}\n\nif (msg.RevotioData.PostData.gadgetData.formData.hasOwnProperty('email')){\n    msg.RevotioData.PostData.gadgetData.formData.email = msg.RevotioData.PostData.gadgetData.formData.email.toLowerCase()\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1570,"y":1820,"wires":[["a8c7c3ab.79165"]]},{"id":"5261656d.242b3c","type":"function","z":"d8703926.e2eca","name":"Trigger email","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n      \n                \nmsg.payload = {\n  \"title\":\"Account activation\",\n  \"logo\":msg.RevotioData.domainData.DomainProperties.RootDomain+\"/static/logo.png\",\n  \"firstname\":msg.RevotioData.FlowData.Data.UserData.first_name,\n  \"lastname\":msg.RevotioData.FlowData.Data.UserData.last_name,\n//   \"attachment\" : msg.RevotioData.domainData.DomainProperties.filesFolder+\"SystemFiles/logo.png\",\n  \"message\":\"Welcome to PNO's education platform!\",\n  \"closing\":\"Cheerfully yours,\",\n  \"signature\":\"Team Grant tools\",\n  \"activate_text\":\"You can activate your account by clicking on this link:\",\n  \"activate_link\":msg.RevotioData.domainData.DomainProperties.RootDomain+ \"/activation=\" + msg.RevotioData.FlowData.Data.UserData.activationToken,\n  \"activate_click\":\"Activate!\",\n  \"footer_text\":\"Grant tools B.V. | Rijswijk, Netherlands\",\n  \"settings_link\":msg.RevotioData.domainData.DomainProperties.RootDomain,\n  \"submessage\":\"Finalize your account\",\n  email:msg.RevotioData.FlowData.Data.UserData.email,\n//   data:fs.readFileSync(msg.RevotioData.domainData.DomainProperties.filesFolder+\"SystemFiles/logo.png\"),\n//   base64data : fs.readFileSync(msg.RevotioData.domainData.DomainProperties.filesFolder+\"SystemFiles/logo.png\").toString('base64'),\n}\n\n\n// check if emilTemplate is available\nif (msg.RevotioData.domainData.hasOwnProperty(\"emailTemplates\") && \n      typeof   msg.RevotioData.domainData.emailTemplates === 'object'  &&\n      msg.RevotioData.domainData.emailTemplates.hasOwnProperty(\"activation\") &&\n      typeof   msg.RevotioData.domainData.emailTemplates.activation === 'object' \n   ){\n       _.each(msg.RevotioData.domainData.emailTemplates.activation, function(value, key){\n           msg.payload[key] = value\n       })\n   }\n\n\n\nmsg.data = msg.payload\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3130,"y":1740,"wires":[["3c01caa.8db6e36"]]},{"id":"23e39ffe.6ca42","type":"debug","z":"d8703926.e2eca","name":"Pre Redirect form ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1930,"y":1720,"wires":[]},{"id":"2eca6833.ba1d88","type":"debug","z":"d8703926.e2eca","name":"POST create user permission 2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2690,"y":1700,"wires":[]},{"id":"2d63d841.66ee48","type":"debug","z":"d8703926.e2eca","name":"POST create user permission 11","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2110,"y":1760,"wires":[]},{"id":"9b20bb31.76f478","type":"debug","z":"d8703926.e2eca","name":"POST create user permission 111","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2280,"y":1680,"wires":[]},{"id":"3c01caa.8db6e36","type":"template","z":"d8703926.e2eca","name":"Activation","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" style=\"width:100%;font-family:'open sans', 'helvetica neue', helvetica, arial, sans-serif;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;padding:0;Margin:0\">\n <head> \n  <meta charset=\"UTF-8\"> \n  <meta content=\"width=device-width, initial-scale=1\" name=\"viewport\"> \n  <meta name=\"x-apple-disable-message-reformatting\"> \n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"> \n  <meta content=\"telephone=no\" name=\"format-detection\"> \n  <title>{{payload.title}}</title> \n\n  <link href=\"https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i\" rel=\"stylesheet\"> \n  <!--<![endif]--> \n  <style type=\"text/css\">\n#outlook a {\n\tpadding:0;\n}\n.ExternalClass {\n\twidth:100%;\n}\n.ExternalClass,\n.ExternalClass p,\n.ExternalClass span,\n.ExternalClass font,\n.ExternalClass td,\n.ExternalClass div {\n\tline-height:100%;\n}\n.es-button {\n\tmso-style-priority:100!important;\n\ttext-decoration:none!important;\n}\na[x-apple-data-detectors] {\n\tcolor:inherit!important;\n\ttext-decoration:none!important;\n\tfont-size:inherit!important;\n\tfont-family:inherit!important;\n\tfont-weight:inherit!important;\n\tline-height:inherit!important;\n}\n.es-desk-hidden {\n\tdisplay:none;\n\tfloat:left;\n\toverflow:hidden;\n\twidth:0;\n\tmax-height:0;\n\tline-height:0;\n\tmso-hide:all;\n}\n/* customs */\n/* td .es-button-border:hover a.es-button{\n    background: #000000!important;\n    border-color: #000000!important;\n    \n    color: #cccccc !important;\n}\ntd .es-button-border  a.es-button{\n  background: #ffdc0f !important;\n    border-color: #ffdc0f !important;\n    \n    color: #000000 !important;\n}\ntd .es-button-border:hover {\n    background: #000000!important;\n}\n.es-button-border:hover {\n    border-style: solid solid solid solid!important;\n    border-color: #000000 #000000 #000000 #000000!important;\n}\nspan.es-button-border {\n  border-color: #ffffff !important;\n    background: #ffffff !important;\n}\nh1,p {\n  color:#0c0909 !important;\n} */\n/* end of customs */\n@media only screen and (max-width:600px) {p, ul li, ol li, a { font-size:16px!important; line-height:150%!important } h1 { font-size:30px!important; text-align:center; line-height:120%!important } h2 { font-size:26px!important; text-align:center; line-height:120%!important } h3 { font-size:20px!important; text-align:center; line-height:120%!important } h1 a { font-size:30px!important } h2 a { font-size:26px!important } h3 a { font-size:20px!important } .es-menu td a { font-size:16px!important } .es-header-body p, .es-header-body ul li, .es-header-body ol li, .es-header-body a { font-size:16px!important } .es-footer-body p, .es-footer-body ul li, .es-footer-body ol li, .es-footer-body a { font-size:16px!important } .es-infoblock p, .es-infoblock ul li, .es-infoblock ol li, .es-infoblock a { font-size:12px!important } *[class=\"gmail-fix\"] { display:none!important } .es-m-txt-c, .es-m-txt-c h1, .es-m-txt-c h2, .es-m-txt-c h3 { text-align:center!important } .es-m-txt-r, .es-m-txt-r h1, .es-m-txt-r h2, .es-m-txt-r h3 { text-align:right!important } .es-m-txt-l, .es-m-txt-l h1, .es-m-txt-l h2, .es-m-txt-l h3 { text-align:left!important } .es-m-txt-r img, .es-m-txt-c img, .es-m-txt-l img { display:inline!important } .es-button-border { display:block!important } a.es-button { font-size:20px!important; display:block!important; border-width:15px 25px 15px 25px!important } .es-btn-fw { border-width:10px 0px!important; text-align:center!important } .es-adaptive table, .es-btn-fw, .es-btn-fw-brdr, .es-left, .es-right { width:100%!important } .es-content table, .es-header table, .es-footer table, .es-content, .es-footer, .es-header { width:100%!important; max-width:600px!important } .es-adapt-td { display:block!important; width:100%!important } .adapt-img { width:100%!important; height:auto!important } .es-m-p0 { padding:0px!important } .es-m-p0r { padding-right:0px!important } .es-m-p0l { padding-left:0px!important } .es-m-p0t { padding-top:0px!important } .es-m-p0b { padding-bottom:0!important } .es-m-p20b { padding-bottom:20px!important } .es-mobile-hidden, .es-hidden { display:none!important } tr.es-desk-hidden, td.es-desk-hidden, table.es-desk-hidden { width:auto!important; overflow:visible!important; float:none!important; max-height:inherit!important; line-height:inherit!important } tr.es-desk-hidden { display:table-row!important } table.es-desk-hidden { display:table!important } td.es-desk-menu-hidden { display:table-cell!important } .es-menu td { width:1%!important } table.es-table-not-adapt, .esd-block-html table { width:auto!important } table.es-social { display:inline-block!important } table.es-social td { display:inline-block!important } }\n</style> \n </head> \n <body style=\"width:100%;font-family:'open sans', 'helvetica neue', helvetica, arial, sans-serif;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;padding:0;Margin:0\"> \n  <div class=\"es-wrapper-color\" style=\"background-color:#F6F6F6\"> \n   <!--[if gte mso 9]>\n\t\t\t<v:background xmlns:v=\"urn:schemas-microsoft-com:vml\" fill=\"t\">\n\t\t\t\t<v:fill type=\"tile\" color=\"#f6f6f6\"></v:fill>\n\t\t\t</v:background>\n\t\t<![endif]--> \n   <table class=\"es-wrapper\" width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;padding:0;Margin:0;width:100%;height:100%;background-repeat:repeat;background-position:center top\"> \n     <tr style=\"border-collapse:collapse\"> \n      <td valign=\"top\" style=\"padding:0;Margin:0\"> \n       <table class=\"es-content\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%\"> \n         <tr style=\"border-collapse:collapse\"> \n          <td style=\"padding:0;padding-top:88px;Margin:0;background-image:url({{payload.backgroundUrl}});background-color:#ffdc0f;background-position:top;background-repeat:no-repeat;background-size:cover\" bgcolor=\"#3d4c6b\" align=\"center\" background=\"https://images.pexels.com/photos/3760323/pexels-photo-3760323.jpeg\"> \n          <table class=\"es-content-body\" style=\"background-color:transparent\" width=\"640\" cellspacing=\"0\" cellpadding=\"0\" bgcolor=\"#f6f6f6\" align=\"center\"> \n            <tbody>\n             <tr>\n               <td class=\"esd-structure es-p20t es-p20r es-p201\" align=\"left\">\n                <table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n                  <tbody>\n                    <tr>\n                      <td width=\"600\" class=\"esd-container-frame\" align=\"center\" valign=\"top\">\n                        <table cellpadding=\"0\" cellspacing=\"0\" widt=\"100%\">\n                          <tr>\n                            <td align=\"center\" class=\"esd-block-image\" style=\"font-size: 0px; padding-top:30px;\">\n                              <a target=\"_blank\">\n                                <img class=\"adapt-img\" src=\"{{payload.logo}}\" style=\"display:block;\" width=\"300\">\n                              </a>\n                            </td>\n                          </tr>\n                        </table>\n                      </td>\n                    </tr>\n                  </tbody>\n                </table>\n               </td>\n             </tr>\n             <tr style=\"border-collapse:collapse\"> \n              <td align=\"left\" style=\"padding:0;Margin:0;padding-top:10px;padding-left:20px;padding-right:20px\"> \n               <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px\"> \n                 <tr style=\"border-collapse:collapse\"> \n                  <td valign=\"top\" align=\"center\" style=\"padding:0;Margin:0;width:600px\"> \n                   <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px\"> \n                     <tr style=\"border-collapse:collapse\"> \n                      <td align=\"center\" style=\"padding:0;Margin:0;padding-top:36px;padding-bottom:30px\"><h1 style=\"Margin:0;line-height:48px;mso-line-height-rule:exactly;font-family:'open sans', 'helvetica neue', helvetica, arial, sans-serif;font-size:35px;font-style:normal;font-weight:bold;color:#0c0909\">Welcome {{payload.firstname}}!</h1></td> \n                     </tr> \n                   </table></td> \n                 </tr> \n               </table></td> \n             </tr> \n             <tr style=\"border-collapse:collapse\"> \n              <td align=\"left\" style=\"Margin:0;padding-bottom:15px;padding-top:20px;padding-left:20px;padding-right:20px\"> \n               <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px\"> \n                 <tr style=\"border-collapse:collapse\"> \n                  <td valign=\"top\" align=\"center\" style=\"padding:0;Margin:0;width:600px\"> \n                   <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px\"> \n                     <tr style=\"border-collapse:collapse\"> \n                      <td esdev-links-color=\"#b7bdc9\" align=\"center\" style=\"padding:0;Margin:0;padding-top:15px;padding-bottom:20px\"><p style=\"Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-size:16px;font-family:'open sans', 'helvetica neue', helvetica, arial, sans-serif;line-height:24px;color:#0c0909\">{{payload.message}}<br></p></td> \n                     </tr> \n                   </table></td> \n                 </tr> \n               </table></td> \n             </tr> \n            </tbody>\n           </table></td> \n         </tr> \n       </table> \n       <table cellpadding=\"0\" cellspacing=\"0\" class=\"es-footer\" align=\"center\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;table-layout:fixed !important;width:100%;background-color:transparent;background-repeat:repeat;background-position:center top\"> \n         <tr style=\"border-collapse:collapse\"> \n          <td align=\"center\" style=\"padding:0;Margin:0\"> \n           <table class=\"es-footer-body\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px;background-color:transparent;width:640px;\"> \n             <tr style=\"border-collapse:collapse\"> \n              <td align=\"left\" style=\"Margin:0;padding-left:20px;padding-right:20px;padding-top:40px;padding-bottom:40px\"> \n               <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px\"> \n                \n                <tr style=\"border-collapse:collapse\"> \n                  <td align=\"center\" style=\"padding:0;Margin:0;padding-top:5px;padding-bottom:40px\"><span class=\"es-button-border\" style=\"border-style:solid;border-color:#ffdc0f;background:#ffdc0f;border-width:1px;display:inline-block;border-radius:28px;width:auto\"><a href=\"{{payload.activate_link}}\" class=\"es-button\" target=\"_blank\" style=\"mso-style-priority:100 !important;text-decoration:none;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:'open sans', 'helvetica neue', helvetica, arial, sans-serif;font-size:18px;color:#0c0909;border-style:solid;border-color:#ffdc0f;border-width:15px 25px 15px 25px;display:inline-block;background:#ffdc0f;border-radius:28px;font-weight:normal;font-style:normal;line-height:22px;width:auto;text-align:center\">{{payload.activate_text}}</a></span></td> \n                 </tr>  \n                <tr style=\"border-collapse:collapse\"> \n                  <td valign=\"top\" align=\"center\" style=\"padding:0;Margin:0;width:600px\"> \n                   <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\" style=\"mso-table-lspace:0pt;mso-table-rspace:0pt;border-collapse:collapse;border-spacing:0px\"> \n                     <tr style=\"border-collapse:collapse\"> \n                      <td align=\"center\" style=\"padding:0;Margin:0;padding-bottom:5px;font-size:0\"><a target=\"_blank\" href=\"\" style=\"-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-family:'open sans', 'helvetica neue', helvetica, arial, sans-serif;font-size:14px;text-decoration:none;color:#0c0909\"><img src=\"https://ixyjlx.stripocdn.email/content/guids/CABINET_729b6a94015d410538fa6f6810b21b85/images/55891519718168286.png\" alt=\"Logo\" style=\"display:block;border:0;outline:none;text-decoration:none;-ms-interpolation-mode:bicubic\" title=\"Logo\" width=\"35\"></a></td> \n                     </tr> \n                     <tr style=\"border-collapse:collapse\"> \n                      <td align=\"center\" style=\"padding:0;Margin:0;padding-top:15px;padding-bottom:15px\"><p style=\"Margin:0;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;mso-line-height-rule:exactly;font-size:14px;font-family:'open sans', 'helvetica neue', helvetica, arial, sans-serif;line-height:21px;color:#0c0909\">\n                        {{payload.submessage}}\n                      </p></td> \n                     </tr> \n                   </table></td> \n                 </tr> \n               </table></td> \n             </tr> \n           </table></td> \n         </tr> \n       </table></td> \n     </tr> \n   </table> \n  </div>  \n </body>\n</html>","output":"str","x":3260,"y":1740,"wires":[["f651b019.af01a"]]},{"id":"d40881d7.b0ff5","type":"comment","z":"d8703926.e2eca","name":"Create forms","info":"","x":1670,"y":1480,"wires":[]},{"id":"177a5e64.0e9a72","type":"debug","z":"d8703926.e2eca","name":"@@@@@@","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2130,"y":1540,"wires":[]},{"id":"57700237.bfe73c","type":"function","z":"d8703926.e2eca","name":"Route based on form FormType","func":"var user\n\nif ( msg.RevotioData.FlowData.Form.FormType === \"User\"){\n    user = msg;\n}\n\n\n\n\n\nreturn [user]\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":1500,"wires":[["988e14b1.c64a78"]],"outputLabels":["user"]},{"id":"988e14b1.c64a78","type":"function","z":"d8703926.e2eca","name":"Edit user Form","func":"var _ = global.get('underscore');\nvar lodash = global.get('lodash');\n\n\n\n\nmsg.form = {\n      id: 'view-user-form',\n      canceled: true, // false\n      submitButtonText: 'Submit',\n      prevButtonText: 'Previous',\n      nextButtonText: 'Next',\n      showPrevious: false, //false\n      Type: \"Update\",\n      FormType : \"User\",\n      user:msg.RevotioData.FlowData.Form.FormData._id,\n      Appuser_id: msg.RevotioData.FlowData.Form.FormData.user,\n    //   tab: msg.RevotioData.GadgetPost.gadgetData.tab,\n      title: 'View user',\n      steps: [\n        {\n          title: 'General information',\n          subtitle: '',\n          fields: [\n              {\n              name: 'first_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'First name',\n                placeholder: 'John',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                required: true // false by default\n              }\n            },\n              {\n              name: 'middle_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Middle name',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: false, // false by default\n                maxlength: 50\n              }\n            },\n            {\n              name: 'last_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Last name',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: 'Do',\n                required: true, // false by default\n                maxlength: 50\n              }\n            },\n            {\n              name: 'email',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Email address',\n                type: 'email', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: true, // false by default\n                maxlength: 50\n              }\n            },\n                        {\n              name: 'phone_number',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Phone number',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: false, // false by default\n                // min: 12,\n                // max: 12\n              }\n            },\n            \n          \n           {\n                name: 'avatar',\n                label: 'Avatar',\n                htmlTag: 'button',\n                options: {\n                value:msg.RevotioData.FlowData.Form.FormData.avatar,\n                type: 'upload',\n                folder: msg.RevotioData.domainData.DomainProperties.rootPath + \"users/\"+  msg.RevotioData.FlowData.Form.FormData.user + \"/\",\n                classes: 'md-icon-button md-primary',\n                // previewUrl:  msg.RevotioData.domainData.DomainProperties.url + msg.RevotioData.FlowData.Form.FormData.avatar,\n                // previewUrl: global.get(\"functions.fileManagement\")( msg.RevotioData.domainData.DomainProperties.rootPath + msg.RevotioData.FlowData.Form.FormData.avatar, msg.RevotioData.FlowData.Form.FormData.avatar ,msg.RevotioData.session._id, \"copySync\"), // source, destination, operation msg.RevotioData.domainData.DomainProperties.url + msg.RevotioData.session.UserData.avatar,\n                preview: 'inside', // inside / outside\n                previewPosition: 'right',\n                icon: 'fas fa-upload'\n                }\n                }\n            \n        ]},\n      ]\n    };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1920,"y":1500,"wires":[["141dd572.e74abb"]]},{"id":"141dd572.e74abb","type":"function","z":"d8703926.e2eca","name":"Map FormData","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n_.each(msg.form.steps, function(SlideValue, SlideIndex){\n    _.each(SlideValue.fields, function(fieldsValue, fieldsIndex){\n            if (msg.RevotioData.FlowData.Form.FormData.hasOwnProperty(fieldsValue.name)){\n                // check if the value is a date\n                                \n \n                        fieldsValue.options.value = msg.RevotioData.FlowData.Form.FormData[fieldsValue.name];\n                    // }\n                    \n                \n                }\n    });\n});\n\nmsg.RevotioData.FlowData.Form.Type = msg.RevotioData.FlowData.Form.FormActionType;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2140,"y":1500,"wires":[["cbbac0fa.8faad"]]},{"id":"9fe07b0e.5af2c8","type":"comment","z":"d8703926.e2eca","name":"Create forms","info":"","x":1670,"y":1600,"wires":[]},{"id":"4568e295.eafe4c","type":"function","z":"d8703926.e2eca","name":"Route based on form FormType","func":"var user\n\nif ( msg.RevotioData.FlowData.Form.FormType === \"User\"){\n    user = msg;\n}\n\n\n\n\n\nreturn [user]\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":1620,"wires":[["35e8c1df.8a815e"]],"outputLabels":["user"]},{"id":"35e8c1df.8a815e","type":"function","z":"d8703926.e2eca","name":"Edit user Form","func":"var _ = global.get('underscore');\nvar lodash = global.get('lodash');\n\n\n\n\nmsg.form = {\n      id: 'edit-user-form',\n      canceled: true, // false\n      submitButtonText: 'Submit',\n      prevButtonText: 'Previous',\n      nextButtonText: 'Next',\n      showPrevious: false, //false\n      Type: \"Update\",\n      FormType : \"User\",\n      user: msg.RevotioData.FlowData.Form.FormData.user,\n      Appuser_id: msg.RevotioData.FlowData.Form.FormData.user,\n      title: 'Edit user',\n      steps: [\n        {\n          title: 'General information',\n          subtitle: '',\n          fields: [\n              {\n              name: 'first_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'First name',\n                placeholder: 'John',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                required: true // false by default\n              }\n            },\n              {\n              name: 'middle_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Middle name',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: false, // false by default\n                maxlength: 50\n              }\n            },\n            {\n              name: 'last_name',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Last name',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: 'Do',\n                required: true, // false by default\n                maxlength: 50\n              }\n            },\n            {\n              name: 'email',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Email address',\n                type: 'email', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: true, // false by default\n                maxlength: 50\n              }\n            },\n                        {\n              name: 'phone_number',\n              htmlTag: 'input',  // button | select | textarea\n              options: {\n                value: '',\n                label: 'Phone number',\n                type: 'text', // default: text | button | checkbox | date | email | number | password | radio | submit\n                placeholder: '',\n                required: false, // false by default\n                // min: 12,\n                // max: 12\n              }\n            },\n            \n          \n           {\n                name: 'avatar',\n                label: 'Avatar',\n                htmlTag: 'button',\n                options: {\n                value:msg.RevotioData.FlowData.Form.FormData.avatar,\n                type: 'upload',\n                folder: msg.RevotioData.domainData.DomainProperties.rootPath + \"users/\"+  msg.RevotioData.FlowData.Form.FormData.user + \"/\",\n                classes: 'md-icon-button md-primary',\n                // previewUrl:  msg.RevotioData.domainData.DomainProperties.url + msg.RevotioData.FlowData.Form.FormData.avatar,\n                // previewUrl: global.get(\"functions.fileManagement\")( msg.RevotioData.domainData.DomainProperties.rootPath + msg.RevotioData.FlowData.Form.FormData.avatar, msg.RevotioData.FlowData.Form.FormData.avatar ,msg.RevotioData.session._id, \"copySync\"), // source, destination, operation msg.RevotioData.domainData.DomainProperties.url + msg.RevotioData.session.UserData.avatar,\n                preview: 'inside', // inside / outside\n                previewPosition: 'right',\n                icon: 'fas fa-upload'\n                }\n                }\n            \n        ]},\n      ]\n    };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1920,"y":1620,"wires":[["7a848414.8eb99c"]]},{"id":"7a848414.8eb99c","type":"function","z":"d8703926.e2eca","name":"Map FormData","func":"// Get libraries\nconst Moment = global.get('moment');\nconst MomentRange = global.get('momentrange');\nconst moment = MomentRange.extendMoment(Moment);\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\n\n_.each(msg.form.steps, function(SlideValue, SlideIndex){\n    _.each(SlideValue.fields, function(fieldsValue, fieldsIndex){\n            if (msg.RevotioData.FlowData.Form.FormData.hasOwnProperty(fieldsValue.name)){\n                // check if the value is a date\n                                \n \n                        fieldsValue.options.value = msg.RevotioData.FlowData.Form.FormData[fieldsValue.name];\n                    // }\n                    \n                \n                }\n    });\n});\n\nmsg.RevotioData.FlowData.Form.Type = msg.RevotioData.FlowData.Form.FormActionType;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2140,"y":1620,"wires":[[]]},{"id":"c5ab9339.eca4","type":"function","z":"a78ee99e.44ec48","name":"nodemailer_mailgun_transport && nodemailer","func":"// var request = global.get('request'); \nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar request = global.get('request');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nvar nodemailerMessage\n\nnode.warn({\n    RevotioData: msg.RevotioData,\n    type: \"Email\"\n})\nvar mailData = msg.RevotioData.domainData.email\nif (mailData.type === \"mailgun\"){\n\n \n        const auth = {\n          auth: {\n            api_key: mailData.apiKey,\n            domain: mailData.server\n          },\n       \n        }\n         \n        nodemailerMessage = nodemailer.createTransport(mg(auth));\n}\n else if (mailData.type === \"smtp\") {\n        \n        nodemailerMessage = nodemailer.createTransport( {\n            host: mailData.host,\n            port: mailData.port,\n            \"secure\":mailData.secure, \n            \"logger\":mailData.logger,\n            \"debug\": mailData.debug,\n            \"requireTLS\": mailData.requireTLS,\n            \"from\":mailData.from,\n            \"auth\": {\n              \"user\":mailData.auth.user,\n              \"pass\": mailData.auth.pass,\n          },\n         });\n        // base64Attachment =  msg.payload.data.toString('base64');\n        }\n        \n        node.warn({type:\"email\",\n                     message:\"PRE email send\",\n                    })\n   nodemailerMessage.sendMail({\n          from: mailData.from,\n          to: msg.data.email, // An array if you have multiple recipients.\n       \n          subject: msg.data.title,\n        //   'h:Reply-To': 'reply2this@company.com',\n          //You can use \"html:\" to send HTML email content. It's magic!\n          html: msg.payload,\n          //You can use \"text:\" to send plain-text content. It's oldschool!\n        //   text: 'Mailgun rocks, pow pow!',\n        //   attachments: [\n        //         {\n        //             cid: 'logo.png',\n        //             content: base64Attachment,\n        //             encoding: 'base64'\n        //         },]\n        }, (err, info) => {\n          if (err) {\n              node.send({err:err})\n               node.warn({type:\"email\",\n                            message:\"email err\",\n                            err:err,\n                            mailData:mailData\n                 })\n            // console.log(`Error: ${err}`);\n          }\n          else {\n                 node.send({info:info})\n                 node.warn({type:\"email\",\n                            message:\"email send\",\n                            info:info\n                 })\n            // console.log(`Response: ${info}`);\n          }\n        });\n\n// return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":160,"wires":[[]]},{"id":"f651b019.af01a","type":"subflow:a78ee99e.44ec48","z":"d8703926.e2eca","name":"","env":[],"x":3500,"y":1740,"wires":[[]]},{"id":"d23967ae.3f49a8","type":"subflow:5e9b9c1d.bbe4a4","z":"d8703926.e2eca","name":"","x":3360,"y":1800,"wires":[]},{"id":"b6a6b9bb.0557b8","type":"function","z":"d8703926.e2eca","name":"Route based on form FormType","func":"var user\n\nif ( msg.RevotioData.FlowData.Form.FormType === \"User\"){\n    user = msg;\n}\n\n\n\n\n\nreturn [user]\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1290,"y":1820,"wires":[["8898138d.a9ad8"]],"outputLabels":["user"]},{"id":"cf419bc2.c861c8","type":"link in","z":"d8703926.e2eca","name":"** Gadget Name **","links":["ff46d30.12df93","e3a4dd43.1f6c"],"x":1515,"y":2680,"wires":[["1de84887.f2d297"]]},{"id":"1de84887.f2d297","type":"function","z":"d8703926.e2eca","name":"item","func":"\nmsg.payload = {\n    gadgetsList:[\n \n       {\n  \"gadgetId\": \"4a91cebb-9c1d-f0ec-73bb-ab4a321401bb\",\n  \"gadgetName\": \"item\",\n  \"gadgetType\": \"custom-item-container\",\n  \"gadgetData\": [\n  {\n    \"gadgetId\": \"cfc71a73-6a60-514e-3f75-c1356ea6e277\",\n    \"gadgetName\": \"topbar text\",\n    \"gadgetType\": \"dynamic-text-area\",\n    \"gadgetData\": {\n      \"gadgetOptions\": {\n        \"disable\": true\n      },\n      \"data\": [\n        {\n          \"label\": \"Last login\",\n          \"value\": \"Tuesday, February 23rd 2021, 11:59:51 am\"\n        }\n      ],\n      \"options\": {\n        \"inlineTextSpace\": 10,\n        \"options\": {\n          \"label\": {\n            \"textWeight\": \"base\",\n            \"italic\": true,\n            \"size\": \"xs\"\n          },\n          \"value\": {\n            \"textWeight\": \"extrabold\",\n            \"italic\": false,\n            \"size\": \"xs\"\n          }\n        }\n      }\n    }\n  },\n  {\n    \"gadgetId\": \"aa41fd57-1b4d-22d6-3065-a7023676903a\",\n    \"gadgetName\": \"Topbar btn\",\n    \"gadgetType\": \"dynamic-btn\",\n    \"gadgetData\": {\n      \"title\": \"Dafydd\",\n      \"options\": [\n        {\n          \"title\": \"Last logins\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"loginRecords\",\n            \"FormType\": \"loginRecords\",\n            \"FormAction\": \"View\",\n            \"RevotioData\": {\n              \"user_id\": \"5bc85af71eabf93884014c55\"\n            }\n          },\n          \"design\": {\n            \"icon\": \"policy\"\n          }\n        },\n        {\n          \"title\": \"Overview\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"redirect\",\n            \"Page\": \"user_cockpit\",\n            \"RevotioData\": {\n              \"user_id\": \"5bc85af71eabf93884014c55\"\n            }\n          },\n          \"design\": {\n            \"icon\": \"view_quilt\"\n          }\n        },\n        {\n          \"title\": \"Create ticket\",\n          \"type\": \"supportTicket\",\n          \"link\": \"\",\n          \"action\": {\n            \"action\": \"form\",\n            \"FormType\": \"supportTicket\",\n            \"RevotioData\": {\n              \"user_id\": \"5bc85af71eabf93884014c55\"\n            }\n          },\n          \"design\": {\n            \"icon\": \"support_agent\"\n          }\n        },\n        {\n          \"title\": \"Manage tour preferences\",\n          \"type\": \"tour\",\n          \"link\": \"\",\n          \"actionType\": \"publisherAction\",\n          \"action\": \"tour\",\n          \"design\": {\n            \"icon\": \"support\",\n            \"switch\": true\n          }\n        },\n        {\n          \"title\": \"Log out\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"logout\"\n          },\n          \"design\": {\n            \"icon\": \"exit_to_app\"\n          }\n        },\n        {\n          \"title\": \"Clear cash\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"clearCash\"\n          },\n          \"design\": {\n            \"icon\": \"delete\"\n          }\n        }\n      ],\n      \"design\": {\n        \"iconType\": \"image\",\n        \"size\": \"large\"\n      },\n      \"tour\": {\n        \"content\": \"<p>Manage all your &nbsp;<strong>user account&nbsp;</strong>related actions, like last login info and creation of backoffice service requests.</p>\",\n        \"title\": \"User account actions\",\n        \"priority\": 8\n      }\n    },\n    \"gadgetOptions\": {\n      \"title\": \"Dafydd\",\n      \"buttonalign\": \"left\",\n      \"textcolor\": \"black\",\n      \"filePath\": \"/files/SystemFiles/icons/user.png\",\n      \"displayType\": \"image\",\n      \"dataType\": \"multiple\",\n      \"buttonlabel\": \"Dafydd Williams settings\",\n      \"action\": \"topbarBTN_action\"\n    }\n  },\n  {\n    \"gadgetId\": \"20810f83-caae-b636-a8e5-3c85a77c6a0d\",\n    \"gadgetName\": \"Topbar btn\",\n    \"gadgetType\": \"dynamic-btn\",\n    \"gadgetData\": {\n      \"title\": \"Settings\",\n      \"options\": [\n        {\n          \"title\": \"Form management\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"redirect\",\n            \"Page\": \"settings form management\",\n            \"RevotioData\": {\n              \"user_id\": \"5bc85af71eabf93884014c55\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Permission management\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"redirect\",\n            \"Page\": \"setting permission management\",\n            \"RevotioData\": {\n              \"user_id\": \"5bc85af71eabf93884014c55\"\n            }\n          },\n          \"design\": {\n            \"icon\": \"lock_open\"\n          }\n        },\n        {\n          \"title\": \"Project management\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"redirect\",\n            \"Page\": \"setting project management\",\n            \"RevotioData\": {\n              \"user_id\": \"5bc85af71eabf93884014c55\"\n            }\n          },\n          \"design\": {\n            \"icon\": \"dashboard\"\n          }\n        },\n        {\n          \"title\": \"Language management\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"redirect\",\n            \"Page\": \"settings_language_management\",\n            \"RevotioData\": {\n              \"user_id\": \"5bc85af71eabf93884014c55\"\n            }\n          },\n          \"design\": {\n            \"icon\": \"language\"\n          }\n        },\n        {\n          \"title\": \"Financial management\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"redirect\",\n            \"Page\": \"settings - financials management\",\n            \"RevotioData\": {\n              \"user_id\": \"5bc85af71eabf93884014c55\",\n              \"organization_id\": \"5ea985444667c455cf9ccc56\"\n            }\n          },\n          \"design\": {\n            \"icon\": \"€\"\n          }\n        }\n      ],\n      \"design\": {\n        \"icon\": \"settings\",\n        \"iconType\": \"icon\",\n        \"size\": \"large\"\n      },\n      \"tour\": {\n        \"content\": \"<p>Navigation for all permitted  &nbsp;<strong>application settings&nbsp;</strong>.</p>\",\n        \"title\": \"Application settings\",\n        \"priority\": 7\n      }\n    },\n    \"gadgetOptions\": {\n      \"disabled\": false,\n      \"dataType\": \"multiple\",\n      \"displayType\": \"image\",\n      \"buttonlabel\": \"Settings\"\n    }\n  },\n  {\n    \"gadgetId\": \"8034dad2-fe64-f005-fa6a-e30890655d28\",\n    \"gadgetName\": \"topbarBreadcrumbs\",\n    \"gadgetType\": \"breadcrumbs\",\n    \"gadgetData\": [\n      {\n        \"buttonData\": {\n          \"title\": \"\",\n          \"label\": \"Home\",\n          \"titleDisplayType\": \"selected\",\n          \"allowSearch\": true,\n          \"design\": {\n            \"icon\": \"house\"\n          },\n          \"action\": {\n            \"selected\": {\n              \"key\": \"home\",\n              \"value\": \"home\",\n              \"btnType\": \"redirect\",\n              \"Page\": \"user_cockpit\"\n            }\n          },\n          \"tour\": {\n            \"content\": \"<p>The&nbsp;<strong>Home&nbsp;</strong>button will quickly bring you back to the main page where all your organisations are presented.</p>\",\n            \"title\": \"Home\",\n            \"priority\": 1\n          }\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"single\",\n          \"displayType\": \"text\"\n        }\n      },\n      {\n        \"buttonData\": {\n          \"title\": \"organizations\",\n          \"label\": \"Organizations\",\n          \"titleDisplayType\": \"selected\",\n          \"FormType\": \"Organization\",\n          \"selected\": false,\n          \"allowSearch\": true,\n          \"design\": {\n            \"icon\": \"business\"\n          },\n          \"subButton\": [\n            {\n              \"icon\": \"visibility\",\n              \"action\": {\n                \"_id\": \"5ea985444667c455cf9ccc56\",\n                \"FormType\": \"Organization\",\n                \"FormActionType\": \"View\",\n                \"FormData\": {\n                  \"_id\": \"5ea985444667c455cf9ccc56\",\n                  \"legal_entity\": \"\",\n                  \"multiple_entity\": \"false\",\n                  \"name\": \"System organization\",\n                  \"type\": \"Master\"\n                },\n                \"organization_id\": \"5ea985444667c455cf9ccc56\"\n              },\n              \"type\": \"organization\",\n              \"color\": \"primary\",\n              \"organization_id\": \"5ea985444667c455cf9ccc56\",\n              \"tooltip\": \"View System organization data\"\n            },\n            {\n              \"icon\": \"add\",\n              \"action\": {\n                \"FormType\": \"Organization\",\n                \"FormActionType\": \"Create\"\n              },\n              \"type\": \"organization\",\n              \"color\": \"success\",\n              \"tooltip\": \"Create a new organization\",\n              \"tooltipPosition\": \"bottom\"\n            },\n            {\n              \"icon\": \"edit\",\n              \"action\": {\n                \"_id\": \"5ea985444667c455cf9ccc56\",\n                \"FormType\": \"Organization\",\n                \"FormActionType\": \"Edit\",\n                \"FormData\": {\n                  \"_id\": \"5ea985444667c455cf9ccc56\",\n                  \"legal_entity\": \"\",\n                  \"multiple_entity\": \"false\",\n                  \"name\": \"System organization\",\n                  \"type\": \"Master\"\n                },\n                \"organization_id\": \"5ea985444667c455cf9ccc56\"\n              },\n              \"type\": \"organization\",\n              \"color\": \"warning\",\n              \"organization_id\": \"5ea985444667c455cf9ccc56\",\n              \"tooltip\": \"Edit System organization\",\n              \"tooltipPosition\": \"bottom\"\n            },\n            {\n              \"icon\": \"delete\",\n              \"action\": {\n                \"_id\": \"5ea985444667c455cf9ccc56\",\n                \"FormType\": \"Organization\",\n                \"FormActionType\": \"Delete\",\n                \"FormData\": {\n                  \"_id\": \"5ea985444667c455cf9ccc56\",\n                  \"legal_entity\": \"\",\n                  \"multiple_entity\": \"false\",\n                  \"name\": \"System organization\",\n                  \"type\": \"Master\"\n                },\n                \"organization_id\": \"5ea985444667c455cf9ccc56\"\n              },\n              \"type\": \"organization\",\n              \"color\": \"danger\",\n              \"organization_id\": \"5ea985444667c455cf9ccc56\",\n              \"tooltip\": \"Delete System organization\",\n              \"tooltipPosition\": \"bottom\"\n            },\n            {\n              \"icon\": \"store\",\n              \"action\": {\n                \"FormType\": \"Organization\",\n                \"FormActionType\": \"create_suborg\",\n                \"FormData\": {\n                  \"_id\": \"5ea985444667c455cf9ccc56\",\n                  \"legal_entity\": \"\",\n                  \"multiple_entity\": \"false\",\n                  \"name\": \"System organization\",\n                  \"type\": \"Master\"\n                },\n                \"organization_id\": \"5ea985444667c455cf9ccc56\"\n              },\n              \"type\": \"organization\",\n              \"color\": \"success\",\n              \"organization_id\": \"5ea985444667c455cf9ccc56\",\n              \"tooltip\": \"Add suborganization\",\n              \"tooltipPosition\": \"bottom\"\n            }\n          ],\n          \"options\": [\n            {\n              \"title\": \"ffiqs\",\n              \"key\": \"organization\",\n              \"design\": {\n                \"icon\": \"business\"\n              },\n              \"selected\": false,\n              \"action\": {\n                \"key\": \"organization\",\n                \"value\": \"ffiqs\",\n                \"icon\": \"business\",\n                \"Page\": \"organization overview\",\n                \"organization_id\": \"5b3360ce41c82d3f438035cb\"\n              }\n            },\n            {\n              \"title\": \"System organization\",\n              \"key\": \"organization\",\n              \"design\": {\n                \"icon\": \"business\"\n              },\n              \"selected\": true,\n              \"action\": {\n                \"key\": \"organization\",\n                \"value\": \"System organization\",\n                \"icon\": \"business\",\n                \"Page\": \"organization overview\",\n                \"organization_id\": \"5ea985444667c455cf9ccc56\"\n              }\n            },\n            {\n              \"title\": \"MMDS\",\n              \"key\": \"organization\",\n              \"design\": {\n                \"icon\": \"business\"\n              },\n              \"selected\": false,\n              \"action\": {\n                \"key\": \"organization\",\n                \"value\": \"MMDS\",\n                \"icon\": \"business\",\n                \"Page\": \"organization overview\",\n                \"organization_id\": \"602ce43c8be482666130aa01\"\n              }\n            },\n            {\n              \"title\": \"SMMD\",\n              \"key\": \"organization\",\n              \"design\": {\n                \"icon\": \"business\"\n              },\n              \"selected\": false,\n              \"action\": {\n                \"key\": \"organization\",\n                \"value\": \"SMMD\",\n                \"icon\": \"business\",\n                \"Page\": \"organization overview\",\n                \"organization_id\": \"602cfbeda85d9d8e0deaa750\"\n              }\n            },\n            {\n              \"title\": \"Consultancy organization\",\n              \"key\": \"organization\",\n              \"design\": {\n                \"icon\": \"business\"\n              },\n              \"selected\": false,\n              \"action\": {\n                \"key\": \"organization\",\n                \"value\": \"Consultancy organization\",\n                \"icon\": \"business\",\n                \"Page\": \"organization overview\",\n                \"organization_id\": \"604f1e29d04b0ffadcf3c899\"\n              }\n            },\n            {\n              \"title\": \"Client organization\",\n              \"key\": \"organization\",\n              \"design\": {\n                \"icon\": \"business\"\n              },\n              \"selected\": false,\n              \"action\": {\n                \"key\": \"organization\",\n                \"value\": \"Client organization\",\n                \"icon\": \"business\",\n                \"Page\": \"organization overview\",\n                \"organization_id\": \"604f202dd04b0ffadcf3c932\"\n              }\n            },\n            {\n              \"title\": \"Partner organization\",\n              \"key\": \"organization\",\n              \"design\": {\n                \"icon\": \"business\"\n              },\n              \"selected\": false,\n              \"action\": {\n                \"key\": \"organization\",\n                \"value\": \"Partner organization\",\n                \"icon\": \"business\",\n                \"Page\": \"organization overview\",\n                \"organization_id\": \"604f2212d04b0ffadcf3c98d\"\n              }\n            }\n          ],\n          \"tour\": {\n            \"content\": \"<p>The main navigation is offered via the breadcrumb gadget.</p><p>It provides you:</p><ol><li>Insights in your current view/focus</li><li>the ability to navigate to other entities within the application</li><li>the possibility to trigger actions on the current active entity, action like:</li></ol><table style=\\\"height: 171px; margin-left: 30px; width: 530px;\\\"><tbody><tr style=\\\"height: 3px;\\\"><td style=\\\"width: 31px; height: 3px;\\\"><img src=\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAFqADAAQAAAABAAAAFgAAAAA/6RFgAAABxklEQVQ4EWNki331n4EGgIkGZoKNHDUYHrJDLyhY4G7HwxDjYWIwkGVmkOBnYrj76h/DhSd/GL7+wp9K8RosJ8jE0BTMxRBizcHAyswIt/rDl38Ms3Z/Z2jZ/I3h5x+4MAoDZxjrSDIz7K8TYIi042S4/fQvQ9r0TwzyOW8Z6pd/Yfj7j4GhLJCbYWsxPwMfB8JCZJOxGszCzMCwPJ+fQUYYyACCzDmfGUyUWBgO1QswvAG6dvK2b2BxW202hgnR3GA2OoHV4GgzdgY1KYiht579ZXj1+T9DmjsXg7woM0NZADfD/CM/4eZE2HIyyApgGoMpAtSy5dIvBlA4goCSODPDn3//GS4+gATmznM/Gdy1WcFyIOLkzV8M...\",\n            \"title\": \"Topbar sub buttons\",\n            \"priority\": 2\n          }\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"multiple\",\n          \"displayType\": \"text\"\n        }\n      },\n      {\n        \"buttonData\": {\n          \"title\": \"Projects\",\n          \"label\": \"Projects\",\n          \"allowSearch\": true,\n          \"titleDisplayType\": \"selected\",\n          \"design\": {\n            \"icon\": \"dashboard\"\n          },\n          \"subButton\": [\n            {\n              \"icon\": \"add\",\n              \"action\": {\n                \"FormType\": \"Project\",\n                \"FormActionType\": \"Create\",\n                \"organization_id\": \"5ea985444667c455cf9ccc56\"\n              },\n              \"type\": \"project\",\n              \"color\": \"green\",\n              \"organization_id\": \"5ea985444667c455cf9ccc56\",\n              \"tooltip\": \"Create a new project\"\n            }\n          ],\n          \"options\": [],\n          \"tour\": {\n            \"content\": \"<p>To quickly find entities in the list, you can use the <strong>Seach&nbsp;</strong>box in the dropdown</p><p style=\\\"padding-left: 60px;\\\"><img src=\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASIAAAAmCAYAAABgWJYUAAABSGlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8rAxMDPwMEgzaCVmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis9xO3lx3eeOW2woX3pjfCVwhgqkcBXCmpxclA+g8QpyUXFJUwMDCmANnK5SUFIHYHkC1SBHQUkD0HxE6HsDeA2EkQ9hGwmpAgZyD7BpAtkJyRCDSD8QWQrZOEJJ6OxIbaCwI8Lq4+PgqhRuaGph4EnEs6KEmtKAHRzvkFlUWZ6RklCo7AUEpV8MxL1tNRMDIwMmRgAIU5RPXnIHBYMortQ4jlL2FgsPjGwMA8ESGWNIWBYXsbA4PELYSYyjwGBv4WBoZthwoSixLhDmD8xlKcZmwEYfPYMzCw3v3//7MGAwP7RAaGvxP///+9+P//v4uB5t9mYDhQCQAFb2KCHncNIgAAAFZlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA5KGAAcAAAASAAAARKACAAQAAAABAAABIqADAAQAAAABAAAAJgAAAABBU0NJSQAAAFNjcmVlbnNob3TYZ5nWAAAB1WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5b...\",\n            \"title\": \"Search\",\n            \"priority\": 3\n          }\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"multiple\",\n          \"displayType\": \"text\"\n        }\n      }\n    ]\n  },\n  {\n    \"gadgetId\": \"8e6ecdb0-ca21-8847-0de3-ae9352d8bd2a\",\n    \"gadgetName\": \"Topbar btn\",\n    \"gadgetType\": \"dynamic-btn\",\n    \"gadgetOptions\": {\n      \"disabled\": false,\n      \"dataType\": \"single\",\n      \"displayType\": \"button\"\n    },\n    \"gadgetData\": {\n      \"design\": {\n        \"icon\": \"feedback\",\n        \"iconType\": \"icon\",\n        \"size\": \"large\"\n      },\n      \"title\": \"Feedback\",\n      \"action\": {\n        \"action\": \"form\",\n        \"FormType\": \"feedback\",\n        \"formData\": {\n          \"user\": \"5bc85af71eabf93884014c55\",\n          \"page\": \"user_cockpit\",\n          \"organization_id\": \"5ea985444667c455cf9ccc56\"\n        },\n        \"FormActionType\": \"Create\"\n      },\n      \"buttonType\": \"relief\",\n      \"tour\": {\n        \"content\": \"<p>Trigger the form to provide us &nbsp;<strong>your feedback&nbsp;</strong> we highly appreciate you taking the time to give us the chance to optimize our application.</p>\",\n        \"title\": \"Feedback\",\n        \"priority\": 5\n      }\n    }\n  },\n  {\n    \"gadgetName\": \"Topbar btn\",\n    \"gadgetId\": \"d6a6d106-18c4-179d-6636-115005896ef6\",\n    \"gadgetType\": \"dynamic-btn\",\n    \"gadgetData\": {\n      \"title\": \"Language\",\n      \"options\": [\n        {\n          \"title\": \"Abkhaz\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ab\",\n              \"name\": \"Abkhaz\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Afar\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"aa\",\n              \"name\": \"Afar\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Afrikaans\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"af\",\n              \"name\": \"Afrikaans\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Akan\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ak\",\n              \"name\": \"Akan\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Albanian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sq\",\n              \"name\": \"Albanian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Amharic\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"am\",\n              \"name\": \"Amharic\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Arabic\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ar\",\n              \"name\": \"Arabic\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Aragonese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"an\",\n              \"name\": \"Aragonese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Armenian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"hy\",\n              \"name\": \"Armenian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Assamese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"as\",\n              \"name\": \"Assamese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Avaric\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"av\",\n              \"name\": \"Avaric\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Avestan\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ae\",\n              \"name\": \"Avestan\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Aymara\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ay\",\n              \"name\": \"Aymara\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Azerbaijani\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"az\",\n              \"name\": \"Azerbaijani\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Bambara\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"bm\",\n              \"name\": \"Bambara\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Bashkir\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ba\",\n              \"name\": \"Bashkir\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Basque\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"eu\",\n              \"name\": \"Basque\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Belarusian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"be\",\n              \"name\": \"Belarusian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Bengali; Bangla\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"bn\",\n              \"name\": \"Bengali; Bangla\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Bihari\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"bh\",\n              \"name\": \"Bihari\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Bislama\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"bi\",\n              \"name\": \"Bislama\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Bosnian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"bs\",\n              \"name\": \"Bosnian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Breton\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"br\",\n              \"name\": \"Breton\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Bulgarian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"bg\",\n              \"name\": \"Bulgarian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Burmese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"my\",\n              \"name\": \"Burmese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Catalan; Valencian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ca\",\n              \"name\": \"Catalan; Valencian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Chamorro\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ch\",\n              \"name\": \"Chamorro\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Chechen\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ce\",\n              \"name\": \"Chechen\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Chichewa; Chewa; Nyanja\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ny\",\n              \"name\": \"Chichewa; Chewa; Nyanja\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Chinese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"zh\",\n              \"name\": \"Chinese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Chuvash\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"cv\",\n              \"name\": \"Chuvash\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Cornish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"kw\",\n              \"name\": \"Cornish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Corsican\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"co\",\n              \"name\": \"Corsican\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Cree\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"cr\",\n              \"name\": \"Cree\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Croatian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"hr\",\n              \"name\": \"Croatian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Czech\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"cs\",\n              \"name\": \"Czech\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Danish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"da\",\n              \"name\": \"Danish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Divehi; Dhivehi; Maldivian;\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"dv\",\n              \"name\": \"Divehi; Dhivehi; Maldivian;\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Dutch\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"nl\",\n              \"name\": \"Dutch\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Dzongkha\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"dz\",\n              \"name\": \"Dzongkha\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"English\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"en\",\n              \"name\": \"English\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Esperanto\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"eo\",\n              \"name\": \"Esperanto\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Estonian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"et\",\n              \"name\": \"Estonian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Ewe\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ee\",\n              \"name\": \"Ewe\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Faroese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"fo\",\n              \"name\": \"Faroese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Fijian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"fj\",\n              \"name\": \"Fijian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Finnish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"fi\",\n              \"name\": \"Finnish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"French\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"fr\",\n              \"name\": \"French\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Fula; Fulah; Pulaar; Pular\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ff\",\n              \"name\": \"Fula; Fulah; Pulaar; Pular\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Galician\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"gl\",\n              \"name\": \"Galician\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Ganda\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"lg\",\n              \"name\": \"Ganda\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Georgian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ka\",\n              \"name\": \"Georgian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"German\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"de\",\n              \"name\": \"German\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Greek, Modern\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"el\",\n              \"name\": \"Greek, Modern\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"GuaranÃ\\u00ad\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"gn\",\n              \"name\": \"GuaranÃ\\u00ad\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Gujarati\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"gu\",\n              \"name\": \"Gujarati\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Haitian; Haitian Creole\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ht\",\n              \"name\": \"Haitian; Haitian Creole\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Hausa\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ha\",\n              \"name\": \"Hausa\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Hebrew (modern)\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"he\",\n              \"name\": \"Hebrew (modern)\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Herero\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"hz\",\n              \"name\": \"Herero\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Hindi\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"hi\",\n              \"name\": \"Hindi\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Hiri Motu\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ho\",\n              \"name\": \"Hiri Motu\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Hungarian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"hu\",\n              \"name\": \"Hungarian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Icelandic\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"is\",\n              \"name\": \"Icelandic\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Ido\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"io\",\n              \"name\": \"Ido\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Igbo\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ig\",\n              \"name\": \"Igbo\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Indonesian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"id\",\n              \"name\": \"Indonesian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Interlingua\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ia\",\n              \"name\": \"Interlingua\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Interlingue\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ie\",\n              \"name\": \"Interlingue\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Inuktitut\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"iu\",\n              \"name\": \"Inuktitut\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Inupiaq\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ik\",\n              \"name\": \"Inupiaq\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Irish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ga\",\n              \"name\": \"Irish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Italian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"it\",\n              \"name\": \"Italian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Japanese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ja\",\n              \"name\": \"Japanese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Javanese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"jv\",\n              \"name\": \"Javanese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kalaallisut, Greenlandic\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"kl\",\n              \"name\": \"Kalaallisut, Greenlandic\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kannada\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"kn\",\n              \"name\": \"Kannada\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kanuri\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"kr\",\n              \"name\": \"Kanuri\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kashmiri\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ks\",\n              \"name\": \"Kashmiri\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kazakh\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"kk\",\n              \"name\": \"Kazakh\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Khmer\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"km\",\n              \"name\": \"Khmer\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kikuyu, Gikuyu\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ki\",\n              \"name\": \"Kikuyu, Gikuyu\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kinyarwanda\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"rw\",\n              \"name\": \"Kinyarwanda\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kirundi\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"rn\",\n              \"name\": \"Kirundi\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Komi\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"kv\",\n              \"name\": \"Komi\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kongo\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"kg\",\n              \"name\": \"Kongo\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Korean\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ko\",\n              \"name\": \"Korean\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kurdish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ku\",\n              \"name\": \"Kurdish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kwanyama, Kuanyama\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"kj\",\n              \"name\": \"Kwanyama, Kuanyama\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Kyrgyz\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ky\",\n              \"name\": \"Kyrgyz\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Lao\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"lo\",\n              \"name\": \"Lao\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Latin\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"la\",\n              \"name\": \"Latin\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Latvian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"lv\",\n              \"name\": \"Latvian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Limburgish, Limburgan, Limburger\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"li\",\n              \"name\": \"Limburgish, Limburgan, Limburger\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Lingala\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ln\",\n              \"name\": \"Lingala\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Lithuanian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"lt\",\n              \"name\": \"Lithuanian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Luba-Katanga\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"lu\",\n              \"name\": \"Luba-Katanga\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Luxembourgish, Letzeburgesch\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"lb\",\n              \"name\": \"Luxembourgish, Letzeburgesch\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Macedonian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"mk\",\n              \"name\": \"Macedonian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Malagasy\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"mg\",\n              \"name\": \"Malagasy\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Malay\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ms\",\n              \"name\": \"Malay\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Malayalam\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ml\",\n              \"name\": \"Malayalam\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Maltese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"mt\",\n              \"name\": \"Maltese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Manx\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"gv\",\n              \"name\": \"Manx\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Marathi (MarÄá¹\\u00adhÄ«)\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"mr\",\n              \"name\": \"Marathi (MarÄá¹\\u00adhÄ«)\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Marshallese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"mh\",\n              \"name\": \"Marshallese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Mongolian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"mn\",\n              \"name\": \"Mongolian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"MÄori\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"mi\",\n              \"name\": \"MÄori\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Nauru\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"na\",\n              \"name\": \"Nauru\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Navajo, Navaho\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"nv\",\n              \"name\": \"Navajo, Navaho\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Ndonga\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ng\",\n              \"name\": \"Ndonga\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Nepali\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ne\",\n              \"name\": \"Nepali\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"North Ndebele\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"nd\",\n              \"name\": \"North Ndebele\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Northern Sami\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"se\",\n              \"name\": \"Northern Sami\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Norwegian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"no\",\n              \"name\": \"Norwegian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Norwegian BokmÃ¥l\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"nb\",\n              \"name\": \"Norwegian BokmÃ¥l\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Norwegian Nynorsk\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"nn\",\n              \"name\": \"Norwegian Nynorsk\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Nuosu\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ii\",\n              \"name\": \"Nuosu\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Occitan\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"oc\",\n              \"name\": \"Occitan\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Ojibwe, Ojibwa\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"oj\",\n              \"name\": \"Ojibwe, Ojibwa\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Old Church Slavonic, Church Slavic, Church Slavonic, Old Bulgarian, Old Slavonic\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"cu\",\n              \"name\": \"Old Church Slavonic, Church Slavic, Church Slavonic, Old Bulgarian, Old Slavonic\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Oriya\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"or\",\n              \"name\": \"Oriya\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Oromo\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"om\",\n              \"name\": \"Oromo\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Ossetian, Ossetic\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"os\",\n              \"name\": \"Ossetian, Ossetic\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Panjabi, Punjabi\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"pa\",\n              \"name\": \"Panjabi, Punjabi\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Pashto, Pushto\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ps\",\n              \"name\": \"Pashto, Pushto\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Persian (Farsi)\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"fa\",\n              \"name\": \"Persian (Farsi)\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Polish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"pl\",\n              \"name\": \"Polish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Portuguese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"pt\",\n              \"name\": \"Portuguese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"PÄli\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"pi\",\n              \"name\": \"PÄli\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Quechua\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"qu\",\n              \"name\": \"Quechua\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Romanian, [])\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ro\",\n              \"name\": \"Romanian, [])\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Romansh\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"rm\",\n              \"name\": \"Romansh\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Russian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ru\",\n              \"name\": \"Russian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Samoan\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sm\",\n              \"name\": \"Samoan\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Sango\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sg\",\n              \"name\": \"Sango\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Sanskrit (Saá¹ská¹›ta)\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sa\",\n              \"name\": \"Sanskrit (Saá¹ská¹›ta)\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Sardinian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sc\",\n              \"name\": \"Sardinian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Scottish Gaelic; Gaelic\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"gd\",\n              \"name\": \"Scottish Gaelic; Gaelic\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Serbian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sr\",\n              \"name\": \"Serbian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Shona\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sn\",\n              \"name\": \"Shona\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Sindhi\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sd\",\n              \"name\": \"Sindhi\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Sinhala, Sinhalese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"si\",\n              \"name\": \"Sinhala, Sinhalese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Slovak\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sk\",\n              \"name\": \"Slovak\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Slovene\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sl\",\n              \"name\": \"Slovene\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Somali\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"so\",\n              \"name\": \"Somali\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"South Azerbaijani\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"az\",\n              \"name\": \"South Azerbaijani\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"South Ndebele\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"nr\",\n              \"name\": \"South Ndebele\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Southern Sotho\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"st\",\n              \"name\": \"Southern Sotho\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Spanish; Castilian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"es\",\n              \"name\": \"Spanish; Castilian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Sundanese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"su\",\n              \"name\": \"Sundanese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Swahili\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sw\",\n              \"name\": \"Swahili\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Swati\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ss\",\n              \"name\": \"Swati\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Swedish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"sv\",\n              \"name\": \"Swedish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tagalog\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"tl\",\n              \"name\": \"Tagalog\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tahitian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ty\",\n              \"name\": \"Tahitian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tajik\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"tg\",\n              \"name\": \"Tajik\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tamil\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ta\",\n              \"name\": \"Tamil\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tatar\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"tt\",\n              \"name\": \"Tatar\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Telugu\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"te\",\n              \"name\": \"Telugu\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Thai\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"th\",\n              \"name\": \"Thai\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tibetan Standard, Tibetan, Central\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"bo\",\n              \"name\": \"Tibetan Standard, Tibetan, Central\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tigrinya\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ti\",\n              \"name\": \"Tigrinya\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tonga (Tonga Islands)\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"to\",\n              \"name\": \"Tonga (Tonga Islands)\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tsonga\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ts\",\n              \"name\": \"Tsonga\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Tswana\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"tn\",\n              \"name\": \"Tswana\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Turkish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"tr\",\n              \"name\": \"Turkish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Turkmen\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"tk\",\n              \"name\": \"Turkmen\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Twi\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"tw\",\n              \"name\": \"Twi\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Ukrainian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"uk\",\n              \"name\": \"Ukrainian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Urdu\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ur\",\n              \"name\": \"Urdu\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Uyghur, Uighur\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ug\",\n              \"name\": \"Uyghur, Uighur\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Uzbek\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"uz\",\n              \"name\": \"Uzbek\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Venda\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"ve\",\n              \"name\": \"Venda\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Vietnamese\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"vi\",\n              \"name\": \"Vietnamese\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"VolapÃ¼k\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"vo\",\n              \"name\": \"VolapÃ¼k\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Walloon\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"wa\",\n              \"name\": \"Walloon\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Welsh\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"cy\",\n              \"name\": \"Welsh\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Western Frisian\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"fy\",\n              \"name\": \"Western Frisian\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Wolof\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"wo\",\n              \"name\": \"Wolof\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Xhosa\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"xh\",\n              \"name\": \"Xhosa\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Yiddish\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"yi\",\n              \"name\": \"Yiddish\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Yoruba\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"yo\",\n              \"name\": \"Yoruba\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Zhuang, Chuang\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"za\",\n              \"name\": \"Zhuang, Chuang\"\n            }\n          },\n          \"design\": {}\n        },\n        {\n          \"title\": \"Zulu\",\n          \"type\": \"action\",\n          \"action\": {\n            \"action\": \"languageSet\",\n            \"languageCode\": {\n              \"code\": \"zu\",\n              \"name\": \"Zulu\"\n            }\n          },\n          \"design\": {}\n        }\n      ],\n      \"allowSearch\": true,\n      \"searchPlaceholder\": \"Search\",\n      \"design\": {\n        \"icon\": \"language\",\n        \"iconType\": \"icon\",\n        \"size\": \"large\"\n      },\n      \"tour\": {\n        \"content\": \"<p>Select &nbsp;<strong>your language preference &nbsp;</strong>to interact with the application.</p>\",\n        \"title\": \"Language\",\n        \"priority\": 6\n      }\n    },\n    \"gadgetOptions\": {\n      \"disabled\": false,\n      \"dataType\": \"multiple\",\n      \"displayType\": \"image\",\n      \"buttonlabel\": \"Language\"\n    }\n  },\n  {\n    \"start\": \"2021-03-16T10:34:12.163Z\",\n    \"postProjects\": \"2021-03-16T10:34:13.228Z\",\n    \"userDataFileDate\": \"2021-03-16T10:34:13.246Z\",\n    \"postLookup\": \"2021-03-16T10:34:13.321Z\",\n    \"postBreadcrum\": \"2021-03-16T10:34:13.366Z\"\n  },\n  {\n    \"gadgetId\": \"3427872f-8aef-7ede-fe03-7481285edab9\",\n    \"gadgetName\": \"Topbar btn\",\n    \"gadgetType\": \"dynamic-btn\",\n    \"gadgetData\": {\n      \"switchOffLabel\": \"Tour off\",\n      \"switchOnLabel\": \"Off\",\n      \"title\": \"Tour on\",\n      \"actionType\": \"publisherAction\",\n      \"action\": \"tour\",\n      \"design\": {\n        \"icon\": \"support\",\n        \"iconType\": \"icon\",\n        \"size\": \"large\",\n        \"switch\": true\n      },\n      \"tour\": {\n        \"content\": \"<p>Manage you personal <strong>tour preferences</strong>.</p>\",\n        \"title\": \"Tour preferences\",\n        \"priority\": 4\n      }\n    },\n    \"gadgetOptions\": {\n      \"dataType\": \"single\",\n      \"displayType\": \"switch\"\n    }\n  }\n],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"display\": \"single\",\n  }\n}\n      \n      \n      \n      \n      \n      ]\n}\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"34136246-0bd7-c783-cb67-2be9c424c809\",\n  \"gadgetName\": \"itemCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push( \n       {\n  \"gadgetId\": \"2727ad11-7688-6825-829e-27a6975804c6\",\n  \"gadgetName\": \"itemDivider\",\n  \"gadgetType\": \"divider\",\n  \"gadgetData\": {\n    \"borderStyle\": \"solid\",\n    \"position\": \"right-center\",\n    \"icon\": \"bookmark\",\n    \"iconSize\": \"40\",\n    \"background\": \"transparent\",\n    \"title\": \"Item & screen profile\",\n    \"textTag\": \"h2\",\n    \"color\": \"primary\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false\n  }\n}\n      )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":2680,"wires":[["f416fa4d.8a69b8"]]},{"id":"f416fa4d.8a69b8","type":"link out","z":"d8703926.e2eca","name":"","links":["85ce669.6b97d18"],"x":2395,"y":2680,"wires":[]},{"id":"ccdb821.c63f28","type":"http request","z":"ac049260.12936","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://services-pmt-development.innonation.nl/organization_time_registration_dashboard","tls":"","persist":false,"proxy":"","authType":"","x":650,"y":460,"wires":[["ce948f48.1c2cd"]]},{"id":"3f24cc5a.4dd044","type":"inject","z":"ac049260.12936","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":460,"wires":[["e22e87c.88e9078"]]},{"id":"e22e87c.88e9078","type":"function","z":"ac049260.12936","name":"","func":"\nmsg.headers = {};\nmsg.rejectUnauthorized =  false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":460,"wires":[["ccdb821.c63f28"]]},{"id":"ce948f48.1c2cd","type":"debug","z":"ac049260.12936","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":900,"y":420,"wires":[]},{"id":"52911968.cbf0d8","type":"inject","z":"a2b40f09.d18fd8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":1180,"wires":[["11611eab.d23ce1"]]},{"id":"11611eab.d23ce1","type":"function","z":"a2b40f09.d18fd8","name":"download","func":"msg.headers = {};\nmsg.rejectUnauthorized =  false;\nurl = \"https://files.innonation.nl/download/\"\nstring = '?file=/files/users/60227758325875ba31252c81/test_excel.xlsx&type=file&requestingUrl=pmt-development.innonation.nl&token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWJjODVhZjcxZWFiZjkzODg0MDE0YzU1Iiwia2V5IjoidGVzdDEyMzQ1QEBAQEBAQEBAIiwicmV2b3Rpb1Nlc3Npb25JZCI6IjYwNmM0OWZkZDA4YzZiYWY2YWU2MjY5ZCIsImRldmljZUlkIjoiZmQ0MjkwOTA0Y2RiMThmNjI0OTE2ZGQwNWM0NTU5YTYiLCJ0eXBlIjoiYXV0aG9yaXplZCIsImlhdCI6MTYxNzcwOTYxMn0.pQL7Fe4x7fQy8QvPltvRN-r9mn9L4FRaTkNw-co7PGs&deviceId=fd4290904cdb18f624916dd05c4559a6&revotioSessionId=606c49fdd08c6baf6ae6269d&revotio-token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNWJjODVhZjcxZWFiZjkzODg0MDE0YzU1Iiwia2V5IjoidGVzdDEyMzQ1QEBAQEBAQEBAIiwicmV2b3Rpb1Nlc3Npb25JZCI6IjYwNmM0OWZkZDA4YzZiYWY2YWU2MjY5ZCIsImRldmljZUlkIjoiZmQ0MjkwOTA0Y2RiMThmNjI0OTE2ZGQwNWM0NTU5YTYiLCJ0eXBlIjoiYXV0aG9yaXplZCIsImlhdCI6MTYxNzcwOTYxMn0.pQL7Fe4x7fQy8QvPltvRN-r9mn9L4FRaTkNw-co7PGs'\n\nmsg.url = url+string\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":1180,"wires":[["9f3705b9.ef0ff8","2a781d6e.e47eb2"]]},{"id":"9f3705b9.ef0ff8","type":"http request","z":"a2b40f09.d18fd8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":1180,"wires":[["8393723d.98396","da38b772.3944e8"]]},{"id":"c66fcbc1.7670e8","type":"function","z":"a2b40f09.d18fd8","name":"Generate token","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nif (msg.PostPayload.content.hasOwnProperty(\"pageSessionId\") && msg.PostPayload.content.pageSessionId !== \"\" && ObjectID.isValid(msg.PostPayload.content.pageSessionId)){\n    \n        node.warn({\n        Type: \"YES page session ID\",\n        msg:msg\n    })\n    \n    findOne_objLimit = {\n                    query : {\n                            query :{_id : new ObjectID(msg.PostPayload.content.pageSessionId)},\n                            limit : 1\n                            },\n                    connection:msg.domainData.DB_data.connection,\n                    database:msg.domainData.DB_data.appDB,\n                    collection:'page_load_sessions',\n                    operation:'find',\n                    }\n\n            mongodbTools.resolveAsync(findOne_objLimit, node, function(res){\n                if (res.length > 0){\n                    page_load_session = res[0]\n                \n                  \n                    TokenContent = {};\n                    // verify a token symmetric\n                        jsonwebtoken.verify(page_load_session.token, msg.domainData.SystemVars.secret, function(err, decoded) {\n                          if (decoded !== undefined){\n                              \n                              TokenContent = decoded\n                          }\n                        });\n                        \n                       \n                        \n                        msg.PostPayload.content.type = TokenContent.type\n                        \n                       if (msg.domainData.SystemVars.hasOwnProperty(\"tokenSecret\")){\n                            msg.PostPayload.content.key  = msg.domainData.SystemVars.tokenSecret\n                        } else {\n                            msg.PostPayload.content.key  = new ObjectID()\n                        }\n                        \n                        payload = {type : msg.PostPayload.type, token : jsonwebtoken.sign(msg.PostPayload.content, msg.domainData.SystemVars.secret)};\n                        \n                        msg.PostPayload.content.token = payload.token\n                        \n                        msg.payload = payload\n                        \n                        // update     \n                        \n                        msg.payload.key =  msg.PostPayload.content.key\n                    \n                    \n                } else {\n                    \n                    \n                    msg.PostPayload.content.type = \"unauthorized\"\n                    \n                    if (msg.domainData.SystemVars.hasOwnProperty(\"tokenSecret\")){\n                         msg.PostPayload.content.key  = msg.domainData.SystemVars.tokenSecret\n                    } else {\n                         msg.PostPayload.content.key  = new ObjectID()\n                    }\n                   \n                    \n                    payload = {type : msg.PostPayload.type, token : jsonwebtoken.sign(msg.PostPayload.content, msg.domainData.SystemVars.secret)};\n                    \n                    msg.PostPayload.content.token = payload.token\n                    \n                    msg.payload = payload\n                    \n                    // update     \n                    \n                    msg.payload.key =  msg.PostPayload.content.key\n                   \n                }\n                    \n                    node.send(msg) \n            })  \n            \n} else {\n    \n    node.warn({\n        Type: \"no page session ID\",\n        msg:msg\n    })\n    \n            msg.PostPayload.content.type = \"unauthorized\"\n               if (msg.domainData.SystemVars.hasOwnProperty(\"tokenSecret\")){\n                         msg.PostPayload.content.key  = msg.domainData.SystemVars.tokenSecret\n                    } else {\n                         msg.PostPayload.content.key  = new ObjectID()\n                    }\n            \n            payload = {type : msg.PostPayload.type, token : jsonwebtoken.sign(msg.PostPayload.content, msg.domainData.SystemVars.secret)};\n            \n            msg.PostPayload.content.token = payload.token\n            \n            msg.payload = payload\n            \n            // update     \n            \n            msg.payload.key =  msg.PostPayload.content.key\n            node.send(msg)\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":1060,"wires":[["1d2f7572.e3302b"]]},{"id":"1d2f7572.e3302b","type":"function","z":"a2b40f09.d18fd8","name":"Get /Set key","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n//**********************************************\n// update    \n    updateObj = {\n                    query : {\n                            query :{    revotioSessionId:msg.PostPayload.content.revotioSessionId,\n                                        deviceId:msg.PostPayload.content.deviceId}, \n                            update : { \"$set\" : {token : msg.payload.token}},\n                            options : {upsert: true, returnOriginal: false}\n                            },\n                    connection:msg.domainData.DB_data.connection,\n                    database:msg.domainData.DB_data.appDB,\n                    collection:'sessions',\n                    operation:'findOneAndUpdate', // updateMany , updateOne\n                    }\n\n            mongodbTools.resolveAsync(updateObj, node, function(res){\n                    msg.findOneAndUpdateResponse = res\n                    node.send(msg) \n            }) ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":1060,"wires":[[]]},{"id":"2a781d6e.e47eb2","type":"debug","z":"a2b40f09.d18fd8","name":"A","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":1120,"wires":[]},{"id":"8393723d.98396","type":"debug","z":"a2b40f09.d18fd8","name":"B","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":1140,"wires":[]},{"id":"da38b772.3944e8","type":"function","z":"a2b40f09.d18fd8","name":"parse response","func":"msg.response = JSON.parse(msg.payload)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":1200,"wires":[["dc03256a.558e28"]]},{"id":"dc03256a.558e28","type":"debug","z":"a2b40f09.d18fd8","name":"C","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":1300,"wires":[]},{"id":"8c39ea2c.6e6028","type":"comment","z":"9de255bd.0d0938","name":"fileManager","info":"","x":230,"y":420,"wires":[]},{"id":"9b5cd8be.fa1ef8","type":"comment","z":"9de255bd.0d0938","name":"fileManager gagdet actions","info":"","x":3230,"y":360,"wires":[]},{"id":"4b1312b9.a1445c","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2550,"y":320,"wires":[]},{"id":"a5f49aeb.d07d18","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","3d4cff93.1bb22"],"x":835,"y":500,"wires":[["ad22c945.257c28","d0d1b75e.76d058"]]},{"id":"57253d74.2e5fb4","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var   MenuAction,  resetPage, gadgetAction;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n} else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    gadgetAction = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,  resetPage, gadgetAction];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":500,"wires":[["256fec14.3e4914"],["78c96950.bd4768"],["56182296.2c68ec"]],"outputLabels":[" MenuAction","resetPage","gadgetAction"]},{"id":"bcf9ba9c.93cf38","type":"debug","z":"9de255bd.0d0938","name":"fileManager Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3170,"y":400,"wires":[]},{"id":"869a68db.069b78","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","6543956a.553dac","26c29dda.6daf62","cd9f1d1b.bf34","b72bb7ae.4495b8","f8235377.6d569","662d87cc.7d0548","8929def7.0f4f5","9d0d8058.675b9","3648209c.9bd2c","50782444.56a8ec","b9b84fca.e64d9","33162ce5.e32d44"],"x":1215,"y":500,"wires":[]},{"id":"89d1e967.da7a78","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":800,"y":460,"wires":[]},{"id":"ad22c945.257c28","type":"debug","z":"9de255bd.0d0938","name":"fileManager INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":980,"y":460,"wires":[]},{"id":"35c9e50.5bfbd1c","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","e3e7bc7c.2960a"],"x":3035,"y":500,"wires":[["bcf9ba9c.93cf38","57253d74.2e5fb4"]]},{"id":"7ba3bdac.3fd774","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","e0ad8922.6601b8"],"x":795,"y":400,"wires":[["f94b4833.393f08"]]},{"id":"818f2.ee06c70e","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1370,"y":400,"wires":[]},{"id":"35d8029d.b15c1e","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":400,"wires":[["a2f34886.8d7d28"]]},{"id":"e446bfa3.49379","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":800,"y":360,"wires":[]},{"id":"6543956a.553dac","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["869a68db.069b78"],"x":1495,"y":600,"wires":[["c484ec69.37a8f"]]},{"id":"14cd732c.7b657d","type":"http in","z":"9de255bd.0d0938","name":"fileManager","url":"/fileManager","method":"post","upload":false,"swaggerDoc":"","x":210,"y":480,"wires":[["d5956eff.b60e1"]]},{"id":"e0ad8922.6601b8","type":"link out","z":"9de255bd.0d0938","name":"","links":["7ba3bdac.3fd774"],"x":475,"y":440,"wires":[]},{"id":"3d4cff93.1bb22","type":"link out","z":"9de255bd.0d0938","name":"","links":["a5f49aeb.d07d18"],"x":475,"y":480,"wires":[]},{"id":"e3e7bc7c.2960a","type":"link out","z":"9de255bd.0d0938","name":"","links":["35c9e50.5bfbd1c"],"x":475,"y":520,"wires":[]},{"id":"efa16062.24f86","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":550,"y":480,"wires":[]},{"id":"b3c9df7f.6a411","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":560,"y":440,"wires":[]},{"id":"531ba21f.934a8c","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":550,"y":520,"wires":[]},{"id":"f94b4833.393f08","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":900,"y":400,"wires":[["35d8029d.b15c1e"]]},{"id":"d5956eff.b60e1","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":330,"y":480,"wires":[["e0ad8922.6601b8"],["3d4cff93.1bb22"],["e3e7bc7c.2960a"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"256fec14.3e4914","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3340,"y":440,"wires":[["59e6fd2f.725424"]]},{"id":"c484ec69.37a8f","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1680,"y":600,"wires":[["1af6fe34.485702"]]},{"id":"a2f34886.8d7d28","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1220,"y":400,"wires":[["818f2.ee06c70e"]]},{"id":"b72bb7ae.4495b8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["869a68db.069b78","78c96950.bd4768"],"x":1495,"y":360,"wires":[["c1f62341.3ec02"]]},{"id":"c1f62341.3ec02","type":"function","z":"9de255bd.0d0938","name":"basic","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\n\nmsg.payload = {\n    gadgetsList:[\n                {\n                      \"gadgetId\": \"a083095d-5f95-aa0b-bd92-72850559edce\",\n                      \"gadgetType\": \"file-manager\",\n                      \"gadgetName\": \"basic\",\n                      \"gadgetOptions\": {\n                        \"maxItems\": -100000000,\n                        \"searchCurrentDir\": false\n                      },\n                      \"gadgetData\": {\n                        \"path\": \"\",\n                        \"parent\": {\n                          \"absolutePath\":msg.RevotioData.FlowData.gadgetOptions.folder,\n                          \"filePath\": \"/\",\n                          \"type\": \"folder\",\n                          \"extensionName\": \"\",\n                          \"size\": -100000000,\n                          \"accessTime\": \"\",\n                          \"changedTime\": \"\",\n                          \"modifiedTime\": \"\",\n                          \"name\": \"Home\",\n                          \"options\": {\n                            \"rename\": false,\n                            \"move\": false,\n                            \"delete\": false,\n                            \"addNewFile\": false,\n                            \"createNewFolder\": false\n                          }\n                        },\n                        \"child\": msg.RevotioData.FlowData.gadgetOptions.folderContent,\n                        \"listColumnData\": {\n                          \"columnHead\": [\n                            {\n                              \"title\": \"Preview\",\n                              \"allowSort\": false,\n                              \"headKey\": \"prev\",\n                              \"hidden\": false,\n                              \"displayType\": \"file\"\n                            },\n                            {\n                              \"title\": \"Name\",\n                              \"allowSort\": false,\n                              \"headKey\": \"name\",\n                              \"hidden\": false,\n                              \"displayType\": \"string\"\n                            }\n                          ],\n                          \"columnOptions\": {\n                            \"columnStyle\": {\n                              \"color\": \"red\",\n                              \"font-size\": \"12px\"\n                            },\n                            \"cellStyle\": {\n                              \"color\": \"red\",\n                              \"font-size\": \"12px\"\n                            },\n                            \"allowSort\": false\n                          }\n                        },\n                        \"directoryTree\": [\n                          {\n                            \"name\": \"`home`\",\n                            \"filePath\": \"/\",\n                            \"type\": \"dir\",\n                            \"extensionName\": \"doc\",\n                            \"children\": \n                             msg.RevotioData.FlowData.gadgetOptions.folderContent\n                            \n                          }\n                        ]\n                      }\n                    }\n      \n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"83d65ed1-6120-a884-a4e4-0a8c33ad7fec\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":360,"wires":[["989bb7c5.8f5918"]]},{"id":"f8235377.6d569","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["869a68db.069b78","78c96950.bd4768"],"x":1495,"y":440,"wires":[["e4fa3f3d.987eb"]]},{"id":"e4fa3f3d.987eb","type":"function","z":"9de255bd.0d0938","name":"CRUD","func":"\nmsg.payload = {\n    gadgetsList:[\n                {\n                      \"gadgetId\": \"10a1b27a-32c2-a5dd-2cff-4e1db114635e\",\n                      \"gadgetType\": \"file-manager\",\n                      \"gadgetName\": \"CRUD\",\n                      \"gadgetOptions\": {\n                        \"maxItems\": -100000000,\n                        \"searchCurrentDir\": false\n                      },\n                      \"gadgetData\": {\n                        \"path\": \"\",\n                        \"parent\": {\n                          \"absolutePath\":msg.RevotioData.FlowData.gadgetOptions.folder,\n                          \"filePath\": \"/\",\n                          \"type\": \"folder\",\n                          \"extensionName\": \"\",\n                          \"size\": -100000000,\n                          \"accessTime\": \"\",\n                          \"changedTime\": \"\",\n                          \"modifiedTime\": \"\",\n                          \"name\": \"Home\",\n                          \"options\": {\n                            \"rename\": false,\n                            \"move\": false,\n                            \"delete\": false,\n                            \"addNewFile\": false,\n                            \"createNewFolder\": false\n                          }\n                        },\n                        \"child\": msg.RevotioData.FlowData.gadgetOptions.folderContent,\n                        \"listColumnData\": {\n                          \"columnHead\": [\n                            {\n                              \"title\": \"Preview\",\n                              \"allowSort\": false,\n                              \"headKey\": \"prev\",\n                              \"hidden\": false,\n                              \"displayType\": \"file\"\n                            },\n                            {\n                              \"title\": \"Name\",\n                              \"allowSort\": false,\n                              \"headKey\": \"name\",\n                              \"hidden\": false,\n                              \"displayType\": \"string\"\n                            }\n                          ],\n                          \"columnOptions\": {\n                            \"columnStyle\": {\n                              \"color\": \"red\",\n                              \"font-size\": \"12px\"\n                            },\n                            \"cellStyle\": {\n                              \"color\": \"red\",\n                              \"font-size\": \"12px\"\n                            },\n                            \"allowSort\": false\n                          }\n                        },\n                        \"directoryTree\": [\n                          {\n                            \"name\": \"`home`\",\n                            \"filePath\": \"/\",\n                            \"type\": \"dir\",\n                            \"extensionName\": \"doc\",\n                            \"children\": \n                             msg.RevotioData.FlowData.gadgetOptions.folderContent\n                            \n                          }\n                        ]\n                      }\n                    }\n      \n      \n      ]\n}\n\n\nmsg.payload.gadgetsList.push(\n       {\n  \"gadgetId\": \"2a631ecd-7b7f-67bd-98dd-a39347cd3d48\",\n  \"gadgetName\": \"rangeCode\",\n  \"gadgetType\": \"code-block\",\n  \"gadgetData\": {\n    \"content\": msg.payload.gadgetsList[0],\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n}\n      )\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"rangeDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"CRUD\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":440,"wires":[["3c5c019.7d8ccfe"]]},{"id":"56182296.2c68ec","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"60aa3272-5726-f1ba-0fb8-c27062aa4074\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3730,"y":520,"wires":[["e9cd7eb.8b48f8"]]},{"id":"1637ba9b.33be35","type":"function","z":"9de255bd.0d0938","name":"Set msg.data","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.data  = []\n\n_.each(msg.RevotioData.PostData.gadgetData, function(value , key){\n    \n    if (typeof value === \"object\"){\n        _.each(value, function(valueValue, valueValueKey){\n            msg.data.push({\n                    \"label\": key +\".\"+valueValueKey,\n                    \"value\": valueValue\n                  })\n    \n        })\n    } else {\n        msg.data.push({\n        \"label\": key,\n        \"value\": value\n      })\n    \n    }\n    \n    \n})\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3540,"y":640,"wires":[["56182296.2c68ec"]]},{"id":"9d0d8058.675b9","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["869a68db.069b78","78c96950.bd4768"],"x":1495,"y":520,"wires":[["59644ff9.45fb2"]]},{"id":"59644ff9.45fb2","type":"function","z":"9de255bd.0d0938","name":"tour","func":"\nmsg.payload = {\n    gadgetsList:[\n                {\n              \"gadgetId\": \"1de419d0-4ac1-2a00-d907-691c35f5ab4c\",\n  \"gadgetType\": \"file-manager\",\n  \"gadgetName\": \"tour\",\n                      \"gadgetOptions\": {\n                        \"maxItems\": -100000000,\n                        \"searchCurrentDir\": false\n                      },\n                      \"gadgetData\": {\n                              \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    },\n                        \"path\": \"\",\n                        \"parent\": {\n                          \"absolutePath\":msg.RevotioData.FlowData.gadgetOptions.folder,\n                          \"filePath\": \"/\",\n                          \"type\": \"folder\",\n                          \"extensionName\": \"\",\n                          \"size\": -100000000,\n                          \"accessTime\": \"\",\n                          \"changedTime\": \"\",\n                          \"modifiedTime\": \"\",\n                          \"name\": \"Home\",\n                          \"options\": {\n                            \"rename\": false,\n                            \"move\": false,\n                            \"delete\": false,\n                            \"addNewFile\": false,\n                            \"createNewFolder\": false\n                          }\n                        },\n                        \"child\": msg.RevotioData.FlowData.gadgetOptions.folderContent,\n                        \"listColumnData\": {\n                          \"columnHead\": [\n                            {\n                              \"title\": \"Preview\",\n                              \"allowSort\": false,\n                              \"headKey\": \"prev\",\n                              \"hidden\": false,\n                              \"displayType\": \"file\"\n                            },\n                            {\n                              \"title\": \"Name\",\n                              \"allowSort\": false,\n                              \"headKey\": \"name\",\n                              \"hidden\": false,\n                              \"displayType\": \"string\"\n                            }\n                          ],\n                          \"columnOptions\": {\n                            \"columnStyle\": {\n                              \"color\": \"red\",\n                              \"font-size\": \"12px\"\n                            },\n                            \"cellStyle\": {\n                              \"color\": \"red\",\n                              \"font-size\": \"12px\"\n                            },\n                            \"allowSort\": false\n                          }\n                        },\n                        \"directoryTree\": [\n                          {\n                            \"name\": \"`home`\",\n                            \"filePath\": \"/\",\n                            \"type\": \"dir\",\n                            \"extensionName\": \"doc\",\n                            \"children\": \n                             msg.RevotioData.FlowData.gadgetOptions.folderContent\n                            \n                          }\n                        ]\n                      }\n                    }\n      \n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"6b80b4a7-472c-14b6-9327-357f23a4edef\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":520,"wires":[["b78823e3.f2b6a"]]},{"id":"3648209c.9bd2c","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["869a68db.069b78","78c96950.bd4768"],"x":1495,"y":400,"wires":[["39641ad5.e76016"]]},{"id":"39641ad5.e76016","type":"function","z":"9de255bd.0d0938","name":"drag","func":"\n\n\nmsg.payload = {\n    gadgetsList:[\n                {\n                          \"gadgetId\": \"33ffcfb9-d7b8-92e0-99b5-b6fbe8c55f4d\",\n                          \"gadgetType\": \"file-manager\",\n                          \"gadgetName\": \"drag\",\n                      \"gadgetOptions\": {\n                        \"maxItems\": -100000000,\n                        \"searchCurrentDir\": false\n                      },\n                      \"gadgetData\": {\n                        \"path\": \"\",\n                        \"parent\": {\n                          \"absolutePath\":msg.RevotioData.FlowData.gadgetOptions.folder,\n                          \"filePath\": \"/\",\n                          \"type\": \"folder\",\n                          \"extensionName\": \"\",\n                          \"size\": -100000000,\n                          \"accessTime\": \"\",\n                          \"changedTime\": \"\",\n                          \"modifiedTime\": \"\",\n                          \"name\": \"Home\",\n                          \"options\": {\n                            \"rename\": false,\n                            \"move\": false,\n                            \"delete\": false,\n                            \"addNewFile\": false,\n                            \"createNewFolder\": false\n                          }\n                        },\n                        \"child\": msg.RevotioData.FlowData.gadgetOptions.folderContent,\n                        \"listColumnData\": {\n                          \"columnHead\": [\n                            {\n                              \"title\": \"Preview\",\n                              \"allowSort\": false,\n                              \"headKey\": \"prev\",\n                              \"hidden\": false,\n                              \"displayType\": \"file\"\n                            },\n                            {\n                              \"title\": \"Name\",\n                              \"allowSort\": false,\n                              \"headKey\": \"name\",\n                              \"hidden\": false,\n                              \"displayType\": \"string\"\n                            }\n                          ],\n                          \"columnOptions\": {\n                            \"columnStyle\": {\n                              \"color\": \"red\",\n                              \"font-size\": \"12px\"\n                            },\n                            \"cellStyle\": {\n                              \"color\": \"red\",\n                              \"font-size\": \"12px\"\n                            },\n                            \"allowSort\": false\n                          }\n                        },\n                        \"directoryTree\": [\n                          {\n                            \"name\": \"`home`\",\n                            \"filePath\": \"/\",\n                            \"type\": \"dir\",\n                            \"extensionName\": \"doc\",\n                            \"children\": \n                             msg.RevotioData.FlowData.gadgetOptions.folderContent\n                            \n                          }\n                        ]\n                      }\n                    }\n      \n      \n      ]\n}\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"bc72a15d-b52f-680f-4630-a69eef419438\",\n  \"gadgetName\": \"dragCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"dragDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Drag\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":400,"wires":[["971ed970.9f9a48"]]},{"id":"50782444.56a8ec","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["869a68db.069b78","78c96950.bd4768"],"x":1495,"y":560,"wires":[["80aa2d30.ba7d9"]]},{"id":"80aa2d30.ba7d9","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1680,"y":560,"wires":[["c06136a.92480c8"]]},{"id":"78c96950.bd4768","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","b72bb7ae.4495b8","f8235377.6d569","662d87cc.7d0548","8929def7.0f4f5","9d0d8058.675b9","3648209c.9bd2c","50782444.56a8ec"],"x":3395,"y":480,"wires":[]},{"id":"9aa27537.ec6118","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"eeab0124-3b3f-f3ee-ea67-fa7f10754782\",\n  \"gadgetName\": \"title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>File-manager</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1670,"y":640,"wires":[["6a3db0fa.307"]]},{"id":"b9b84fca.e64d9","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["869a68db.069b78"],"x":1495,"y":640,"wires":[["9aa27537.ec6118"]]},{"id":"d0d1b75e.76d058","type":"function","z":"9de255bd.0d0938","name":"File manager INIT","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\n\nmsg.RevotioData.FlowData.gadgetOptions= {\n    \n    folder: \"/files/file-managerTMP\"\n    \n    \n}\n\n// With a callback:\nfs.ensureDir(msg.RevotioData.FlowData.gadgetOptions.folder, err => {\n  console.log(err) // => null\n  // dir has now been created, including the directory it is to be placed in\n  \n  msg.RevotioData.FlowData.gadgetOptions.folderContent = []\n  _.each(fs.readdirSync(msg.RevotioData.FlowData.gadgetOptions.folder), function(folderItem, folderItemIndex){\n    \n    data =  fs.statSync(msg.RevotioData.FlowData.gadgetOptions.folder +\"/\"+folderItem)\n   data.name =folderItem\n   data.absolutePath = msg.RevotioData.FlowData.gadgetOptions.folder +\"/\" + folderItem\n   data.filePath = \"/\"\n   data.options = {\n       rename : false,\n       move : false,\n       delete : false,\n       addNewFile : false,\n       createNewFolder : false\n   }\n    msg.RevotioData.FlowData.gadgetOptions.folderContent.push(data)\n\n})\n\n  node.send(msg)\n  \n})\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":500,"wires":[["869a68db.069b78","6dbbac0a.370484"]]},{"id":"6dbbac0a.370484","type":"debug","z":"9de255bd.0d0938","name":"fileManager INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1180,"y":660,"wires":[]},{"id":"989bb7c5.8f5918","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2295,"y":360,"wires":[]},{"id":"971ed970.9f9a48","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2295,"y":400,"wires":[]},{"id":"3c5c019.7d8ccfe","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2295,"y":440,"wires":[]},{"id":"b78823e3.f2b6a","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2295,"y":520,"wires":[]},{"id":"c06136a.92480c8","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2355,"y":560,"wires":[]},{"id":"1af6fe34.485702","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2355,"y":600,"wires":[]},{"id":"6a3db0fa.307","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":2355,"y":640,"wires":[]},{"id":"59e6fd2f.725424","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":3435,"y":440,"wires":[]},{"id":"e9cd7eb.8b48f8","type":"link out","z":"9de255bd.0d0938","name":"","links":["6319a4af.c1413c"],"x":3895,"y":520,"wires":[]},{"id":"bb26c67a.ed71c8","type":"comment","z":"9921cbf1.f82328","name":"custom-item-container","info":"","x":200,"y":2780,"wires":[]},{"id":"f09c570f.65d868","type":"comment","z":"9921cbf1.f82328","name":"Organization global gagdet actions","info":"","x":3340,"y":2720,"wires":[]},{"id":"f5522d7d.dbe1a","type":"comment","z":"9921cbf1.f82328","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2490,"y":2680,"wires":[]},{"id":"5d9874b1.4e7fbc","type":"link in","z":"9921cbf1.f82328","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","161aea2e.5d62c6"],"x":795,"y":2900,"wires":[["9755e8fa.4b1bd8","32e4e069.89bc4"]]},{"id":"277bb920.3bed86","type":"function","z":"9921cbf1.f82328","name":"Route userAction","func":"var  MenuAction,resetPage, breadcrumb;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n}  else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    breadcrumb = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,resetPage, breadcrumb];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3250,"y":2940,"wires":[["8adf0740.a75d28"],["944c590a.b87c48"],["b6c0266e.d21148"]],"outputLabels":["MenuAction,,","resetPage","breadcrumb"]},{"id":"21c10ab7.2433b6","type":"debug","z":"9921cbf1.f82328","name":"custom-item-container Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3310,"y":2760,"wires":[]},{"id":"32e4e069.89bc4","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","e68b05c7.33ee28","26c29dda.6daf62","cd9f1d1b.bf34","44f4d9df.da36d8","7e3a04ca.44d81c","662d87cc.7d0548","1fc023b3.8a13fc","21261bc2.8265f4","36c09bb1.b80e34","9daae846.b7afd8","224a0698.0fdbea"],"x":1175,"y":2900,"wires":[]},{"id":"d9404594.f20d58","type":"comment","z":"9921cbf1.f82328","name":"INIT FLOW","info":"","x":760,"y":2860,"wires":[]},{"id":"9755e8fa.4b1bd8","type":"debug","z":"9921cbf1.f82328","name":"custom-item-container INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":980,"y":2860,"wires":[]},{"id":"bd5079e6.ce96c8","type":"link in","z":"9921cbf1.f82328","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","fa4dfc13.1e162"],"x":3055,"y":2860,"wires":[["21c10ab7.2433b6","277bb920.3bed86"]]},{"id":"506f4cf5.852234","type":"link in","z":"9921cbf1.f82328","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","e5db5dcc.6ac5d"],"x":755,"y":2800,"wires":[["a45464f2.b159b8"]]},{"id":"6341771d.992788","type":"http response","z":"9921cbf1.f82328","name":"","statusCode":"","headers":{},"x":1330,"y":2800,"wires":[]},{"id":"ad9e693d.b2f848","type":"function","z":"9921cbf1.f82328","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1040,"y":2800,"wires":[["f4cb780d.8d0dd8"]]},{"id":"a89852cc.e5bf","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":760,"y":2760,"wires":[]},{"id":"e68b05c7.33ee28","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["32e4e069.89bc4"],"x":1475,"y":2960,"wires":[["78d4eaf9.ba39b4"]]},{"id":"e5780956.f17ac8","type":"http in","z":"9921cbf1.f82328","name":"customitemcontainer","url":"/customitemcontainer","method":"post","upload":false,"swaggerDoc":"","x":200,"y":2840,"wires":[["8e9268e8.d192f8"]]},{"id":"e5db5dcc.6ac5d","type":"link out","z":"9921cbf1.f82328","name":"","links":["506f4cf5.852234"],"x":495,"y":2800,"wires":[]},{"id":"161aea2e.5d62c6","type":"link out","z":"9921cbf1.f82328","name":"","links":["5d9874b1.4e7fbc"],"x":495,"y":2840,"wires":[]},{"id":"fa4dfc13.1e162","type":"link out","z":"9921cbf1.f82328","name":"","links":["bd5079e6.ce96c8"],"x":495,"y":2880,"wires":[]},{"id":"35f559b4.0e7dd6","type":"comment","z":"9921cbf1.f82328","name":"INIT","info":"","x":570,"y":2840,"wires":[]},{"id":"8388be98.dd711","type":"comment","z":"9921cbf1.f82328","name":"DESIGN","info":"","x":580,"y":2800,"wires":[]},{"id":"5ef663d1.b8c95c","type":"comment","z":"9921cbf1.f82328","name":"ROUTE","info":"","x":570,"y":2880,"wires":[]},{"id":"a45464f2.b159b8","type":"subflow:39834eee.0dd5a2","z":"9921cbf1.f82328","name":"","env":[],"x":860,"y":2800,"wires":[["ad9e693d.b2f848"]]},{"id":"8e9268e8.d192f8","type":"subflow:a55f7aee.572be","z":"9921cbf1.f82328","name":"","env":[],"x":370,"y":2840,"wires":[["e5db5dcc.6ac5d"],["161aea2e.5d62c6"],["fa4dfc13.1e162"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"8adf0740.a75d28","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":3420,"y":2800,"wires":[["588bbc88.4586d4"]]},{"id":"78d4eaf9.ba39b4","type":"subflow:152aab03.7a806d","z":"9921cbf1.f82328","name":"","env":[],"x":1640,"y":2960,"wires":[["bedc9b4c.e14ab8"]]},{"id":"f4cb780d.8d0dd8","type":"subflow:2ef93158.ae5276","z":"9921cbf1.f82328","name":"","env":[],"x":1180,"y":2800,"wires":[["6341771d.992788"]]},{"id":"5fb061a7.ffba6","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2335,"y":2720,"wires":[]},{"id":"44f4d9df.da36d8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["32e4e069.89bc4","944c590a.b87c48"],"x":1475,"y":2720,"wires":[["7d95c38.449523c"]]},{"id":"588bbc88.4586d4","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":3495,"y":2800,"wires":[]},{"id":"7d95c38.449523c","type":"function","z":"9921cbf1.f82328","name":"basic_factory_custom_item_container","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6007435c-e308-6cbf-8834-ca16b405cfbe\",\n  \"gadgetName\": \"basic_factory_custom_item_container\",\n  \"gadgetType\": \"custom-item-container\",\n  \"gadgetData\": [\n                        {\n                              \"gadgetId\": \"43aed9f3-a64e-1f5b-db28-e07de2f17f3f\",\n                              \"gadgetName\": \"basic_item_btn\",\n                              \"gadgetType\": \"dynamic-btn\",\n                              \"gadgetOptions\": {\n                                \"dataType\": \"single\",\n                                \"displayType\": \"button\"\n                              },\n                              \"gadgetData\": {\n                                \"title\": \"basic_item_btn\",\n                               \n                                \"action\": {\n                                  \"data\": \"basic_item_btn\",\n                                  \"type\": \"userClick\"\n                                },\n                              }\n                            }\n      \n  ],\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"display\": \"single\",\n    \"totalGroup\": 4,\n    \"padding\": 0,\n    \"filters\": [\n      {\n        \"label\": \"filternum\",\n        \"title\": \"Filter the number\",\n        \"type\": \"number\"\n      }\n    ],\n    \"filterTitle\": \"Filter the list\",\n    \"pagination\": true,\n    \"itemsPerPage\": 10,\n    \"alternatingColor\": true,\n    \"dropShadow\": false,\n    \"border\": false,\n    \"horizontalScroll\": false,\n    \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    }\n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"8b1a8e9e-e528-612f-7320-8a3ad6c58281\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                     \"blockHeight\": 300\n                                },\n                              \"gadgetOptions\": {\n                  \n                                 \"copy\":true\n                              }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Custom item Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":2720,"wires":[["5fb061a7.ffba6"]]},{"id":"1d02dc85.832453","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2335,"y":2800,"wires":[]},{"id":"7e3a04ca.44d81c","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["32e4e069.89bc4","944c590a.b87c48"],"x":1475,"y":2800,"wires":[["5de7407e.616c2"]]},{"id":"5de7407e.616c2","type":"function","z":"9921cbf1.f82328","name":"multi_dimensional_horizontal","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"f81af382-36bc-3a44-5e84-2b209009d9f0\",\n  \"gadgetName\": \"multi_dimensional_horizontal\",\n  \"gadgetType\": \"custom-item-container\",\n  \"gadgetData\": [\n                        {\n                              \"gadgetId\": \"43aed9f3-a64e-1f5b-db28-e07de2f17f3f\",\n                              \"gadgetName\": \"basic_item_btn\",\n                              \"gadgetType\": \"dynamic-btn\",\n                              \"gadgetOptions\": {\n                                \"dataType\": \"single\",\n                                \"displayType\": \"button\"\n                              },\n                              \"gadgetData\": {\n                                \"title\": \"basic_item_btn C\",\n                               \n                                \"action\": {\n                                  \"data\": \"basic_item_btn C\",\n                                  \"type\": \"userClick\"\n                                },\n                              }\n                            },\n                               {\n                              \"gadgetId\": \"43aed9f3-a64e-1f5b-db28-e07de2f17f3f\",\n                              \"gadgetName\": \"basic_item_btn\",\n                              \"gadgetType\": \"dynamic-btn\",\n                              \"gadgetOptions\": {\n                                \"dataType\": \"single\",\n                                \"displayType\": \"button\"\n                              },\n                              \"gadgetData\": {\n                                \"title\": \"basic_item_btn D\",\n                               \n                                \"action\": {\n                                  \"data\": \"basic_item_btn D\",\n                                  \"type\": \"userClick\"\n                                },\n                              }\n                            }\n      \n  ],\n    \"gadgetOptions\": {\n        \"display\":\"horizontal\"\n    }\n}\n      \n      ]\n}\n\nmsg.payload.gadgetsList.push({\n                                \"gadgetId\": \"a8ab05c4-1595-584a-f223-889ed4f47666\",\n  \"gadgetName\": \"subButtonsCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"subbuttons\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"multi_dimensional_horizontal\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":2800,"wires":[["1d02dc85.832453"]]},{"id":"66f04e8a.f3473","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nvar gadgetsList =[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}}];\n\n  \ngadgetsList.push(\n       {\n  \"gadgetData\": {\n    \"data\": msg.data,\n    \"options\": {\"number-columns\":1}\n  },\n  \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n  \"gadgetName\": \"actionConfirmationText\",\n  \"gadgetType\": \"dynamic-text-area\"\n}\n      )\n\nmsg.payload = {gadgetsList:gadgetsList};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3950,"y":2880,"wires":[["e12bf1b4.9899b"]]},{"id":"e12bf1b4.9899b","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":4155,"y":2880,"wires":[]},{"id":"1096812f.8a64ff","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"msg.data = [ {\n        \"label\": \"Gadget name\",\n        \"value\": msg.RevotioData.PostData.gadgetName\n      },\n      {\n        \"label\": \"Selected\",\n        \"value\": msg.RevotioData.PostData.gadgetData.selected\n      },\n      {\n        \"label\": \"Icon\",\n        \"value\": msg.RevotioData.PostData.gadgetData.icon\n      },\n      {\n        \"label\": \"Title\",\n        \"value\": msg.RevotioData.PostData.gadgetData.title\n      }\n      \n      \n      ]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3680,"y":2800,"wires":[["66f04e8a.f3473"]]},{"id":"41705762.594de8","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"msg.data = [ {\n        \"label\": \"Gadget name\",\n        \"value\": msg.RevotioData.PostData.gadgetName\n      },\n      {\n        \"label\": \"Selected\",\n        \"value\": msg.RevotioData.PostData.gadgetData.selected.option\n      },\n      {\n        \"label\": \"Icon\",\n        \"value\": msg.RevotioData.PostData.gadgetData.icon\n      },\n      {\n        \"label\": \"Title\",\n        \"value\": msg.RevotioData.PostData.gadgetData.title\n      }\n      \n      \n      ]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3680,"y":2780,"wires":[["66f04e8a.f3473"]]},{"id":"87e4fdac.7c21","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2335,"y":2840,"wires":[]},{"id":"1fc023b3.8a13fc","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["32e4e069.89bc4","944c590a.b87c48"],"x":1475,"y":2840,"wires":[[]]},{"id":"1dad2c99.4b0783","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"\n\nmsg.data = [ {\n        \"label\": \"Gadget name\",\n        \"value\": msg.RevotioData.PostData.gadgetName\n      },\n      {\n        \"label\": \"Gadget type\",\n        \"value\": msg.RevotioData.PostData.gadgetType\n      },\n            {\n        \"label\": \"actionType\",\n        \"value\": msg.RevotioData.PostData.gadgetData.actionType\n      },\n      {\n        \"label\": \"FormData\",\n        \"value\": JSON.stringify(msg.RevotioData.PostData.gadgetData.formData)\n      },\n\n          {\n        \"label\": \"formObj\",\n        \"value\": JSON.stringify(msg.RevotioData.PostData.gadgetData.formObj)\n      },\n      ]\n      \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3680,"y":2820,"wires":[["66f04e8a.f3473"]]},{"id":"f4a17635.7094d8","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2335,"y":2880,"wires":[]},{"id":"21261bc2.8265f4","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["32e4e069.89bc4","944c590a.b87c48"],"x":1475,"y":2880,"wires":[[]]},{"id":"10bf9b6f.5bcc35","type":"function","z":"9921cbf1.f82328","name":"Set msg.data","func":"msg.data = [ {\n        \"label\": \"Gadget name\",\n        \"value\": msg.RevotioData.PostData.gadgetName\n      },\n      {\n        \"label\": \"Selected\",\n        \"value\": msg.RevotioData.PostData.gadgetData.selected.option\n      },\n      {\n        \"label\": \"Icon\",\n        \"value\": msg.RevotioData.PostData.gadgetData.icon\n      },\n      {\n        \"label\": \"Title\",\n        \"value\": msg.RevotioData.PostData.gadgetData.title\n      }\n      \n      \n      ]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3680,"y":2860,"wires":[["66f04e8a.f3473"]]},{"id":"fe0810d0.32a41","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2335,"y":2760,"wires":[]},{"id":"36c09bb1.b80e34","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["32e4e069.89bc4","944c590a.b87c48"],"x":1475,"y":2760,"wires":[["6b154f48.502b4"]]},{"id":"6b154f48.502b4","type":"function","z":"9921cbf1.f82328","name":"multi_dimensional_vertical","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"801843e7-12ec-38f2-d21e-0281d0addc20\",\n  \"gadgetName\": \"multi_dimensional_vertical\",\n  \"gadgetType\": \"custom-item-container\",\n  \"gadgetData\": [\n                        {\n                              \"gadgetId\": \"43aed9f3-a64e-1f5b-db28-e07de2f17f3f\",\n                              \"gadgetName\": \"basic_item_btn\",\n                              \"gadgetType\": \"dynamic-btn\",\n                              \"gadgetOptions\": {\n                                \"dataType\": \"single\",\n                                \"displayType\": \"button\"\n                              },\n                              \"gadgetData\": {\n                                \"title\": \"basic_item_btn A\",\n                               \n                                \"action\": {\n                                  \"data\": \"basic_item_btn A\",\n                                  \"type\": \"userClick\"\n                                },\n                              }\n                            },\n                               {\n                              \"gadgetId\": \"43aed9f3-a64e-1f5b-db28-e07de2f17f3f\",\n                              \"gadgetName\": \"basic_item_btn\",\n                              \"gadgetType\": \"dynamic-btn\",\n                              \"gadgetOptions\": {\n                                \"dataType\": \"single\",\n                                \"displayType\": \"button\"\n                              },\n                              \"gadgetData\": {\n                                \"title\": \"basic_item_btn B\",\n                               \n                                \"action\": {\n                                  \"data\": \"basic_item_btn B\",\n                                  \"type\": \"userClick\"\n                                },\n                              }\n                            }\n      \n  ],\n    \"gadgetOptions\": {\n        \"display\":\"vertical\"\n    }\n}\n      \n      ]\n}\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"73dc6735-b87f-9edb-e978-5a45b4b123cb\",\n  \"gadgetName\": \"basicOptions\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                             \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n})\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"BasicOptionsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"multi_dimensional_vertical\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":2760,"wires":[["fe0810d0.32a41"]]},{"id":"d5955510.abc8c8","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2335,"y":2920,"wires":[]},{"id":"9daae846.b7afd8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["32e4e069.89bc4","944c590a.b87c48"],"x":1475,"y":2920,"wires":[["8cc0dd8a.71c8e"]]},{"id":"8cc0dd8a.71c8e","type":"function","z":"9921cbf1.f82328","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1640,"y":2920,"wires":[["d5955510.abc8c8"]]},{"id":"944c590a.b87c48","type":"link out","z":"9921cbf1.f82328","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","44f4d9df.da36d8","7e3a04ca.44d81c","662d87cc.7d0548","1fc023b3.8a13fc","21261bc2.8265f4","36c09bb1.b80e34","9daae846.b7afd8","224a0698.0fdbea"],"x":3475,"y":2840,"wires":[]},{"id":"bedc9b4c.e14ab8","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2335,"y":2960,"wires":[]},{"id":"d70fbbfb.67c9f8","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2335,"y":3000,"wires":[]},{"id":"224a0698.0fdbea","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["32e4e069.89bc4","944c590a.b87c48"],"x":1475,"y":3000,"wires":[["a3ce08ad.73d0c8"]]},{"id":"a3ce08ad.73d0c8","type":"function","z":"9921cbf1.f82328","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"708ad058-fbae-ef60-9bfb-8c211ad668f5\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Custom-item-container</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1630,"y":3000,"wires":[["d70fbbfb.67c9f8"]]},{"id":"b6c0266e.d21148","type":"function","z":"9921cbf1.f82328","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"e0811593-2879-9c1d-d423-64392a45c7ac\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3930,"y":2940,"wires":[["e12bf1b4.9899b"]]},{"id":"5c153a6a.8147f4","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":4040,"wires":[["827e38ca.b7b4d8"]]},{"id":"827e38ca.b7b4d8","type":"function","z":"9921cbf1.f82328","name":"Button inside cell","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n{\n  \"gadgetId\": \"e69223c1-0bca-8abb-b90a-dea876b76f88\",\n  \"gadgetName\": \"button_inside_cell\",\n  \"gadgetType\": \"data-table\",\n    \"gadgetOptions\": {\n      \"allowSearch\": false,\n      \"maxItems\": 10,\n      \"striped\": false,\n      \"export\": false,\n      \"multipleSelection\": false,\n      \"submitFilter\": false,\n      \"calculateColumns\": false,\n      \"calculateLabel\": \"Total\"\n    },\n    \"gadgetData\": {\n      \"tableColumnData\": {\n        \"columnHead\": [\n          {\n            \"title\": \"Name\",\n            \"allowSort\": true,\n            \"headKey\": \"name\",\n            \"hidden\": false,\n            \"editable\": false,\n            \"showCalculateLabel\": true\n          },\n          {\n            \"title\": \"Amount\",\n            \"allowSort\": true,\n            \"headKey\": \"amount\",\n            \"hidden\": false,\n            \"editable\": false,\n            \"showFilter\": false,\n            \"filterType\": \"number\",\n            \"formatOptions\": {\n              \"decimal\": 2,\n              \"numberSymbol\": \"$\",\n              \"numberSymbolPosition\": \"before\",\n              \"decimalSymbol\": \".\",\n              \"digitGroupSymbol\": \",\",\n              \"calculationType\": \"sum\"\n            }\n          }\n        ],\n        \"columnOptions\": {\n          \"columnStyle\": {},\n          \"cellStyle\": {},\n          \"allowSort\": true\n        }\n      },\n      \"tableTitle\": \"button_inside_cell\",\n      \"tableRowData\": [\n        {\n          \"rowData\": [\n            {\n              \"headKey\": \"name\",\n              \"type\": \"button\",\n              \"data\": \"John Doe\",\n              \"editable\": false,\n              \"buttons\": [{\n                \"buttonData\": {\n                    \"title\": \"Check\",\n                    \"allowSearch\": false,\n                    \"searchPlaceholder\": \"Search\",\n                    \"design\": {\n                        \"icon\": \"done\",\n                        \"size\": \"medium\",\n                        \"type\":\"border\"\n                    },\n                    \"disabled\": false,\n                    \"type\": \"success\",\n                    \"action\": {\n                        \"actionType\": \"button\",\n                        \"state\": \"\"\n                    }\n                },\n                \"buttonOptions\": {\n                    \"dataType\": \"button\",\n                    \"displayType\": \"text\"\n                }\n                }]\n            },\n            {\n              \"headKey\": \"amount\",\n              \"type\": \"number\",\n              \"data\": \"30\",\n              \"editable\": false,\n              \"options\": {\n                \"bold\": true,\n                \"italic\": true,\n                \"min\": \"10\",\n                \"max\": \"30\"\n              }\n            }\n          ],\n          \"rowSourceData\": {\n            \"name\": \"John Doe\",\n            \"amount\": \"600\"\n          },\n          \"rowOptions\": {\n            \"globalClick\": true,\n            \"style\": {\n              \"width\": \"20%\"\n            }\n          }\n        }\n      ],\n      \"tableOptions\": {\n        \"mainOption\": \"global\"\n      }\n    }\n  } ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"c565b0fb-8693-ca1b-a4d6-a9ce1b50c272\",\n  \"gadgetName\": \"code_button_inside_cell\",\n  \"gadgetType\": \"code-block\",\n    \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n \"gadgetId\": \"c0c0ca10-a4cb-f6c9-3e09-54b406881138\",\n  \"gadgetName\": \"button inside a cell\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Button inside cell\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":4040,"wires":[["d9d9b00f.8be1c"]]},{"id":"d9d9b00f.8be1c","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":4040,"wires":[]},{"id":"69243e82.2f872","type":"link out","z":"9921cbf1.f82328","name":"","links":["569a0a55.e796d4"],"x":2295,"y":540,"wires":[]},{"id":"6e279118.75e0d","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["193edcb4.56c8e3","67412f74.5eb71"],"x":1435,"y":540,"wires":[["56780ca3.a0c944"]]},{"id":"56780ca3.a0c944","type":"function","z":"9921cbf1.f82328","name":"titleDisplayType","func":"msg.payload = {\n    gadgetsList:[\n{\n  \"gadgetId\": \"c0713d5c-26be-9793-5abb-9378d0dc9559\",\n  \"gadgetName\": \"titleDisplayType\",\n  \"gadgetType\": \"breadcrumbs\",\n    \"gadgetData\": [\n      {\n        \"buttonData\": {\n          \"title\": \"Breadcrumb item 1\",\n          \"titleDisplayType\":\"selected\",\n          \"allowSearch\": true,\n          \"searchPlaceholder\":\"Search string\",\n          \"design\": {\n            \"icon\": \"comment_bank\",\n            \"size\": \"small\"\n          },\n          \"actionType\": \"button\",\n          \"options\": [\n            {\n              \"title\": \"Option 1.A\",\n              \"design\": {\n                \"color\": \"green\",\n                \"iconType\": \"icon\",\n                \"icon\": \"info\",\n                \"size\": \"large\"\n              },\n              \"selected\": true,\n              \"action\": {\n                \"option\": \"Option 1.A\",\n                \"type\": \"global\"\n              }\n            },\n            {\n              \"title\": \"Option 1.B\",\n              \"design\": {\n                \"color\": \"orange\",\n                \"iconType\": \"icon\",\n                \"icon\": \"check_circle\"\n              },\n              \"action\": {\n                \"option\": \"Option 1.B\",\n                \"type\": \"global\"\n              }\n            },\n            {\n              \"title\": \"Option 1.C\",\n              \"design\": {\n                \"color\": \"red\",\n                \"iconType\": \"icon\",\n                \"icon\": \"check_circle\"\n              },\n              \"action\": {\n                \"option\": \"Option 1.C\",\n                \"type\": \"global\"\n              }\n            }\n          ]\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"multiple\",\n          \"displayType\": \"text\"\n        }\n      },\n      {\n        \"buttonData\": {\n          \"title\": \"Breadcrumb item 2\",\n          \"titleDisplayType\":\"selected\",\n          \"allowSearch\": true,\n          \"design\": {\n            \"color\": \"black\",\n            \"icon\": \"info\",\n            \"size\": \"medium\"\n          },\n          \"actionType\": \"button\",\n          \"options\": [\n            {\n              \"title\": \"Option 2.A\",\n              \"design\": {\n                \"color\": \"green\",\n                \"iconType\": \"icon\",\n                \"icon\": \"info\",\n                \"size\": \"large\"\n              },\n              \"selected\": true,\n              \"action\": {\n                \"option\": \"Option 2.A\",\n                \"type\": \"global\"\n              }\n            },\n            {\n              \"title\": \"Option 2.B\",\n              \"design\": {\n                \"color\": \"red\",\n                \"iconType\": \"icon\",\n                \"icon\": \"check_circle\"\n              },\n              \"action\": {\n                \"option\": \"Option 2.B\",\n                \"type\": \"global\"\n              }\n            }\n          ]\n        },\n        \"buttonOptions\": {\n          \"dataType\": \"multiple\",\n          \"displayType\": \"text\"\n        }\n      }\n    ],\n    \"gadgetOptions\": {\n      \"disabled\": false,\n      \"separatorIcon\": \"favorite_border\",\n      \"title\": \"Used in breadcrumbs mobile can be null\"\n    }\n  }\n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"9c8163b5-119b-3836-da73-5eaee762c659\",\n  \"gadgetName\": \"codeTitleDisplayType\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                     \"blockHeight\": 300\n                                },\n                              \"gadgetOptions\": {\n                  \n                                 \"copy\":true\n                              }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n \"gadgetId\": \"21c6ccda-5450-5aeb-0d85-4ef098b1f582\",\n  \"gadgetName\": \"divider_titleDisplayType\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"title, Display & Type\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":540,"wires":[["69243e82.2f872"]]},{"id":"2f4d456.e9d4bba","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["2f6a47c6.4ca4b8","77e2ab43.a07704"],"x":1535,"y":3940,"wires":[["34c669ff.4176f6"]]},{"id":"34c669ff.4176f6","type":"function","z":"9921cbf1.f82328","name":"submitFilter & column alignment","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n{\n  \"gadgetId\": \"10b44cc2-8025-3738-bf42-ba5f22da503b\",\n  \"gadgetName\": \"submitFilter & column alignment\",\n  \"gadgetType\": \"data-table\",\n    \"gadgetOptions\": {\n      \"allowSearch\": false,\n      \"maxItems\": 10,\n      \"striped\": false,\n      \"export\": false,\n      \"multipleSelection\": false,\n      \"submitFilter\": true,\n      \"calculateColumns\": false,\n      \"calculateLabel\": \"Total\"\n    },\n    \"gadgetData\": {\n      \"tableColumnData\": {\n        \"columnHead\": [\n          {\n            \"title\": \"Name - alignment=right\",\n            \"allowSort\": true,\n            \"headKey\": \"name\",\n            \"hidden\": false,\n            \"editable\": false,\n            \"showCalculateLabel\": true,\n            \"alignment\":\"right\"\n          },\n\n          {\n            \"title\": \"Age - alignment= center\",\n            \"allowSort\": true,\n            \"headKey\": \"age\",\n            \"hidden\": false,\n            \"editable\": false,\n            \"showCalculateLabel\": true,\n            \"alignment\":\"center\"\n          },\n          {\n            \"title\": \"Amount - alignment=left\",\n            \"allowSort\": true,\n            \"headKey\": \"amount\",\n            \"hidden\": false,\n            \"editable\": false,\n            \"showFilter\": true,\n            \"filterType\": \"number\",\n\n            \"alignment\":\"left\",\n            \"formatOptions\": {\n              \"decimal\": 2,\n              \"numberSymbol\": \"$\",\n              \"numberSymbolPosition\": \"before\",\n              \"decimalSymbol\": \".\",\n              \"digitGroupSymbol\": \",\"\n            },\n            \"calculationType\": \"sum\"\n          }\n        ],\n        \"columnOptions\": {\n          \"columnStyle\": {},\n          \"cellStyle\": {},\n          \"allowSort\": true\n        }\n      },\n      \"tableTitle\": \"submitFilter & column alignment\",\n      \"tableRowData\": [\n        {\n          \"rowData\": [\n            {\n              \"headKey\": \"name\",\n              \"type\": \"string\",\n              \"data\": \"John Doe\",\n              \"editable\": false\n            },\n            {\n              \"headKey\": \"age\",\n              \"type\": \"number\",\n              \"data\": \"20\",\n              \"editable\": false\n            },\n            {\n              \"headKey\": \"amount\",\n              \"type\": \"number\",\n              \"data\": \"30\",\n              \"editable\": false,\n              \"options\": {\n                \"bold\": true,\n                \"italic\": true,\n                \"min\": \"10\",\n                \"max\": \"30\"\n              }\n            }\n          ],\n          \"rowSourceData\": {\n            \"name\": \"John Doe\",\n            \"age\":\"20\",\n            \"amount\": \"600\"\n          },\n          \"rowOptions\": {\n            \"globalClick\": true,\n            \"style\": {\n              \"width\": \"20%\"\n            }\n          }\n        }\n      ],\n      \"tableOptions\": {\n        \"mainOption\": \"global\"\n      }\n    }\n  }  ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"0a791c99-5f5c-9371-5529-b80086b3e919\",\n  \"gadgetName\": \"Code submitFilter & column alignment\",\n  \"gadgetType\": \"code-block\",\n    \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"c271a46e-9ddf-4f95-fbe7-7becf841d13c\",\n  \"gadgetName\": \"Divider submitFilter & column alignment\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"submitFilter & column alignment\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1770,"y":3940,"wires":[["34097e05.43a7f2"]]},{"id":"34097e05.43a7f2","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":3940,"wires":[]},{"id":"f81ae2be.b5cb3","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2375,"y":4600,"wires":[]},{"id":"68a81141.8dfb8","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["4a0e13.afe011ec","828b4955.b29758"],"x":1515,"y":4600,"wires":[["9ce87419.18b6c8"]]},{"id":"9ce87419.18b6c8","type":"function","z":"9921cbf1.f82328","name":"background, iconsize & textTag\"","func":"\nmsg.payload = {\n    gadgetsList:[\n               \n     {\n  \"gadgetId\": \"f04dca21-19f6-9f47-18f8-cde2c2c11187\",\n  \"gadgetName\": \"background, iconsize & textTag\",\n  \"gadgetType\": \"divider\",\n    \"gadgetData\": {\n        \"borderStyle\": \"solid\",\n        \"position\": \"right-center\",\n        \"icon\": \"bookmark\",\n        \"iconSize\": \"40\",\n        \"background\": \"green\",\n        \"title\": \"Sample Divider\",\n        \"textTag\": \"h2\",\n        \"color\": \"primary\"\n    },\n    \"gadgetOptions\": {\n        \"disabled\": false\n    }\n}\n\n ]}\n\n\nmsg.payload.gadgetsList.push({\n \"gadgetId\": \"af212df3-74e0-cc4a-57d9-b518f564c1ac\",\n  \"gadgetName\": \"Code background, iconsize & textTag\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": \"auto\"\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n                            \n                            \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1770,"y":4600,"wires":[["f81ae2be.b5cb3"]]},{"id":"7de23991.328508","type":"link out","z":"9921cbf1.f82328","name":"","links":["ada94af4.e7ada8"],"x":2355,"y":2640,"wires":[]},{"id":"88da0511.ea3f28","type":"link in","z":"9921cbf1.f82328","name":"** Gadget Name **","links":["f5d34cc5.53496"],"x":1495,"y":2640,"wires":[["df40f655.121fd8"]]},{"id":"df40f655.121fd8","type":"function","z":"9921cbf1.f82328","name":"dismissDisabledSubmit & required fields","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    \n    gadgetsList : [{\n                    \"gadgetId\": \"f080cd0c-b10e-ae81-a31d-19c54930fab6\",\n                      \"gadgetName\": \"Divider dismissDisabledSubmit & required fields\",\n                      \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"DismissDisabledSubmit & required fields\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            }]}\n\n// code dismissDisabledSubmit false & required fields true\n    dismissDisabledSubmit_false_required_true  =    {\n          \"gadgetData\": {\n              \"canceled\": false,\n              \"submitButtonAction\":true,\n              \"submitOnInputChange\":false,\n              \"id\": \"mockdataFOrm10\",\n              \"nextButtonText\": \"Next\",\n              \"showPrevious\": true,\n              \"dismissDisabledSubmit\":false,\n              \"submitButtonText\": \"Submit\",\n              \"title\": \"\",\n              \"steps\": [{\n                  \"fields\": [\n                      {\n                          \"htmlTag\": \"input\",\n                          \"name\": \"input1\",\n                          \"options\": {\n                              \"label\": \"Sample Input\",\n                              \"placeholder\": \"Sample Inpu\",\n                              \"required\": true,\n                              \"type\": \"text\",\n                              \"value\": \"\",\n                              \"disabled\": false\n                          }\n                      }\n                  ]\n              }]\n          },\n          \"gadgetOptions\": {\n            \"disabled\":false\n          },\n     \"gadgetId\": \"429dc9ee-ba86-a565-ad63-6eaac949d3bd\",\n      \"gadgetName\": \"dismissDisabledSubmit false & required fields true\",\n      \"gadgetType\": \"custom-form\"\n      }\n    msg.payload.gadgetsList.push(dismissDisabledSubmit_false_required_true)\n    \n    code_dismissDisabledSubmit_false_required_true = {\n      \"gadgetId\": \"65e938af-d771-5fce-1c76-e15db65c24fa\",\n      \"gadgetName\": \"dismissDisabledSubmit false & required fields true \",\n      \"gadgetType\": \"code-block\",\n                                  \"gadgetData\": {\n                                       \"content\": JSON.stringify(dismissDisabledSubmit_false_required_true),\n        \"language\": \"json\",\n        \"blockHeight\": 500\n      },\n      \"gadgetOptions\": {\n        \"disabled\": false,\n        \"copy\": true\n      }\n                                }\n    msg.payload.gadgetsList.push(code_dismissDisabledSubmit_false_required_true)\n    \n    \n// code dismissDisabledSubmit false & required fields false\n    dismissDisabledSubmit_false_required_false  =    {\n      \"gadgetData\": {\n          \"canceled\": false,\n          \"submitButtonAction\":true,\n          \"submitOnInputChange\":false,\n          \"id\": \"mockdataFOrm10\",\n          \"nextButtonText\": \"Next\",\n          \"showPrevious\": true,\n          \"dismissDisabledSubmit\":false,\n          \"submitButtonText\": \"Submit\",\n          \"title\": \"\",\n          \"steps\": [{\n              \"fields\": [\n                  {\n                      \"htmlTag\": \"input\",\n                      \"name\": \"input1\",\n                      \"options\": {\n                          \"label\": \"Sample Input\",\n                          \"placeholder\": \"Sample Inpu\",\n                          \"required\": false,\n                          \"type\": \"text\",\n                          \"value\": \"\",\n                          \"disabled\": false\n                      }\n                  }\n              ]\n          }]\n      },\n      \"gadgetOptions\": {\n        \"disabled\":false\n      },\n  \"gadgetId\": \"57c7d378-a723-f9f9-84b3-d6e8e5ea438c\",\n  \"gadgetName\": \"dismissDisabledSubmit false & required fields false\",\n  \"gadgetType\": \"custom-form\"\n      }\n    msg.payload.gadgetsList.push(dismissDisabledSubmit_false_required_false)\n    \n    code_dismissDisabledSubmit_false_required_false = {\n    \"gadgetId\": \"58b4c19b-ece9-8c0a-fd20-7e92628978e6\",\n  \"gadgetName\": \"code dismissDisabledSubmit false & required fields false\",\n  \"gadgetType\": \"code-block\",\n                                  \"gadgetData\": {\n                                       \"content\": JSON.stringify(dismissDisabledSubmit_false_required_false),\n        \"language\": \"json\",\n        \"blockHeight\": 500\n      },\n      \"gadgetOptions\": {\n        \"disabled\": false,\n        \"copy\": true\n      }\n                                }\n    msg.payload.gadgetsList.push(code_dismissDisabledSubmit_false_required_false)\n    \n\n// code dismissDisabledSubmit true & required fields false\n    dismissDisabledSubmit_true_required_false  =     {\n      \"gadgetData\": {\n          \"canceled\": false,\n          \"submitButtonAction\":true,\n          \"submitOnInputChange\":false,\n          \"id\": \"mockdataFOrm10\",\n          \"nextButtonText\": \"Next\",\n          \"showPrevious\": true,\n          \"dismissDisabledSubmit\":true,\n          \"submitButtonText\": \"Submit\",\n          \"title\": \"\",\n          \"steps\": [{\n              \"fields\": [\n                  {\n                      \"htmlTag\": \"input\",\n                      \"name\": \"input1\",\n                      \"options\": {\n                          \"label\": \"Sample Input\",\n                          \"placeholder\": \"Sample Inpu\",\n                          \"required\": false,\n                          \"type\": \"text\",\n                          \"value\": \"\",\n                          \"disabled\": false\n                      }\n                  }\n              ]\n          }]\n      },\n      \"gadgetOptions\": {\n        \"disabled\":false\n      },\n  \"gadgetId\": \"88835cb2-69c3-accb-c86a-24521e3e457f\",\n  \"gadgetName\": \"dismissDisabledSubmit true & required fields false\",\n  \"gadgetType\": \"custom-form\"\n  }\n    msg.payload.gadgetsList.push(dismissDisabledSubmit_true_required_false)\n    \n    code_dismissDisabledSubmit_true_required_false = {\n  \"gadgetId\": \"6356982c-ae69-7e48-29e5-97c9c772e881\",\n  \"gadgetName\": \"code dismissDisabledSubmit true & required fields false\",\n  \"gadgetType\": \"code-block\",\n                                  \"gadgetData\": {\n                                       \"content\": JSON.stringify(dismissDisabledSubmit_true_required_false),\n        \"language\": \"json\",\n        \"blockHeight\": 500\n      },\n      \"gadgetOptions\": {\n        \"disabled\": false,\n        \"copy\": true\n      }\n                                }\n    msg.payload.gadgetsList.push(code_dismissDisabledSubmit_true_required_false)\n    \n    \n// code dismissDisabledSubmit true & required fields true\n    dismissDisabledSubmit_true_required_true  =    {\n      \"gadgetData\": {\n          \"canceled\": false,\n          \"submitButtonAction\":true,\n          \"submitOnInputChange\":false,\n          \"id\": \"mockdataFOrm10\",\n          \"nextButtonText\": \"Next\",\n          \"showPrevious\": true,\n          \"dismissDisabledSubmit\":false,\n          \"submitButtonText\": \"Submit\",\n          \"title\": \"\",\n          \"steps\": [{\n              \"fields\": [\n                  {\n                      \"htmlTag\": \"input\",\n                      \"name\": \"input1\",\n                      \"options\": {\n                          \"label\": \"Sample Input\",\n                          \"placeholder\": \"Sample Inpu\",\n                          \"required\": false,\n                          \"type\": \"text\",\n                          \"value\": \"\",\n                          \"disabled\": false\n                      }\n                  }\n              ]\n          }]\n      },\n      \"gadgetOptions\": {\n        \"disabled\":false\n      },\n  \"gadgetId\": \"94dd92f0-bd4d-b952-e8c4-8b82200e12eb\",\n  \"gadgetName\": \"dismissDisabledSubmit true & required fields true\",\n  \"gadgetType\": \"custom-form\"\n      }\n    msg.payload.gadgetsList.push(dismissDisabledSubmit_true_required_true)\n    \n    code_dismissDisabledSubmit_true_required_true = {\n  \"gadgetId\": \"d5b6b4d0-a1e1-e472-d673-ad44f4ec4d06\",\n  \"gadgetName\": \"code dismissDisabledSubmit true & required fields true\",\n  \"gadgetType\": \"code-block\",\n                                  \"gadgetData\": {\n                                       \"content\": JSON.stringify(dismissDisabledSubmit_true_required_true),\n        \"language\": \"json\",\n        \"blockHeight\": 500\n      },\n      \"gadgetOptions\": {\n        \"disabled\": false,\n        \"copy\": true\n      }\n                                }\n    msg.payload.gadgetsList.push(code_dismissDisabledSubmit_true_required_true)\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":2640,"wires":[["7de23991.328508"]]},{"id":"2bdfe5b4.97192a","type":"function","z":"9921cbf1.f82328","name":"subform inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"subform inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n \"gadgetId\": \"8381cf62-afeb-2408-4438-4ad0533eb371\",\n  \"gadgetName\": \"subform inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"f628f049-7488-bd6f-f2f1-d0e05d2e09b6\",\n  \"gadgetName\": \"code subform inputs\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"6a70f763-3001-7be5-f31d-2d528680468b\",\n  \"gadgetName\": \"divider subform inputs\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"subform inputs\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2220,"y":2400,"wires":[["538f42a3.0b07cc"]]},{"id":"538f42a3.0b07cc","type":"function","z":"9921cbf1.f82328","name":"upload/download inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"upload/download inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"785bbb34-2250-a0d9-ca29-2520c5545c5a\",\n  \"gadgetName\": \"upload/download inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\n// node.warn({\n//     data:data,\n//     mainForm:msg.payload.gadgetsList[0]\n// })\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"032c7d3e-6a3d-ee3e-b922-2da01906d394\",\n  \"gadgetName\": \"code upload/download inputs\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"30237476-531f-c4de-f7e0-45291385d36e\",\n  \"gadgetName\": \"divider upload/download\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"upload/download inputs\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":2460,"wires":[["7db484f3.01b25c"]]},{"id":"7db484f3.01b25c","type":"function","z":"9921cbf1.f82328","name":"wysiwg inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"wysiwg inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"45e450c0-dd16-4479-4610-f7bd59b4d185\",\n  \"gadgetName\": \"wysiwg inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"d5468bad-dc8a-d8cb-76dd-c6febcc7ee2d\",\n  \"gadgetName\": \"code wysiwg inputs\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"38b64a0b-e811-93db-352a-9bcb44676b32\",\n  \"gadgetName\": \"divider Wysiwg\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"upload/download inputs\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1820,"y":2460,"wires":[["10347e21.e38092"]]},{"id":"10347e21.e38092","type":"function","z":"9921cbf1.f82328","name":"date/time inputs","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\ndata = \n       {\n  \"gadgetData\": {\n    \"canceled\": false,\n    \"submitButtonAction\": true,\n    \"submitOnInputChange\": true,\n    \"id\": \"mockdataFOrm10\",\n    \"nextButtonText\": \"Next\",\n    \"showPrevious\": true,\n    \"dismissDisabledSubmit\": false,\n    \"submitButtonText\": \"Submit\",\n    \"title\": \"date/time inputs\",\n    \"steps\": [ ]\n  },\n  \"gadgetOptions\": {},\n  \"gadgetId\": \"d0ff26a4-a565-5618-cb13-f97d449b6a55\",\n  \"gadgetName\": \"date/time inputs\",\n  \"gadgetType\": \"custom-form\"\n}\n    \n    \n// get correct slide\n_.each(msg.payload.gadgetsList[0].gadgetData.steps, function(step,index){\n    \n   Newstep = {}\n    \n    if (step.title === data.gadgetData.title){\n        \n        // _.each(step)\n        \n        data.gadgetData.steps.push(step)\n                            \n    }\n    \n})\n\nmsg.payload.gadgetsList.push(data)\n\n\nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"dcd2542c-52eb-73ea-669f-51d1832e3f6e\",\n  \"gadgetName\": \"code date/time inputs\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(data),\n    \"language\": \"json\",\n    \"blockHeight\": 500\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n  \"gadgetId\": \"c877a335-504c-8a27-832a-96361fe4cf99\",\n  \"gadgetName\": \"divider date/time inputs\",\n  \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"upload/download inputs\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2020,"y":2460,"wires":[["43cc6552.23510c"]]},{"id":"a1348f99.d487b","type":"comment","z":"9de255bd.0d0938","name":"tabsSelect","info":"","x":220,"y":3940,"wires":[]},{"id":"7e095562.2954bc","type":"comment","z":"9de255bd.0d0938","name":"tabsSelect gagdet actions","info":"","x":3110,"y":3880,"wires":[]},{"id":"90c5f0a0.5fc5d","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2550,"y":3840,"wires":[]},{"id":"4d3b2948.a2bcc8","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","5e344d1f.4bf444"],"x":855,"y":4060,"wires":[["1d23a965.a08b57","4c59934b.94d60c"]]},{"id":"5c0da104.8a1ec","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var  MenuAction,resetPage, breadcrumb;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n}  else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    breadcrumb = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,resetPage, breadcrumb];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":3980,"wires":[["5f16c14b.cdde8"],["11d310ec.1333ef"],["e34160bd.875eb"]],"outputLabels":["MenuAction,,","resetPage","breadcrumb"]},{"id":"8a716b37.056688","type":"debug","z":"9de255bd.0d0938","name":"tabsSelect Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3110,"y":3920,"wires":[]},{"id":"4c59934b.94d60c","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","f0ec7531.12baf8","26c29dda.6daf62","cd9f1d1b.bf34","53265513.211b3c","7ad2a18c.6e6df","662d87cc.7d0548","b1cbeef4.f75aa","9ee9b963.32abb8","d1c29e5f.b0fc4","1ebf17ea.19cc58","e9ed4905.97c838","93c117bc.a397f8","53ea0d0f.9c5504","fee53b17.751c98","141a4fbd.7561e"],"x":1235,"y":4060,"wires":[]},{"id":"e324ba2b.0b3858","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":820,"y":4020,"wires":[]},{"id":"1d23a965.a08b57","type":"debug","z":"9de255bd.0d0938","name":"tabsSelect INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1000,"y":4020,"wires":[]},{"id":"9c2072c4.b21ca","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","a22a0243.3f134"],"x":3035,"y":3980,"wires":[["8a716b37.056688","5c0da104.8a1ec"]]},{"id":"6e8e1ddf.ac7f94","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","dd6e9043.3d069"],"x":815,"y":3960,"wires":[["927d4f20.dba5"]]},{"id":"d0f5d844.e6a648","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1390,"y":3960,"wires":[]},{"id":"5db8cdc8.28f5d4","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":3960,"wires":[["132070b.140558f"]]},{"id":"35d55f71.fa432","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":820,"y":3920,"wires":[]},{"id":"f0ec7531.12baf8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c"],"x":1535,"y":4160,"wires":[["db2e1fd9.af6ba"]]},{"id":"c0fa193.61c33e8","type":"http in","z":"9de255bd.0d0938","name":"tabsSelect","url":"/tabsSelect","method":"post","upload":false,"swaggerDoc":"","x":280,"y":4000,"wires":[["68fd8996.eac5c8"]]},{"id":"dd6e9043.3d069","type":"link out","z":"9de255bd.0d0938","name":"","links":["6e8e1ddf.ac7f94"],"x":555,"y":3960,"wires":[]},{"id":"5e344d1f.4bf444","type":"link out","z":"9de255bd.0d0938","name":"","links":["4d3b2948.a2bcc8"],"x":555,"y":4000,"wires":[]},{"id":"a22a0243.3f134","type":"link out","z":"9de255bd.0d0938","name":"","links":["9c2072c4.b21ca"],"x":555,"y":4040,"wires":[]},{"id":"6825e529.0f82bc","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":630,"y":4000,"wires":[]},{"id":"33e329f4.a573d6","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":640,"y":3960,"wires":[]},{"id":"31a976d5.ad864a","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":630,"y":4040,"wires":[]},{"id":"927d4f20.dba5","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":920,"y":3960,"wires":[["5db8cdc8.28f5d4"]]},{"id":"68fd8996.eac5c8","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":430,"y":4000,"wires":[["dd6e9043.3d069"],["5e344d1f.4bf444"],["a22a0243.3f134"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"5f16c14b.cdde8","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3360,"y":3940,"wires":[["eb6413ca.61682"]]},{"id":"db2e1fd9.af6ba","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1700,"y":4160,"wires":[["57e60c57.e7ffe4"]]},{"id":"132070b.140558f","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1240,"y":3960,"wires":[["d0f5d844.e6a648"]]},{"id":"53265513.211b3c","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c","11d310ec.1333ef"],"x":1535,"y":3880,"wires":[["ec000b7c.3ce0e8"]]},{"id":"ec000b7c.3ce0e8","type":"function","z":"9de255bd.0d0938","name":"basic","func":"msg.payload = {\n    gadgetsList:[\n        {\n   \"gadgetId\": \"de8ea3fa-654e-17f0-b386-6610823b4ea9\",\n  \"gadgetName\": \"basic\",\n\n       \"gadgetType\": \"tabs-select\",\n  \"gadgetData\": {\n    \"tabs\": [{\n      \"dropdownKey\": \"The value of the tab\",\n      \"fields\": [{\n          \"label\": \"The title of the tab\",\n          \"name\": \"The name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": false\n          }\n        },\n        {\n          \"label\": \"The second title of the tab\",\n          \"name\": \"The second name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": false\n          }\n        }\n      ]\n    }]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"title\": \"Select\"\n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"8b1a8e9e-e528-612f-7320-8a3ad6c58281\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                     \"blockHeight\": 300\n                                },\n                              \"gadgetOptions\": {\n                  \n                                 \"copy\":true\n                              }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":3880,"wires":[["ddb4ddf9.0baa2"]]},{"id":"7ad2a18c.6e6df","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c","11d310ec.1333ef"],"x":1535,"y":3960,"wires":[["5553c587.acf43c"]]},{"id":"5553c587.acf43c","type":"function","z":"9de255bd.0d0938","name":"Tab with bubble","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n \n       {\n  \"gadgetId\": \"eb4f0acc-e936-c547-6b44-8ad2a5ea5a4f\",\n  \"gadgetName\": \"Bubble\",\n  \"gadgetType\": \"tabs-select\",\n  \"gadgetData\": {\n    \"tabs\": [{\n      \"dropdownKey\": \"The value of the tab\",\n      \"fields\": [{\n          \"label\": \"The title of the tab\",\n          \"name\": \"The name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": false,\n            \"bubble\": 10\n          }\n\n        },\n        {\n          \"label\": \"The second title of the tab\",\n          \"name\": \"The second name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": false\n          }\n        }\n      ]\n\n    }]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"title\": \"Select\"\n  }\n}\n      \n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                                \"gadgetId\": \"a8ab05c4-1595-584a-f223-889ed4f47666\",\n  \"gadgetName\": \"filter__searchCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"filter__searchDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Bubble\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1720,"y":3960,"wires":[["72783216.9e1e9c"]]},{"id":"9ee9b963.32abb8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c","11d310ec.1333ef"],"x":1535,"y":4080,"wires":[["60ea0757.3f5288"]]},{"id":"60ea0757.3f5288","type":"function","z":"9de255bd.0d0938","name":"tour","func":"msg.payload = {\n    gadgetsList:[\n   \n   \n       {\n  \"gadgetId\": \"d69cc7c6-deb8-e02f-a2ac-f5559a2d6dcc\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"tabs-select\",\n  \"gadgetData\": {\n    \"dropdown\": {\n      \"options\": {\n        \"1\": \"Option one\",\n        \"2\": \"Option two\",\n        \"3\": \"Option three\"\n      },\n      \"value\": \"1\"\n    },\n    \"tabs\": [\n      {\n        \"dropdownKey\": \"The value of the tab\",\n        \"fields\": [\n          {\n            \"label\": \"The title of the tab\",\n            \"name\": \"The name of the tab\",\n            \"icon\": \"assessment\",\n            \"options\": {\n              \"disabled\": false,\n              \"active\": false,\n              \"bubble\": 10\n            },\n           \n            tour:{\n                      content:\"Tour tab, top placement\",\n                      title :\"Tour tab, top placement\",\n                      priority:1,\n                      placement :\"top\"\n                  },\n          },\n          {\n            \"label\": \"The second title of the tab\",\n            \"name\": \"The second name of the tab\",\n            \"icon\": \"assessment\",\n            \"options\": {\n              \"disabled\": false,\n              \"active\": false\n            },\n               tour:{\n                      content:\"Tour tab, right placement\",\n                      title :\"Tour tab, right placement\",\n                      priority:2,\n                      placement :\"bottom\"\n                  },\n          }\n        ]\n      }\n    ],\n       tour:{\n                      content:\"Tour main level, bottom placement\",\n                      title :\"Tour main level, bottom placement\",\n                      priority:3,\n                      placement :\"bottom\"\n                  },\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"title\": \"Select\"\n  }\n}\n      \n\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"f4017a35-7604-ecfd-557d-13aea3691900\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4080,"wires":[["12aeee0a.c94592"]]},{"id":"d1c29e5f.b0fc4","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c","11d310ec.1333ef"],"x":1535,"y":3920,"wires":[["3be1b916.570fb6"]]},{"id":"3be1b916.570fb6","type":"function","z":"9de255bd.0d0938","name":"ActiveTab","func":"msg.payload = {\n    gadgetsList:[\n\n{\n  \"gadgetId\": \"fef274dd-cf65-5382-21ea-3c20ee429001\",\n  \"gadgetName\": \"ActiveTab\",\n  \"gadgetType\": \"tabs-select\",\n  \"gadgetData\": {\n    \"tabs\": [{\n      \"dropdownKey\": \"The value of the tab\",\n      \"fields\": [{\n          \"label\": \"The title of the tab\",\n          \"name\": \"The name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": true\n          }\n        },\n        {\n          \"label\": \"The second title of the tab\",\n          \"name\": \"The second name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": false\n          }\n        }\n      ]\n    }]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"title\": \"Select\"\n  }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"73dc6735-b87f-9edb-e978-5a45b4b123cb\",\n  \"gadgetName\": \"basicOptions\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                             \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n})\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"BasicOptionsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Active tab\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":3920,"wires":[["a4c49818.1c0c28"]]},{"id":"1ebf17ea.19cc58","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c","11d310ec.1333ef"],"x":1535,"y":4120,"wires":[["7afeb6bf.c51718"]]},{"id":"7afeb6bf.c51718","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":4120,"wires":[["6ed72e85.2eb8a"]]},{"id":"11d310ec.1333ef","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","53265513.211b3c","7ad2a18c.6e6df","662d87cc.7d0548","b1cbeef4.f75aa","9ee9b963.32abb8","d1c29e5f.b0fc4","1ebf17ea.19cc58","e9ed4905.97c838","93c117bc.a397f8","53ea0d0f.9c5504","fee53b17.751c98","141a4fbd.7561e"],"x":3315,"y":3980,"wires":[]},{"id":"e9ed4905.97c838","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c","11d310ec.1333ef"],"x":1535,"y":4200,"wires":[["54192758.f9ebf8"]]},{"id":"54192758.f9ebf8","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"708ad058-fbae-ef60-9bfb-8c211ad668f5\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Data table</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":4200,"wires":[["80675d73.2c5ef"]]},{"id":"e34160bd.875eb","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"e0811593-2879-9c1d-d423-64392a45c7ac\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3430,"y":4020,"wires":[["a6be8e2c.5dcaa"]]},{"id":"a6be8e2c.5dcaa","type":"link out","z":"9de255bd.0d0938","name":"","links":["ada94af4.e7ada8"],"x":3575,"y":4020,"wires":[]},{"id":"eb6413ca.61682","type":"link out","z":"9de255bd.0d0938","name":"","links":["ada94af4.e7ada8"],"x":3435,"y":3940,"wires":[]},{"id":"93c117bc.a397f8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c","11d310ec.1333ef"],"x":1535,"y":4000,"wires":[["4abcd064.e913f"]]},{"id":"4abcd064.e913f","type":"function","z":"9de255bd.0d0938","name":"Dropdown","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n {\n  \"gadgetId\": \"6bb104d8-ddf0-baf4-5d3e-33d6f86e40f1\",\n  \"gadgetName\": \"Dropdown\",\n  \"gadgetType\": \"tabs-select\",\n  \"gadgetData\": {\n    \"dropdown\": {\n      \"options\": {\n        \"1\": \"Option one\",\n        \"2\": \"Option two\",\n        \"3\": \"Option three\"\n      },\n      \"value\": \"1\"\n    },\n    \"tabs\": [{\n      \"dropdownKey\": \"The value of the tab\",\n      \"fields\": [{\n          \"label\": \"The title of the tab\",\n          \"name\": \"The name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": false,\n            \"bubble\": 10\n          }\n\n        },\n        {\n          \"label\": \"The second title of the tab\",\n          \"name\": \"The second name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": false\n          }\n        }\n      ]\n\n    }]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"title\": \"Select\"\n  }\n}\n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"9a087433-9e18-6c38-7ff0-c8f7ced57e5e\",\n                              \"gadgetName\": \"designCode\",\n                              \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"c344f9a5-77ba-45c5-f39a-e28e5ce9ddb1\",\n                              \"gadgetName\": \"designDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Dropdown\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":4000,"wires":[["8189707d.406e4"]]},{"id":"53ea0d0f.9c5504","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["4c59934b.94d60c","11d310ec.1333ef"],"x":1535,"y":4040,"wires":[["47f2c315.240dfc"]]},{"id":"47f2c315.240dfc","type":"function","z":"9de255bd.0d0938","name":"Disabled tab","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n \n{\n  \"gadgetId\": \"dd783cd0-5286-6c0a-04e2-51165e25bc10\",\n  \"gadgetName\": \"Disabled\",\n  \"gadgetType\": \"tabs-select\",\n  \"gadgetData\": {\n    \"tabs\": [{\n      \"dropdownKey\": \"The value of the tab\",\n      \"fields\": [{\n          \"label\": \"The title of the tab\",\n          \"name\": \"The name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": true,\n            \"active\": false,\n            \"bubble\": 10\n          }\n\n        },\n        {\n          \"label\": \"The second title of the tab\",\n          \"name\": \"The second name of the tab\",\n          \"icon\": \"assessment\",\n          \"options\": {\n            \"disabled\": false,\n            \"active\": true\n          }\n        }\n      ]\n\n    }]\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"title\": \"Select\"\n  }\n}\n      \n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"f70ebd01-4ed8-2b7c-7e29-918fcb2a43f7\",\n                              \"gadgetName\": \"advancedCode\",\n                              \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"1c60f788-c457-512a-a88a-c2e1c5c0e352\",\n                              \"gadgetName\": \"advancedDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Disabled\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":4040,"wires":[["28740e4d.346de2"]]},{"id":"ddb4ddf9.0baa2","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":3880,"wires":[]},{"id":"a4c49818.1c0c28","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":3920,"wires":[]},{"id":"72783216.9e1e9c","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":3960,"wires":[]},{"id":"8189707d.406e4","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":4000,"wires":[]},{"id":"28740e4d.346de2","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":4040,"wires":[]},{"id":"12aeee0a.c94592","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":4080,"wires":[]},{"id":"6ed72e85.2eb8a","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":4120,"wires":[]},{"id":"57e60c57.e7ffe4","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":4160,"wires":[]},{"id":"80675d73.2c5ef","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":4200,"wires":[]},{"id":"19f61c07.c7cb34","type":"comment","z":"9de255bd.0d0938","name":"highcharts","info":"","x":220,"y":860,"wires":[]},{"id":"b2802d09.7d438","type":"comment","z":"9de255bd.0d0938","name":"highcharts gagdet actions","info":"","x":3110,"y":800,"wires":[]},{"id":"873b0659.138a78","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2550,"y":760,"wires":[]},{"id":"b55db902.17b398","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","a38ef20d.8a5a7"],"x":855,"y":980,"wires":[["3ee66a6c.8a7926","8fd309c4.ea3d98"]]},{"id":"5dd4eae0.06c444","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var  MenuAction,resetPage, breadcrumb;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n}  else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n} else {\n    breadcrumb = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,resetPage, breadcrumb];","outputs":3,"noerr":0,"initialize":"","finalize":"","x":3170,"y":900,"wires":[["98e7f905.030b98"],["2404a9d0.5b5f76"],["d2c6bd5c.fbe61"]],"outputLabels":["MenuAction,,","resetPage","breadcrumb"]},{"id":"303addb2.37b992","type":"debug","z":"9de255bd.0d0938","name":"highcharts Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3110,"y":840,"wires":[]},{"id":"8fd309c4.ea3d98","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","9207d343.2de9b","26c29dda.6daf62","cd9f1d1b.bf34","3874b9d6.27a156","9c4bc3dc.d17a3","662d87cc.7d0548","b1cbeef4.f75aa","e390b7db.feda78","f75f5c3b.2ccd8","2b186e9d.f6bcc2","2c91fdc1.3fbbe2","5aec6fcf.59ad6","a163f8e4.deac98","fee53b17.751c98","141a4fbd.7561e"],"x":1235,"y":980,"wires":[]},{"id":"34a7d5c4.d7a0ca","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":820,"y":940,"wires":[]},{"id":"3ee66a6c.8a7926","type":"debug","z":"9de255bd.0d0938","name":"highcharts INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1000,"y":940,"wires":[]},{"id":"34ffdc7e.47ce14","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","63a8adf0.d77414"],"x":3035,"y":900,"wires":[["303addb2.37b992","5dd4eae0.06c444"]]},{"id":"3684847a.03ea4c","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","383b9c6f.06c5f4"],"x":815,"y":880,"wires":[["48bc73e8.fa99fc"]]},{"id":"9f74153a.7f23f8","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1390,"y":880,"wires":[]},{"id":"17651b7e.1458a5","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":880,"wires":[["9ee29e94.a7af3"]]},{"id":"243d2959.3488f6","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":820,"y":840,"wires":[]},{"id":"9207d343.2de9b","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98"],"x":1535,"y":1080,"wires":[["4c26450e.63281c"]]},{"id":"9d23c856.95af18","type":"http in","z":"9de255bd.0d0938","name":"highcharts","url":"/highcharts","method":"post","upload":false,"swaggerDoc":"","x":280,"y":920,"wires":[["52167e61.37c85"]]},{"id":"383b9c6f.06c5f4","type":"link out","z":"9de255bd.0d0938","name":"","links":["3684847a.03ea4c"],"x":555,"y":880,"wires":[]},{"id":"a38ef20d.8a5a7","type":"link out","z":"9de255bd.0d0938","name":"","links":["b55db902.17b398"],"x":555,"y":920,"wires":[]},{"id":"63a8adf0.d77414","type":"link out","z":"9de255bd.0d0938","name":"","links":["34ffdc7e.47ce14"],"x":555,"y":960,"wires":[]},{"id":"530bad27.0819f4","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":630,"y":920,"wires":[]},{"id":"9673554e.0a2858","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":640,"y":880,"wires":[]},{"id":"2aeed3e0.01a37c","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":630,"y":960,"wires":[]},{"id":"48bc73e8.fa99fc","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":920,"y":880,"wires":[["17651b7e.1458a5"]]},{"id":"52167e61.37c85","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":430,"y":920,"wires":[["383b9c6f.06c5f4"],["a38ef20d.8a5a7"],["63a8adf0.d77414"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"98e7f905.030b98","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3360,"y":860,"wires":[["bb35f8df.261f58"]]},{"id":"4c26450e.63281c","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1700,"y":1080,"wires":[["5e9a4860.70ac48"]]},{"id":"9ee29e94.a7af3","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1240,"y":880,"wires":[["9f74153a.7f23f8"]]},{"id":"3874b9d6.27a156","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98","2404a9d0.5b5f76"],"x":1535,"y":800,"wires":[["4a09a1d9.f5a21"]]},{"id":"4a09a1d9.f5a21","type":"function","z":"9de255bd.0d0938","name":"Highchart table view/tableContent","func":"msg.payload = {\n    gadgetsList:[\n      {\n  \"gadgetId\": \"49342efd-962c-5a4c-36cc-3889a1c76eb9\",\n  \"gadgetName\": \"Highchart table view/tableContent\",\n  \"gadgetType\": \"highcharts\",\n    \"gadgetData\": {\n      \"title\": {\n        \"text\": \"Simple Gantt Chart\"\n      },\n      \"series\": [{\n        \"name\": \"Project 1\",\n        \"data\": [{\n            \"id\": \"s\",\n            \"name\": \"Start prototype\",\n            \"start\": 1619827200000,\n            \"end\": 1619913600000\n          },\n          {\n            \"id\": \"b\",\n            \"name\": \"Develop\",\n            \"start\": 1622419200000,\n            \"end\": 1619913600000,\n            \"dependency\": \"s\"\n          },\n          {\n            \"id\": \"a\",\n            \"name\": \"Run acceptance tests\",\n            \"start\": 1622246400000,\n            \"end\": 1619827200000\n          },\n          {\n            \"name\": \"Test prototype\",\n            \"start\": 1622246400000,\n            \"end\": 1622678400000,\n            \"dependency\": [\n              \"a\",\n              \"b\"\n            ]\n          }\n        ]\n      }]\n    },\n    \"gadgetOptions\": {\n      \"type\": \"ganttChart\",\n      \"tableView\":true,\n      \"tableContent\": [\n          {\n              \"title\":\"to Name\",\n              \"variable\":\"name\"\n          },\n          {\n            \"title\":\"to Dependency\",\n            \"variable\":\"dependency\"\n            },\n            {\n              \"title\":\"To start\",\n              \"variable\":\"start\"\n              }\n      ]\n    }\n  }\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                            \"gadgetId\": \"8b1a8e9e-e528-612f-7320-8a3ad6c58281\",\n  \"gadgetName\": \"basicCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                     \"blockHeight\": 300\n                                },\n                              \"gadgetOptions\": {\n                  \n                                 \"copy\":true\n                              }\n                            })\n                            \n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Highchart table view/tableContent\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1780,"y":800,"wires":[["edf40e53.d9006"]]},{"id":"9c4bc3dc.d17a3","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98","2404a9d0.5b5f76"],"x":1535,"y":880,"wires":[["922a4689.3e74c8"]]},{"id":"922a4689.3e74c8","type":"function","z":"9de255bd.0d0938","name":"High charts Theme","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n \n    {\n   \"gadgetId\": \"a7260732-634b-9199-fb96-0e7ffdd174ca\",\n  \"gadgetName\": \"High charts Theme\",\n  \"gadgetType\": \"highcharts\",\n  \"gadgetData\": {\n    \"title\": {\n      \"text\": \"Solar Employment Growth by Sector, 2010-2016\"\n    },\n    \"subtitle\": {\n      \"text\": \"Source: thesolarfoundation.com\"\n    },\n    \"yAxis\": {\n      \"title\": {\n        \"text\": \"Number of Employees\"\n      }\n    },\n    \"xAxis\": {\n      \"accessibility\": {\n        \"   \": \"Range: 2010 to 2017\"\n      }\n    },\n    \"legend\": {\n      \"layout\": \"vertical\",\n      \"align\": \"right\",\n      \"verticalAlign\": \"middle\"\n    },\n    \"plotOptions\": {\n      \"series\": {\n        \"label\": {\n          \"connectorAllowed\": false\n        },\n        \"pointStart\": 2010\n      }\n    },\n\n    \"series\": [{\n      \"name\": \"Installation\",\n      \"data\": [43934, 52503, 57177, 69658, 97031, 119931, 137133, 154175]\n    }, {\n      \"name\": \"Manufacturing\",\n      \"data\": [24916, 24064, 29742, 29851, 32490, 30282, 38121, 40434]\n    }, {\n      \"name\": \"Sales & Distribution\",\n      \"data\": [11744, 17722, 16005, 19771, 20185, 24377, 32147, 39387]\n    }, {\n      \"name\": \"Project Development\",\n      \"data\": [null, null, 7988, 12169, 15112, 22452, 34400, 34227]\n    }, {\n      \"name\": \"Other\",\n      \"data\": [12908, 5948, 8105, 11248, 8989, 11816, 18274, 18111]\n    }],\n    \"responsive\": {\n      \"rules\": [{\n        \"condition\": {\n          \"maxWidth\": 500\n        },\n        \"chartOptions\": {\n          \"legend\": {\n            \"layout\": \"horizontal\",\n            \"align\": \"center\",\n            \"verticalAlign\": \"bottom\"\n          }\n        }\n      }]\n    }\n  },\n  \"gadgetOptions\": {\n    \"type\": \"chart\",\n    \"theme\": \"dark\"\n  }\n}\n      \n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                                \"gadgetId\": \"a8ab05c4-1595-584a-f223-889ed4f47666\",\n  \"gadgetName\": \"filter__searchCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"d0819f5f-51ba-50ef-1fee-593df855236c\",\n                              \"gadgetName\": \"filter__searchDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"High charts Theme\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1730,"y":880,"wires":[["bde01cf1.830e7"]]},{"id":"e390b7db.feda78","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98","2404a9d0.5b5f76"],"x":1535,"y":1000,"wires":[["95d88f2.c524f7"]]},{"id":"95d88f2.c524f7","type":"function","z":"9de255bd.0d0938","name":"tour","func":"msg.payload = {\n    gadgetsList:[\n   \n   \n   \n       {\n  \"gadgetId\": \"7388b909-f501-3ea7-ae69-0c516806ae66\",\n  \"gadgetName\": \"tour\",\n  \"gadgetType\": \"highcharts\",\n  \"gadgetData\": {\n      \"tour\": {\n      \"content\": \"Body Content\",\n      \"title\": \"Tour Title\",\n      \"priority\": 1,\n      \"placement\": \"bottom\"\n    },\n    \"title\": {\n      \"text\": \"Solar Employment Growth by Sector, 2010-2016\"\n    },\n    \"subtitle\": {\n      \"text\": \"Source: thesolarfoundation.com\"\n    },\n    \"yAxis\": {\n      \"title\": {\n        \"text\": \"Number of Employees\"\n      }\n    },\n    \"xAxis\": {\n      \"accessibility\": {\n        \"   \": \"Range: 2010 to 2017\"\n      }\n    },\n    \"legend\": {\n      \"layout\": \"vertical\",\n      \"align\": \"right\",\n      \"verticalAlign\": \"middle\"\n    },\n    \"plotOptions\": {\n      \"series\": {\n        \"label\": {\n          \"connectorAllowed\": false\n        },\n        \"pointStart\": 2010\n      }\n    },\n    \"series\": [\n      {\n        \"name\": \"Installation\",\n        \"data\": [\n          43934,\n          52503,\n          57177,\n          69658,\n          97031,\n          119931,\n          137133,\n          154175\n        ]\n      },\n      {\n        \"name\": \"Manufacturing\",\n        \"data\": [\n          24916,\n          24064,\n          29742,\n          29851,\n          32490,\n          30282,\n          38121,\n          40434\n        ]\n      },\n      {\n        \"name\": \"Sales & Distribution\",\n        \"data\": [\n          11744,\n          17722,\n          16005,\n          19771,\n          20185,\n          24377,\n          32147,\n          39387\n        ]\n      },\n      {\n        \"name\": \"Project Development\",\n        \"data\": [\n          null,\n          null,\n          7988,\n          12169,\n          15112,\n          22452,\n          34400,\n          34227\n        ]\n      },\n      {\n        \"name\": \"Other\",\n        \"data\": [\n          12908,\n          5948,\n          8105,\n          11248,\n          8989,\n          11816,\n          18274,\n          18111\n        ]\n      }\n    ],\n    \"responsive\": {\n      \"rules\": [\n        {\n          \"condition\": {\n            \"maxWidth\": 500\n          },\n          \"chartOptions\": {\n            \"legend\": {\n              \"layout\": \"horizontal\",\n              \"align\": \"center\",\n              \"verticalAlign\": \"bottom\"\n            }\n          }\n        }\n      ]\n    }\n  },\n  \"gadgetOptions\": {\n    \"type\": \"chart\",\n    \"tableContent\": [\n      {\n        \"title\": \"\",\n        \"variable\": \"\"\n      }\n    ]\n  }\n}\n      \n\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                               \"gadgetId\": \"f4017a35-7604-ecfd-557d-13aea3691900\",\n  \"gadgetName\": \"tourCode\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n    \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n                            })\nmsg.payload.gadgetsList.push(\n                               {\n                                      \"gadgetId\": \"726781e0-ce02-633c-e63d-f0b468c34c81\",\n                                      \"gadgetName\": \"manageTourState\",\n                                      \"gadgetType\": \"dynamic-btn\",\n                                        'gadgetData' :{\n                                            switchOffLabel:\"Tour off\",\n                                            switchOnLabel:\"Off\",\n                                            title: \"Tour on\",\n                                            // options:options,\n                                            actionType:\"publisherAction\",\n                                            action:\"tour\",\n                                            design:{\n                                                icon:\"support\",\n                                                iconType:\"icon\",\n                                                size:\"large\",\n                                                switch: false,\n                                            },\n                                        },\n                                        \"gadgetOptions\": {\n                                         \"dataType\":\"single\",\n                                         \"displayType\":\"switch\"\n                                         \n                                            \n                                        },\n                                    })\nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"69c75a1f-74fc-7a14-104d-d21ab1865faa\",\n                              \"gadgetName\": \"tourTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"right-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Tour\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":1000,"wires":[["affb75c5.518788"]]},{"id":"f75f5c3b.2ccd8","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98","2404a9d0.5b5f76"],"x":1535,"y":840,"wires":[["92d7eada.17aa68"]]},{"id":"92d7eada.17aa68","type":"function","z":"9de255bd.0d0938","name":"HighChart gadgetOptions.action and gadgetOptions.export","func":"msg.payload = {\n    gadgetsList:[\n\n{\n  \"gadgetId\": \"1aeb2c59-df58-12a6-e0a6-fe4a2b65e029\",\n  \"gadgetName\": \"HighChart gadgetOptions.action and gadgetOptions.export\",\n  \"gadgetType\": \"highcharts\",\n    \"gadgetData\": {\n        \"title\": {\n          \"text\": \"Solar Employment Growth by Sector, 2010-2016\"\n        },\n        \"subtitle\": {\n          \"text\": \"Source: thesolarfoundation.com\"\n        },\n        \"yAxis\": {\n          \"title\": {\n            \"text\": \"Number of Employees\"\n          }\n        },\n        \"xAxis\": {\n          \"accessibility\": {\n            \"   \": \"Range: 2010 to 2017\"\n          }\n        },\n        \"legend\": {\n          \"layout\": \"vertical\",\n          \"align\": \"right\",\n          \"verticalAlign\": \"middle\"\n        },\n        \"plotOptions\": {\n          \"series\": {\n            \"label\": {\n              \"connectorAllowed\": false\n            },\n            \"pointStart\": 2010\n          }\n        },\n    \n        \"series\": [{\n          \"name\": \"Installation\",\n          \"data\": [43934, 52503, 57177, 69658, 97031, 119931, 137133, 154175],\n          \"action\":true\n        }, {\n          \"name\": \"Manufacturing\",\n          \"data\": [24916, 24064, 29742, 29851, 32490, 30282, 38121, 40434]\n        }, {\n          \"name\": \"Sales & Distribution\",\n          \"data\": [11744, 17722, 16005, 19771, 20185, 24377, 32147, 39387]\n        }, {\n          \"name\": \"Project Development\",\n          \"data\": [null, null, 7988, 12169, 15112, 22452, 34400, 34227]\n        }, {\n          \"name\": \"Other\",\n          \"data\": [12908, 5948, 8105, 11248, 8989, 11816, 18274, 18111]\n        }],\n        \"responsive\": {\n          \"rules\": [{\n            \"condition\": {\n              \"maxWidth\": 500\n            },\n            \"chartOptions\": {\n              \"legend\": {\n                \"layout\": \"horizontal\",\n                \"align\": \"center\",\n                \"verticalAlign\": \"bottom\"\n              }\n            }\n          }]\n        }\n      },\n    \"gadgetOptions\": {\n        \"type\": \"chart\",\n        \"action\":true,\n        \"export\":false\n    }\n}\n      \n      ]\n}\n\n\n\nmsg.payload.gadgetsList.push({\n                           \"gadgetId\": \"73dc6735-b87f-9edb-e978-5a45b4b123cb\",\n  \"gadgetName\": \"basicOptions\",\n  \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                   \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                             \"language\": \"json\",\n    \"blockHeight\": 300\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"copy\": true\n  }\n})\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"BasicOptionsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"HighChart gadgetOptions.action and gadgetOptions.export\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1860,"y":840,"wires":[["28b40741.4093d8"]]},{"id":"2b186e9d.f6bcc2","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98","2404a9d0.5b5f76"],"x":1535,"y":1040,"wires":[["e8a314a2.f0f4f8"]]},{"id":"e8a314a2.f0f4f8","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":1040,"wires":[["de86a65d.9fdde8"]]},{"id":"2404a9d0.5b5f76","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","3874b9d6.27a156","9c4bc3dc.d17a3","662d87cc.7d0548","b1cbeef4.f75aa","e390b7db.feda78","f75f5c3b.2ccd8","2b186e9d.f6bcc2","2c91fdc1.3fbbe2","5aec6fcf.59ad6","a163f8e4.deac98","fee53b17.751c98","141a4fbd.7561e"],"x":3315,"y":900,"wires":[]},{"id":"2c91fdc1.3fbbe2","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98","2404a9d0.5b5f76"],"x":1535,"y":1120,"wires":[["503028b1.fac1c8"]]},{"id":"503028b1.fac1c8","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"708ad058-fbae-ef60-9bfb-8c211ad668f5\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Data table</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":1120,"wires":[["e01bb0c0.2e22"]]},{"id":"d2c6bd5c.fbe61","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"e0811593-2879-9c1d-d423-64392a45c7ac\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3430,"y":940,"wires":[["6838509.e41fcb"]]},{"id":"6838509.e41fcb","type":"link out","z":"9de255bd.0d0938","name":"","links":["ada94af4.e7ada8"],"x":3575,"y":940,"wires":[]},{"id":"bb35f8df.261f58","type":"link out","z":"9de255bd.0d0938","name":"","links":["ada94af4.e7ada8"],"x":3435,"y":860,"wires":[]},{"id":"5aec6fcf.59ad6","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98","2404a9d0.5b5f76"],"x":1535,"y":920,"wires":[["89cff6d0.a25278"]]},{"id":"89cff6d0.a25278","type":"function","z":"9de255bd.0d0938","name":"Basic Highchart, type= 'chart'","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n {\n  \"gadgetId\": \"7eaa8d7f-a0e4-2e23-49d3-392f16a1b5ff\",\n  \"gadgetName\": \"Basic Highchart, type= 'chart'\",\n  \"gadgetType\": \"highcharts\",\n    \"gadgetData\": {\n\n        \"title\": {\n            \"text\": \"Solar Employment Growth by Sector, 2010-2016\"\n        },\n\n        \"subtitle\": {\n            \"text\": \"Source: thesolarfoundation.com\"\n        },\n\n        \"yAxis\": {\n            \"title\": {\n                \"text\": \"Number of Employees\"\n            }\n        },\n\n        \"xAxis\": {\n            \"accessibility\": {\n                \"   \": \"Range: 2010 to 2017\"\n            }\n        },\n\n        \"legend\": {\n            \"layout\": \"vertical\",\n            \"align\": \"right\",\n            \"verticalAlign\": \"middle\"\n        },\n\n        \"plotOptions\": {\n            \"series\": {\n                \"label\": {\n                    \"connectorAllowed\": false\n                },\n                \"pointStart\": 2010\n            }\n        },\n\n        \"series\": [{\n            \"name\": \"Installation\",\n            \"data\": [43934, 52503, 57177, 69658, 97031, 119931, 137133, 154175]\n        }, {\n            \"name\": \"Manufacturing\",\n            \"data\": [24916, 24064, 29742, 29851, 32490, 30282, 38121, 40434]\n        }, {\n            \"name\": \"Sales & Distribution\",\n            \"data\": [11744, 17722, 16005, 19771, 20185, 24377, 32147, 39387]\n        }, {\n            \"name\": \"Project Development\",\n            \"data\": [null, null, 7988, 12169, 15112, 22452, 34400, 34227]\n        }, {\n            \"name\": \"Other\",\n            \"data\": [12908, 5948, 8105, 11248, 8989, 11816, 18274, 18111]\n        }],\n\n        \"responsive\": {\n            \"rules\": [{\n                \"condition\": {\n                    \"maxWidth\": 500\n                },\n                \"chartOptions\": {\n                    \"legend\": {\n                        \"layout\": \"horizontal\",\n                        \"align\": \"center\",\n                        \"verticalAlign\": \"bottom\"\n                    }\n                }\n            }]\n        }\n\n    },\n    \"gadgetOptions\": {\n        \"type\": \"chart\"\n    }\n}\n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"9a087433-9e18-6c38-7ff0-c8f7ced57e5e\",\n                              \"gadgetName\": \"designCode\",\n                              \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"c344f9a5-77ba-45c5-f39a-e28e5ce9ddb1\",\n                              \"gadgetName\": \"designDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic Highchart, type= 'chart'\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1770,"y":920,"wires":[["12b90b10.c7fb65"]]},{"id":"a163f8e4.deac98","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["8fd309c4.ea3d98","2404a9d0.5b5f76"],"x":1535,"y":960,"wires":[["6574ee9c.4c74b"]]},{"id":"6574ee9c.4c74b","type":"function","z":"9de255bd.0d0938","name":"GanttChart","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\nmsg.payload = {\n    gadgetsList:[\n \n{\n  \"gadgetId\": \"a483f026-d661-d139-fcad-631ccc01fdcd\",\n  \"gadgetName\": \"GanttChart\",\n  \"gadgetType\": \"highcharts\",\n  \"gadgetData\": {\n    \"title\": {\n      \"text\": \"Simple Gantt Chart\"\n    },\n    \"series\": [{\n      \"name\": \"Project 1\",\n      \"data\": [{\n          \"id\": \"s\",\n          \"name\": \"Start prototype\",\n          \"start\": 1619827200000,\n          \"end\": 1619913600000\n        },\n        {\n          \"id\": \"b\",\n          \"name\": \"Develop\",\n          \"start\": 1622419200000,\n          \"end\": 1619913600000,\n          \"dependency\": \"s\"\n        },\n        {\n          \"id\": \"a\",\n          \"name\": \"Run acceptance tests\",\n          \"start\": 1622246400000,\n          \"end\": 1619827200000\n        },\n        {\n          \"name\": \"Test prototype\",\n          \"start\": 1622246400000,\n          \"end\": 1622678400000,\n          \"dependency\": [\n            \"a\",\n            \"b\"\n          ]\n        }\n      ]\n    }]\n  },\n  \"gadgetOptions\": {\n    \"type\": \"ganttChart\"\n  }\n}\n      \n      ]\n}\n\n\n\n\nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"f70ebd01-4ed8-2b7c-7e29-918fcb2a43f7\",\n                              \"gadgetName\": \"advancedCode\",\n                              \"gadgetType\": \"code-block\",\n                              \"gadgetData\": {\n                                    \"content\": JSON.stringify(msg.payload.gadgetsList[0]),\n                                    \"language\": \"json\",\n                                    \"blockHeight\": 300\n                                  },\n                                  \"gadgetOptions\": {\n                                    \"disabled\": false,\n                                    \"copy\": true\n                                  }\n\n      \n                            })\n      \n                                 \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"1c60f788-c457-512a-a88a-c2e1c5c0e352\",\n                              \"gadgetName\": \"advancedDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"GanttChart\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } ) \n      \n      \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":960,"wires":[["5fc299e1.d7f0c8"]]},{"id":"edf40e53.d9006","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":800,"wires":[]},{"id":"28b40741.4093d8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":840,"wires":[]},{"id":"bde01cf1.830e7","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":880,"wires":[]},{"id":"12b90b10.c7fb65","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":920,"wires":[]},{"id":"5fc299e1.d7f0c8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":960,"wires":[]},{"id":"affb75c5.518788","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":1000,"wires":[]},{"id":"de86a65d.9fdde8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":1040,"wires":[]},{"id":"5e9a4860.70ac48","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":1080,"wires":[]},{"id":"e01bb0c0.2e22","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":1120,"wires":[]},{"id":"ba0ebc56.ea829","type":"comment","z":"9de255bd.0d0938","name":"modal","info":"","x":210,"y":2420,"wires":[]},{"id":"cb059ceb.8592a","type":"comment","z":"9de255bd.0d0938","name":"modal gagdet actions","info":"","x":3100,"y":2360,"wires":[]},{"id":"a943edb0.e8a78","type":"comment","z":"9de255bd.0d0938","name":"***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************","info":"","x":2550,"y":2320,"wires":[]},{"id":"96dd0d7.4db32f","type":"link in","z":"9de255bd.0d0938","name":"organization global - INIT FLOW","links":["5d57bad4.0cdff4","9a050e9a.e90288","3b858951.2c8d86","febed477.696398","ad7fa698.4ae5f8"],"x":855,"y":2540,"wires":[["20b85f2e.964fd","57cf6e32.051fc"]]},{"id":"fe996ebd.6f6e2","type":"function","z":"9de255bd.0d0938","name":"Route userAction","func":"var  MenuAction,resetPage, breadcrumb, modal;\nvar PostData    = msg.RevotioData.PostData;\nvar Page        = msg.RevotioData.session.Page;\n\n if (PostData.gadgetType=== \"Menu\"){\n    MenuAction = msg;\n}  else  if (PostData.gadgetName=== \"Reset page\"){\n    resetPage = msg;\n}  else  if (PostData.gadgetType=== \"dynamic-btn\"){\n    modal = msg;\n} else {\n    breadcrumb = msg\n}\n\n\n\n\n\n\nreturn [ MenuAction,resetPage, breadcrumb, modal];","outputs":4,"noerr":0,"initialize":"","finalize":"","x":3170,"y":2460,"wires":[["19486044.92948"],["d8fdbcda.b2b86"],["7023dce.bb92224"],["1479313a.7d19ff"]],"outputLabels":["MenuAction,,","resetPage","breadcrumb","modal"]},{"id":"b1f8508c.6731f","type":"debug","z":"9de255bd.0d0938","name":"modal Gadget post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3090,"y":2400,"wires":[]},{"id":"57cf6e32.051fc","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","bf5f49c7.292878","26c29dda.6daf62","cd9f1d1b.bf34","8988b899.179688","85310c42.5746a","662d87cc.7d0548","b1cbeef4.f75aa","5b8e39b2.5d0fc8","a54ef6e1.eda928","9c26e4ae.842b98","59b11152.4a686","50714a70.d38a54","3b742e62.808a42","fee53b17.751c98","141a4fbd.7561e"],"x":1235,"y":2540,"wires":[]},{"id":"e1acee0f.559a8","type":"comment","z":"9de255bd.0d0938","name":"INIT FLOW","info":"","x":820,"y":2500,"wires":[]},{"id":"20b85f2e.964fd","type":"debug","z":"9de255bd.0d0938","name":"modal INIT post","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":980,"y":2500,"wires":[]},{"id":"284315d3.8745ca","type":"link in","z":"9de255bd.0d0938","name":"organization global - GadgetAction","links":["ca484bde.d6efc8","b636d429.212c48","1e608bf7.bc0d64"],"x":3035,"y":2460,"wires":[["b1f8508c.6731f","fe996ebd.6f6e2"]]},{"id":"307f8e71.d90262","type":"link in","z":"9de255bd.0d0938","name":"organization global - design","links":["c98c548a.95f4b","ead712f3.5bdef8","48726931.25f288"],"x":815,"y":2440,"wires":[["8ee47e8d.813bf"]]},{"id":"5c748e89.33bde","type":"http response","z":"9de255bd.0d0938","name":"","statusCode":"","headers":{},"x":1390,"y":2440,"wires":[]},{"id":"7293043d.bdd29c","type":"function","z":"9de255bd.0d0938","name":"breadcrumbs -  design","func":"msg.topbarContanerId =  \"9e859d4a-16d7-fcf7-9c79-b828bbf1d262\"\n// msg.payload.design = {}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":2440,"wires":[["5784e3b9.c95b6c"]]},{"id":"2eb82001.90c39","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":820,"y":2400,"wires":[]},{"id":"bf5f49c7.292878","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["57cf6e32.051fc"],"x":1535,"y":2640,"wires":[["925cb67b.487e38"]]},{"id":"aef18e20.a4c95","type":"http in","z":"9de255bd.0d0938","name":"modal","url":"/modal","method":"post","upload":false,"swaggerDoc":"","x":270,"y":2480,"wires":[["b679ecdd.2d25"]]},{"id":"48726931.25f288","type":"link out","z":"9de255bd.0d0938","name":"","links":["307f8e71.d90262"],"x":555,"y":2440,"wires":[]},{"id":"ad7fa698.4ae5f8","type":"link out","z":"9de255bd.0d0938","name":"","links":["96dd0d7.4db32f"],"x":555,"y":2480,"wires":[]},{"id":"1e608bf7.bc0d64","type":"link out","z":"9de255bd.0d0938","name":"","links":["284315d3.8745ca"],"x":555,"y":2520,"wires":[]},{"id":"4c961bff.c64804","type":"comment","z":"9de255bd.0d0938","name":"INIT","info":"","x":630,"y":2480,"wires":[]},{"id":"9e803b99.4e85b8","type":"comment","z":"9de255bd.0d0938","name":"DESIGN","info":"","x":640,"y":2440,"wires":[]},{"id":"56ec310a.9e045","type":"comment","z":"9de255bd.0d0938","name":"ROUTE","info":"","x":630,"y":2520,"wires":[]},{"id":"8ee47e8d.813bf","type":"subflow:39834eee.0dd5a2","z":"9de255bd.0d0938","name":"","env":[],"x":920,"y":2440,"wires":[["7293043d.bdd29c"]]},{"id":"b679ecdd.2d25","type":"subflow:a55f7aee.572be","z":"9de255bd.0d0938","name":"","env":[],"x":430,"y":2480,"wires":[["48726931.25f288"],["ad7fa698.4ae5f8"],["1e608bf7.bc0d64"]],"outputLabels":["DESIGN ","INIT","ACTION"]},{"id":"19486044.92948","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":3360,"y":2420,"wires":[["7c2c84df.49433c"]]},{"id":"925cb67b.487e38","type":"subflow:152aab03.7a806d","z":"9de255bd.0d0938","name":"","env":[],"x":1700,"y":2640,"wires":[["4361d011.2170c"]]},{"id":"5784e3b9.c95b6c","type":"subflow:2ef93158.ae5276","z":"9de255bd.0d0938","name":"","env":[],"x":1240,"y":2440,"wires":[["5c748e89.33bde"]]},{"id":"8988b899.179688","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["57cf6e32.051fc","d8fdbcda.b2b86"],"x":1535,"y":2360,"wires":[["2c57dde5.8b7be2"]]},{"id":"2c57dde5.8b7be2","type":"function","z":"9de255bd.0d0938","name":"Basic","func":"msg.payload = {\n    gadgetsList:[\n       {\n                  \"gadgetId\": \"e23451d7-7fc6-6bbd-fdce-38c021daaf47\",\n                  \"gadgetName\": \"basic\",\n                  \"gadgetType\": \"dynamic-btn\",\n                                    \"gadgetOptions\": {\n                      \"dataType\": \"multiple\",\n                      \"displayType\": \"button\"\n                    },\n                  \"gadgetData\": {\n                    \"title\": \"Basic modals\",\n\n                    \"options\": [\n                      {\n                        \"title\": \"Basic Modal\",\n                        \"action\": \"Basic Modal\",\n                        \"actionType\": \"Basic Modal\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                       {\n                        \"title\": \"10 sec, outside click allowed\",\n                        \"action\": \"10 sec, outside click allowed\",\n                        \"actionType\": \"10 sec, outside click allowed\",\n                        \"design\": {\n                          \"icon\": \"timer\"\n                        }\n                      },\n                           {\n                        \"title\": \"10 sec, outside click NOT allowed\",\n                        \"action\": \"10 sec, outside click NOT allowed\",\n                        \"actionType\": \"10 sec, outside NOT click allowed\",\n                        \"design\": {\n                          \"icon\": \"timer\"\n                        }\n                      },\n                    ],\n              \n                  }\n                }\n      \n      \n      ]\n}\n\n                            \nmsg.payload.gadgetsList.push({\n                              \"gadgetId\": \"5e15dabf-ddbc-c1e6-7b65-cff1e60b1881\",\n                              \"gadgetName\": \"BasicTitle\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Basic\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":2360,"wires":[["94e2d649.66f048"]]},{"id":"a54ef6e1.eda928","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["57cf6e32.051fc","d8fdbcda.b2b86"],"x":1535,"y":2460,"wires":[["6e785e8b.10502"]]},{"id":"6e785e8b.10502","type":"function","z":"9de255bd.0d0938","name":"Display","func":"msg.payload = {\n    gadgetsList:[\n       {\n  \"gadgetId\": \"96da405c-f5bb-1c8f-3d79-44bc085a9181\",\n  \"gadgetName\": \"display\",\n  \"gadgetType\": \"dynamic-btn\",\n                   \"gadgetOptions\": {\n                          \"dataType\": \"multiple\",\n                          \"displayType\": \"button\"\n                        },\n                  \"gadgetData\": {\n                    \"title\": \"Display modals\",\n\n                    \"options\": [\n                      {\n                        \"title\": \"No close button\",\n                        \"action\": \"No close button\",\n                        \"actionType\": \"No close button\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                       {\n                        \"title\": \"modalStatus: show\",\n                        \"action\": \"modalStatus: show\",\n                        \"actionType\": \"modalStatus: show\",\n                        \"design\": {\n                          \"icon\": \"timer\"\n                        }\n                      },\n                           {\n                        \"title\": \"fullscreen\",\n                        \"action\": \"fullscreen\",\n                        \"actionType\": \"fullscreen\",\n                        \"design\": {\n                          \"icon\": \"timer\"\n                        }\n                      },\n                      // positions\n                             {\n                        \"title\": \"position = left\",\n                        \"action\":\"position = left\",\n                        \"actionType\": \"position = left\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                                      {\n                        \"title\": \"position = right\",\n                        \"action\":\"position = right\",\n                        \"actionType\": \"position = right\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                                     {\n                        \"title\": \"position = top\",\n                        \"action\":\"position = top\",\n                        \"actionType\": \"position = top\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                                     {\n                        \"title\": \"position = topLeft\",\n                        \"action\":\"position = topLeft\",\n                        \"actionType\": \"position = topLeft\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                                     {\n                        \"title\": \"position = topRight\",\n                        \"action\":\"position = topRight\",\n                        \"actionType\": \"position = topRight\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                                     {\n                        \"title\": \"position = bottom\",\n                        \"action\":\"position = bottom\",\n                        \"actionType\": \"position = bottom\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                                     {\n                        \"title\": \"position = bottomRight\",\n                        \"action\":\"position = bottomRight\",\n                        \"actionType\": \"position = bottomRight\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                                     {\n                        \"title\": \"position = bottomLeft\",\n                        \"action\":\"position = bottomLeft\",\n                        \"actionType\": \"position = bottomLeft\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                                     {\n                        \"title\": \"position = center\",\n                        \"action\":\"position = center\",\n                        \"actionType\": \"position = center\",\n                        \"design\": {\n                          \"icon\": \"home\"\n                        }\n                      },\n                    ],\n              \n                  }\n                }\n      \n      \n      ]\n}\n\n          \n\n\n                            \n                            \nmsg.payload.gadgetsList.push({\n                             \"gadgetId\": \"1a6356ca-e51f-308d-1e63-0fc2ecbcec2f\",\n                              \"gadgetName\": \"BasicOptionsDivider\",\n                              \"gadgetType\": \"divider\",\n                              \"gadgetData\": {\n                                \"borderStyle\": \"solid\",\n                                \"position\": \"left-center\",\n                                \"icon\": \"bookmark\",\n                                \"iconSize\": \"40\",\n                                \"background\": \"transparent\",\n                                \"title\": \"Display\",\n                                \"textTag\": \"h2\",\n                                \"color\": \"primary\"\n                              },\n                              \"gadgetOptions\": {\n                                \"disabled\": false\n                              }\n                            } )\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":2460,"wires":[["dddda585.ca8dc8"]]},{"id":"9c26e4ae.842b98","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["57cf6e32.051fc","d8fdbcda.b2b86"],"x":1535,"y":2600,"wires":[["299ed9b8.569656"]]},{"id":"299ed9b8.569656","type":"function","z":"9de255bd.0d0938","name":"resetPage","func":"msg.payload = {\n    gadgetsList:[\n      \n       {\n  \"gadgetId\": \"6cc169f8-bc77-cb3f-c5b9-3a2a4f0ad86d\",\n  \"gadgetName\": \"Reset page\",\n  \"gadgetType\": \"dynamic-btn\",\n  \"gadgetOptions\": {\n    \"dataType\": \"single\",\n    \"displayType\": \"button\"\n  },\n  \"gadgetData\": {\n    \"title\": \"Reset page\",\n    \n    \"design\": {\n \"color\": \"#A9A9A9\",\n      \"icon\": \"reload\"\n    },\n    \"action\": \"page reset\",\n    \"actionType\": \"button\",\n   \n  }\n}\n      \n      ]\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1700,"y":2600,"wires":[["cf641bf8.a672c8"]]},{"id":"d8fdbcda.b2b86","type":"link out","z":"9de255bd.0d0938","name":"Trigger gadgets","links":["1198ab94.12521c","6dd9e005.08317","15313496.c9b06b","6adedbdb.e70694","e714ad41.62fe18","26c29dda.6daf62","cd9f1d1b.bf34","8988b899.179688","85310c42.5746a","662d87cc.7d0548","b1cbeef4.f75aa","5b8e39b2.5d0fc8","a54ef6e1.eda928","9c26e4ae.842b98","59b11152.4a686","50714a70.d38a54","3b742e62.808a42","fee53b17.751c98","141a4fbd.7561e"],"x":3315,"y":2460,"wires":[]},{"id":"59b11152.4a686","type":"link in","z":"9de255bd.0d0938","name":"** Gadget Name **","links":["57cf6e32.051fc","d8fdbcda.b2b86"],"x":1535,"y":2680,"wires":[["b8521672.85a478"]]},{"id":"b8521672.85a478","type":"function","z":"9de255bd.0d0938","name":"title","func":"msg.payload = {\n    gadgetsList:[\n\n       {\n  \"gadgetId\": \"708ad058-fbae-ef60-9bfb-8c211ad668f5\",\n  \"gadgetName\": \"Title\",\n  \"gadgetType\": \"wysiwyg\",\n  \"gadgetData\": {\n    \"content\": '<h1 style=\"text-align: center; font-size: 96px;\"><span style=\"text-decoration: underline;\"><strong>Data table</strong></span></h1>'\n  },\n  \"gadgetOptions\": {\n    \"disabled\": false,\n    \"canEdit\": false,\n    \"editor\": \"froala\"\n  }\n}\n      \n      ]\n}\n\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1690,"y":2680,"wires":[["2e458b45.51c7e4"]]},{"id":"7023dce.bb92224","type":"function","z":"9de255bd.0d0938","name":"Add to confirmation win window","func":"\nmsg.payload = { gadgetsList :[ {\n            \"gadgetId\":  \"1db1d21f-04ee-80fe-c48f-d5bb0d99039b\",\n            \"gadgetName\": \"actionConfirmationModal\",\n            \"gadgetType\": \"dynamic-modal\",\n            \"gadgetData\": {\"modalStatus\":\"show\"}},\n            \n       {\n                  \"gadgetId\": \"e0811593-2879-9c1d-d423-64392a45c7ac\",\n                  \"gadgetName\": \"actionPost\",\n                  \"gadgetType\": \"code-block\",\n                  \"gadgetData\": {\n                    \"content\": msg.RevotioData.PostData,\n                    \"language\": \"json\",\n                    \"blockHeight\": \"auto\"\n                  },\n                  \"gadgetOptions\": {\n                    \"disabled\": false,\n                    \"copy\": false\n                  }\n                }\n                      ]}\n\n  \n// gadgetsList.push(\n//       {\n//   \"gadgetData\": {\n//     \"data\": msg.data,\n//     \"options\": {\"number-columns\":1}\n//   },\n//   \"gadgetOptions\":{\n//       \"options\": {\n//             \"label\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             },\n//             \"value\": {\n//               \"textWeight\": \"hairline\",\n//               \"italic\": false,\n//               \"size\": \"xs\"\n//             }\n//       }\n//   },\n//   \"gadgetId\": \"f37b93a0-4546-8be4-92b8-3c494fdd8f30\",\n//   \"gadgetName\": \"actionConfirmationText\",\n//   \"gadgetType\": \"dynamic-text-area\"\n// }\n//       )\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3430,"y":2500,"wires":[["144c0757.249a79"]]},{"id":"144c0757.249a79","type":"link out","z":"9de255bd.0d0938","name":"","links":["ada94af4.e7ada8"],"x":3575,"y":2500,"wires":[]},{"id":"7c2c84df.49433c","type":"link out","z":"9de255bd.0d0938","name":"","links":["ada94af4.e7ada8"],"x":3435,"y":2420,"wires":[]},{"id":"94e2d649.66f048","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":2360,"wires":[]},{"id":"dddda585.ca8dc8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":2460,"wires":[]},{"id":"cf641bf8.a672c8","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":2600,"wires":[]},{"id":"4361d011.2170c","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":2640,"wires":[]},{"id":"2e458b45.51c7e4","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":2395,"y":2680,"wires":[]},{"id":"1479313a.7d19ff","type":"function","z":"9de255bd.0d0938","name":"modal payload","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3370,"y":2540,"wires":[["bfa0a56b.25cf28"]]},{"id":"bfa0a56b.25cf28","type":"link out","z":"9de255bd.0d0938","name":"","links":["14bb20e8.503a5f"],"x":3475,"y":2540,"wires":[]},{"id":"67297d5e.1f59a4","type":"function","z":"22428f45.8ab","name":"Decrypt httpcall","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// With a callback:\npayloadData = msg.payload\n\n\n\nif (typeof msg.payload === \"string\"){\n    data = msg.payload\n} else if (typeof msg.payload === \"object\" && msg.payload.hasOwnProperty(\"postData\")){\n    data = msg.payload.postData\n} else {\n    data = msg.payload\n}\n\n\n// verify a token symmetric\n    jsonwebtoken.verify(data, global.get(\"SystemVars.tokenSecret\"), function(err, decoded) {\n      if (decoded !== undefined){\n          \n          msg.payload  = decoded\n          msg.state = \"valid\"\n      } else {\n          \n          msg.state = \"error\"\n      }\n    });\n    \n    // node.warn({\n    //     payloadData:payloadData,\n    //     packageObj:packageObj,\n    //     payload : msg.payload\n    // })\n    \n  node.send(msg)\n  \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":1060,"wires":[["e4d2623c.ef712"]]},{"id":"e4d2623c.ef712","type":"function","z":"22428f45.8ab","name":"","func":"var error, valid;\n    msg.payload.state = msg.state\nif (msg.state === \"error\"){\n\n    error = msg;\n} else {\n    valid = msg;\n}\nreturn [error, valid];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":340,"y":1060,"wires":[["61a99bc5.43e124"],["57ab671a.bbe478"]],"outputLabels":["error","valid"]},{"id":"61a99bc5.43e124","type":"http response","z":"22428f45.8ab","name":"","statusCode":"","headers":{},"x":470,"y":1020,"wires":[]},{"id":"7f9dfbf6.4ce354","type":"function","z":"22428f45.8ab","name":"encrypt response","func":"var request = global.get('request');\nvar Moment = global.get('moment');\nvar MomentRange = global.get('momentrange');\nvar moment = MomentRange.extendMoment(Moment)\nvar crypto = global.get('crypto');\nvar momentTimezone = global.get('moment_timezone');\nvar lodash = global.get('lodash');\nvar _ = global.get('underscore');\nvar BSON = global.get('bson');\nvar ObjectID = BSON.ObjectID;\nvar accounting = global.get('accounting');\nvar accountingoptions = {\tsymbol : \"€\",\tdecimal : \".\", \tthousand: \" \", \tprecision : 0, \tformat: \"%s %v\"}; // example = Output = accounting.formatMoney(Number, accountingoptions );\nvar jsonwebtoken = global.get('jsonwebtoken');\nvar mongodbTools = global.get('mongodbTools');\nvar excelToJson = global.get('excelToJson');\nvar Excel = global.get('exceljs');\nvar fs = global.get('fsextra');\nvar xml2js = global.get('xml2js');\nvar json2xls = global.get('json2xls');\nvar nodemailer = global.get('nodemailer');\nvar mg = global.get('nodemailer_mailgun_transport');\n\n// With a callback:\n\n\n\n\ndata = msg.payload\n\n\n        // verify a token symmetric\n        msg.payload =  jsonwebtoken.sign(msg.payload,global.get(\"SystemVars.tokenSecret\")) \n    \n        // node.warn({\n        //     packageObj:packageObj,\n        //     payload : msg.payload,\n        //     data:data\n        // })\n  node.send(msg)\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1210,"y":1100,"wires":[["21e2fb63.940c44"]]},{"id":"95ad1aec.c05398","type":"debug","z":"22428f45.8ab","name":"TOKEN post","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1250,"y":1160,"wires":[]}]